{
  "issue_number": 13127.0,
  "title": "[CRASH] Guru Meditation: Unknown object type #rdb.c:669",
  "body": "**Crash report**\r\n\r\n```\r\n538912:C 09 Mar 2024 09:44:19.056 * RDB: 14 MB of memory used by copy-on-write\r\n152693:M 09 Mar 2024 09:44:19.201 * Background saving terminated with success\r\n152693:M 09 Mar 2024 09:49:20.047 * 10 changes in 300 seconds. Saving...\r\n152693:M 09 Mar 2024 09:49:20.136 * Background saving started by pid 538951\r\n538951:C 09 Mar 2024 09:49:45.068 * DB saved on disk\r\n538951:C 09 Mar 2024 09:49:45.139 * RDB: 30 MB of memory used by copy-on-write\r\n152693:M 09 Mar 2024 09:49:45.329 * Background saving terminated with success\r\n152693:M 09 Mar 2024 09:54:46.028 * 10 changes in 300 seconds. Saving...\r\n152693:M 09 Mar 2024 09:54:46.117 * Background saving started by pid 538990\r\n538990:C 09 Mar 2024 09:54:57.495 * DB saved on disk\r\n538990:C 09 Mar 2024 09:54:57.563 * RDB: 11 MB of memory used by copy-on-write\r\n152693:M 09 Mar 2024 09:54:57.653 * Background saving terminated with success\r\n152693:M 09 Mar 2024 09:59:58.075 * 10 changes in 300 seconds. Saving...\r\n152693:M 09 Mar 2024 09:59:58.165 * Background saving started by pid 539030\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n539030:C 09 Mar 2024 10:00:00.008 # ------------------------------------------------\r\n539030:C 09 Mar 2024 10:00:00.008 # !!! Software Failure. Press left mouse button to continue\r\n539030:C 09 Mar 2024 10:00:00.008 # Guru Meditation: Unknown object type #rdb.c:669\r\n539030:C 09 Mar 2024 10:00:00.008 # (forcing SIGSEGV in order to print the stack trace)\r\n539030:C 09 Mar 2024 10:00:00.008 # ------------------------------------------------\r\n539030:C 09 Mar 2024 10:00:00.008 # Redis 6.0.16 crashed by signal: 11, si_code: 1\r\n539030:C 09 Mar 2024 10:00:00.008 # Crashed running the instruction at: 0x5590c8cfc46c\r\n539030:C 09 Mar 2024 10:00:00.008 # Accessing address: 0xffffffffffffffff\r\n539030:C 09 Mar 2024 10:00:00.008 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\nredis-rdb-bgsave 127.0.0.1:6379(_serverPanic+0x14c)[0x5590c8cfc46c]\r\n\r\nBacktrace:\r\nredis-rdb-bgsave 127.0.0.1:6379(logStackTrace+0x5c)[0x5590c8cfa83c]\r\nredis-rdb-bgsave 127.0.0.1:6379(sigsegvHandler+0xd0)[0x5590c8cfd320]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x42520)[0x7f21f5a57520]\r\nredis-rdb-bgsave 127.0.0.1:6379(_serverPanic+0x14c)[0x5590c8cfc46c]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveObjectType+0x1e3)[0x5590c8cc6943]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveKeyValuePair+0x60)[0x5590c8ccce90]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveRio+0x25d)[0x5590c8ccd28d]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSave+0x117)[0x5590c8ccd8c7]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveBackground+0xf3)[0x5590c8ccdbe3]\r\nredis-rdb-bgsave 127.0.0.1:6379(serverCron+0x6ff)[0x5590c8c9cd2f]\r\nredis-rdb-bgsave 127.0.0.1:6379(aeProcessEvents+0x477)[0x5590c8c93ca7]\r\nredis-rdb-bgsave 127.0.0.1:6379(aeMain+0x1d)[0x5590c8c93edd]\r\nredis-rdb-bgsave 127.0.0.1:6379(main+0x466)[0x5590c8c8f5f6]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x29d90)[0x7f21f5a3ed90]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x80)[0x7f21f5a3ee40]\r\nredis-rdb-bgsave 127.0.0.1:6379(_start+0x25)[0x5590c8c8f9d5]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.16\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:a3fdef44459b3ad6\r\nredis_mode:standalone\r\nos:Linux 5.15.0-100-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:11.2.0\r\nprocess_id:539030\r\nrun_id:f3c11c529316b49dacfae5dbf2a6f692ce6f06b9\r\ntcp_port:6379\r\nuptime_in_seconds:902776\r\nuptime_in_days:10\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:15468782\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_recent_max_input_buffer:40960\r\nclient_recent_max_output_buffer:20504\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n\r\n# Memory\r\nused_memory:2147145520\r\nused_memory_human:2.00G\r\nused_memory_rss:2349441024\r\nused_memory_rss_human:2.19G\r\nused_memory_peak:2213792816\r\nused_memory_peak_human:2.06G\r\nused_memory_peak_perc:96.99%\r\nused_memory_overhead:33957936\r\nused_memory_startup:809688\r\nused_memory_dataset:2113187584\r\nused_memory_dataset_perc:98.46%\r\nallocator_allocated:2149015288\r\nallocator_active:2310848512\r\nallocator_resident:2349686784\r\ntotal_system_memory:32519483392\r\ntotal_system_memory_human:30.29G\r\nused_memory_lua:1177600\r\nused_memory_lua_human:1.12M\r\nused_memory_scripts:232\r\nused_memory_scripts_human:232B\r\nnumber_of_cached_scripts:1\r\nmaxmemory:2147483648\r\nmaxmemory_human:2.00G\r\nmaxmemory_policy:allkeys-lru\r\nallocator_frag_ratio:1.08\r\nallocator_frag_bytes:161833224\r\nallocator_rss_ratio:1.02\r\nallocator_rss_bytes:38838272\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:-245760\r\nmem_fragmentation_ratio:1.09\r\nmem_fragmentation_bytes:202297056\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.2.1\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:7425\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1709967297\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:11\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:12197888\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:7642451\r\ntotal_commands_processed:512781344\r\ninstantaneous_ops_per_sec:98\r\ntotal_net_input_bytes:529670311736\r\ntotal_net_output_bytes:2727120476161\r\ninstantaneous_input_kbps:121.13\r\ninstantaneous_output_kbps:660.95\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:599830\r\nexpired_stale_perc:0.14\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:131722\r\nevicted_keys:27458547\r\nkeyspace_hits:791007429\r\nkeyspace_misses:115909222\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:89648\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:439100208\r\ntotal_writes_processed:422699329\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:06998fd1f209f0a8d0fe1696f933e16cd2b55619\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.112500\r\nused_cpu_user:1.418312\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_ping:calls=1718956,usec=5370834,usec_per_call=3.12\r\ncmdstat_mget:calls=75026149,usec=1594634959,usec_per_call=21.25\r\ncmdstat_zremrangebyscore:calls=251,usec=2820620,usec_per_call=11237.53\r\ncmdstat_get:calls=266235121,usec=1987156090,usec_per_call=7.46\r\ncmdstat_del:calls=750050,usec=1166131572,usec_per_call=1554.74\r\ncmdstat_expire:calls=1298874,usec=16763276,usec_per_call=12.91\r\ncmdstat_info:calls=1718956,usec=130415427,usec_per_call=75.87\r\ncmdstat_setex:calls=1496905,usec=15882371,usec_per_call=10.61\r\ncmdstat_select:calls=4624500,usec=17582859,usec_per_call=3.80\r\ncmdstat_zrangebyscore:calls=510,usec=3340846,usec_per_call=6550.68\r\ncmdstat_zadd:calls=1718935,usec=41542308,usec_per_call=24.17\r\ncmdstat_keys:calls=1,usec=112823,usec_per_call=112823.00\r\ncmdstat_set:calls=158192135,usec=828164722,usec_per_call=5.24\r\ncmdstat_eval:calls=1,usec=174770,usec_per_call=174770.00\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=603425,expires=15011,avg_ttl=8309983\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n539030:C 09 Mar 2024 10:00:00.012 #\r\nRAX:0000000000000000 RBX:000000000000029d\r\nRCX:0000000000000001 RDX:ffffffffffffe7b8\r\nRDI:00007f21f61dd040 RSI:00007f21f660b938\r\nRBP:00005590c8d819c0 RSP:00007ffce3bdd900\r\nR8 :00007f21f52008c0 R9 :0000000000000200\r\nR10:0000000000000008 R11:00007f21f660d000\r\nR12:00005590c8d796da R13:00007ffce3bdd920\r\nR14:00007f21f50b1000 R15:000000000086967f\r\nRIP:00005590c8cfc46c EFL:0000000000010206\r\nCSGSFS:002b000000000033\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90f) -> 00000000000002c0\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90e) -> 00007f21ee8d7200\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90d) -> 00007f21f5aa0665\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90c) -> 0000000000000002\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90b) -> 00007f21f5aa19e1\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd90a) -> 00007f21e7865ba6\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd909) -> 00007f21f5aa2e6c\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd908) -> 0000000000001000\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd907) -> 00007f21ee8d7200\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd906) -> 0000000000657079\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd905) -> 74207463656a626f\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd904) -> 206e776f6e6b6e55\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd903) -> 0000000000001000\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd902) -> 00007ffce3bdda30\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd901) -> 00007ffce3bddb10\r\n539030:C 09 Mar 2024 10:00:00.012 # (00007ffce3bdd900) -> 0000003000000018\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n539030:C 09 Mar 2024 10:00:00.012 # Bio thread for job type #0 terminated\r\n152693:M 09 Mar 2024 10:01:29.649 # Background saving terminated by signal 11\r\n152693:M 09 Mar 2024 10:01:29.749 * 10 changes in 300 seconds. Saving...\r\n152693:M 09 Mar 2024 10:01:29.836 * Background saving started by pid 539081\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n539081:C 09 Mar 2024 10:01:32.174 # ------------------------------------------------\r\n539081:C 09 Mar 2024 10:01:32.174 # !!! Software Failure. Press left mouse button to continue\r\n539081:C 09 Mar 2024 10:01:32.174 # Guru Meditation: Unknown object type #rdb.c:669\r\n539081:C 09 Mar 2024 10:01:32.174 # (forcing SIGSEGV in order to print the stack trace)\r\n539081:C 09 Mar 2024 10:01:32.174 # ------------------------------------------------\r\n539081:C 09 Mar 2024 10:01:32.174 # Redis 6.0.16 crashed by signal: 11, si_code: 1\r\n539081:C 09 Mar 2024 10:01:32.174 # Crashed running the instruction at: 0x5590c8cfc46c\r\n539081:C 09 Mar 2024 10:01:32.174 # Accessing address: 0xffffffffffffffff\r\n539081:C 09 Mar 2024 10:01:32.174 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\nredis-rdb-bgsave 127.0.0.1:6379(_serverPanic+0x14c)[0x5590c8cfc46c]\r\n\r\nBacktrace:\r\nredis-rdb-bgsave 127.0.0.1:6379(logStackTrace+0x5c)[0x5590c8cfa83c]\r\nredis-rdb-bgsave 127.0.0.1:6379(sigsegvHandler+0xd0)[0x5590c8cfd320]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x42520)[0x7f21f5a57520]\r\nredis-rdb-bgsave 127.0.0.1:6379(_serverPanic+0x14c)[0x5590c8cfc46c]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveObjectType+0x1e3)[0x5590c8cc6943]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveKeyValuePair+0x60)[0x5590c8ccce90]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveRio+0x25d)[0x5590c8ccd28d]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSave+0x117)[0x5590c8ccd8c7]\r\nredis-rdb-bgsave 127.0.0.1:6379(rdbSaveBackground+0xf3)[0x5590c8ccdbe3]\r\nredis-rdb-bgsave 127.0.0.1:6379(serverCron+0x6ff)[0x5590c8c9cd2f]\r\nredis-rdb-bgsave 127.0.0.1:6379(aeProcessEvents+0x477)[0x5590c8c93ca7]\r\nredis-rdb-bgsave 127.0.0.1:6379(aeMain+0x1d)[0x5590c8c93edd]\r\nredis-rdb-bgsave 127.0.0.1:6379(main+0x466)[0x5590c8c8f5f6]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x29d90)[0x7f21f5a3ed90]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x80)[0x7f21f5a3ee40]\r\nredis-rdb-bgsave 127.0.0.1:6379(_start+0x25)[0x5590c8c8f9d5]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.16\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:a3fdef44459b3ad6\r\nredis_mode:standalone\r\nos:Linux 5.15.0-100-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:11.2.0\r\nprocess_id:539081\r\nrun_id:f3c11c529316b49dacfae5dbf2a6f692ce6f06b9\r\ntcp_port:6379\r\nuptime_in_seconds:902867\r\nuptime_in_days:10\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:15468873\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:2\r\nclient_recent_max_input_buffer:917504\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:2144686192\r\nused_memory_human:2.00G\r\nused_memory_rss:2349576192\r\nused_memory_rss_human:2.19G\r\nused_memory_peak:2213792816\r\nused_memory_peak_human:2.06G\r\nused_memory_peak_perc:96.88%\r\nused_memory_overhead:33961320\r\nused_memory_startup:809688\r\nused_memory_dataset:2110724872\r\nused_memory_dataset_perc:98.45%\r\nallocator_allocated:2146554184\r\nallocator_active:2311208960\r\nallocator_resident:2349600768\r\ntotal_system_memory:32519483392\r\ntotal_system_memory_human:30.29G\r\nused_memory_lua:1177600\r\nused_memory_lua_human:1.12M\r\nused_memory_scripts:232\r\nused_memory_scripts_human:232B\r\nnumber_of_cached_scripts:1\r\nmaxmemory:2147483648\r\nmaxmemory_human:2.00G\r\nmaxmemory_policy:allkeys-lru\r\nallocator_frag_ratio:1.08\r\nallocator_frag_bytes:164654776\r\nallocator_rss_ratio:1.02\r\nallocator_rss_bytes:38391808\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:-24576\r\nmem_fragmentation_ratio:1.10\r\nmem_fragmentation_bytes:204850600\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:40992\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.2.1\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:9279\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1709967297\r\nrdb_last_bgsave_status:err\r\nrdb_last_bgsave_time_sec:91\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:12197888\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:7643019\r\ntotal_commands_processed:512816665\r\ninstantaneous_ops_per_sec:582\r\ntotal_net_input_bytes:529706875997\r\ntotal_net_output_bytes:2727312640497\r\ninstantaneous_input_kbps:512.04\r\ninstantaneous_output_kbps:1899.72\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:599891\r\nexpired_stale_perc:0.77\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:131736\r\nevicted_keys:27461006\r\nkeyspace_hits:791061210\r\nkeyspace_misses:115916979\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:89332\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:439130686\r\ntotal_writes_processed:422728467\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:06998fd1f209f0a8d0fe1696f933e16cd2b55619\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.088005\r\nused_cpu_user:1.388093\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_ping:calls=1719081,usec=5371217,usec_per_call=3.12\r\ncmdstat_mget:calls=75031521,usec=1594741803,usec_per_call=21.25\r\ncmdstat_zremrangebyscore:calls=251,usec=2820620,usec_per_call=11237.53\r\ncmdstat_get:calls=266253659,usec=1987299375,usec_per_call=7.46\r\ncmdstat_del:calls=750053,usec=1166131591,usec_per_call=1554.73\r\ncmdstat_expire:calls=1298958,usec=16764642,usec_per_call=12.91\r\ncmdstat_info:calls=1719081,usec=130424804,usec_per_call=75.87\r\ncmdstat_setex:calls=1496974,usec=15883160,usec_per_call=10.61\r\ncmdstat_select:calls=4624859,usec=17584307,usec_per_call=3.80\r\ncmdstat_zrangebyscore:calls=510,usec=3340846,usec_per_call=6550.68\r\ncmdstat_zadd:calls=1719059,usec=41546349,usec_per_call=24.17\r\ncmdstat_keys:calls=1,usec=112823,usec_per_call=112823.00\r\ncmdstat_set:calls=158202657,usec=828225896,usec_per_call=5.24\r\ncmdstat_eval:calls=1,usec=174770,usec_per_call=174770.00\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=602480,expires=15019,avg_ttl=8353182\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=7643021 addr=127.0.0.1:46604 fd=10 name= age=0 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20504 events=r cmd=get user=default\r\nid=7643022 addr=127.0.0.1:46608 fd=8 name= age=0 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20488 events=r cmd=NULL user=default\r\n\r\n------ REGISTERS ------\r\n539081:C 09 Mar 2024 10:01:32.175 #\r\nRAX:0000000000000000 RBX:000000000000029d\r\nRCX:0000000000000001 RDX:ffffffffffffe7b8\r\nRDI:00007f21f61dd040 RSI:00007f21f660b938\r\nRBP:00005590c8d819c0 RSP:00007ffce3bdd900\r\nR8 :00007f21f52008c0 R9 :0000000000000200\r\nR10:0000000000000008 R11:00007f21f660d000\r\nR12:00005590c8d796da R13:00007ffce3bdd920\r\nR14:00007f21f50b1000 R15:00000000008696da\r\nRIP:00005590c8cfc46c EFL:0000000000010206\r\nCSGSFS:002b000000000033\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90f) -> 00000000000000f9\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90e) -> 00007f21ed2b4000\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90d) -> 00007f21f5aa0665\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90c) -> 00007ffce3bdd9ae\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90b) -> 00007f21f5aa19e1\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd90a) -> 00007f21d739f436\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd909) -> 00007f21f5aa2e6c\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd908) -> 0000000000001000\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd907) -> 00007f21ed2b4000\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd906) -> 0000000000657079\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd905) -> 74207463656a626f\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd904) -> 206e776f6e6b6e55\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd903) -> 0000000000001000\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd902) -> 00007ffce3bdda30\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd901) -> 00007ffce3bddb10\r\n539081:C 09 Mar 2024 10:01:32.175 # (00007ffce3bdd900) -> 0000003000000018\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n539081:C 09 Mar 2024 10:01:32.175 # Bio thread for job type #0 terminated\r\n152693:M 09 Mar 2024 10:01:32.446 # Background saving terminated by signal 11\r\n152693:M 09 Mar 2024 10:01:35.061 * 10 changes in 300 seconds. Saving...\r\n152693:M 09 Mar 2024 10:01:35.150 * Background saving started by pid 539083\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n539083:C 09 Mar 2024 10:01:36.804 # ------------------------------------------------\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version\r\nUbuntu 22.04.4 LTS\r\n\r\n2. Steps to reproduce (if any)\r\n\r\nThe setup is the following:\r\n\r\nWordpress site with plugins redis-object-cache (for caching DB queries), nginx-helper (for clearing page cache on page edit)\r\n\r\nnginx with sr-cache module, MariaDB, redis",
  "state": "open",
  "created_at": "2024-03-11T10:40:54Z",
  "updated_at": "2024-03-13T02:37:00Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1988176642,
      "user": "DeeKey",
      "created_at": "2024-03-11T11:03:41Z",
      "body": "Also noticed the following errors:\r\n\r\nTP/1.1\", upstream: \"fastcgi://unix:/run/php/php8.1-fpm.sock:\", host: \"www.hidden\"\r\n2024/03/09 11:07:43 [error] 530938#530938: *8978459 FastCGI sent in stderr: \"PHP message: Predis\\Response\\ServerException: MISCONF Redis is configured to save RDB snapshots, but it is currently not able to persist on disk. Commands that may modify the data set are disabled, because this instance is configured to report errors during writes if RDB snapshotting fails (stop-writes-on-bgsave-error option). Please check the Redis logs for details about the RDB error. in /hidden/wp-content/plugins/redis-cache/dependencies/predis/predis/src/Client.php:384\r\n\r\nsyslog\r\n\r\nMar  9 10:00:00 server kernel: [1247337.804079] redis-server[539030]: segfault at 7f21f4115910 ip 00007f21f5aa7bdd sp 00007ffce3bdd140 error 4 in libc.so.6[7f21f5a3d000+195000]\r\nMar  9 10:00:00 server kernel: [1247337.804374] Code: 08 5b 5d c3 66 0f 1f 84 00 00 00 00 00 f3 0f 1e fa 55 48 81 ec a0 00 00 00 64 48 8b 04 25 28 00 00 00 48 89 84 24 98 00 00 00 <8b> 87 d0 02 00 00 85 c0 75 29 48 8b 84 24 98 00 00 00 64 48 2b 04\r\n"
    },
    {
      "id": 1988404798,
      "user": "sundb",
      "created_at": "2024-03-11T13:09:02Z",
      "body": "@DeeKey seems that the rdb is corrupted, can you use `redis-check-rdb` to check it?"
    },
    {
      "id": 1991344844,
      "user": "DeeKey",
      "created_at": "2024-03-12T10:45:59Z",
      "body": "There is definitely something strange happening in the system.\r\nWhen doing backup with rsync had a bunch of errors like:\r\n`rsync: [sender] readlink_stat(\"/home/768x768.jpg\") failed: Bad message (74)`\r\nUpon examination turns out that it was not possible to read or delete these files. After reboot these files were accessible without any problems. Also few times had problems with dadlock processes. The process was hanging marked with D state. It was not possible to kill the process. Full RAM and disk tests showed no anomaly.\r\n\r\nCurrently there are two files:\r\n```\r\n/var/lib/redis# ls -la\r\ntotal 810632\r\ndrwxr-x---  2 redis redis      4096 Mar 12 13:35 .\r\ndrwxr-xr-x 54 root  root       4096 May 31  2023 ..\r\n-rw-rw----  1 redis redis 726848361 Mar 12 13:35 dump.rdb\r\n-rw-rw----  1 redis redis 103223282 Mar  9 11:09 temp-152693.rdb\r\n\r\n\r\n# redis-check-rdb temp-152693.rdb \r\n \r\n[offset 0] Checking RDB file temp-152693.rdb\r\n[offset 27] AUX FIELD redis-ver = '6.0.16'\r\n[offset 41] AUX FIELD redis-bits = '64'\r\n[offset 53] AUX FIELD ctime = '1709971786'\r\n[offset 68] AUX FIELD used-mem = '1884522816'\r\n[offset 84] AUX FIELD aof-preamble = '0'\r\n[offset 86] Selecting DB ID 0\r\n--- RDB ERROR DETECTED ---\r\n[offset 103223244] Unexpected EOF reading RDB file\r\n[additional info] While doing: read-object-value\r\n[additional info] Reading key 'asi:terms:11348'\r\n[additional info] Reading type 0 (string)\r\n[info] 98014 keys read\r\n[info] 1897 expires\r\n[info] 1897 already expired\r\n\r\n# redis-check-rdb dump.rdb \r\n[offset 0] Checking RDB file dump.rdb\r\n[offset 27] AUX FIELD redis-ver = '6.0.16'\r\n[offset 41] AUX FIELD redis-bits = '64'\r\n[offset 53] AUX FIELD ctime = '1710240014'\r\n[offset 68] AUX FIELD used-mem = '2146421192'\r\n[offset 84] AUX FIELD aof-preamble = '0'\r\n[offset 86] Selecting DB ID 0\r\n[offset 728165086] Checksum OK\r\n[offset 728165086] \\o/ RDB looks OK! \\o/\r\n[info] 640519 keys read\r\n[info] 11447 expires\r\n[info] 140 already expired\r\n``` "
    },
    {
      "id": 1991457298,
      "user": "sundb",
      "created_at": "2024-03-12T11:40:30Z",
      "body": "I'm wondering why temp-152693.rdb and crash time don't match.\r\ndid you restart the server after crash and them everything works?\r\ncould you check if `asi:terms:11348` exist and its time is stirng?"
    },
    {
      "id": 1991502003,
      "user": "DeeKey",
      "created_at": "2024-03-12T12:06:58Z",
      "body": "> did you restart the server after crash and them everything works?\r\nYes - I restarted redis-server right after the crush. It was successful.\r\nAfter I made apt upgrade and rebooted the server (as new Linux kernel requested this).\r\n\r\n> could you check if asi:terms:11348 exist and its time is stirng?\r\n\r\nHow can I do this?"
    },
    {
      "id": 1991521882,
      "user": "sundb",
      "created_at": "2024-03-12T12:18:26Z",
      "body": "`object encoding asi:terms:11348`, maybe other key like `asi:terms:xxxx`."
    },
    {
      "id": 1991531065,
      "user": "DeeKey",
      "created_at": "2024-03-12T12:23:35Z",
      "body": "```\r\n redis-cli --scan --pattern 'asi:terms:11348'\r\nasi:terms:11348\r\n```"
    },
    {
      "id": 1991567047,
      "user": "sundb",
      "created_at": "2024-03-12T12:42:55Z",
      "body": "@DeeKey can you give the output of `object encoding asi:terms:11348`?"
    },
    {
      "id": 1991579889,
      "user": "DeeKey",
      "created_at": "2024-03-12T12:49:59Z",
      "body": "Could you please provide exact command how to do this?"
    },
    {
      "id": 1991593280,
      "user": "sundb",
      "created_at": "2024-03-12T12:57:10Z",
      "body": "`./src/redis-cli object encoding asi:terms:11348`."
    },
    {
      "id": 1991607859,
      "user": "DeeKey",
      "created_at": "2024-03-12T13:04:59Z",
      "body": "```\r\n# redis-cli object encoding asi:terms:11348\r\n\"raw\"\r\n```\r\n"
    },
    {
      "id": 1991619895,
      "user": "DeeKey",
      "created_at": "2024-03-12T13:11:10Z",
      "body": "Just in case it might be useful for this case. As I mentioned above I use two Wodpress plugins with Redis. Both are opensourced:\r\n\r\nhttps://wordpress.org/plugins/redis-cache/\r\nhttps://github.com/rtCamp/nginx-helper\r\n\r\nCould they cause some sort of collisions?"
    },
    {
      "id": 1991803046,
      "user": "sundb",
      "created_at": "2024-03-12T14:37:25Z",
      "body": "> Just in case it might be useful for this case. As I mentioned above I use two Wodpress plugins with Redis. Both are opensourced:\r\n> \r\n> [wordpress.org/plugins/redis-cache](https://wordpress.org/plugins/redis-cache/) [rtCamp/nginx-helper](https://github.com/rtCamp/nginx-helper)\r\n> \r\n> Could they cause some sort of collisions?\r\n\r\nI don't think it has anything to do with these two plugins.\r\nI'm not sure if it's related to the content of this key.\r\nIf possible, could you provide the content of this key? If there are privacy issues please send me email `debing.sun@redis.com', thanks.\r\nIf you could provide the corrupted rdb file even better."
    },
    {
      "id": 1992086237,
      "user": "DeeKey",
      "created_at": "2024-03-12T16:34:54Z",
      "body": "I have sent you corrupted file."
    },
    {
      "id": 1993194683,
      "user": "sundb",
      "created_at": "2024-03-13T02:36:59Z",
      "body": "@DeeKey thanks, the value of `asi:terms:11348` doesn't appear to be corrupt, it just wasn't written in its entirety due to the crash, and I still can't find any valid clues from this corrupted rdb, so perhaps we can wait to see if the next crash will provide more information."
    }
  ]
}