{
  "issue_number": 8144.0,
  "title": "[CRASH] redis-start command fails on Apple M1 chip",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\ndeepeshmehta@Deepeshs-Air ~ % arch -x86_64 redis-server\r\n19976:C 06 Dec 2020 20:19:34.947 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n19976:C 06 Dec 2020 20:19:34.947 # Redis version=6.0.9, bits=64, commit=00000000, modified=0, pid=19976, just started\r\n19976:C 06 Dec 2020 20:19:34.947 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf\r\n19976:M 06 Dec 2020 20:19:34.949 * Increased maximum number of open files to 10032 (it was originally set to 256).\r\n\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n19976:M 06 Dec 2020 20:19:34.951 # Redis 6.0.9 crashed by signal: 11, si_code: 2\r\n19976:M 06 Dec 2020 20:19:34.951 # Crashed running the instruction at: 0x7fff20451430\r\n19976:M 06 Dec 2020 20:19:34.951 # Accessing address: 0x309e03000\r\n19976:M 06 Dec 2020 20:19:34.951 # Killed by PID: 0, UID: 0\r\n19976:M 06 Dec 2020 20:19:34.951 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n0   libsystem_platform.dylib            0x00007fff20451430 _platform_memset$VARIANT$Rosetta + 108\r\n\r\nBacktrace:\r\n0   redis-server                        0x0000000102d7abb7 logStackTrace + 110\r\n1   redis-server                        0x0000000102d7afd5 sigsegvHandler + 271\r\n2   libsystem_platform.dylib            0x00007fff2044ed7d _sigtramp + 29\r\n3   libsystem_malloc.dylib              0x00007fff202347aa tiny_free_no_lock + 1116\r\n4   redis-server                        0x0000000102dcb0c3 luaD_call + 97\r\n5   ???                                 0x0000000032aaaba2 0x0 + 850045858\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.9\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:ec508acaad782189\r\nredis_mode:standalone\r\nos:Darwin 20.1.0 x86_64\r\narch_bits:64\r\nmultiplexing_api:kqueue\r\natomicvar_api:atomic-builtin\r\ngcc_version:4.2.1\r\nprocess_id:19976\r\nrun_id:fa31ad16e34ab8d9a05671c7fc952793a755d6d2\r\ntcp_port:6379\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:13468454\r\nexecutable:/Users/deepeshmehta/redis-server\r\nconfig_file:\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_recent_max_input_buffer:0\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:1019296\r\nused_memory_human:995.41K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:1019296\r\nused_memory_peak_human:995.41K\r\nused_memory_peak_perc:inf%\r\nused_memory_overhead:0\r\nused_memory_startup:0\r\nused_memory_dataset:1019296\r\nused_memory_dataset_perc:100.00%\r\nallocator_allocated:0\r\nallocator_active:0\r\nallocator_resident:0\r\ntotal_system_memory:8589934592\r\ntotal_system_memory_human:8.00G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:nan\r\nallocator_frag_bytes:0\r\nallocator_rss_ratio:nan\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:nan\r\nrss_overhead_bytes:0\r\nmem_fragmentation_ratio:nan\r\nmem_fragmentation_bytes:0\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:libc\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1607303974\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:0\r\ntotal_writes_processed:0\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:5b711d973bc9bf978fd16ed53e5352462ab04934\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.010534\r\nused_cpu_user:0.019080\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n19976:M 06 Dec 2020 20:19:34.952 # \r\nRAX:0000000309e02cc0 RBX:0000000000000013\r\nRCX:0000000309e03000 RDX:00007f954ce0290e\r\nRDI:0000000309e02c68 RSI:0000000000000000\r\nRBP:0000000309e02a90 RSP:0000000309e028a8\r\nR8 :0000000000000000 R9 :0000000309e02960\r\nR10:0000000102de67b3 R11:ffffffffffffffff\r\nR12:0000000309e02b30 R13:00000000000000ff\r\nR14:0000000102de7127 R15:0000000102e17740\r\nRIP:00007fff20451430 EFL:0000000000000202\r\nCS :000000000000002b FS:0000000000000000  GS:0000000000000000\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b7) -> 000000010b8cca00\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b6) -> 0000000000000006\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b5) -> 0000000000000000\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b4) -> 0000000000002800\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b3) -> 0000000000000000\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b2) -> 00007fff20232020\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b1) -> 0000000102df5bca\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028b0) -> 0000000102d894d6\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028af) -> 0000000309e02a20\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028ae) -> 00007f9856c00000\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028ad) -> 0000000102de8d38\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028ac) -> 00000000000018eb\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028ab) -> 0000000102de3bcd\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028aa) -> 0000000309e02c68\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028a9) -> 00007f9856c5a2c0\r\n19976:M 06 Dec 2020 20:19:34.952 # (0000000309e028a8) -> 0000000102d99ebb\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: _platform_memset$VARIANT$Rosetta (base: 0x7fff204513c4)\r\nModule: /usr/lib/system/libsystem_platform.dylib (base 0x7fff2044b000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x7fff204513c4 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n19976:M 06 Dec 2020 20:19:34.953 # dump of function (hexdump of 236 bytes):\r\n81e6ff00000048b90101010101010101480faff14889f94883fa400f82360100004881fa008000000f82a00000000faef0480fc337480fc37708480fc37710480fc37718480fc37720480fc37728480fc37730480fc37738488d4f404883e1c04801fa488d41404829c27631480fc331480fc37108480fc37110480fc37118480fc37120480fc37128480fc37130480fc371384883c1404883ea4077cf4801d1480fc331480fc37108480fc37110480fc37118480fc37120480fc37128480fc37130480fc371380faef84889f8c3488937488977084889771048897718488977204889772848897730488977\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n\r\n**Aditional information**\r\n\r\n1. \r\n![image](https://user-images.githubusercontent.com/7513293/101299615-d636c080-3800-11eb-835f-cd3825c510cf.png)'\r\n2. Macbook Air M1 chip\r\n\r\n2. https://redis.io/topics/quickstart\r\n",
  "state": "closed",
  "created_at": "2020-12-07T01:23:32Z",
  "updated_at": "2020-12-07T10:03:44Z",
  "closed_at": "2020-12-07T10:03:44Z",
  "labels": [],
  "comments_data": [
    {
      "id": 739812725,
      "user": "oranagra",
      "created_at": "2020-12-07T10:03:43Z",
      "body": "@deepeshhmehta thanks for reporting.\r\nseems like a dup of #8062"
    }
  ]
}