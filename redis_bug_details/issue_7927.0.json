{
  "issue_number": 7927.0,
  "title": "[CRASH]",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n24608:C 18 Oct 2020 12:59:06.038 # Redis 6.0.6 crashed by signal: 11\r\n24608:C 18 Oct 2020 12:59:06.038 # Crashed running the instruction at: 0x561cbd1c46f8\r\n24608:C 18 Oct 2020 12:59:06.038 # Accessing address: 0x1f2cf8\r\n24608:C 18 Oct 2020 12:59:06.039 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](je_malloc_usable_size+0x78)[0x561cbd1c46f8]\r\n\r\nBacktrace:\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](logStackTrace+0x5a)[0x561cbd143daa]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](sigsegvHandler+0xb1)[0x561cbd144561]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x128a0)[0x7f63b0dce8a0]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](je_malloc_usable_size+0x78)[0x561cbd1c46f8]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](+0x4e009)[0x561cbd105009]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](rdbSave+0x2a1)[0x561cbd124f41]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](rdbSaveBackground+0xc3)[0x561cbd125013]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](serverCron+0x795)[0x561cbd0fecc5]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](aeProcessEvents+0x33b)[0x561cbd0f64db]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](aeMain+0x1d)[0x561cbd0f67cd]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](main+0x51b)[0x561cbd0f2dcb]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xe7)[0x7f63b09ecb97]\r\nredis-rdb-bgsave 0.0.0.0:6379 [cluster](_start+0x2a)[0x561cbd0f307a]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:d463d609620685c0\r\nredis_mode:cluster\r\nos:Linux 4.15.0-70-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:7.5.0\r\nprocess_id:24608\r\nrun_id:9a02f0a7f9f78c565a55e0486072cc835547b757\r\ntcp_port:6379\r\nuptime_in_seconds:56892\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:9190426\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\n\r\n# Clients\r\nconnected_clients:104\r\nclient_recent_max_input_buffer:4\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:6157456\r\nused_memory_human:5.87M\r\nused_memory_rss:9527296\r\nused_memory_rss_human:9.09M\r\nused_memory_peak:7151256\r\nused_memory_peak_human:6.82M\r\nused_memory_peak_perc:86.10%\r\nused_memory_overhead:4320980\r\nused_memory_startup:1474800\r\nused_memory_dataset:1836476\r\nused_memory_dataset_perc:39.22%\r\nallocator_allocated:6428416\r\nallocator_active:7286784\r\nallocator_resident:10227712\r\ntotal_system_memory:16819585024\r\ntotal_system_memory_human:15.66G\r\nused_memory_lua:47104\r\nused_memory_lua_human:46.00K\r\nused_memory_scripts:880\r\nused_memory_scripts_human:880B\r\nnumber_of_cached_scripts:2\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.13\r\nallocator_frag_bytes:858368\r\nallocator_rss_ratio:1.40\r\nallocator_rss_bytes:2940928\r\nrss_overhead_ratio:0.93\r\nrss_overhead_bytes:-700416\r\nmem_fragmentation_ratio:1.55\r\nmem_fragmentation_bytes:3371376\r\nmem_not_counted_for_evict:3160\r\nmem_replication_backlog:1048576\r\nmem_clients_slaves:16986\r\nmem_clients_normal:1766626\r\nmem_aof_buffer:3160\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:2430\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1603025645\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:942080\r\naof_enabled:1\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:0\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:733184\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\naof_current_size:9772323\r\naof_base_size:466048\r\naof_pending_rewrite:0\r\naof_buffer_length:0\r\naof_rewrite_buffer_length:0\r\naof_pending_bio_fsync:0\r\naof_delayed_fsync:9\r\n\r\n# Stats\r\ntotal_connections_received:11766\r\ntotal_commands_processed:702730\r\ninstantaneous_ops_per_sec:5\r\ntotal_net_input_bytes:220479722\r\ntotal_net_output_bytes:1288979139\r\ninstantaneous_input_kbps:3.72\r\ninstantaneous_output_kbps:3.71\r\nrejected_connections:0\r\nsync_full:1\r\nsync_partial_ok:0\r\nsync_partial_err:1\r\nexpired_keys:314\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:3140\r\nevicted_keys:0\r\nkeyspace_hits:86609\r\nkeyspace_misses:41\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:956\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:1\r\nslave0:ip=192.168.21.2,port=6380,state=online,offset=209398607,lag=1\r\nmaster_replid:acf424eb1154dc7834078327f258a53d03a71e02\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:209402685\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:1\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:208354110\r\nrepl_backlog_histlen:1048576\r\n\r\n# CPU\r\nused_cpu_sys:0.004260\r\nused_cpu_user:0.000000\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_hexists:calls=20,usec=95,usec_per_call=4.75\r\ncmdstat_llen:calls=12598,usec=54538,usec_per_call=4.33\r\ncmdstat_replconf:calls=56798,usec=150178,usec_per_call=2.64\r\ncmdstat_hlen:calls=6,usec=19,usec_per_call=3.17\r\ncmdstat_cluster:calls=11644,usec=2559212,usec_per_call=219.79\r\ncmdstat_eval:calls=40,usec=7763,usec_per_call=194.07\r\ncmdstat_rpop:calls=8138,usec=167316,usec_per_call=20.56\r\ncmdstat_hdel:calls=109227,usec=1111495,usec_per_call=10.18\r\ncmdstat_publish:calls=20,usec=1241,usec_per_call=62.05\r\ncmdstat_hset:calls=124109,usec=1256575,usec_per_call=10.12\r\ncmdstat_del:calls=39445,usec=233593,usec_per_call=5.92\r\ncmdstat_hkeys:calls=1,usec=5,usec_per_call=5.00\r\ncmdstat_hget:calls=15718,usec=107552,usec_per_call=6.84\r\ncmdstat_set:calls=193227,usec=1792203,usec_per_call=9.28\r\ncmdstat_lpop:calls=3796,usec=85776,usec_per_call=22.60\r\ncmdstat_hgetall:calls=17066,usec=3494712,usec_per_call=204.78\r\ncmdstat_hincrby:calls=283,usec=3129,usec_per_call=11.06\r\ncmdstat_lpush:calls=7489,usec=137375,usec_per_call=18.34\r\ncmdstat_wait:calls=40,usec=142,usec_per_call=3.55\r\ncmdstat_ping:calls=2,usec=3,usec_per_call=1.50\r\ncmdstat_slaveof:calls=15,usec=49,usec_per_call=3.27\r\ncmdstat_rpush:calls=5113,usec=53219,usec_per_call=10.41\r\ncmdstat_pexpire:calls=546,usec=3797,usec_per_call=6.95\r\ncmdstat_lset:calls=39382,usec=441018,usec_per_call=11.20\r\ncmdstat_client:calls=11470,usec=56260,usec_per_call=4.90\r\ncmdstat_config:calls=2,usec=88,usec_per_call=44.00\r\ncmdstat_psync:calls=1,usec=1108,usec_per_call=1108.00\r\ncmdstat_exists:calls=20,usec=84,usec_per_call=4.20\r\ncmdstat_lindex:calls=41221,usec=465213,usec_per_call=11.29\r\ncmdstat_info:calls=182,usec=39644,usec_per_call=217.82\r\ncmdstat_incrby:calls=327,usec=5675,usec_per_call=17.35\r\ncmdstat_setex:calls=4784,usec=131158,usec_per_call=27.42\r\n\r\n# Cluster\r\ncluster_enabled:1\r\n\r\n# Keyspace\r\ndb0:keys=184,expires=12,avg_ttl=24240086\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=15 addr=192.168.21.5:44876 fd=24 name= age=56892 idle=4 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=16 addr=192.168.21.5:44878 fd=25 name= age=56892 idle=4 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=17 addr=192.168.21.5:44880 fd=26 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=18 addr=192.168.21.5:44882 fd=27 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=11765 addr=192.168.21.7:60562 fd=122 name= age=29 idle=29 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=cluster user=default\r\nid=19 addr=192.168.21.5:44884 fd=28 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=20 addr=192.168.21.5:44886 fd=29 name= age=56892 idle=6 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=21 addr=192.168.21.5:44888 fd=30 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=22 addr=192.168.21.5:44890 fd=31 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=23 addr=192.168.21.5:44892 fd=32 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=24 addr=192.168.21.5:44894 fd=33 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=25 addr=192.168.21.5:44896 fd=34 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=26 addr=192.168.21.5:44898 fd=35 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=27 addr=192.168.21.5:44900 fd=36 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=28 addr=192.168.21.5:44902 fd=37 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=29 addr=192.168.21.5:44904 fd=38 name= age=56892 idle=3 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=30 addr=192.168.21.5:44908 fd=39 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=31 addr=192.168.21.5:44906 fd=40 name= age=56892 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=32 addr=192.168.21.8:50100 fd=41 name= age=56892 idle=714 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=33 addr=192.168.21.8:50102 fd=42 name= age=56892 idle=546 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=34 addr=192.168.21.8:50106 fd=43 name= age=56892 idle=1547 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=106 addr=192.168.21.2:40789 fd=123 name= age=56891 idle=1 flags=S db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=replconf user=default\r\nid=35 addr=192.168.21.8:50108 fd=44 name= age=56892 idle=1551 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=36 addr=192.168.21.8:50110 fd=45 name= age=56892 idle=1552 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=37 addr=192.168.21.8:50112 fd=46 name= age=56892 idle=2015 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=38 addr=192.168.21.8:50114 fd=47 name= age=56892 idle=723 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=39 addr=192.168.21.8:50116 fd=48 name= age=56892 idle=1552 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=40 addr=192.168.21.8:50118 fd=49 name= age=56892 idle=1545 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=41 addr=192.168.21.8:50120 fd=50 name= age=56892 idle=1545 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=42 addr=192.168.21.8:50122 fd=51 name= age=56892 idle=546 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=43 addr=192.168.21.8:50124 fd=52 name= age=56892 idle=2015 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=44 addr=192.168.21.8:50126 fd=53 name= age=56892 idle=1547 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=45 addr=192.168.21.8:50128 fd=54 name= age=56892 idle=721 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=46 addr=192.168.21.8:50130 fd=55 name= age=56892 idle=714 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=47 addr=192.168.21.8:50132 fd=56 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=48 addr=192.168.21.8:50134 fd=57 name= age=56892 idle=714 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=49 addr=192.168.21.8:50138 fd=58 name= age=56892 idle=1545 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=50 addr=192.168.21.8:50136 fd=59 name= age=56892 idle=1549 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=51 addr=192.168.21.6:59036 fd=60 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=110 addr=192.168.21.7:60702 fd=125 name= age=56885 idle=3 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=hgetall user=default\r\nid=52 addr=192.168.21.8:50142 fd=61 name= age=56892 idle=1545 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=53 addr=192.168.21.8:50144 fd=62 name= age=56892 idle=720 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=54 addr=192.168.21.8:50146 fd=63 name= age=56892 idle=717 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=55 addr=192.168.21.8:50148 fd=64 name= age=56892 idle=720 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=56 addr=192.168.21.8:50150 fd=65 name= age=56892 idle=723 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=57 addr=192.168.21.8:50152 fd=66 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=58 addr=192.168.21.7:60578 fd=67 name= age=56892 idle=3 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=lset user=default\r\nid=109 addr=192.168.21.7:60654 fd=124 name= age=56889 idle=8 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=hgetall user=default\r\nid=59 addr=192.168.21.6:59038 fd=68 name= age=56892 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=60 addr=192.168.21.7:60580 fd=69 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=61 addr=192.168.21.8:50154 fd=70 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=62 addr=192.168.21.8:50156 fd=71 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=63 addr=192.168.21.8:50158 fd=72 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=64 addr=192.168.21.8:50160 fd=73 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=65 addr=192.168.21.8:50162 fd=74 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=66 addr=192.168.21.8:50164 fd=75 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=67 addr=192.168.21.8:50166 fd=76 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=68 addr=192.168.21.8:50168 fd=77 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=69 addr=192.168.21.8:50170 fd=78 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=70 addr=192.168.21.8:50172 fd=79 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=71 addr=192.168.21.8:50174 fd=80 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=72 addr=192.168.21.8:50176 fd=81 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=73 addr=192.168.21.8:50178 fd=82 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=74 addr=192.168.21.8:50180 fd=83 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=75 addr=192.168.21.8:50182 fd=84 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=76 addr=192.168.21.8:50184 fd=85 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=77 addr=192.168.21.8:50186 fd=86 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=78 addr=192.168.21.8:50188 fd=87 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=79 addr=192.168.21.8:50190 fd=88 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=80 addr=192.168.21.8:50192 fd=89 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=81 addr=192.168.21.8:50194 fd=90 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=82 addr=192.168.21.8:50196 fd=91 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=83 addr=192.168.21.8:50198 fd=92 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=84 addr=192.168.21.8:50200 fd=93 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=85 addr=192.168.21.8:50202 fd=94 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=86 addr=192.168.21.8:50204 fd=95 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=87 addr=192.168.21.8:50206 fd=96 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=88 addr=192.168.21.8:50208 fd=97 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=89 addr=192.168.21.8:50210 fd=98 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=90 addr=192.168.21.8:50212 fd=99 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=91 addr=192.168.21.8:50214 fd=100 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=92 addr=192.168.21.8:50216 fd=101 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=93 addr=192.168.21.8:50218 fd=102 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=94 addr=192.168.21.8:50220 fd=103 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=95 addr=192.168.21.8:50222 fd=104 name= age=56892 idle=1547 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=96 addr=192.168.21.8:50224 fd=105 name= age=56892 idle=723 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=97 addr=192.168.21.8:50226 fd=106 name= age=56892 idle=717 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=98 addr=192.168.21.8:50228 fd=107 name= age=56892 idle=1551 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=99 addr=192.168.21.8:50230 fd=108 name= age=56892 idle=714 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=100 addr=192.168.21.8:50232 fd=109 name= age=56892 idle=721 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=101 addr=192.168.21.8:50234 fd=110 name= age=56892 idle=1549 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=incrby user=default\r\nid=102 addr=192.168.21.8:50236 fd=111 name= age=56892 idle=723 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=103 addr=192.168.21.8:50238 fd=112 name= age=56892 idle=1547 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=pexpire user=default\r\nid=104 addr=192.168.21.7:60584 fd=113 name= age=56892 idle=10 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=hgetall user=default\r\nid=4 addr=192.168.21.8:50096 fd=13 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=5 addr=192.168.21.8:50098 fd=14 name= age=56892 idle=3 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=hset user=default\r\nid=6 addr=192.168.21.5:44858 fd=15 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=7 addr=192.168.21.5:44860 fd=16 name= age=56892 idle=6 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=8 addr=192.168.21.5:44862 fd=17 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=9 addr=192.168.21.5:44864 fd=18 name= age=56892 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=10 addr=192.168.21.5:44866 fd=19 name= age=56892 idle=6 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=11 addr=192.168.21.5:44868 fd=20 name= age=56892 idle=3 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\nid=12 addr=192.168.21.5:44870 fd=21 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=13 addr=192.168.21.5:44872 fd=22 name= age=56892 idle=56892 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=NULL user=default\r\nid=14 addr=192.168.21.5:44874 fd=23 name= age=56892 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=set user=default\r\n\r\n------ REGISTERS ------\r\n24608:C 18 Oct 2020 12:59:06.045 # \r\nRAX:00000000001f2cf8 RBX:0000561cbe59fa50\r\nRCX:00007f63b20f4778 RDX:0000000000000001\r\nRDI:00007f63b20f4868 RSI:0000000000000000\r\nRBP:00007f63b20f4758 RSP:00007ffeb15fda40\r\nR8 :0000561c80000000 R9 :0000000000000000\r\nR10:0000000000000006 R11:0000000000000206\r\nR12:00007f63b049a4c8 R13:00007f63b049a4c8\r\nR14:00007ffeb15fde10 R15:0000000000000001\r\nRIP:0000561cbd1c46f8 EFL:0000000000010202\r\nCSGSFS:002b000000000033\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4f) -> 0000000000000000\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4e) -> 00007ffeb15fdae8\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4d) -> 0000000000000000\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4c) -> 0000000000000000\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4b) -> 0000001eb049a4c8\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda4a) -> 00007f63b0b80bce\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda49) -> 0000000000000004\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda48) -> 0000000000000000\r\n24608:C 18 Oct 2020 12:59:06.045 # (00007ffeb15fda47) -> 70509aa598dc5200\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda46) -> 00007ffeb15fdccf\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda45) -> 00007f63b09fd58e\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda44) -> 00007ffeb15fdb70\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda43) -> 000000000000001e\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda42) -> 00007ffe006f6d2e\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda41) -> 6362696c2f534547\r\n24608:C 18 Oct 2020 12:59:06.046 # (00007ffeb15fda40) -> 415353454d5f434c\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n*** Preparing to test memory region 561cbd490000 (2277376 bytes)\r\n*** Preparing to test memory region 561cbe56b000 (270336 bytes)\r\n*** Preparing to test memory region 7f63a7c00000 (4329472 bytes)\r\n*** Preparing to test memory region 7f63ac200000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63aca00000 (2097152 bytes)\r\n*** Preparing to test memory region 7f63ace00000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63ad600000 (2097152 bytes)\r\n*** Preparing to test memory region 7f63ad97c000 (3670016 bytes)\r\n*** Preparing to test memory region 7f63adcfd000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63ae4fe000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63aecff000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63af500000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63afd00000 (3145728 bytes)\r\n*** Preparing to test memory region 7f63b0000000 (8388608 bytes)\r\n*** Preparing to test memory region 7f63b0db8000 (16384 bytes)\r\n*** Preparing to test memory region 7f63b0fd7000 (16384 bytes)\r\n*** Preparing to test memory region 7f63b14a3000 (12288 bytes)\r\n*** Preparing to test memory region 7f63b20f4000 (32768 bytes)\r\n*** Preparing to test memory region 7f63b2106000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: je_malloc_usable_size (base: 0x561cbd1c4680)\r\nModule: redis-rdb-bgsave 0.0.0.0:6379 [cluster] (base 0x561cbd0b7000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x561cbd1c4680 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n24608:C 18 Oct 2020 12:59:06.729 # dump of function (hexdump of 248 bytes):\r\n55534889fb4881ec9801000064488b042528000000488984248801000031c0803db2132d00000f85840000004885ff0f84bb0000004889e54889efe840d5030031c04889de4889da48c1ee1a4881e2000000c081e6f00000004801ee488b0e4839ca0f85900000004889d848c1e80925f8ff1f0048034608488b18488d153e72080048c1eb30488b04da488bbc24880100006448333c25280000000f85920100004881c4980100005b5dc30f1f440000488b05e1172c0064803800751b4885ff742e644803042500000000488d6828e96effffff0f1f400064480304250000000031f64889c7e855b805004885db754831c0eb960f1f4000\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n\r\n**Aditional information**\r\n\r\n1. OS distribution and version\r\nLinux\r\n\r\n6.0.6\r\n\r\n2. Steps to reproduce (if any)\r\n",
  "state": "closed",
  "created_at": "2020-10-19T01:52:03Z",
  "updated_at": "2022-02-06T16:04:57Z",
  "closed_at": "2020-10-28T10:52:57Z",
  "labels": [],
  "comments_data": [
    {
      "id": 711501124,
      "user": "oranagra",
      "created_at": "2020-10-19T04:00:25Z",
      "body": "@guotie can you please upload the executable you used (hopefully it can provide more details on the stack trace of the crash)"
    },
    {
      "id": 711589103,
      "user": "guotie",
      "created_at": "2020-10-19T05:18:16Z",
      "body": "\r\n[redis-check-rdb.zip](https://github.com/redis/redis/files/5399216/redis-check-rdb.zip)\r\n\r\n\r\n"
    },
    {
      "id": 711677187,
      "user": "oranagra",
      "created_at": "2020-10-19T06:43:47Z",
      "body": "@guotie any chance you have the same build with the debug symbols (in case they were stripped after compilation)?\r\nsome thing don't make sense. i don't see how `rdbSave` can lead to `je_malloc_usable_size`"
    },
    {
      "id": 711889128,
      "user": "guotie",
      "created_at": "2020-10-19T09:10:06Z",
      "body": "I use apt install it\r\n"
    },
    {
      "id": 712103172,
      "user": "oranagra",
      "created_at": "2020-10-19T11:49:57Z",
      "body": "@guotie can you please check what you have in the log file just above the crash log?\r\ni'm suspecting it's \"Failed opening the RDB file\"...\r\nmaybe your disk became non-writable?\r\nstill trying to figure out why it cased a crash."
    },
    {
      "id": 712112099,
      "user": "oranagra",
      "created_at": "2020-10-19T12:07:31Z",
      "body": "@guotie please specify your apt source (from the disassembly it doesn't like like clean redis 6.0.6)\r\n\r\nfor the record:\r\nit looks like rdbSave is calling zfree after logging \"Failed opening the RDB file\""
    },
    {
      "id": 712519845,
      "user": "guotie",
      "created_at": "2020-10-20T00:47:10Z",
      "body": "\r\n```\r\nsudo apt-get install software-properties-common -y\r\nsudo add-apt-repository ppa:chris-lea/redis-server -y\r\nsudo apt-get update && sudo apt-get install redis-server -y\r\nsudo systemctl enable redis-server\r\nsudo systemctl start redis-server\r\n\r\n```"
    },
    {
      "id": 712583004,
      "user": "oranagra",
      "created_at": "2020-10-20T04:37:13Z",
      "body": "it turns out there's a bug in the PPA code. but it's only triggered in this error condition.\r\nfor some reason your disk wasn't writable and that crashed the child child process, if you'll solve that you'll be ok until the bug is fixed."
    },
    {
      "id": 714289136,
      "user": "yossigo",
      "created_at": "2020-10-22T07:22:50Z",
      "body": "@guotie This has been a bug in the debian-specific patches, and it has been resolved in the new official PPA we maintain. If you want to use it, you'll have to use `sudo add-apt-repository ppa:redislabs/redis -y`.\r\n"
    },
    {
      "id": 714309748,
      "user": "yossigo",
      "created_at": "2020-10-22T08:01:36Z",
      "body": "Pinging @chrislea and @lamby, as the source of this crash is the Debian `0010-Use-get_current_dir_name-over-PATHMAX-etc.patch` which seems to exhibit two issues:\r\n1. It uses `zfree()` to free an allocation done by `get_current_dir_name()`.\r\n2. In another occasion it uses `zfree()` on a stack pointer.\r\n\r\nBoth cases only involve error handling/reporting code flows when failing to write local files so they are not that common, but if reached crashes Redis."
    },
    {
      "id": 714334307,
      "user": "lamby",
      "created_at": "2020-10-22T08:43:43Z",
      "body": "Thanks @yossigo. Can you share your patch that does not have those two issues so we can include them in the Debian package?"
    },
    {
      "id": 714447536,
      "user": "yossigo",
      "created_at": "2020-10-22T12:06:20Z",
      "body": "@lamby Sure I'll do that."
    },
    {
      "id": 1030721077,
      "user": "lamby",
      "created_at": "2022-02-06T00:36:10Z",
      "body": "@yossigo Can you share your patch...? Looks like you closed this without sending it on."
    },
    {
      "id": 1030764693,
      "user": "yossigo",
      "created_at": "2022-02-06T06:50:33Z",
      "body": "@lamby Looks like I did, and it's merged:\r\nhttps://bugs.debian.org/cgi-bin/bugreport.cgi?bug=972683"
    },
    {
      "id": 1030862405,
      "user": "lamby",
      "created_at": "2022-02-06T16:04:57Z",
      "body": "Ah! Thanks! :"
    }
  ]
}