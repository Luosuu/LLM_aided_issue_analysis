{
  "issue_number": 10815.0,
  "title": "[CRASH] Redis (graph) crashes on startup",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n772733:C 03 Jun 2022 09:01:17.323 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n772733:C 03 Jun 2022 09:01:17.323 # Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=772733, just started\r\n772733:C 03 Jun 2022 09:01:17.323 # Configuration loaded\r\n772733:M 03 Jun 2022 09:01:17.324 * monotonic clock: POSIX clock_gettime\r\n                _._\r\n           _.-``__ ''-._\r\n      _.-``    `.  `_.  ''-._           Redis 6.2.6 (00000000/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._\r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 772733\r\n  `-._    `-._  `-./  _.-'    _.-'\r\n |`-._`-._    `-.__.-'    _.-'_.-'|\r\n |    `-._`-._        _.-'_.-'    |           https://redis.io\r\n  `-._    `-._`-.__.-'_.-'    _.-'\r\n |`-._`-._    `-.__.-'    _.-'_.-'|\r\n |    `-._`-._        _.-'_.-'    |\r\n  `-._    `-._`-.__.-'_.-'    _.-'\r\n      `-._    `-.__.-'    _.-'\r\n          `-._        _.-'\r\n              `-.__.-'\r\n\r\n772733:M 03 Jun 2022 09:01:17.324 # Server initialized\r\n772733:M 03 Jun 2022 09:01:17.327 * <graph> Starting up RedisGraph version 99.99.99.\r\n772733:M 03 Jun 2022 09:01:17.327 * <graph> Thread pool created, using 16 threads.\r\n772733:M 03 Jun 2022 09:01:17.327 * <graph> Maximum number of OpenMP threads set to 16\r\n772733:M 03 Jun 2022 09:01:17.328 * Module 'graph' loaded from /usr/local/lib/redis/redisgraph.so\r\n772733:M 03 Jun 2022 09:01:17.328 * Loading RDB produced by version 6.2.6\r\n772733:M 03 Jun 2022 09:01:17.328 * RDB age 57664 seconds\r\n772733:M 03 Jun 2022 09:01:17.328 * RDB memory usage when created 4940.56 Mb\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n772733:M 03 Jun 2022 09:01:51.588 # Redis 6.2.6 crashed by signal: 11, si_code: 1\r\n772733:M 03 Jun 2022 09:01:51.588 # Accessing address: 0x20\r\n772733:M 03 Jun 2022 09:01:51.588 # Crashed running the instruction at: 0x7f6d4cf05169\r\n----- STACK TRACE ------\r\nEIP:\r\n/usr/local/lib/redis/redisgraph.so(RG_Matrix_setElement_UINT64+0x39)[0x7f6d4cf05169]\r\n\r\nBacktrace:\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x143c0)[0x7f6d4f4943c0]\r\n/usr/local/lib/redis/redisgraph.so(RG_Matrix_setElement_UINT64+0x39)[0x7f6d4cf05169]\r\n/usr/local/lib/redis/redisgraph.so(Graph_FormConnection+0x56)[0x7f6d4ceff696]\r\n/usr/local/lib/redis/redisgraph.so(RdbLoadEdges_v10+0xac)[0x7f6d4cf087fc]\r\n/usr/local/lib/redis/redisgraph.so(RdbLoadGraphContext_v10+0x3a3)[0x7f6d4cf08ca3]\r\n/usr/local/lib/redis/redisgraph.so(+0x2168e5)[0x7f6d4cf068e5]\r\n/usr/local/bin/redis-server *:6379(rdbLoadObject+0x18d)[0x55db9ed7b08d]\r\n/usr/local/bin/redis-server *:6379(rdbLoadRio+0x2b5)[0x55db9ed7da05]\r\n/usr/local/bin/redis-server *:6379(rdbLoad+0x69)[0x55db9ed7e619]\r\n/usr/local/bin/redis-server *:6379(loadDataFromDisk+0xa0)[0x55db9ed50550]\r\n/usr/local/bin/redis-server *:6379(main+0x2c1)[0x55db9ed3fea1]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0x7f6d4f2b20b3]\r\n/usr/local/bin/redis-server *:6379(_start+0x2e)[0x55db9ed4045e]\r\n\r\n------ REGISTERS ------\r\n772733:M 03 Jun 2022 09:01:51.590 #\r\nRAX:0000000000000000 RBX:000000000000001a\r\nRCX:0000000000000019 RDX:0000000000000019\r\nRDI:0000000000000000 RSI:0000000000000018\r\nRBP:0000000000000000 RSP:00007fffa401f840\r\nR8 :0000000000000002 R9 :0000000000000001\r\nR10:0000000000000024 R11:0000000000000018\r\nR12:0000000000000019 R13:0000000000000019\r\nR14:0000000000000017 R15:0000000000000018\r\nRIP:00007f6d4cf05169 EFL:0000000000010246\r\nCSGSFS:002b000000000033\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84f) -> 00007fffa401fac0\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84e) -> 00007fffa401fac0\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84d) -> 00007f6d4ceff696\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84c) -> 0000000000000017\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84b) -> 0000000000000000\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f84a) -> 0000000000000019\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f849) -> 0000000000000018\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f848) -> 00007f6ab97d68c0\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f847) -> 000000000000001a\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f846) -> 0000000000000000\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f845) -> f5b48f4a432eba00\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f844) -> 00007fffa401f8a6\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f843) -> 00007f6ab987b300\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f842) -> 0000000000000001\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f841) -> 00007f6d4cf04908\r\n772733:M 03 Jun 2022 09:01:51.590 # (00007fffa401f840) -> 0000000000000019\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:5736d487eb15e73f\r\nredis_mode:standalone\r\nos:Linux 5.13.0-1025-aws x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:9.3.0\r\nprocess_id:772733\r\nprocess_supervised:no\r\nrun_id:e4353cf12f512791636852c771a1eddb0b637df5\r\ntcp_port:6379\r\nserver_time_usec:1654246911572137\r\nuptime_in_seconds:34\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:10079709\r\nexecutable:/usr/local/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:1\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:0\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:3619048048\r\nused_memory_human:3.37G\r\nused_memory_rss:3372019712\r\nused_memory_rss_human:3.14G\r\nused_memory_peak:3619048048\r\nused_memory_peak_human:3.37G\r\nused_memory_peak_perc:100.17%\r\nused_memory_overhead:850696\r\nused_memory_startup:843816\r\nused_memory_dataset:3618197352\r\nused_memory_dataset_perc:100.00%\r\nallocator_allocated:3613058184\r\nallocator_active:3618553856\r\nallocator_resident:3652702208\r\ntotal_system_memory:66597511168\r\ntotal_system_memory_human:62.02G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.00\r\nallocator_frag_bytes:5495672\r\nallocator_rss_ratio:1.01\r\nallocator_rss_bytes:34148352\r\nrss_overhead_ratio:0.92\r\nrss_overhead_bytes:-280682496\r\nmem_fragmentation_ratio:0.93\r\nmem_fragmentation_bytes:-241004824\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n\r\n# Persistence\r\nloading:1\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1654246877\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\nloading_start_time:1654246877\r\nloading_total_bytes:1348589522\r\nloading_rdb_used_mem:5180555768\r\nloading_loaded_bytes:1073741823\r\nloading_loaded_perc:79.62\r\nloading_eta_seconds:8\r\n\r\n# Stats\r\ntotal_connections_received:1\r\ntotal_commands_processed:3\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:69\r\ntotal_net_output_bytes:13435\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\ntotal_forks:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:0\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:3\r\ntotal_writes_processed:3\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:52071240411ff027f25a4bbdf9f4d04b48a3e4a9\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n# CPU\r\nused_cpu_sys:3.283807\r\nused_cpu_user:112.240365\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\nused_cpu_sys_main_thread:1.451543\r\nused_cpu_user_main_thread:32.441754\r\n\r\n# Modules\r\nmodule:name=graph,ver=999999,api=1,filters=0,usedby=[],using=[],options=[]\r\n\r\n# Commandstats\r\ncmdstat_info:calls=3,usec=268,usec_per_call=89.33,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=120,expires=0,avg_ttl=0\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=5 addr=127.0.0.1:51750 laddr=127.0.0.1:6379 fd=9 name= age=21 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=40954 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=61456 events=r cmd=info user=default redir=-1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n# graph_executing commands\r\n\r\n------ FAST MEMORY TEST ------\r\n772733:M 03 Jun 2022 09:01:51.590 # Bio thread for job type #0 terminated\r\n772733:M 03 Jun 2022 09:01:51.590 # Bio thread for job type #1 terminated\r\n772733:M 03 Jun 2022 09:01:51.590 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 55db9ef0f000 (2277376 bytes)\r\n*** Preparing to test memory region 55db9fd10000 (135168 bytes)\r\n*** Preparing to test memory region 55db9fd31000 (667648 bytes)\r\n*** Preparing to test memory region 7f6a44000000 (2416054272 bytes)\r\n*** Preparing to test memory region 7f6ad8000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6adc000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6ae0000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6ae4000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6ae8000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6aec000000 (135168 bytes)\r\n*** Preparing to test memory region 7f6af0000000 (135168 bytes)\r\n....\r\n*** Preparing to test memory region 7f6d4f0f1000 (24576 bytes)\r\n*** Preparing to test memory region 7f6d4f282000 (8192 bytes)\r\n*** Preparing to test memory region 7f6d4f47c000 (16384 bytes)\r\n*** Preparing to test memory region 7f6d4f49f000 (16384 bytes)\r\n*** Preparing to test memory region 7f6d4f551000 (4096 bytes)\r\n*** Preparing to test memory region 7f6d4f6a7000 (8192 bytes)\r\n*** Preparing to test memory region 7f6d4f6df000 (4096 bytes)\r\n\r\n\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version : Linux acc-redis 5.13.0-1025-aws #27~20.04.1-Ubuntu SMP Thu May 19 15:17:13 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux3. \r\n2. Steps to reproduce (if any)\r\nUsing Redis + redis graph with persistence enabled, after restarting the system, redis is stuck in a loop with crashes. Tried changing instances several times (on AWS) after running memory test, we are still getting the error. \r\n\r\n",
  "state": "closed",
  "created_at": "2022-06-03T09:06:25Z",
  "updated_at": "2022-06-03T10:56:13Z",
  "closed_at": "2022-06-03T10:56:13Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1145844619,
      "user": "oranagra",
      "created_at": "2022-06-03T10:56:13Z",
      "body": "@vijaykiran please open in https://github.com/RedisGraph/RedisGraph\r\n@AviAvni FYI"
    }
  ]
}