{
  "issue_number": 8406.0,
  "title": "[CRASH] Using redis ver 6.0.10 on docker on jetson tx2 - with JetPack3.3 ",
  "body": "I was running redis on jetson tx2 - with JetPack3.3  using:\r\n\r\n```\r\nsudo docker run -p 6379:6379 --memory=100m --memory-reservation=100m --name my_name -d --restart always arm64v8/redis\r\n```\r\n\r\nDocker logs output is:\r\n```\r\n1:C 27 Jan 2021 12:49:23.504 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n1:C 27 Jan 2021 12:49:23.504 # Redis version=6.0.10, bits=64, commit=00000000, modified=0, pid=1, just started\r\n1:C 27 Jan 2021 12:49:23.504 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf\r\n1:M 27 Jan 2021 12:49:23.510 * Running mode=standalone, port=6379.\r\n1:M 27 Jan 2021 12:49:23.510 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\r\n1:M 27 Jan 2021 12:49:23.510 # Server initialized\r\n1:M 27 Jan 2021 12:49:23.510 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n1:M 27 Jan 2021 12:49:23.510 # === ASSERTION FAILED ===\r\n1:M 27 Jan 2021 12:49:23.510 # ==> server.c:4864 '!ret' is not true\r\n1:M 27 Jan 2021 12:49:23.510 # (forcing SIGSEGV to print the bug report.)\r\n1:M 27 Jan 2021 12:49:23.510 # Redis 6.0.10 crashed by signal: 11, si_code: 1\r\n1:M 27 Jan 2021 12:49:23.510 # Crashed running the instruction at: 0x557f18d908\r\n1:M 27 Jan 2021 12:49:23.510 # Accessing address: 0xffffffffffffff\r\n1:M 27 Jan 2021 12:49:23.510 # Failed assertion: !ret (server.c:4864)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\nredis-server *:6379(_serverAssert+0x80)[0x557f18d908]\r\n\r\nBacktrace:\r\nredis-server *:6379(logStackTrace+0x40)[0x557f190020]\r\nredis-server *:6379(sigsegvHandler+0xbc)[0x557f19082c]\r\nlinux-vdso.so.1(__kernel_rt_sigreturn+0x0)[0x7faba36510]\r\nredis-server *:6379(_serverAssert+0x80)[0x557f18d908]\r\nredis-server *:6379(linuxMadvFreeForkBugCheck+0x2c8)[0x557f14de40]\r\nredis-server *:6379(main+0x380)[0x557f1402b8]\r\n/lib/aarch64-linux-gnu/libc.so.6(__libc_start_main+0xe4)[0x7fab444d24]\r\nredis-server *:6379(+0x3e708)[0x557f140708]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.10\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:5d9f47a024d32aad\r\nredis_mode:standalone\r\nos:Linux 4.4.38-docker aarch64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:8.3.0\r\nprocess_id:1\r\nrun_id:eab007f431513e71ca2794e1cb833ae6d48a88dc\r\ntcp_port:6379\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:1139027\r\nexecutable:/data/redis-server\r\nconfig_file:\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_recent_max_input_buffer:0\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:837328\r\nused_memory_human:817.70K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:837328\r\nused_memory_peak_human:817.70K\r\nused_memory_peak_perc:inf%\r\nused_memory_overhead:0\r\nused_memory_startup:0\r\nused_memory_dataset:837328\r\nused_memory_dataset_perc:100.00%\r\nallocator_allocated:0\r\nallocator_active:0\r\nallocator_resident:0\r\ntotal_system_memory:8230514688\r\ntotal_system_memory_human:7.67G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:nan\r\nallocator_frag_bytes:0\r\nallocator_rss_ratio:nan\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:nan\r\nrss_overhead_bytes:0\r\nmem_fragmentation_ratio:nan\r\nmem_fragmentation_bytes:0\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1611751763\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:0\r\ntotal_writes_processed:0\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:a0c809d969f391d8cb2bea28b537d5aee76e68f3\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.016000\r\nused_cpu_user:0.048000\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n1:M 27 Jan 2021 12:49:23.511 # \r\nX18:0000000000000000 X19:000000557f2cd000\r\nX20:0000000000001300 X21:000000557f258628\r\nX22:000000557f25afb0 X23:000000557f2de1f0\r\nX24:000000557f2cd000 X25:0000000000000001\r\nX26:0000000000000000 X27:0000000000000000\r\nX28:0000000000000000 X29:0000007fecd255c0\r\nX30:000000557f18d900\r\npc:000000557f18d908 sp:0000007fecd255c0\r\npstate:0000000060000000 fault_address:00ffffffffffffff\r\n\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255cf) -> 0000000000000000\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255ce) -> 0000000000000001\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255cd) -> 000000557f2cd000\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255cc) -> 000000557f2de1f0\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255cb) -> 0000007fecd25730\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255ca) -> 0000007fecd258b8\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c9) -> 0000000000000000\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c8) -> 000000557f2de1f0\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c7) -> 000000557f1402b8\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c6) -> 0000007fecd256a0\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c5) -> 0000007fecd25730\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c4) -> 0000007fecd258b8\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c3) -> 0000007faba28000\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c2) -> 0000007faba29000\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c1) -> 000000557f14de40\r\n1:M 27 Jan 2021 12:49:23.511 # (0000007fecd255c0) -> 0000007fecd255f0\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n*** Preparing to test memory region 557f2d9000 (974848 bytes)\r\n*** Preparing to test memory region 7faa700000 (13631488 bytes)\r\n*** Preparing to test memory region 7fab592000 (16384 bytes)\r\n*** Preparing to test memory region 7fab5c1000 (16384 bytes)\r\n*** Preparing to test memory region 7fab868000 (16384 bytes)\r\n*** Preparing to test memory region 7fab94a000 (4096 bytes)\r\n*** Preparing to test memory region 7faba29000 (4096 bytes)\r\n*** Preparing to test memory region 7faba2b000 (32768 bytes)\r\n.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: _serverAssert (base: 0x557f18d888)\r\nModule: redis-server *:6379 (base 0x557f102000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x557f18d888 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n1:M 27 Jan 2021 12:49:23.784 # dump of function (hexdump of 256 bytes):\r\nfd7bbda9fd030091f35301a9130a0090f403022af55b02a9f60300aaf50301aa605e46f900e44db96003003460008052c10600f021c0239162e7fe97e40316aae303142ae20315aa60008052c10600f0214024915be7fe97625e46f960008052c10600f021c0249156e806f955ec06f954e00db953e7fe9700008092010f805201000039f35341a9f55b42a9fd7bc3a8c0035fd68bfeff97e5ffff171f2003d5fd7bb2a9010a0090fd030091215c46f9f35301a9f40300aaf76303a920e44db94008003460008052c10600f0218025913ce7fe97825e40f960008052c10600f021202691130080d2d70600f035e7fe97800640f9020480d2e1030191e5390194\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/redis/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n```\r\n\r\nNote that running older docker/redis versions work just fine.\r\n\r\nThe following is running with no crushes:\r\n\r\n```\r\nsudo docker run -p 6379:6379 --memory=100m --memory-reservation=100m --name my_name -d --restart always arm64v8/redis:5\r\n```\r\n\r\nOS details:\r\n```\r\n$ uname -a\r\nLinux tegra-ubuntu 4.4.38-tegra #8 SMP PREEMPT Fri Nov 9 13:01:46 CST 2018 aarch64 aarch64 aarch64 GNU/Linux\r\n```\r\n",
  "state": "closed",
  "created_at": "2021-01-27T13:09:30Z",
  "updated_at": "2021-01-28T08:33:46Z",
  "closed_at": "2021-01-28T08:33:46Z",
  "labels": [],
  "comments_data": [
    {
      "id": 768289552,
      "user": "yossigo",
      "created_at": "2021-01-27T13:36:16Z",
      "body": "Hello @ofirule, long time! hope you're well.\r\n\r\nRedis is trying to detect if the Linux kernel is vulnerable to a critical bug (arm64-specific), and the test itself crashes (asserts). It's going to be solved by #8405 but we're still a bit in the dark as to what's triggering this problem. I have some questions that may help identifying it:\r\n* What OS release and kernel do you use?\r\n* Any specific kernel configuration/tuning done?\r\n* Do you experience the same problem if you download, compile and run unstable `redis-server` on the host and not insider docker?\r\n\r\nThanks!"
    },
    {
      "id": 768335029,
      "user": "ofirule",
      "created_at": "2021-01-27T14:47:23Z",
      "body": "Hi @yossigo, indeed  long time, all is well, hope you're well too.\r\n\r\n- OS info :\r\n```\r\n$ uname -a\r\nLinux tegra-ubuntu 4.4.38-tegra #8 SMP PREEMPT Fri Nov 9 13:01:46 CST 2018 aarch64 aarch64 aarch64 GNU/Linux\r\n```\r\n\r\nit's basically ubuntu 16.04 for aarch64 with modifications nvidia made to support their HW\r\n\r\n-  kernel configuration/tuning:\r\nI didn't made any, NVIDIA probably did some. I can add `/proc/config.gz` (in an email or some other method since it's 5k rows long) \r\n\r\n- Running unstable redis without docker (also crash):\r\n\r\n```\r\n$ ./redis-server \r\n24204:C 27 Jan 2021 14:36:22.716 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n24204:C 27 Jan 2021 14:36:22.716 # Redis version=255.255.255, bits=64, commit=9e56d396, modified=0, pid=24204, just started\r\n24204:C 27 Jan 2021 14:36:22.716 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf\r\n24204:M 27 Jan 2021 14:36:22.719 # You requested maxclients of 10000 requiring at least 10032 max file descriptors.\r\n24204:M 27 Jan 2021 14:36:22.719 # Server can't set maximum open files to 10032 because of OS error: Operation not permitted.\r\n24204:M 27 Jan 2021 14:36:22.719 # Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase 'ulimit -n'.\r\n24204:M 27 Jan 2021 14:36:22.719 * monotonic clock: POSIX clock_gettime\r\n                _._                                                  \r\n           _.-``__ ''-._                                             \r\n      _.-``    `.  `_.  ''-._           Redis 255.255.255 (9e56d396/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 24204\r\n  `-._    `-._  `-./  _.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |           http://redis.io        \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |                                  \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n      `-._    `-.__.-'    _.-'                                       \r\n          `-._        _.-'                                           \r\n              `-.__.-'                                               \r\n\r\n24204:M 27 Jan 2021 14:36:22.721 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\r\n24204:M 27 Jan 2021 14:36:22.721 # Server initialized\r\n24204:M 27 Jan 2021 14:36:22.721 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n24204:M 27 Jan 2021 14:36:22.721 # === ASSERTION FAILED ===\r\n24204:M 27 Jan 2021 14:36:22.721 # ==> server.c:5241 '!ret' is not true\r\n\r\n------ STACK TRACE ------\r\n\r\nBacktrace:\r\n./redis-server *:6379(linuxMadvFreeForkBugCheck+0x2ac)[0x43d424]\r\n./redis-server *:6379(main+0x4cc)[0x42e554]\r\n/lib/aarch64-linux-gnu/libc.so.6(__libc_start_main+0xe0)[0x7fa17b78a0]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:255.255.255\r\nredis_git_sha1:9e56d396\r\nredis_git_dirty:0\r\nredis_build_id:c8c1bdc8e7de6bf1\r\nredis_mode:standalone\r\nos:Linux 4.4.38-tegra aarch64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:5.4.0\r\nprocess_id:24204\r\nprocess_supervised:no\r\nrun_id:0054db4695b3831df1ca8254b07ff45ca27d54c7\r\ntcp_port:6379\r\nserver_time_usec:1611758182711932\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:1145446\r\nexecutable:/home/nvidia/dev/redis/src/./redis-server\r\nconfig_file:\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:0\r\ncluster_connections:0\r\nmaxclients:4064\r\nclient_recent_max_input_buffer:0\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:530832\r\nused_memory_human:518.39K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:530832\r\nused_memory_peak_human:518.39K\r\nused_memory_peak_perc:inf%\r\nused_memory_overhead:0\r\nused_memory_startup:0\r\nused_memory_dataset:530832\r\nused_memory_dataset_perc:100.00%\r\nallocator_allocated:0\r\nallocator_active:0\r\nallocator_resident:0\r\ntotal_system_memory:8236527616\r\ntotal_system_memory_human:7.67G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:nan\r\nallocator_frag_bytes:0\r\nallocator_rss_ratio:nan\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:nan\r\nrss_overhead_bytes:0\r\nmem_fragmentation_ratio:nan\r\nmem_fragmentation_bytes:0\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1611758182\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\ntotal_forks:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:0\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:0\r\ntotal_writes_processed:0\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:f0a0c9299db03fe2bca83e7aa4d4f06156da1c56\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.008000\r\nused_cpu_user:0.008000\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\nused_cpu_sys_main_thread:0.008000\r\nused_cpu_user_main_thread:0.008000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\n\r\n# Errorstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n*** Preparing to test memory region 5d4000 (2416640 bytes)\r\n*** Preparing to test memory region 7fa0e00000 (8388608 bytes)\r\n*** Preparing to test memory region 7fa18db000 (16384 bytes)\r\n*** Preparing to test memory region 7fa1907000 (16384 bytes)\r\n*** Preparing to test memory region 7fa1a07000 (4096 bytes)\r\n*** Preparing to test memory region 7fa1a09000 (20480 bytes)\r\n.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/redis/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\nAborted (core dumped)\r\n```\r\n"
    },
    {
      "id": 768381497,
      "user": "yossigo",
      "created_at": "2021-01-27T15:52:58Z",
      "body": "@ofirule Thanks, so we know it's not a Docker issue.\r\nOne last ask, can you try to build and run directly from #8405 and paste the Redis log?\r\nThe log file should include more information about the error code we receive (and if you include `ignore-warnings ARM64-COW-BUG` it should even run)."
    },
    {
      "id": 768406045,
      "user": "ofirule",
      "created_at": "2021-01-27T16:29:05Z",
      "body": "very nice, worked exactly as you said\r\n\r\nBuilding from your branch redis failed with informative error:\r\n```\r\n$ ./redis-server \r\n13030:C 27 Jan 2021 16:20:00.657 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n13030:C 27 Jan 2021 16:20:00.657 # Redis version=255.255.255, bits=64, commit=b9f36a1f, modified=0, pid=13030, just started\r\n13030:C 27 Jan 2021 16:20:00.658 # Warning: no config file specified, using the default config. In order to specify a config file use ./redis-server /path/to/redis.conf\r\n13030:M 27 Jan 2021 16:20:00.663 # You requested maxclients of 10000 requiring at least 10032 max file descriptors.\r\n13030:M 27 Jan 2021 16:20:00.663 # Server can't set maximum open files to 10032 because of OS error: Operation not permitted.\r\n13030:M 27 Jan 2021 16:20:00.663 # Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase 'ulimit -n'.\r\n13030:M 27 Jan 2021 16:20:00.663 * monotonic clock: POSIX clock_gettime\r\n                _._                                                  \r\n           _.-``__ ''-._                                             \r\n      _.-``    `.  `_.  ''-._           Redis 255.255.255 (b9f36a1f/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 13030\r\n  `-._    `-._  `-./  _.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |           http://redis.io        \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |                                  \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n      `-._    `-.__.-'    _.-'                                       \r\n          `-._        _.-'                                           \r\n              `-.__.-'                                               \r\n\r\n13030:M 27 Jan 2021 16:20:00.665 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\r\n13030:M 27 Jan 2021 16:20:00.665 # Server initialized\r\n13030:M 27 Jan 2021 16:20:00.666 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\r\n13030:M 27 Jan 2021 16:20:00.666 # Failed to madvise(): Invalid argument\r\n13030:M 27 Jan 2021 16:20:00.666 # Failed to test the kernel for a bug that could lead to data corruption during background save.\r\n13030:M 27 Jan 2021 16:20:00.666 # Redis will now exit to prevent data corruption. Note that it is possible to suppress this warning by setting the following config: ignore-warnings ARM64-COW-BUG\r\n```\r\n\r\nand redis was running when I included `ignore-warnings ARM64-COW-BUG`\r\n```\r\n$ ./redis-server myconf \r\n16113:C 27 Jan 2021 16:24:36.756 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n16113:C 27 Jan 2021 16:24:36.756 # Redis version=255.255.255, bits=64, commit=b9f36a1f, modified=0, pid=16113, just started\r\n16113:C 27 Jan 2021 16:24:36.756 # Configuration loaded\r\n16113:M 27 Jan 2021 16:24:36.759 # You requested maxclients of 10000 requiring at least 10032 max file descriptors.\r\n16113:M 27 Jan 2021 16:24:36.759 # Server can't set maximum open files to 10032 because of OS error: Operation not permitted.\r\n16113:M 27 Jan 2021 16:24:36.760 # Current maximum open files is 4096. maxclients has been reduced to 4064 to compensate for low ulimit. If you need higher maxclients increase 'ulimit -n'.\r\n16113:M 27 Jan 2021 16:24:36.760 * monotonic clock: POSIX clock_gettime\r\n                _._                                                  \r\n           _.-``__ ''-._                                             \r\n      _.-``    `.  `_.  ''-._           Redis 255.255.255 (b9f36a1f/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 16113\r\n  `-._    `-._  `-./  _.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |           http://redis.io        \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |                                  \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n      `-._    `-.__.-'    _.-'                                       \r\n          `-._        _.-'                                           \r\n              `-.__.-'                                               \r\n\r\n16113:M 27 Jan 2021 16:24:36.761 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.\r\n16113:M 27 Jan 2021 16:24:36.761 # Server initialized\r\n16113:M 27 Jan 2021 16:24:36.761 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\r\n16113:M 27 Jan 2021 16:24:36.762 # Failed to madvise(): Invalid argument\r\n16113:M 27 Jan 2021 16:24:36.762 # Failed to test the kernel for a bug that could lead to data corruption during background save.\r\n16113:M 27 Jan 2021 16:24:36.762 * Ready to accept connections\r\n```"
    },
    {
      "id": 768411143,
      "user": "yossigo",
      "created_at": "2021-01-27T16:37:05Z",
      "body": "So apparently `MADV_FREE` is not available before 4.5, which explains the `EINVAL` error. Thanks @ofirule for helping to track this down!"
    }
  ]
}