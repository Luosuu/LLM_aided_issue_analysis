{
  "issue_number": 9802.0,
  "title": "[BUG] Sentinel Config rewrite comment not ordered",
  "body": "**Describe the bug**\r\n\r\nOn Sentinel config rewrite, rewritten lines appear below \"\\# Generated by CONFIG REWRITE\" line. However this is misleading as other lines in the configuration file can be re-written as well, because automatically changed configuration directives can actually occur above this message, it is misleading in understanding what is static config v's automatic config.\r\n\r\n**To reproduce**\r\n\r\nCreate simple sentinel.conf with line:\r\n\r\n...\r\nsentinel monitor mymaster 192.168.0.1 6379 2\r\n...\r\n\r\nStart sentinel on ie 192.168.0.1\r\n\r\n**Expected behavior**\r\n\r\n[failure rewrite]\r\n...\r\n\\# Generated by CONFIG REWRITE\r\nsentinel monitor mymaster \\<NEW IP ADDRESS\\> 6379 2\r\n...\r\n\r\nNOT\r\n[failure rewrite]\r\n..\r\nsentinel monitor mymaster \\<NEW IP ADDRESS\\> 6379 2\r\n...\r\n\\# Generated by CONFIG REWRITE\r\n...\r\n\r\n**Additional information**\r\n\r\nPriming a cluster from config files using sentinel monitor X.X.X.X assumes X.X.X.X is always referring to co-located redis instance, at least in conventional docs. However to initialise a cluster from scratch with functioning sentinel failover, all sentinel monitor configs should point to same redis, centralised instance. ie start from a functioning cluster. Then sentinel takes over (and manages ie config monitor entries). If sentinel did not take over, then this issue would not be relevant. However, sentinel does take over, and rewrites the config file, whenever the original master fails and the failed-to instance has a monitor config line that needs updating.\r\n\r\nRedis v6.2.6 (Gentoo)\r\n",
  "state": "open",
  "created_at": "2021-11-18T09:17:42Z",
  "updated_at": "2021-11-21T14:24:53Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 973293459,
      "user": "hwware",
      "created_at": "2021-11-18T21:39:07Z",
      "body": "@yossigo Could you please share your idea about this part? I do not think this is a bug, but maybe we could improve the log format. Thanks"
    },
    {
      "id": 973901172,
      "user": "damobrisbane",
      "created_at": "2021-11-19T09:26:46Z",
      "body": "Hi @yossigo. When the config file gets dynamically updated, you would expect only the parts *below* the line _Generated by CONFIG REWRITE_, get updated. However this is not the case, for example any lines above config rewrite comment, like the _monitor_ line, can be dynamically updated as well. Anything that gets dynamically updated, is better grouped together, below the CONFIG REWRITE comment. An alternative perhaps, is dont bother with it because it seems pretty complicated way of doing things anyway, but is there somewhere that says, \"these are the configuration directives that *can, or might*, get dynamically updated by the Sentinel configuration update process\"."
    },
    {
      "id": 974826784,
      "user": "yossigo",
      "created_at": "2021-11-21T14:24:53Z",
      "body": "@damobrisbane I'm not able to reproduce this issue, for example:\r\n\r\n```\r\nyossi@ubuntu:~/redis$ cat > test.conf\r\nsentinel monitor mymaster 127.0.0.1 6379 2\r\nyossi@ubuntu:~/redis$ ./src/redis-sentinel test.conf\r\n47017:X 21 Nov 2021 16:22:20.897 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n47017:X 21 Nov 2021 16:22:20.897 # Redis version=6.2.6, bits=64, commit=4930d19e, modified=0, pid=47017, just started\r\n[...]\r\n47017:X 21 Nov 2021 16:22:20.901 # Sentinel ID is 95958f6cfee04a874768a5fd5f36350095e6e588\r\n47017:X 21 Nov 2021 16:22:20.901 # +monitor master mymaster 127.0.0.1 6379 quorum 2\r\n^C47017:signal-handler (1637504541) Received SIGINT scheduling shutdown...\r\n47017:X 21 Nov 2021 16:22:21.593 # User requested shutdown...\r\n47017:X 21 Nov 2021 16:22:21.593 # Sentinel is now ready to exit, bye bye...\r\nyossi@ubuntu:~/redis$ cat test.conf \r\nsentinel monitor mymaster 127.0.0.1 6379 2\r\n# Generated by CONFIG REWRITE\r\nprotected-mode no\r\nport 26379\r\nuser default on nopass ~* &* +@all\r\ndir \"/home/yossi/redis\"\r\nsentinel myid 95958f6cfee04a874768a5fd5f36350095e6e588\r\nsentinel config-epoch mymaster 0\r\nsentinel leader-epoch mymaster 0\r\nsentinel current-epoch 0\r\n```"
    }
  ]
}