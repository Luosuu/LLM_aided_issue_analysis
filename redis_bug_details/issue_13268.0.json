{
  "issue_number": 13268.0,
  "title": "[BUG] When the bus_port is inaccessible, creating a cluster using redis-cli will result in an infinite wait without returning a failure",
  "body": "**Describe the bug**\r\n\r\nWhen the bus_port is inaccessible, creating a cluster using redis-cli will result in an infinite wait without returning a failure\r\n\r\n**To reproduce**\r\n\r\nk8s create redis pod yaml\r\n```yaml\r\n# Redis ConfigMap\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: redis-config\r\ndata:\r\n  redis.conf: |\r\n    port 6379\r\n    cluster-enabled yes\r\n    cluster-config-file /data/nodes.conf\r\n    cluster-node-timeout 5000\r\n    cluster-require-full-coverage no\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-1\r\n  labels:\r\n    app: redis-1\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-1\r\nspec:\r\n  selector:\r\n    app: redis-1\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-2\r\n  labels:\r\n    app: redis-2\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-2\r\nspec:\r\n  selector:\r\n    app: redis-2\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-3\r\n  labels:\r\n    app: redis-3\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-3\r\nspec:\r\n  selector:\r\n    app: redis-3\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-4\r\n  labels:\r\n    app: redis-4\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-4\r\nspec:\r\n  selector:\r\n    app: redis-4\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-5\r\n  labels:\r\n    app: redis-5\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-5\r\nspec:\r\n  selector:\r\n    app: redis-5\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: redis-6\r\n  labels:\r\n    app: redis-6\r\nspec:\r\n  containers:\r\n  - name: redis\r\n    image: redis:latest\r\n    ports:\r\n    - containerPort: 6379\r\n    command: [\"redis-server\", \"/redis/redis.conf\"]\r\n    volumeMounts:\r\n    - mountPath: /redis\r\n      name: redis-config\r\n  volumes:\r\n  - configMap:\r\n      name: redis-config\r\n    name: redis-config\r\n---\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  name: redis-6\r\nspec:\r\n  selector:\r\n    app: redis-6\r\n  ports:\r\n  - port: 6379\r\n    targetPort: 6379\r\n```\r\nk8s svc ip\r\n```shell\r\n kubectl get svc   \r\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\r\nredis-1      ClusterIP   172.19.184.80    <none>        6379/TCP   3m36s\r\nredis-2      ClusterIP   172.19.40.177    <none>        6379/TCP   3m36s\r\nredis-3      ClusterIP   172.19.177.153   <none>        6379/TCP   3m36s\r\nredis-4      ClusterIP   172.19.245.202   <none>        6379/TCP   3m36s\r\nredis-5      ClusterIP   172.19.90.76     <none>        6379/TCP   3m36s\r\nredis-6      ClusterIP   172.19.179.203   <none>        6379/TCP   3m36s\r\n```\r\n\r\nk8s exec redis-cli create redis-cluster\r\n```shell\r\nkubectl exec -it redis-1 -- redis-cli --cluster create --cluster-replicas 1 172.19.184.80:6379 172.19.40.177:6379 172.19.177.153:6379 172.19.245.202:6379 172.19.90.76:6379 172.19.179.203:6379 \r\n>>> Performing hash slots allocation on 6 nodes...\r\nMaster[0] -> Slots 0 - 5460\r\nMaster[1] -> Slots 5461 - 10922\r\nMaster[2] -> Slots 10923 - 16383\r\nAdding replica 172.19.90.76:6379 to 172.19.184.80:6379\r\nAdding replica 172.19.179.203:6379 to 172.19.40.177:6379\r\nAdding replica 172.19.245.202:6379 to 172.19.177.153:6379\r\nM: ec7a57860be9c3a082e6b98920c6014a6cf45af7 172.19.184.80:6379\r\n   slots:[0-5460] (5461 slots) master\r\nM: c7d130bf6348dbc0c36194def32bd8d832a87fcf 172.19.40.177:6379\r\n   slots:[5461-10922] (5462 slots) master\r\nM: 73035597353c5d5f7794c9a9efd539b9ce23c095 172.19.177.153:6379\r\n   slots:[10923-16383] (5461 slots) master\r\nS: 5d9a3714a44934e1f36da8e669ac939347404d9d 172.19.245.202:6379\r\n   replicates 73035597353c5d5f7794c9a9efd539b9ce23c095\r\nS: d5884f26da055197de5e6faa9fe2ade32223417c 172.19.90.76:6379\r\n   replicates ec7a57860be9c3a082e6b98920c6014a6cf45af7\r\nS: 30348065e1c898fa1f08b3113ae815552e0910eb 172.19.179.203:6379\r\n   replicates c7d130bf6348dbc0c36194def32bd8d832a87fcf\r\nCan I set the above configuration? (type 'yes' to accept): yes\r\n>>> Nodes configuration updated\r\n>>> Assign a different config epoch to each node\r\n>>> Sending CLUSTER MEET messages to join the cluster\r\nWaiting for the cluster to join\r\n............................................................................................\r\n```\r\n\r\n**Expected behavior**\r\n\r\ndon't stay indefinitely without exiting\r\n\r\n**Additional information**\r\n\r\nkind v0.22.0 go1.20.13 linux/amd64\r\n```\r\nkubectl get node\r\nNAME                 STATUS   ROLES                  AGE     VERSION\r\nkind-control-plane   Ready    control-plane,master   5d      v1.22.17\r\nkind-worker          Ready    <none>                 4d23h   v1.22.17\r\nkind-worker2         Ready    <none>                 4d23h   v1.22.17\r\n```\r\n",
  "state": "open",
  "created_at": "2024-05-14T06:16:56Z",
  "updated_at": "2024-05-15T02:04:42Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 2111446905,
      "user": "sys-liqian",
      "created_at": "2024-05-15T02:04:40Z",
      "body": "I also encountered this problem."
    }
  ]
}