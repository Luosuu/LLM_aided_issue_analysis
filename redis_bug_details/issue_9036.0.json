{
  "issue_number": 9036.0,
  "title": "[CRASH] Windows 10 - Redis Server gives an error when trying to start, and Redis-cli cannot make connection with target machine.",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n[2072] 02 Jun 10:45:55.789 * Redis 3.2.100 (00000000/0) 64 bit, standalone mode, port 6379, pid 2072 ready to start.\r\n[2072] 02 Jun 10:45:55.789 # Server started, Redis version 3.2.100\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\nRedis version: 3.2.100\r\n[2072] 02 Jun 10:45:55.806 # === ASSERTION FAILED OBJECT CONTEXT ===\r\n[2072] 02 Jun 10:45:55.806 # Object type: 0\r\n[2072] 02 Jun 10:45:55.806 # Object encoding: 0\r\n[2072] 02 Jun 10:45:55.806 # Object refcount: 1\r\n[2072] 02 Jun 10:45:55.806 # Object raw string len: 0\r\n[2072] 02 Jun 10:45:55.806 # Object raw string content: \"\"\r\n[2072] 02 Jun 10:45:55.806 # === ASSERTION FAILED ===\r\n[2072] 02 Jun 10:45:55.806 # ==> ..\\src\\db.c:164 'retval == DICT_OK' is not true\r\n[2072] 02 Jun 10:45:55.806 # --- EXCEPTION_ACCESS_VIOLATION\r\n[2072] 02 Jun 10:45:55.814 # --- STACK TRACE\r\nredis-server.exe!LogStackTrace(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:95)(0x00D0E340, 0x00D0FF60, 0x40028F20, 0x4013A7F8)\r\nredis-server.exe!UnhandledExceptiontHandler(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x00000000, 0x00000000, 0x00000000, 0x00000000)\r\nKERNELBASE.dll!UnhandledExceptionFilter(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0xED43E1EC, 0xED40F838, 0x00000000, 0x00000000)\r\nntdll.dll!memset(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x00D0FF60, 0xED43E1EC, 0x00D0E410, 0x00000000)\r\nntdll.dll!_C_specific_handler(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x00000000, 0x00D0E910, 0x00D0EFF0, 0x00D0EFF0)\r\nntdll.dll!_chkstk(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x00D0EFF0, 0xED2C0000, 0xED2C485B, 0xED43E1EC)\r\nntdll.dll!RtlRestoreContext(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x0145EB40, 0x00000000, 0x5006AEC0, 0x40170C6A)\r\nntdll.dll!KiUserExceptionDispatcher(c:\\release\\redis\\src\\win32_interop\\win32_stacktrace.cpp:185)(0x5006AEC0, 0x40170C50, 0x4016FC40, 0x000000A4)\r\nredis-server.exe!dbAdd(c:\\release\\redis\\src\\db.c:164)(0x00000000, 0x00000000, 0x00D0F3E0, 0x5006AEC0)\r\nredis-server.exe!rdbLoad(c:\\release\\redis\\src\\rdb.c:1414)(0x8C2BD761, 0x00000002, 0x00000031, 0x0000002F)\r\nredis-server.exe!loadDataFromDisk(c:\\release\\redis\\src\\server.c:3850)(0x60B799A3, 0x40178288, 0x00D0EF10, 0x00D0EF30)\r\nredis-server.exe!redis_main(c:\\release\\redis\\src\\server.c:4134)(0x005771B0, 0x60B799A3, 0x021439B0, 0x00000002)\r\nredis-server.exe!main(c:\\release\\redis\\src\\win32_interop\\win32_qfork.cpp:1241)(0x00000016, 0xFFFFFFFF, 0x00000016, 0x00000000)\r\nredis-server.exe!ServiceWorkerThread(c:\\release\\redis\\src\\win32_interop\\win32_service.cpp:484)(0x00000000, 0x00000000, 0x00000000, 0x00000000)\r\nKERNEL32.DLL!BaseThreadInitThunk(c:\\release\\redis\\src\\win32_interop\\win32_service.cpp:484)(0x00000000, 0x00000000, 0x00000000, 0x00000000)\r\nntdll.dll!RtlUserThreadStart(c:\\release\\redis\\src\\win32_interop\\win32_service.cpp:484)(0x00000000, 0x00000000, 0x00000000, 0x00000000)\r\nntdll.dll!RtlUserThreadStart(c:\\release\\redis\\src\\win32_interop\\win32_service.cpp:484)(0x00000000, 0x00000000, 0x00000000, 0x00000000)\r\n[2072] 02 Jun 10:45:55.830 # --- INFO OUTPUT\r\n# Server\r\nredis_version:3.2.100\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:dd26f1f93c5130ee\r\nredis_mode:standalone\r\nos:Windows  \r\narch_bits:64\r\nmultiplexing_api:WinSock_IOCP\r\nprocess_id:2072\r\nrun_id:ecbd063fe6ea03616d4ec032d1aacadb497a1783\r\ntcp_port:6379\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:12032419\r\nexecutable:C:\\Program Files\\Redis\\\"C:\\Program Files\\Redis\\redis-server.exe\"\r\nconfig_file:C:\\Program Files\\Redis\\redis.windows-service.conf\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:1044368\r\nused_memory_human:1019.89K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:1044368\r\nused_memory_peak_human:1019.89K\r\ntotal_system_memory:0\r\ntotal_system_memory_human:0B\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:2097152000\r\nmaxmemory_human:1.95G\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:0.00\r\nmem_allocator:jemalloc-3.6.0\r\n\r\n# Persistence\r\nloading:1\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1622645155\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\nloading_start_time:jd\r\nloading_total_bytes:1622645155\r\nloading_loaded_bytes:670807\r\nloading_loaded_perc:0.00\r\nloading_eta_seconds:jd\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.05\r\nused_cpu_user:0.11\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=1,expires=0,avg_ttl=0\r\n[2072] 02 Jun 10:45:55.830 # \r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n\r\nI was trying to start my redis server using redis-server.exe, and this error came up. Redis does not start upon reboot in services.msc, and when I run redis-cli, I get a separate issue saying \"Could not connect to Redis at 127.0.0.1:6379: No connection could be made because the target machine actively refused it.\" Any clues with how to fix this?\r\n\r\nUsing Windows 10 Home, build 21390.1\r\nJust tried to start redis-server.exe using redis-server with a command prompt in C:/Program Files/Redis\r\n",
  "state": "closed",
  "created_at": "2021-06-02T15:16:48Z",
  "updated_at": "2021-08-13T12:56:58Z",
  "closed_at": "2021-06-27T10:47:33Z",
  "labels": [
    "state:to-be-closed"
  ],
  "comments_data": [
    {
      "id": 853161841,
      "user": "oranagra",
      "created_at": "2021-06-02T16:14:43Z",
      "body": "Redis (the one in this repository) does not run on windows, so you probably need to open this issue on another repo. \r\nBy looking at the crash log I would guess that for some reason the RDB file has two keys with the same name. \r\nyou can try to load that rdb file into normal (Linux) redis or analyze it with some other rdb processing tool (like redis-rdb-tools) to try and prove that theory.\r\nIf that's correct, then the question is how that happened, and then you need to look into the redis (I assume the windows fork) that generated that rdb file (which looks like it's based on a very old version of Redis). "
    },
    {
      "id": 898437190,
      "user": "my9988",
      "created_at": "2021-08-13T12:53:14Z",
      "body": "if you want to use windows version,you can try to download redis6.2.5 from [link removed by @oranagra], it is stable"
    },
    {
      "id": 898439285,
      "user": "oranagra",
      "created_at": "2021-08-13T12:56:58Z",
      "body": "@my9988 that link seems suspicious to me and I decided to remove it.\r\nRedis is open source, and github is usually used to store source code.\r\nThis link referred to a repo that was created just a few weeks ago, and contained binary files for which the content cannot be verified.\r\nHad this been a link to another repo hosting sources or a commercial or free company offering redis binaries, I wouldn't probably mind.\r\n\r\nAlso, considering porting redis to windows is complicated, and the very fact that there are commercial companies offering that, makes me wonder about the content of these binary files too.\r\n\r\nHope I'm wrong and you can clear that up."
    }
  ]
}