{
  "issue_number": 11104.0,
  "title": "[BUG] Slot rebalancing can stop due to loading error",
  "body": "**Describe the bug**\r\n\r\nWhen I try to move all slots on two or more nodes to other nodes using `redis-cli --cluster rebalance`, rebalancing can be stopped along the way.\r\n\r\n**To reproduce**\r\n\r\nWhen I have a Redis cluster of 12 master nodes, and want to scale it down to 6 masters, I would be able to use rebalance command like this.\r\n\r\n```\r\nredis-cli --cluster rebalance \\\r\n  --cluster-weight {node07_id}=0 \\\r\n  --cluster-weight {node08_id}=0 \\\r\n  --cluster-weight {node09_id}=0\r\n  --cluster-weight {node10_id}=0 \\\r\n  --cluster-weight {node11_id}=0 \\\r\n  --cluster-weight {node12_id}=0\r\n  __worker_node_addr__\r\n```\r\n\r\nAnd it can stop with the following errors:\r\n- *ERR Please use SETSLOT only with masters.*\r\n- *LOADING Redis is loading the dataset in memory*\r\n\r\n**Expected behavior**\r\n\r\nLoading errors can also be ignored.\r\n\r\n**Additional information**\r\n\r\nThis problem occurs because nodes that were recognized as masters at the beginning of redis-cli execution are converted to replicas as their slots become 0.\r\n\r\nWhen the node that used to be the master changes to a replica, and executes the `CLUSTER SETSLOT` command on that node, the following error occurs.\r\n\r\n- *ERR Please use SETSLOT only with masters.*\r\n\r\nHowever, during the process of becoming a replica and synchronizing with the new master, a `LOADING error` will occur for the `CLUSTER SETSLOT` command.\r\n\r\n- *LOADING Redis is loading the dataset in memory*\r\n\r\nOf course, there were patches related to this in the past.\r\n- issue: https://github.com/redis/redis/issues/9223\r\n- fixed by: https://github.com/redis/redis/pull/10381\r\n\r\nBut what was previously patched was only for **source**, and the problem I ran into was that of notifications to **others**.\r\nhttps://github.com/redis/redis/blob/44859a41ee63b52632f0726d7bf1e6ca1ce47f83/src/redis-cli.c#L4479\r\n\r\nI think the error can be ignored for the following reasons.\r\n- This error will occur only when changing from master to replica.\r\n- Nodes that were replicas from the beginning were not targets to notify.\r\n\r\nAnother solution is to omit the notification to nodes that do not have any slots. However, I am not sure that there is no side effect.\r\n",
  "state": "open",
  "created_at": "2022-08-11T10:24:04Z",
  "updated_at": "2022-08-11T10:30:17Z",
  "closed_at": null,
  "labels": [],
  "comments_data": []
}