{
  "issue_number": 8173.0,
  "title": "[BUG] Redis unstable make fails with BUILD_TLS=yes ",
  "body": "Running `make BUILD_TLS=yes` fails in the the latest redis-unstable version. I get this error, both on my Mac Mini with M1 chip and my MacBook Pro 16\" Intel chip on macOS Big Sur.\r\n\r\n```\r\nfranciscofabian@Mac-mini redis-unstable % make BUILD_TLS=yes\r\ncd src && /Library/Developer/CommandLineTools/usr/bin/make all\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n    CC Makefile.dep\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\nrm -rf redis-server redis-sentinel redis-cli redis-benchmark redis-check-rdb redis-check-aof *.o *.gcda *.gcno *.gcov redis.info lcov-html Makefile.dep dict-benchmark\r\nrm -f adlist.d quicklist.d ae.d anet.d dict.d server.d sds.d zmalloc.d lzf_c.d lzf_d.d pqsort.d zipmap.d sha1.d ziplist.d release.d networking.d util.d object.d db.d replication.d rdb.d t_string.d t_list.d t_set.d t_zset.d t_hash.d config.d aof.d pubsub.d multi.d debug.d sort.d intset.d syncio.d cluster.d crc16.d endianconv.d slowlog.d scripting.d bio.d rio.d rand.d memtest.d crcspeed.d crc64.d bitops.d sentinel.d notify.d setproctitle.d blocked.d hyperloglog.d latency.d sparkline.d redis-check-rdb.d redis-check-aof.d geo.d lazyfree.d module.d evict.d expire.d geohash.d geohash_helper.d childinfo.d defrag.d siphash.d rax.d t_stream.d listpack.d localtime.d lolwut.d lolwut5.d lolwut6.d acl.d gopher.d tracking.d connection.d tls.d sha256.d timeout.d setcpuaffinity.d monotonic.d anet.d adlist.d dict.d redis-cli.d zmalloc.d release.d ae.d crcspeed.d crc64.d siphash.d crc16.d monotonic.d cli_common.d ae.d anet.d redis-benchmark.d adlist.d dict.d zmalloc.d release.d crcspeed.d crc64.d siphash.d crc16.d monotonic.d cli_common.d\r\n(cd ../deps && /Library/Developer/CommandLineTools/usr/bin/make distclean)\r\n(cd hiredis && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd linenoise && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd lua && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd jemalloc && [ -f Makefile ] && /Library/Developer/CommandLineTools/usr/bin/make distclean) > /dev/null || true\r\n(cd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(rm -f .make-*)\r\n(rm -f .make-*)\r\necho STD=-pedantic -DREDIS_STATIC='' -std=c11 >> .make-settings\r\necho WARN=-Wall -W -Wno-missing-field-initializers >> .make-settings\r\necho OPT=-O2 >> .make-settings\r\necho MALLOC=libc >> .make-settings\r\necho BUILD_TLS=yes >> .make-settings\r\necho USE_SYSTEMD= >> .make-settings\r\necho CFLAGS= >> .make-settings\r\necho LDFLAGS= >> .make-settings\r\necho REDIS_CFLAGS= >> .make-settings\r\necho REDIS_LDFLAGS= >> .make-settings\r\necho PREV_FINAL_CFLAGS=-pedantic -DREDIS_STATIC='' -std=c11 -Wall -W -Wno-missing-field-initializers -O2 -g -ggdb   -I../deps/hiredis -I../deps/linenoise -I../deps/lua/src -I../deps/hdr_histogram -DUSE_OPENSSL -I/usr/local/opt/openssl/include >> .make-settings\r\necho PREV_FINAL_LDFLAGS=  -g -ggdb -L/usr/local/opt/openssl/lib >> .make-settings\r\n(cd ../deps && /Library/Developer/CommandLineTools/usr/bin/make hiredis linenoise lua hdr_histogram)\r\n(cd hiredis && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd linenoise && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd lua && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd jemalloc && [ -f Makefile ] && /Library/Developer/CommandLineTools/usr/bin/make distclean) > /dev/null || true\r\n(cd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(rm -f .make-*)\r\n(echo \"\" > .make-ldflags)\r\n(echo \"\" > .make-cflags)\r\nMAKE hiredis\r\ncd hiredis && /Library/Developer/CommandLineTools/usr/bin/make static USE_SSL=1\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb alloc.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb net.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb hiredis.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb sds.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb async.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb read.c\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb sockcompat.c\r\nar rcs libhiredis.a alloc.o net.o hiredis.o sds.o async.o read.o sockcompat.o\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: libhiredis.a(sockcompat.o) has no symbols\r\ncc -std=c99 -pedantic -c -O3 -fPIC  -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb ssl.c\r\nar rcs libhiredis_ssl.a ssl.o\r\nMAKE linenoise\r\ncd linenoise && /Library/Developer/CommandLineTools/usr/bin/make\r\ncc  -Wall -Os -g  -c linenoise.c\r\nMAKE lua\r\ncd lua/src && /Library/Developer/CommandLineTools/usr/bin/make all CFLAGS=\"-O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP \" MYLDFLAGS=\"\" AR=\"ar rc\"\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lapi.o lapi.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lcode.o lcode.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ldebug.o ldebug.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ldo.o ldo.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ldump.o ldump.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lfunc.o lfunc.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lgc.o lgc.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o llex.o llex.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lmem.o lmem.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lobject.o lobject.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lopcodes.o lopcodes.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lparser.o lparser.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lstate.o lstate.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lstring.o lstring.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ltable.o ltable.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ltm.o ltm.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lundump.o lundump.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lvm.o lvm.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lzio.o lzio.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o strbuf.o strbuf.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o fpconv.o fpconv.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lauxlib.o lauxlib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lbaselib.o lbaselib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ldblib.o ldblib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o liolib.o liolib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lmathlib.o lmathlib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o loslib.o loslib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o ltablib.o ltablib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lstrlib.o lstrlib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o loadlib.o loadlib.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o linit.o linit.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lua_cjson.o lua_cjson.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lua_struct.o lua_struct.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lua_cmsgpack.o lua_cmsgpack.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lua_bit.o lua_bit.c\r\nar rc liblua.a lapi.o lcode.o ldebug.o ldo.o ldump.o lfunc.o lgc.o llex.o lmem.o lobject.o lopcodes.o lparser.o lstate.o lstring.o ltable.o ltm.o lundump.o lvm.o lzio.o strbuf.o fpconv.o lauxlib.o lbaselib.o ldblib.o liolib.o lmathlib.o loslib.o ltablib.o lstrlib.o loadlib.o linit.o lua_cjson.o lua_struct.o lua_cmsgpack.o lua_bit.o\t# DLL needs all object files\r\nranlib liblua.a\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o lua.o lua.c\r\ncc -o lua  lua.o liblua.a -lm \r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o luac.o luac.c\r\ncc -O2 -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP    -c -o print.o print.c\r\ncc -o luac  luac.o print.o liblua.a -lm \r\nMAKE hdr_histogram\r\ncd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make\r\ncc  -Wall -Os -g  -c  hdr_histogram.c \r\n    CC adlist.o\r\n    CC quicklist.o\r\n    CC ae.o\r\n    CC anet.o\r\n    CC dict.o\r\n    CC server.o\r\n    CC sds.o\r\n    CC zmalloc.o\r\n    CC lzf_c.o\r\n    CC lzf_d.o\r\n    CC pqsort.o\r\n    CC zipmap.o\r\n    CC sha1.o\r\n    CC ziplist.o\r\n    CC release.o\r\n    CC networking.o\r\n    CC util.o\r\n    CC object.o\r\n    CC db.o\r\n    CC replication.o\r\n    CC rdb.o\r\n    CC t_string.o\r\n    CC t_list.o\r\n    CC t_set.o\r\n    CC t_zset.o\r\n    CC t_hash.o\r\n    CC config.o\r\n    CC aof.o\r\n    CC pubsub.o\r\n    CC multi.o\r\n    CC debug.o\r\n    CC sort.o\r\n    CC intset.o\r\n    CC syncio.o\r\n    CC cluster.o\r\n    CC crc16.o\r\n    CC endianconv.o\r\n    CC slowlog.o\r\n    CC scripting.o\r\n    CC bio.o\r\n    CC rio.o\r\n    CC rand.o\r\n    CC memtest.o\r\n    CC crcspeed.o\r\n    CC crc64.o\r\n    CC bitops.o\r\n    CC sentinel.o\r\n    CC notify.o\r\n    CC setproctitle.o\r\n    CC blocked.o\r\n    CC hyperloglog.o\r\n    CC latency.o\r\n    CC sparkline.o\r\n    CC redis-check-rdb.o\r\n    CC redis-check-aof.o\r\n    CC geo.o\r\n    CC lazyfree.o\r\n    CC module.o\r\n    CC evict.o\r\n    CC expire.o\r\n    CC geohash.o\r\n    CC geohash_helper.o\r\n    CC childinfo.o\r\n    CC defrag.o\r\n    CC siphash.o\r\n    CC rax.o\r\n    CC t_stream.o\r\n    CC listpack.o\r\n    CC localtime.o\r\n    CC lolwut.o\r\n    CC lolwut5.o\r\n    CC lolwut6.o\r\n    CC acl.o\r\n    CC gopher.o\r\n    CC tracking.o\r\n    CC connection.o\r\n    CC tls.o\r\ntls.c:378:40: error: unknown type name 'bool'\r\nstatic connection *createTLSConnection(bool client_side) {\r\n                                       ^\r\ntls.c:390:32: error: use of undeclared identifier 'true'\r\n    return createTLSConnection(true);\r\n                               ^\r\ntls.c:411:67: error: use of undeclared identifier 'false'\r\n    tls_connection *conn = (tls_connection *) createTLSConnection(false);\r\n                                                                  ^\r\n3 errors generated.\r\nmake[1]: *** [tls.o] Error 1\r\nmake: *** [all] Error 2\r\n```",
  "state": "closed",
  "created_at": "2020-12-12T16:00:55Z",
  "updated_at": "2020-12-13T09:11:30Z",
  "closed_at": "2020-12-13T09:11:30Z",
  "labels": [],
  "comments_data": [
    {
      "id": 743930161,
      "user": "madolson",
      "created_at": "2020-12-13T01:12:56Z",
      "body": "Yeah, for compatibility we generally avoid bools. This should be an easy fix."
    }
  ]
}