{
  "issue_number": 6723.0,
  "title": "Redis 5.9.101 crashed by signal: 8",
  "body": "=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n29427:M 01 Jan 2020 15:21:12.961 # Redis 5.9.101 crashed by signal: 8\r\n29427:M 01 Jan 2020 15:21:12.961 # Crashed running the instruction at: 0x5651b7eebc89\r\n29427:M 01 Jan 2020 15:21:12.961 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/bin/redis-server 127.0.0.1:6379(activeExpireCycle+0x309)[0x5651b7eebc89]\r\n\r\nBacktrace:\r\n/usr/bin/redis-server 127.0.0.1:6379(logStackTrace+0x40)[0x5651b7eb51b0]\r\n/usr/bin/redis-server 127.0.0.1:6379(sigsegvHandler+0xb1)[0x5651b7eb5901]\r\n/lib64/libpthread.so.0(+0x10fc0)[0x7fcd9512cfc0]\r\n/usr/bin/redis-server 127.0.0.1:6379(activeExpireCycle+0x309)[0x5651b7eebc89]\r\n/usr/bin/redis-server 127.0.0.1:6379(databasesCron+0xef)[0x5651b7e6e87f]\r\n/usr/bin/redis-server 127.0.0.1:6379(serverCron+0x242)[0x5651b7e74ca2]\r\n/usr/bin/redis-server 127.0.0.1:6379(aeProcessEvents+0x49a)[0x5651b7e6a03a]\r\n/usr/bin/redis-server 127.0.0.1:6379(aeMain+0x2b)[0x5651b7e6a17b]\r\n/usr/bin/redis-server 127.0.0.1:6379(main+0x3fa)[0x5651b7e66daa]\r\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x7fcd94d80ab5]\r\n/usr/bin/redis-server 127.0.0.1:6379(+0x3a151)[0x5651b7e67151]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:5.9.101\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:dcefde03a6d16d56\r\nredis_mode:standalone\r\nos:Linux 3.10.0-1062.9.1.el7.x86_64 x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:8.3.1\r\nprocess_id:29427\r\nrun_id:2d47aafbbe3f25135c291f241be62c61a0409541\r\ntcp_port:6379\r\nuptime_in_seconds:235433\r\nuptime_in_days:2\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:808568\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis.conf\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_recent_max_input_buffer:2\r\nclient_recent_max_output_buffer:131096\r\nblocked_clients:0\r\ntracking_clients:0\r\n\r\n# Memory\r\nused_memory:55228952\r\nused_memory_human:52.67M\r\nused_memory_rss:142626816\r\nused_memory_rss_human:136.02M\r\nused_memory_peak:121579712\r\nused_memory_peak_human:115.95M\r\nused_memory_peak_perc:45.43%\r\nused_memory_overhead:7919312\r\nused_memory_startup:802472\r\nused_memory_dataset:47309640\r\nused_memory_dataset_perc:86.92%\r\nallocator_allocated:55368336\r\nallocator_active:56979456\r\nallocator_resident:64991232\r\ntotal_system_memory:3973365760\r\ntotal_system_memory_human:3.70G\r\nused_memory_lua:46080\r\nused_memory_lua_human:45.00K\r\nused_memory_scripts:200\r\nused_memory_scripts_human:200B\r\nnumber_of_cached_scripts:1\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.03\r\nallocator_frag_bytes:1611120\r\nallocator_rss_ratio:1.14\r\nallocator_rss_bytes:8011776\r\nrss_overhead_ratio:2.19\r\nrss_overhead_bytes:77635584\r\nmem_fragmentation_ratio:2.58\r\nmem_fragmentation_bytes:87399088\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:138\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1577866659\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:9740288\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:1330086\r\ntotal_commands_processed:21885320\r\ninstantaneous_ops_per_sec:10\r\ntotal_net_input_bytes:1391197970\r\ntotal_net_output_bytes:549060461104\r\ninstantaneous_input_kbps:0.78\r\ninstantaneous_output_kbps:1179.89\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:470300\r\nexpired_stale_perc:0.05\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:56353\r\nevicted_keys:0\r\nkeyspace_hits:16483357\r\nkeyspace_misses:1881279\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:8676\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_used_slots:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:b6cac2fba49ba49bbb1d120a5f10621f1d957cc5\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:946.630587\r\nused_cpu_user:819.339789\r\nused_cpu_sys_children:59.322589\r\nused_cpu_user_children:330.289551\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_get:calls=17782100,usec=205277587,usec_per_call=11.54\r\ncmdstat_incrby:calls=582536,usec=1267535,usec_per_call=2.18\r\ncmdstat_flushdb:calls=2,usec=98517,usec_per_call=49258.50\r\ncmdstat_info:calls=2,usec=276,usec_per_call=138.00\r\ncmdstat_flushall:calls=2,usec=347541,usec_per_call=173770.50\r\ncmdstat_eval:calls=582536,usec=20203266,usec_per_call=34.68\r\ncmdstat_select:calls=1330077,usec=1752403,usec_per_call=1.32\r\ncmdstat_ping:calls=5,usec=4,usec_per_call=0.80\r\ncmdstat_exists:calls=582536,usec=669571,usec_per_call=1.15\r\ncmdstat_command:calls=2,usec=8346,usec_per_call=4173.00\r\ncmdstat_del:calls=5,usec=120,usec_per_call=24.00\r\ncmdstat_set:calls=179809,usec=1278388,usec_per_call=7.11\r\ncmdstat_setex:calls=845708,usec=7456802,usec_per_call=8.82\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb1:keys=44181,expires=1,avg_ttl=6929\r\ndb2:keys=59004,expires=59004,avg_ttl=806560310\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n29427:M 01 Jan 2020 15:21:12.963 # \r\nRAX:0000000000000000 RBX:0000000000000000\r\nRCX:0000000005fb5d99 RDX:0000000000000000\r\nRDI:0000000000000000 RSI:0000000000000000\r\nRBP:0000000000000000 RSP:00007ffcbf597700\r\nR8 :0000000000000000 R9 :0000000000000003\r\nR10:000000005e0c5678 R11:0000000000000668\r\nR12:0000016f6031c881 R13:0000000000000000\r\nR14:0000000000000001 R15:00007fcd92a59048\r\nRIP:00005651b7eebc89 EFL:0000000000010246\r\nCSGSFS:0000000000000033\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770f) -> 00005651b820d600\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770e) -> 000000005e0c5678\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770d) -> 0000001000000001\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770c) -> 00059b0fc2773a97\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770b) -> 00000000000061a8\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf59770a) -> 0000000000000014\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597709) -> 0000000000000003\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597708) -> 0000000000000004\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597707) -> 000000000000000a\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597706) -> 0000000300000003\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597705) -> 0000000000000014\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597704) -> 0000000000000001\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597703) -> 0000000000000014\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597702) -> 0000000100000000\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597701) -> 0000000000000000\r\n29427:M 01 Jan 2020 15:21:12.963 # (00007ffcbf597700) -> 00007ffcbf597778\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n29427:M 01 Jan 2020 15:21:12.963 # Bio thread for job type #0 terminated\r\n29427:M 01 Jan 2020 15:21:12.964 # Bio thread for job type #1 terminated\r\n29427:M 01 Jan 2020 15:21:12.964 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 5651b81f8000 (2260992 bytes)\r\n*** Preparing to test memory region 5651b9eb2000 (135168 bytes)\r\n*** Preparing to test memory region 7fcd74200000 (190840832 bytes)\r\n*** Preparing to test memory region 7fcd7f838000 (170917888 bytes)\r\n*** Preparing to test memory region 7fcd89b39000 (8388608 bytes)\r\n*** Preparing to test memory region 7fcd8a33a000 (8388608 bytes)\r\n*** Preparing to test memory region 7fcd8ab3b000 (8388608 bytes)\r\n*** Preparing to test memory region 7fcd8b33c000 (8388608 bytes)\r\n*** Preparing to test memory region 7fcd92600000 (8388608 bytes)\r\n*** Preparing to test memory region 7fcd94071000 (8192 bytes)\r\n*** Preparing to test memory region 7fcd944f8000 (4096 bytes)\r\n*** Preparing to test memory region 7fcd94b59000 (8192 bytes)\r\n*** Preparing to test memory region 7fcd95117000 (20480 bytes)\r\n*** Preparing to test memory region 7fcd95335000 (16384 bytes)\r\n*** Preparing to test memory region 7fcd95e8d000 (49152 bytes)\r\n*** Preparing to test memory region 7fcd95ea4000 (4096 bytes)\r\n*** Preparing to test memory region 7fcd95ea7000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: activeExpireCycle (base: 0x5651b7eeb980)\r\nModule: /usr/bin/redis-server 127.0.0.1:6379 (base 0x5651b7e2d000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x5651b7eeb980 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n29427:M 01 Jan 2020 15:21:15.034 # dump of function (hexdump of 905 bytes):\r\n4157415641554154555389fb4883ec78488d05691c32008ba850070000e81e27f8ff4889442460e8346ff9ff85c00f85930300008d4dffb80a0000004863c94c69c1fa0000004829c848894424384981c0e803000083fb010f845f040000488d051b1c32008bb0880700008974246c83fe0f0f8fd5040000488d44091931d2488d3dfa1b3200c70568d830000000000048c7442458010000004869c040420f0048637f2848f7f74883f863761a48bac3f5285c8fc2f52848c1e80248f7e248c1ea02488954245883fb018b7c246c4c0f454424584c8944245885ff0f8e69020000488d448914c7442430000000004889442450c74424680000000048c74424480000000048c7442440000000008b0dd5d7300031d289c883c101f7f6488d055d1b3200890dbfd73000488b4030488d14d24c8d3cd0498b47088344243001488b5848480358280f8464030000488b683848036818e83726f8ff4989c44883fd047615488d049b488d048048c1e0024839e80f82a0010000488b4424508b7c24304839d8480f46d883e70f897c2434488d049b48895c242048c1e00248894424284885c00f8e6f0200004885db0f8466020000c744241000000000498b4f3831db31ed48c74424180000000048c7442408000000000f1f4000c744241400000000498b570848634424144883442418014889c74883c00148c1e00548c1e705488b3402488b443a104821ce488b34f04885f674410f1f4400004c8b76084c89e24c89ff4c8b6e10e8b5fcffff4d29e683f8014883ddff4d85f67e0a4c0174240883442410014883c3014c89ee4d85ed75c8498b4f388b74241485f60f84800100004883c10149894f3848395c24207610488b54241848395424280f8f59ffffff8b44241048016c244848015c244085c0745d4c63f0488b442408498b7730489949f7fe4885f6480f44f04889c148b80bd7a3703d0ad7a348d1e948f7ee488d043248c1fe3f48c1f8054829f0488d344048c1e6044801c648b80bd7a3703d0ad7a348f7e148c1ea044801f2498957308b54243485d20f8402010000488d44ad0031d2488d048048c1e00248f7f3483b4424380f871efeffff83442468018b4424683944246c0f84280100008b05c8d5300085c00f851a010000488d05411932008bb088070000e9c3fdffffe8f123f8ff482b4424604889c1488d0522193200488bb8000d0000480188880400004885ff742f48bacff753e3a59bc4204889c848c1f93f48f7ea48c1fa07\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===",
  "state": "closed",
  "created_at": "2020-01-01T09:07:01Z",
  "updated_at": "2020-01-01T17:13:33Z",
  "closed_at": "2020-01-01T17:13:26Z",
  "labels": [
    "critical bug"
  ],
  "comments_data": [
    {
      "id": 570060975,
      "user": "antirez",
      "created_at": "2020-01-01T15:18:29Z",
      "body": "Looks trivial to fix, thank you. Related to the new expires code."
    },
    {
      "id": 570068494,
      "user": "antirez",
      "created_at": "2020-01-01T17:13:32Z",
      "body": "Hopefully fixed in 0af467d1."
    }
  ]
}