{
  "issue_number": 12792.0,
  "title": "[BUG] Debain 12:  make test [exception]: Executing test client: permission denied.",
  "body": "**Describe the bug**\r\n\r\n[exception]: Executing test client: permission denied  was found during \"make test\" \r\n\r\n**To reproduce**\r\n\r\nInstall Debian12 [amd64] then\r\n\r\n1. sudo apt update\r\n2. sudo apt install build-essential make automake\r\n\r\nthen follow by:\r\n\r\n3. git clone https://github.com/redis/redis.git\r\n4. cd redis\r\n5. make\r\n6. make test\r\n\r\n**Expected behavior**\r\n\r\n```\r\n~/Testing/redis$ make test\r\n\r\nTesting unit/networking\r\n[ok]: MGET: mget shouldn't be propagated in Lua (100 ms)\r\n[ok]: CONFIG SET oom-score-adj works as expected (86 ms)\r\n[ok]: CONFIG SET oom-score-adj handles configuration failures (2 ms)\r\n[ok]: CONFIG SET oom-score-adj-values doesn't touch proc when disabled (0 ms)\r\n[ok]: HyperLogLog sparse encoding stress test (2890 ms)\r\n[ok]: Corrupted sparse HyperLogLogs are detected: Additional at tail (2 ms)\r\n[ok]: Corrupted sparse HyperLogLogs are detected: Broken magic (1 ms)\r\n[ok]: Corrupted sparse HyperLogLogs are detected: Invalid encoding (1 ms)\r\n[ok]: Corrupted dense HyperLogLogs are detected: Wrong length (1 ms)\r\n[ok]: EXPIRE: We can call scripts rewriting client->argv from Lua (101 ms)\r\n[exception]: Executing test client: permission denied.\r\npermission denied\r\n    while executing\r\n\"close $fd\"\r\n    (procedure \"set_oom_score_adj\" line 7)\r\n    invoked from within\r\n\"set_oom_score_adj 22\"\r\n    (\"uplevel\" body line 3)\r\n    invoked from within\r\n\"uplevel 1 $code\"\r\n    (procedure \"test\" line 58)\r\n    invoked from within\r\n\"test {CONFIG SET oom score restored on disable} {\r\n            r config set oom-score-adj no\r\n            set_oom_score_adj 22\r\n            assert_equal ...\"\r\n    (\"uplevel\" body line 98)\r\n    invoked from within\r\n\"uplevel 1 $code \"\r\n    (procedure \"start_server\" line 2)\r\n    invoked from within\r\n\"start_server {tags {\"oom-score-adj external:skip\"}} {\r\n        proc get_oom_score_adj {{pid \"\"}} {\r\n            if {$pid == \"\"} {\r\n                set pi...\"\r\n    (file \"tests/unit/oom-score-adj.tcl\" line 5)\r\n    invoked from within\r\n\"source $path\"\r\n    (procedure \"execute_test_file\" line 4)\r\n    invoked from within\r\n\"execute_test_file $data\"\r\n    (procedure \"test_client_main\" line 10)\r\n    invoked from within\r\n\"test_client_main $::test_server_port \"\r\nKilling still running Redis server 4025\r\nKilling still running Redis server 8072\r\nKilling still running Redis server 8096\r\nKilling still running Redis server 8199\r\nKilling still running Redis server 8279\r\nKilling still running Redis server 8316\r\nKilling still running Redis server 12677\r\nKilling still running Redis server 12866\r\nKilling still running Redis server 12918\r\nKilling still running Redis server 13084\r\nKilling still running Redis server 13170\r\nKilling still running Redis server 13205\r\nKilling still running Redis server 13253\r\nKilling still running Redis server 13291\r\nI/O error reading reply\r\n    while executing\r\n\"$r set [expr rand()] [expr rand()]\"\r\n    (procedure \"gen_write_load\" line 7)\r\n    invoked from within\r\n\"gen_write_load [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3]\"\r\n    (file \"tests/helpers/gen_write_load.tcl\" line 18)\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"createComplexDataset\" line 49)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r randomkey\"\r\n    (procedure \"findKeyWithType\" line 3)\r\n    invoked from within\r\n\"findKeyWithType {*}$r zset\"\r\n    (\"uplevel\" body line 2)\r\n    invoked from within\r\n\"uplevel 1 [lindex $args $path]\"\r\n    (procedure \"randpath\" line 3)\r\n    invoked from within\r\n\"randpath {{*}$r zadd $k $d $v}  {{*}$r zrem $k $v}  {\r\n                            set otherzset [findKeyWithType {*}$r zset]\r\n                         ...\"\r\n    (procedure \"createComplexDataset\" line 74)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"createComplexDataset\" line 49)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nKilling still running Redis server 13356\r\nKilling still running Redis server 13376\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"createComplexDataset\" line 49)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"createComplexDataset\" line 33)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"findKeyWithType\" line 7)\r\n    invoked from within\r\n\"findKeyWithType {*}$r zset\"\r\n    (\"uplevel\" body line 2)\r\n    invoked from within\r\n\"uplevel 1 [lindex $args $path]\"\r\n    (procedure \"randpath\" line 3)\r\n    invoked from within\r\n\"randpath {{*}$r zadd $k $d $v}  {{*}$r zrem $k $v}  {\r\n                            set otherzset [findKeyWithType {*}$r zset]\r\n                         ...\"\r\n    (procedure \"createComplexDataset\" line 74)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 5)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 13)\r\nKilling still running Redis server 13524\r\nKilling still running Redis server 13558\r\nKilling still running Redis server 13632\r\nKilling still running Redis server 13639\r\nKilling still running Redis server 13664\r\nKilling still running Redis server 13747\r\nKilling still running Redis server 13931\r\nKilling still running Redis server 13976\r\nKilling still running Redis server 13995\r\nKilling still running Redis server 14021\r\nmake[1]: *** [Makefile:467: test] Error 1\r\nmake[1]: Leaving directory '/home/money/Testing/redis/src'\r\nmake: *** [Makefile:6: test] Error 2\r\n\r\n\r\n```\r\n\r\n**Additional information**\r\n\r\n$ uname -a\r\nLinux debian12 6.1.0-13-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.55-1 (2023-09-29) x86_64 GNU/Linux\r\n\r\n\r\n`\r\n$ sudo apt list --installed | grep tcl\r\nlibtcl8.6/stable,now 8.6.13+dfsg-2 amd64 [installed,automatic]\r\ntcl8.6-dev/stable,now 8.6.13+dfsg-2 amd64 [installed,automatic]\r\ntcl8.6/stable,now 8.6.13+dfsg-2 amd64 [installed,automatic]\r\ntcl/stable,now 8.6.13 amd64 [installed,automatic]\r\n\r\n`\r\n\r\n",
  "state": "closed",
  "created_at": "2023-11-22T06:35:36Z",
  "updated_at": "2023-12-27T06:42:47Z",
  "closed_at": "2023-12-27T06:42:47Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1822231535,
      "user": "sundb",
      "created_at": "2023-11-22T07:18:20Z",
      "body": "Another similar issue: #12662\r\nCan you start a Redis instance and try `echo 1000 > /proc/$(pgrep redis-server)/oom_score_adj` to check the permission?"
    },
    {
      "id": 1822329833,
      "user": "slkbnt",
      "created_at": "2023-11-22T08:41:34Z",
      "body": "> Another similar issue: #12662 Can you start a Redis instance and try `echo 1000 > /proc/$(pgrep redis-server)/oom_score_adj` to check the permission?\r\n\r\nI have executed the command which stated by you and there were no permission issue\r\n"
    },
    {
      "id": 1833551548,
      "user": "sundb",
      "created_at": "2023-11-30T11:11:26Z",
      "body": "this test also failed in my ubuntu 23.\r\nthe minimum oom_score_adj that the non-root user is allowed to set is 100, not 0.\r\n@slkbnt could you help to run `echo (22, 99, 100) > /proc/2260315/oom_score_adj` to verify it again? thanks."
    },
    {
      "id": 1835549163,
      "user": "slkbnt",
      "created_at": "2023-12-01T06:37:50Z",
      "body": "> echo (22, 99, 100) > /proc/2260315/oom_score_adj\r\n\r\n@sundb \r\n\r\n$ echo (22, 99, 100) > /proc/2260315/oom_score_adj\r\nbash: syntax error near unexpected token `22,'\r\n"
    },
    {
      "id": 1835558853,
      "user": "sundb",
      "created_at": "2023-12-01T06:47:48Z",
      "body": "@slkbnt sorry for my misleading.\r\nplease use the flowing three:\r\n`echo 22 > /proc/$(pgrep redis-server)/oom_score_adj`\r\n`echo 99 > /proc/$(pgrep redis-server)/oom_score_adj`\r\n `echo 100 > /proc/$(pgrep redis-server)/oom_score_adj`"
    }
  ]
}