{
  "issue_number": 11165.0,
  "title": "[BUG] 2% CPU usage with no active clients",
  "body": "The Redis server is using a steady 2% CPU usage with no activity whatsoever.\r\n\r\nIs this normal?\r\n\r\n# Server\r\nredis_version:7.0.4\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:49201c797415ecc4\r\nredis_mode:standalone\r\nos:FreeBSD 13.1-RELEASE-p1 amd64\r\narch_bits:64\r\nmonotonic_clock:POSIX clock_gettime\r\nmultiplexing_api:kqueue\r\natomicvar_api:c11-builtin\r\ngcc_version:4.2.1\r\nprocess_id:1497\r\nprocess_supervised:no\r\nrun_id:83684637d73e8d9e222d8a40b7ff259ca38ad93f\r\ntcp_port:6379\r\nserver_time_usec:1661112799233961\r\nuptime_in_seconds:18503\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:168415\r\nexecutable:/usr/local/bin/redis-server\r\nconfig_file:/usr/local/etc/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:1\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:8\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:1429024\r\nused_memory_human:1.36M\r\nused_memory_rss:9740288\r\nused_memory_rss_human:9.29M\r\nused_memory_peak:1429024\r\nused_memory_peak_human:1.36M\r\nused_memory_peak_perc:100.54%\r\nused_memory_overhead:1405592\r\nused_memory_startup:1403592\r\nused_memory_dataset:23432\r\nused_memory_dataset_perc:92.14%\r\nallocator_allocated:1406040\r\nallocator_active:9708544\r\nallocator_resident:9708544\r\ntotal_system_memory:16847036416\r\ntotal_system_memory_human:15.69G\r\nused_memory_lua:31744\r\nused_memory_vm_eval:31744\r\nused_memory_lua_human:31.00K\r\nused_memory_scripts_eval:0\r\nnumber_of_cached_scripts:0\r\nnumber_of_functions:0\r\nnumber_of_libraries:0\r\nused_memory_vm_functions:32768\r\nused_memory_vm_total:64512\r\nused_memory_vm_total_human:63.00K\r\nused_memory_functions:200\r\nused_memory_scripts:200\r\nused_memory_scripts_human:200B\r\nmaxmemory:536870912\r\nmaxmemory_human:512.00M\r\nmaxmemory_policy:volatile-lru\r\nallocator_frag_ratio:6.90\r\nallocator_frag_bytes:8302504\r\nallocator_rss_ratio:1.00\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:31744\r\nmem_fragmentation_ratio:6.93\r\nmem_fragmentation_bytes:8334248\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_total_replication_buffers:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:1800\r\nmem_cluster_links:0\r\nmem_aof_buffer:0\r\nmem_allocator:libc\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nasync_loading:0\r\ncurrent_cow_peak:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1661094296\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_saves:0\r\nrdb_last_cow_size:0\r\nrdb_last_load_keys_expired:0\r\nrdb_last_load_keys_loaded:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_rewrites:0\r\naof_rewrites_consecutive_failures:0\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:1\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:6\r\ntotal_net_output_bytes:0\r\ntotal_net_repl_input_bytes:0\r\ntotal_net_repl_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\ninstantaneous_input_repl_kbps:0.00\r\ninstantaneous_output_repl_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:98\r\nevicted_keys:0\r\nevicted_clients:0\r\ntotal_eviction_exceeded_time:0\r\ncurrent_eviction_exceeded_time:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\npubsubshard_channels:0\r\nlatest_fork_usec:0\r\ntotal_forks:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntotal_active_defrag_time:0\r\ncurrent_active_defrag_time:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:0\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:1\r\ntotal_writes_processed:0\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\nreply_buffer_shrinks:1\r\nreply_buffer_expands:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:f2acbac0207fdf0d5357e66c58632bd9fe352b81\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:1.627153\r\nused_cpu_user:1.746413\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\nused_cpu_sys_main_thread:1.627070\r\nused_cpu_user_main_thread:1.737812\r\n\r\n# Modules\r\n\r\n# Errorstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\n",
  "state": "closed",
  "created_at": "2022-08-21T20:23:21Z",
  "updated_at": "2022-08-24T10:12:06Z",
  "closed_at": "2022-08-24T10:12:06Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1221773867,
      "user": "judeng",
      "created_at": "2022-08-22T03:59:39Z",
      "body": "Hi, from the output message , redis-server has only consumed a very small amount of CPU since it was startedï¼š\r\n`cpu_avg = (used_cpu_sys+used_cpu_user)/uptime_in_seconds = 0.018%`\r\n\r\nMaybe you can describe the source of the 2% statistics in detail.\r\n"
    },
    {
      "id": 1221782990,
      "user": "qcybb",
      "created_at": "2022-08-22T04:11:04Z",
      "body": "Maybe my question should have been is it normal for Redis to use any CPU when in idle?\r\n\r\nIt's constantly active in TOP when there is no activity whatsoever. Nothing is connected to it.\r\n\r\n```\r\n PID USERNAME    THR PRI NICE   SIZE    RES STATE    C   TIME    WCPU COMMAND\r\n1497 redis         4  20    0    34M  9576K kqread   6   0:09   0.02% redis-server\r\n```\r\n\r\n```\r\nConnected clients : 1\r\nUptime : 13 hours 2 minutes 15 seconds\r\nMemory used : 1.52MB\r\nKeys : 0 (all databases)\r\n```\r\n\r\n"
    },
    {
      "id": 1221977668,
      "user": "judeng",
      "created_at": "2022-08-22T07:46:21Z",
      "body": "> Maybe my question should have been is it normal for Redis to use any CPU when in idle?\r\n\r\nYes, redis has some time cron events even when idle.\r\nAnd in the result of your top command, `wcpu` is have only **0.02%**"
    },
    {
      "id": 1225513206,
      "user": "oranagra",
      "created_at": "2022-08-24T10:12:06Z",
      "body": "you can control that by changing the `hz` configuration, although from what i see above (0.2%) you have no reason to worry about it.\r\nit it was really 2%, i would have asked to try and find out what it's doing (using `strate`, or `pstack`).\r\n"
    }
  ]
}