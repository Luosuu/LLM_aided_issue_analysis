{
  "issue_number": 10447.0,
  "title": "[CRASH] Redis-unstable Crash when make BUILD=yes: Undefined symbols for architecture x86_64",
  "body": "```\r\nredis-unstable$ make BUILD_TLS=yes\r\ncd src && /Library/Developer/CommandLineTools/usr/bin/make all\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n    CC Makefile.dep\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\n/bin/sh: pkg-config: command not found\r\nrm -rf redis-server redis-sentinel redis-cli redis-benchmark redis-check-rdb redis-check-aof *.o *.gcda *.gcno *.gcov redis.info lcov-html Makefile.dep\r\nrm -f adlist.d quicklist.d ae.d anet.d dict.d server.d sds.d zmalloc.d lzf_c.d lzf_d.d pqsort.d zipmap.d sha1.d ziplist.d release.d networking.d util.d object.d db.d replication.d rdb.d t_string.d t_list.d t_set.d t_zset.d t_hash.d config.d aof.d pubsub.d multi.d debug.d sort.d intset.d syncio.d cluster.d crc16.d endianconv.d slowlog.d eval.d bio.d rio.d rand.d memtest.d crcspeed.d crc64.d bitops.d sentinel.d notify.d setproctitle.d blocked.d hyperloglog.d latency.d sparkline.d redis-check-rdb.d redis-check-aof.d geo.d lazyfree.d module.d evict.d expire.d geohash.d geohash_helper.d childinfo.d defrag.d siphash.d rax.d t_stream.d listpack.d localtime.d lolwut.d lolwut5.d lolwut6.d acl.d tracking.d connection.d tls.d sha256.d timeout.d setcpuaffinity.d monotonic.d mt19937-64.d resp_parser.d call_reply.d script_lua.d script.d functions.d function_lua.d commands.d anet.d adlist.d dict.d redis-cli.d zmalloc.d release.d ae.d redisassert.d crcspeed.d crc64.d siphash.d crc16.d monotonic.d cli_common.d mt19937-64.d ae.d anet.d redis-benchmark.d adlist.d dict.d zmalloc.d redisassert.d release.d crcspeed.d crc64.d siphash.d crc16.d monotonic.d cli_common.d mt19937-64.d\r\n(cd ../deps && /Library/Developer/CommandLineTools/usr/bin/make distclean)\r\n(cd hiredis && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd linenoise && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd lua && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd jemalloc && [ -f Makefile ] && /Library/Developer/CommandLineTools/usr/bin/make distclean) > /dev/null || true\r\n(cd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(rm -f .make-*)\r\n(cd modules && /Library/Developer/CommandLineTools/usr/bin/make clean)\r\nrm -rf *.xo *.so\r\n(cd ../tests/modules && /Library/Developer/CommandLineTools/usr/bin/make clean)\r\nrm -f commandfilter.so basics.so testrdb.so fork.so infotest.so propagate.so misc.so hooks.so blockonkeys.so blockonbackground.so scan.so datatype.so datatype2.so auth.so keyspace_events.so blockedclient.so getkeys.so getchannels.so test_lazyfree.so timer.so defragtest.so keyspecs.so hash.so zset.so stream.so aclcheck.so list.so subcommands.so reply.so cmdintrospection.so eventloop.so commandfilter.xo basics.xo testrdb.xo fork.xo infotest.xo propagate.xo misc.xo hooks.xo blockonkeys.xo blockonbackground.xo scan.xo datatype.xo datatype2.xo auth.xo keyspace_events.xo blockedclient.xo getkeys.xo getchannels.xo test_lazyfree.xo timer.xo defragtest.xo keyspecs.xo hash.xo zset.xo stream.xo aclcheck.xo list.xo subcommands.xo reply.xo cmdintrospection.xo eventloop.xo\r\n(rm -f .make-*)\r\necho STD=-pedantic -DREDIS_STATIC='' -std=c11 >> .make-settings\r\necho WARN=-Wall -W -Wno-missing-field-initializers >> .make-settings\r\necho OPT=-O2 >> .make-settings\r\necho MALLOC=libc >> .make-settings\r\necho BUILD_TLS=yes >> .make-settings\r\necho USE_SYSTEMD= >> .make-settings\r\necho CFLAGS= >> .make-settings\r\necho LDFLAGS=-L/opt/homebrew/opt/openssl@1.1/lib >> .make-settings\r\necho REDIS_CFLAGS= >> .make-settings\r\necho REDIS_LDFLAGS= >> .make-settings\r\necho PREV_FINAL_CFLAGS=-pedantic -DREDIS_STATIC='' -std=c11 -Wall -W -Wno-missing-field-initializers -O2 -g -ggdb   -I../deps/hiredis -I../deps/linenoise -I../deps/lua/src -I../deps/hdr_histogram -DUSE_OPENSSL -I/usr/local/opt/openssl/include >> .make-settings\r\necho PREV_FINAL_LDFLAGS=-L/opt/homebrew/opt/openssl@1.1/lib  -g -ggdb -L/usr/local/opt/openssl/lib >> .make-settings\r\n(cd ../deps && /Library/Developer/CommandLineTools/usr/bin/make hiredis linenoise lua hdr_histogram)\r\n(cd hiredis && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd linenoise && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd lua && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(cd jemalloc && [ -f Makefile ] && /Library/Developer/CommandLineTools/usr/bin/make distclean) > /dev/null || true\r\n(cd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make clean) > /dev/null || true\r\n(rm -f .make-*)\r\n(echo \"-L/opt/homebrew/opt/openssl@1.1/lib\" > .make-ldflags)\r\n(echo \"\" > .make-cflags)\r\nMAKE hiredis\r\ncd hiredis && /Library/Developer/CommandLineTools/usr/bin/make static USE_SSL=1\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic alloc.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic net.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic hiredis.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic sds.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic async.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic read.c\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic sockcompat.c\r\nar rcs libhiredis.a alloc.o net.o hiredis.o sds.o async.o read.o sockcompat.o\r\n/Library/Developer/CommandLineTools/usr/bin/ranlib: file: libhiredis.a(sockcompat.o) has no symbols\r\ncc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic ssl.c\r\nar rcs libhiredis_ssl.a ssl.o\r\nMAKE linenoise\r\ncd linenoise && /Library/Developer/CommandLineTools/usr/bin/make\r\ncc  -Wall -Os -g  -c linenoise.c\r\nMAKE lua\r\ncd lua/src && /Library/Developer/CommandLineTools/usr/bin/make all CFLAGS=\"-Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2 \" MYLDFLAGS=\"-L/opt/homebrew/opt/openssl@1.1/lib\" AR=\"ar rc\"\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lapi.o lapi.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lcode.o lcode.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ldebug.o ldebug.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ldo.o ldo.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ldump.o ldump.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lfunc.o lfunc.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lgc.o lgc.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o llex.o llex.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lmem.o lmem.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lobject.o lobject.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lopcodes.o lopcodes.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lparser.o lparser.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lstate.o lstate.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lstring.o lstring.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ltable.o ltable.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ltm.o ltm.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lundump.o lundump.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lvm.o lvm.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lzio.o lzio.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o strbuf.o strbuf.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o fpconv.o fpconv.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lauxlib.o lauxlib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lbaselib.o lbaselib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ldblib.o ldblib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o liolib.o liolib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lmathlib.o lmathlib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o loslib.o loslib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o ltablib.o ltablib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lstrlib.o lstrlib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o loadlib.o loadlib.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o linit.o linit.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lua_cjson.o lua_cjson.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lua_struct.o lua_struct.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lua_cmsgpack.o lua_cmsgpack.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lua_bit.o lua_bit.c\r\nar rc liblua.a lapi.o lcode.o ldebug.o ldo.o ldump.o lfunc.o lgc.o llex.o lmem.o lobject.o lopcodes.o lparser.o lstate.o lstring.o ltable.o ltm.o lundump.o lvm.o lzio.o strbuf.o fpconv.o lauxlib.o lbaselib.o ldblib.o liolib.o lmathlib.o loslib.o ltablib.o lstrlib.o loadlib.o linit.o lua_cjson.o lua_struct.o lua_cmsgpack.o lua_bit.o\t# DLL needs all object files\r\nranlib liblua.a\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o lua.o lua.c\r\ncc -o lua -L/opt/homebrew/opt/openssl@1.1/lib lua.o liblua.a -lm\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o luac.o luac.c\r\ncc -Wall -DLUA_ANSI -DENABLE_CJSON_GLOBAL -DREDIS_STATIC='' -DLUA_USE_MKSTEMP  -O2  -I/opt/homebrew/opt/openssl@1.1/include  -c -o print.o print.c\r\ncc -o luac -L/opt/homebrew/opt/openssl@1.1/lib luac.o print.o liblua.a -lm\r\nMAKE hdr_histogram\r\ncd hdr_histogram && /Library/Developer/CommandLineTools/usr/bin/make\r\ncc  -Wall -Os -g  -c  hdr_alloc.c\r\ncc  -Wall -Os -g  -c  hdr_histogram.c\r\nar rcs libhdrhistogram.a hdr_histogram.o hdr_alloc.o\r\n    CC adlist.o\r\n    CC quicklist.o\r\n    CC ae.o\r\n    CC anet.o\r\n    CC dict.o\r\n    CC server.o\r\n    CC sds.o\r\n    CC zmalloc.o\r\n    CC lzf_c.o\r\n    CC lzf_d.o\r\n    CC pqsort.o\r\npqsort.c:106:7: warning: performing pointer subtraction with a null pointer has undefined behavior [-Wnull-pointer-subtraction]\r\nloop:   SWAPINIT(a, es);\r\n        ^~~~~~~~~~~~~~~\r\npqsort.c:65:47: note: expanded from macro 'SWAPINIT'\r\n#define SWAPINIT(a, es) swaptype = ((char *)a - (char *)0) % sizeof(long) || \\\r\n                                              ^ ~~~~~~~~~\r\n1 warning generated.\r\n    CC zipmap.o\r\n    CC sha1.o\r\n    CC ziplist.o\r\n    CC release.o\r\n    CC networking.o\r\n    CC util.o\r\n    CC object.o\r\n    CC db.o\r\n    CC replication.o\r\n    CC rdb.o\r\n    CC t_string.o\r\n    CC t_list.o\r\n    CC t_set.o\r\n    CC t_zset.o\r\n    CC t_hash.o\r\n    CC config.o\r\n    CC aof.o\r\n    CC pubsub.o\r\n    CC multi.o\r\n    CC debug.o\r\n    CC sort.o\r\n    CC intset.o\r\n    CC syncio.o\r\n    CC cluster.o\r\n    CC crc16.o\r\n    CC endianconv.o\r\n    CC slowlog.o\r\n    CC eval.o\r\n    CC bio.o\r\n    CC rio.o\r\n    CC rand.o\r\n    CC memtest.o\r\n    CC crcspeed.o\r\n    CC crc64.o\r\n    CC bitops.o\r\n    CC sentinel.o\r\n    CC notify.o\r\n    CC setproctitle.o\r\n    CC blocked.o\r\n    CC hyperloglog.o\r\n    CC latency.o\r\n    CC sparkline.o\r\n    CC redis-check-rdb.o\r\n    CC redis-check-aof.o\r\n    CC geo.o\r\n    CC lazyfree.o\r\n    CC module.o\r\n    CC evict.o\r\n    CC expire.o\r\n    CC geohash.o\r\n    CC geohash_helper.o\r\n    CC childinfo.o\r\n    CC defrag.o\r\n    CC siphash.o\r\n    CC rax.o\r\n    CC t_stream.o\r\n    CC listpack.o\r\n    CC localtime.o\r\n    CC lolwut.o\r\n    CC lolwut5.o\r\n    CC lolwut6.o\r\n    CC acl.o\r\n    CC tracking.o\r\n    CC connection.o\r\n    CC tls.o\r\n    CC sha256.o\r\n    CC timeout.o\r\n    CC setcpuaffinity.o\r\n    CC monotonic.o\r\n    CC mt19937-64.o\r\n    CC resp_parser.o\r\n    CC call_reply.o\r\n    CC script_lua.o\r\n    CC script.o\r\n    CC functions.o\r\n    CC function_lua.o\r\n    CC commands.o\r\n    LINK redis-server\r\nld: warning: directory not found for option '-L/usr/local/opt/openssl/lib'\r\nld: warning: ignoring file /opt/homebrew/opt/openssl@1.1/lib/libssl.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\r\nld: warning: ignoring file /opt/homebrew/opt/openssl@1.1/lib/libcrypto.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\r\nUndefined symbols for architecture x86_64:\r\n  \"_BIO_ctrl\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_free\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_new\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_s_mem\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_DH_free\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_ERR_clear_error\", referenced from:\r\n      _connTLSConnect in tls.o\r\n      _connTLSWrite in tls.o\r\n      _connTLSRead in tls.o\r\n      _connTLSAccept in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_ERR_error_string_n\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _handleSSLReturnCode in tls.o\r\n  \"_ERR_get_error\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _handleSSLReturnCode in tls.o\r\n  \"_ERR_peek_last_error\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_ERR_reason_error_string\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_OPENSSL_cleanup\", referenced from:\r\n      _tlsCleanup in tls.o\r\n  \"_OPENSSL_init_crypto\", referenced from:\r\n      _tlsInit in tls.o\r\n  \"_OPENSSL_init_ssl\", referenced from:\r\n      _redisInitOpenSSL in libhiredis_ssl.a(ssl.o)\r\n  \"_PEM_read_DHparams\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_PEM_write_bio_X509\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_RAND_poll\", referenced from:\r\n      _tlsInit in tls.o\r\n  \"_SSL_CTX_ctrl\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_free\", referenced from:\r\n      _tlsCleanup in tls.o\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _redisFreeSSLContext in libhiredis_ssl.a(ssl.o)\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_load_verify_locations\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_new\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_set_cipher_list\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_ciphersuites\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_default_passwd_cb\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_default_passwd_cb_userdata\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_options\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_set_session_id_context\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_SSL_CTX_set_timeout\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_SSL_CTX_set_verify\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_use_PrivateKey_file\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_use_certificate_chain_file\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_accept\", referenced from:\r\n      _connTLSAccept in tls.o\r\n      _tlsHandleEvent in tls.o\r\n  \"_SSL_connect\", referenced from:\r\n      _connTLSBlockingConnect in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_ctrl\", referenced from:\r\n      _connTLSSyncWrite in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_free\", referenced from:\r\n      _sentinelReconnectInstance in sentinel.o\r\n      _connTLSClose in tls.o\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLFree in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_get_error\", referenced from:\r\n      _handleSSLReturnCode in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLRead in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLWrite in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_get_peer_certificate\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_SSL_new\", referenced from:\r\n      _sentinelReconnectInstance in sentinel.o\r\n      _connCreateTLS in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_pending\", referenced from:\r\n      _tlsHandleEvent in tls.o\r\n  \"_SSL_read\", referenced from:\r\n      _connTLSRead in tls.o\r\n      _connTLSSyncRead in tls.o\r\n      _connTLSSyncReadLine in tls.o\r\n      _redisSSLRead in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_accept_state\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n  \"_SSL_set_connect_state\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_fd\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n      _connTLSBlockingConnect in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_verify\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n  \"_SSL_write\", referenced from:\r\n      _connTLSWrite in tls.o\r\n      _connTLSSyncWrite in tls.o\r\n      _redisSSLWrite in libhiredis_ssl.a(ssl.o)\r\n  \"_TLS_client_method\", referenced from:\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_TLS_method\", referenced from:\r\n      _createSSLContext in tls.o\r\nld: symbol(s) not found for architecture x86_64\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nmake[1]: *** [redis-server] Error 1\r\nmake: *** [all] Error 2\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version:\r\n    Macbook pro silicon M1 architecture x86_64\r\n    MacOS Monterey Version 12.3\r\n\r\n2. Steps to reproduce (if any)\r\n    I was getting an error about openssl not found so I added that file in src dir:\r\n```\r\nredis-cli.c:51:10: fatal error: 'openssl/ssl.h' file not found\r\n#include <openssl/ssl.h>\r\n         ^~~~~~~~~~~~~~~\r\n```\r\nafter that I did\r\n```\r\n$ make distclean\r\n$ cd src && make all\r\n$ cd ..\r\n```\r\nand finally did \r\n```\r\n$ make BUILD_TLS=yes\r\n```\r\nand it trowed the above error.\r\n\r\nAny idea how to fix that?",
  "state": "closed",
  "created_at": "2022-03-18T17:23:46Z",
  "updated_at": "2022-03-29T22:54:01Z",
  "closed_at": "2022-03-29T22:54:01Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1072685045,
      "user": "oranagra",
      "created_at": "2022-03-18T18:29:36Z",
      "body": "Do you have `openssl-dev installed? \r\nThe header file should come form the system, not being copied to the src dir... \r\n"
    },
    {
      "id": 1072702318,
      "user": "IsraDeAguinaga",
      "created_at": "2022-03-18T18:46:30Z",
      "body": "it is installed ( that part was resolved but the error still showing `Undefined symbols for architecture x86_64`) \r\n```\r\n$ openssl version\r\nOpenSSL 1.1.1l  24 Aug 2021\r\n```\r\n\r\nError:\r\n```\r\nld: warning: directory not found for option '-L/usr/local/opt/openssl/lib'\r\nld: warning: ignoring file /opt/homebrew/opt/openssl@1.1/lib/libssl.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\r\nld: warning: ignoring file /opt/homebrew/opt/openssl@1.1/lib/libcrypto.dylib, building for macOS-x86_64 but attempting to link with file built for macOS-arm64\r\nUndefined symbols for architecture x86_64:\r\n  \"_BIO_ctrl\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_free\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_new\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_BIO_s_mem\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_DH_free\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_ERR_clear_error\", referenced from:\r\n      _connTLSConnect in tls.o\r\n      _connTLSWrite in tls.o\r\n      _connTLSRead in tls.o\r\n      _connTLSAccept in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_ERR_error_string_n\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _handleSSLReturnCode in tls.o\r\n  \"_ERR_get_error\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _handleSSLReturnCode in tls.o\r\n  \"_ERR_peek_last_error\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_ERR_reason_error_string\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_OPENSSL_cleanup\", referenced from:\r\n      _tlsCleanup in tls.o\r\n  \"_OPENSSL_init_crypto\", referenced from:\r\n      _tlsInit in tls.o\r\n  \"_OPENSSL_init_ssl\", referenced from:\r\n      _redisInitOpenSSL in libhiredis_ssl.a(ssl.o)\r\n  \"_PEM_read_DHparams\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_PEM_write_bio_X509\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_RAND_poll\", referenced from:\r\n      _tlsInit in tls.o\r\n  \"_SSL_CTX_ctrl\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_free\", referenced from:\r\n      _tlsCleanup in tls.o\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _redisFreeSSLContext in libhiredis_ssl.a(ssl.o)\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_load_verify_locations\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_new\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_set_cipher_list\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_ciphersuites\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_default_passwd_cb\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_default_passwd_cb_userdata\", referenced from:\r\n      _createSSLContext in tls.o\r\n  \"_SSL_CTX_set_options\", referenced from:\r\n      _tlsConfigure in tls.o\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_set_session_id_context\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_SSL_CTX_set_timeout\", referenced from:\r\n      _tlsConfigure in tls.o\r\n  \"_SSL_CTX_set_verify\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_use_PrivateKey_file\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_CTX_use_certificate_chain_file\", referenced from:\r\n      _createSSLContext in tls.o\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_accept\", referenced from:\r\n      _connTLSAccept in tls.o\r\n      _tlsHandleEvent in tls.o\r\n  \"_SSL_connect\", referenced from:\r\n      _connTLSBlockingConnect in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_ctrl\", referenced from:\r\n      _connTLSSyncWrite in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_free\", referenced from:\r\n      _sentinelReconnectInstance in sentinel.o\r\n      _connTLSClose in tls.o\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLFree in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_get_error\", referenced from:\r\n      _handleSSLReturnCode in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLRead in libhiredis_ssl.a(ssl.o)\r\n      _redisSSLWrite in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_get_peer_certificate\", referenced from:\r\n      _connTLSGetPeerCert in tls.o\r\n  \"_SSL_new\", referenced from:\r\n      _sentinelReconnectInstance in sentinel.o\r\n      _connCreateTLS in tls.o\r\n      _connCreateAcceptedTLS in tls.o\r\n      _redisInitiateSSLWithContext in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_pending\", referenced from:\r\n      _tlsHandleEvent in tls.o\r\n  \"_SSL_read\", referenced from:\r\n      _connTLSRead in tls.o\r\n      _connTLSSyncRead in tls.o\r\n      _connTLSSyncReadLine in tls.o\r\n      _redisSSLRead in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_accept_state\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n  \"_SSL_set_connect_state\", referenced from:\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_fd\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n      _connTLSBlockingConnect in tls.o\r\n      _tlsHandleEvent in tls.o\r\n      _redisSSLConnect in libhiredis_ssl.a(ssl.o)\r\n  \"_SSL_set_verify\", referenced from:\r\n      _connCreateAcceptedTLS in tls.o\r\n  \"_SSL_write\", referenced from:\r\n      _connTLSWrite in tls.o\r\n      _connTLSSyncWrite in tls.o\r\n      _redisSSLWrite in libhiredis_ssl.a(ssl.o)\r\n  \"_TLS_client_method\", referenced from:\r\n      _redisCreateSSLContext in libhiredis_ssl.a(ssl.o)\r\n  \"_TLS_method\", referenced from:\r\n      _createSSLContext in tls.o\r\nld: symbol(s) not found for architecture x86_64\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nmake[1]: *** [redis-server] Error 1\r\nmake: *** [all] Error 2\r\n```"
    },
    {
      "id": 1072971167,
      "user": "oranagra",
      "created_at": "2022-03-19T08:50:42Z",
      "body": "It could be some issue on your system. \r\nBut I also notice you did `make BUILD_TLS=yes` after already building redis. \r\nPlease try this:\r\n```\r\nmake distclean\r\nmake BUILD_TLS=yes\r\n```"
    },
    {
      "id": 1073053119,
      "user": "devnexen",
      "created_at": "2022-03-19T17:53:14Z",
      "body": "if that helps... it seems to be a typical mac M1 build environment issue.\r\nI see here and there compiler/linker flags pointing to a typical homebrew installation path for x86_64/Rosetta mixed with the path for ARM64.\r\n\r\ne.g. `PREV_FINAL_LDFLAGS=-L/opt/homebrew/opt/openssl@1.1/lib  -g -ggdb -L/usr/local/opt/openssl/lib`\r\ne.g. `cc -std=c99 -c -O3 -fPIC -I/opt/homebrew/opt/openssl@1.1/include -DHIREDIS_TEST_SSL -I/usr/local/opt/openssl/include -Wall -W -Wstrict-prototypes -Wwrite-strings -Wno-missing-field-initializers -g -ggdb -pedantic alloc.c`\r\n\r\n\r\n"
    },
    {
      "id": 1082438367,
      "user": "IsraDeAguinaga",
      "created_at": "2022-03-29T22:37:56Z",
      "body": "Sorry, I was busy on other stuff, so the way how I solved this was:\r\nAfter some search I had to look at where the cpp compiler is searching at \" where #include <...> search starts \"\r\n`cpp -v /dev/null -o /dev/nul`\r\n\r\noutput looks something like this:\r\n\r\n```\r\n...\r\nignoring nonexistent directory \"/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/local/include\"\r\nignoring nonexistent directory \"/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/Library/Frameworks\"\r\n#include \"...\" search starts here:\r\n#include <...> search starts here:\r\n /usr/local/include\r\n /Library/Developer/CommandLineTools/usr/lib/clang/13.1.6/include\r\n /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include\r\n /Library/Developer/CommandLineTools/usr/include\r\n /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/System/Library/Frameworks (framework directory)\r\nEnd of search list.\r\n# 1 \"/dev/null\"\r\n# 1 \"<built-in>\" 1\r\n# 1 \"<built-in>\" 3\r\n...\r\n```\r\n\r\n\r\nfrom the output, I copied the include openSSL files in:\r\n`/Library/Developer/CommandLineTools/usr/include`\r\ncommand:\r\n`sudo cp -r /opt/homebrew/opt/openssl@1.1/include/openssl /Library/Developer/CommandLineTools/usr/include/`\r\nthen I ran:\r\n`make BUILD_TLS=yes` and it ran fine, then I test it `make test` and finally `sudo install -m 755 src/redis-cli /usr/local/bin/`. \r\nAll working fine now. ( all this I had to do it on the bash shell since it wasn't working on zsh )."
    },
    {
      "id": 1082441529,
      "user": "IsraDeAguinaga",
      "created_at": "2022-03-29T22:43:48Z",
      "body": "BTW I did this on the redis-stable version. Not sure if it works on Redis-unstable ( it should ). Thank for the help."
    }
  ]
}