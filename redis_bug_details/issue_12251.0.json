{
  "issue_number": 12251.0,
  "title": "[CRASH] <Crashed after running at a few days>",
  "body": "Notice!\r\n- If a Redis module was involved, please open an issue in the module's repo instead!\r\n- If you're using docker on Apple M1, please make sure the image you're using was compiled for ARM!\r\n\r\n\r\n**Crash report**\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n57658:M 04 May 11:11:22.414 # Redis 4.0.10 crashed by signal: 11\r\n57658:M 04 May 11:11:22.414 # Accessing address: 0xffffffffffffffff\r\n57658:M 04 May 11:11:22.414 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\n./redis-server 0.0.0.0:6379(logStackTrace+0x50)[0x46cad8]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:4.0.10\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:e72b66fe03796dbd\r\nredis_mode:standalone\r\nos:Linux 4.19.90.S001.64.200410 aarch64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:5.4.0\r\nprocess_id:57658\r\nrun_id:774bfa6ed14544c253afa84532a8d2c09405b938\r\ntcp_port:6379\r\nuptime_in_seconds:59159\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:5448282\r\nexecutable:/opt/redis-4.0.10/bin/./redis-server\r\nconfig_file:/opt/redis-4.0.10/redis.conf\r\n\r\n# Clients\r\nconnected_clients:6\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:1314680\r\nused_memory_human:1.25M\r\nused_memory_rss:8192000\r\nused_memory_rss_human:7.81M\r\nused_memory_peak:2446560\r\nused_memory_peak_human:2.33M\r\nused_memory_peak_perc:53.74%\r\nused_memory_overhead:956436\r\nused_memory_startup:819400\r\nused_memory_dataset:358244\r\nused_memory_dataset_perc:72.33%\r\ntotal_system_memory:66863038464\r\ntotal_system_memory_human:62.27G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:6.23\r\nmem_allocator:jemalloc-4.0.3\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:272\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1683169814\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:2621440\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:8\r\ntotal_commands_processed:244063\r\ninstantaneous_ops_per_sec:34\r\ntotal_net_input_bytes:189009810\r\ntotal_net_output_bytes:404074637\r\ninstantaneous_input_kbps:22.19\r\ninstantaneous_output_kbps:51.21\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:1156\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nevicted_keys:0\r\nkeyspace_hits:148683\r\nkeyspace_misses:31872\r\npubsub_channels:0\r\npubsub_patterns:9\r\nlatest_fork_usec:336\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:e8211347602d51b379160c53e935e2e6dd21cbc7\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:44.19\r\nused_cpu_user:13.64\r\nused_cpu_sys_children:0.16\r\nused_cpu_user_children:0.61\r\n\r\n# Commandstats\r\ncmdstat_publish:calls=30,usec=232,usec_per_call=7.73\r\ncmdstat_pexpire:calls=8862,usec=72635,usec_per_call=8.20\r\ncmdstat_setnx:calls=9458,usec=35760,usec_per_call=3.78\r\ncmdstat_del:calls=12865,usec=134637,usec_per_call=10.47\r\ncmdstat_hmset:calls=30,usec=355,usec_per_call=11.83\r\ncmdstat_sadd:calls=30,usec=192,usec_per_call=6.40\r\ncmdstat_keys:calls=15,usec=745,usec_per_call=49.67\r\ncmdstat_get:calls=177565,usec=460019,usec_per_call=2.59\r\ncmdstat_setex:calls=32087,usec=263153,usec_per_call=8.20\r\ncmdstat_hgetall:calls=90,usec=515,usec_per_call=5.72\r\ncmdstat_exists:calls=60,usec=96,usec_per_call=1.60\r\ncmdstat_select:calls=4,usec=7,usec_per_call=1.75\r\ncmdstat_append:calls=30,usec=140,usec_per_call=4.67\r\ncmdstat_auth:calls=8,usec=27,usec_per_call=3.38\r\ncmdstat_config:calls=5,usec=179,usec_per_call=35.80\r\ncmdstat_punsubscribe:calls=1,usec=4,usec_per_call=4.00\r\ncmdstat_psubscribe:calls=4,usec=30,usec_per_call=7.50\r\ncmdstat_smembers:calls=2919,usec=7046,usec_per_call=2.41\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb1:keys=307,expires=301,avg_ttl=7117207\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=10 addr=55.2.40.193:38884 fd=12 name= age=58156 idle=0 flags=N db=0 sub=0 psub=3 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=psubscribe\r\nid=5 addr=55.2.40.193:36440 fd=7 name= age=58523 idle=0 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=setex\r\nid=6 addr=55.2.40.193:36472 fd=8 name= age=58508 idle=0 flags=N db=0 sub=0 psub=3 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=psubscribe\r\nid=7 addr=55.2.40.193:38002 fd=9 name= age=58276 idle=0 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=get\r\nid=8 addr=55.2.40.193:38122 fd=10 name= age=58268 idle=0 flags=N db=0 sub=0 psub=3 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=psubscribe\r\nid=9 addr=55.2.40.193:38732 fd=11 name= age=58167 idle=23 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=del\r\n\r\n------ REGISTERS ------\r\n\r\n------ FAST MEMORY TEST ------\r\n57658:M 04 May 11:11:22.415 # Bio thread for job type #0 terminated\r\n57658:M 04 May 11:11:22.415 # Bio thread for job type #1 terminated\r\n57658:M 04 May 11:11:22.415 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 540000 (65536 bytes)\r\n*** Preparing to test memory region 29440000 (196608 bytes)\r\n*** Preparing to test memory region fffc79e00000 (2097152 bytes)\r\n*** Preparing to test memory region fffc7a1e0000 (8388608 bytes)\r\n*** Preparing to test memory region fffc7a9f0000 (8388608 bytes)\r\n*** Preparing to test memory region fffc7b200000 (8388608 bytes)\r\n*** Preparing to test memory region fffc7ba00000 (2097152 bytes)\r\n*** Preparing to test memory region fffc88a00000 (2097152 bytes)\r\n.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/antirez/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n\r\n```\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version\r\n\r\nos:Linux 4.19.90.S001.64.200410 aarch64 （arm64）\r\narch_bits:64\r\nredis version:4.0.10\r\n",
  "state": "open",
  "created_at": "2023-06-01T06:35:38Z",
  "updated_at": "2023-06-05T03:50:32Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1572369879,
      "user": "yossigo",
      "created_at": "2023-06-01T16:31:43Z",
      "body": "@xiaobing395845388 This is a very old version, can you please try the latest and report back if the problem persists?"
    },
    {
      "id": 1573008625,
      "user": "xiaobing395845388",
      "created_at": "2023-06-02T01:39:17Z",
      "body": "> @xiaobing395845388 This is a very old version, can you please try the latest and report back if the problem persists?\r\n\r\nit runs at a relatively special production environment，the signing process is quite complex because of the Classified Host Information"
    },
    {
      "id": 1573008885,
      "user": "xiaobing395845388",
      "created_at": "2023-06-02T01:39:47Z",
      "body": "> @xiaobing395845388 This is a very old version, can you please try the latest and report back if the problem persists?\r\n\r\nit runs at a relatively special production environment，the signing process is quite complex because of the Classified Host Information"
    },
    {
      "id": 1573009403,
      "user": "xiaobing395845388",
      "created_at": "2023-06-02T01:40:38Z",
      "body": "> @xiaobing395845388 This is a very old version, can you please try the latest and report back if the problem persists?\r\n\r\nany ideas by the above report？"
    },
    {
      "id": 1574831405,
      "user": "sundb",
      "created_at": "2023-06-03T10:05:58Z",
      "body": "@xiaobing395845388 I see that you are using arm64 linux, but AFAIK the 4.x version does not have support for arm64. \r\nPerhaps you can look for the following commit:\r\n```\r\n3e112d461 Use jemalloc by default also on ARM (#11407)\r\n34e70c13c fix arm build warning due to new compiler optimizations (#11362)\r\nebfbb0910 Remove redundant -latomic on arm64. (#8867)\r\n1bf02e1ca Fix compliation on arm64 Mac with jemalloc (#8458)\r\n3a5049042 Avoid assertions when testing arm64 cow bug. (#8405)\r\nb02780c41 Add check for the MADV_FREE/fork arm64 Linux kernel bug (#8224)\r\nb51f5da31 Fix TLS build on macOS arm64 systems (#8197)\r\n88351275f Merge pull request #6960 from devnexen/debug_arm_linux\r\n654815729 debug, dump registers on arm too.\r\ne084b5a39 Merge branch 'arm' into unstable\r\n```"
    },
    {
      "id": 1575996986,
      "user": "xiaobing395845388",
      "created_at": "2023-06-05T03:50:32Z",
      "body": "> Merge branch 'arm' into unstable\r\n\r\ni donot think so ,it works well on our test env, the same version 4.0.10 ,and also arm64"
    }
  ]
}