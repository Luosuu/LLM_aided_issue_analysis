{
  "issue_number": 10592.0,
  "title": "[CRASH]Redis 4.0.14 crashed by signal: 11",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n23260:M 16 Apr 22:34:01.753 # Redis 4.0.14 crashed by signal: 11\r\n23260:M 16 Apr 22:34:01.753 # Crashed running the instruction at: 0x46aee5\r\n23260:M 16 Apr 22:34:01.753 # Accessing address: 0x2b19ee400000\r\n23260:M 16 Apr 22:34:01.753 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](intsetGet+0x15)[0x46aee5]\r\n\r\nBacktrace:\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](logStackTrace+0x29)[0x468ad9]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](sigsegvHandler+0xac)[0x46917c]\r\n/lib64/libpthread.so.0(+0xf370)[0x2b19e7085370]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](intsetGet+0x15)[0x46aee5]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](setTypeNext+0x2e)[0x44f91e]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](sinterGenericCommand+0x1b2)[0x4505a2]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](call+0x9e)[0x42c11e]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](processCommand+0x3c7)[0x42c827]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](processInputBuffer+0x105)[0x43b965]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](aeProcessEvents+0x2a0)[0x426840]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](aeMain+0x2b)[0x426b0b]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster](main+0x49f)[0x42390f]\r\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x2b19e72b3b35]\r\n/apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster][0x423c02]\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=1199664 addr=127.0.0.1:8698 fd=98 name= age=433755 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=1112 omem=18219511 events=r cmd=smembers\r\nargv[0]: 'SMEMBERS'\r\nargv[1]: 'ug:1:1:443209786'\r\n23260:M 16 Apr 22:34:01.755 # key 'ug:1:1:443209786' found in DB containing the following object:\r\n23260:M 16 Apr 22:34:01.755 # Object type: 2\r\n23260:M 16 Apr 22:34:01.755 # Object encoding: 6\r\n23260:M 16 Apr 22:34:01.755 # Object refcount: 1\r\n23260:M 16 Apr 22:34:01.755 # Set size: 976304690\r\n\r\n------ REGISTERS ------\r\n23260:M 16 Apr 22:34:01.755 # \r\nRAX:00000000000000d0 RBX:00002b1a7eaefc10\r\nRCX:00002b1aa03b9370 RDX:00007ffcb7f0d098\r\nRDI:00002b19ee01b0a0 RSI:00000000001f27ac\r\nRBP:00007ffcb7f0d090 RSP:00007ffcb7f0d038\r\nR8 :0000000000000001 R9 :0000000000000000\r\nR10:0000000000000000 R11:00002b19e7414150\r\nR12:00002b1a7eaefc10 R13:0000000000000006\r\nR14:0000000000000001 R15:00002b1a319ed900\r\nRIP:000000000046aee5 EFL:0000000000010296\r\nCSGSFS:0000000000000033\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d047) -> 0000000000000000\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d046) -> 00002b1b24df1680\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d045) -> 00002b1b24df1680\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d044) -> 0000000000000001\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d043) -> 0000000000000000\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d042) -> 00000000001f27ac\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d041) -> 00002b1b88595690\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d040) -> 0000000000000000\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03f) -> 0000000000000000\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03e) -> 00000000004505a2\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03d) -> 0000000000000001\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03c) -> 00002b1b24df1680\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03b) -> 0000000000000001\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d03a) -> 000000000044f853\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d039) -> 00002b1aa03b9370\r\n23260:M 16 Apr 22:34:01.755 # (00007ffcb7f0d038) -> 000000000044f91e\r\n\r\n------ FAST MEMORY TEST ------\r\n23260:M 16 Apr 22:34:01.756 # Bio thread for job type #0 terminated\r\n23260:M 16 Apr 22:34:01.756 # Bio thread for job type #1 terminated\r\n23260:M 16 Apr 22:34:01.756 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 745000 (98304 bytes)\r\n*** Preparing to test memory region 21ed000 (135168 bytes)\r\n*** Preparing to test memory region 2b19e696e000 (4096 bytes)\r\n*** Preparing to test memory region 2b19e696f000 (4096 bytes)\r\n*** Preparing to test memory region 2b19e6979000 (16384 bytes)\r\n*** Preparing to test memory region 2b19e6b6f000 (4096 bytes)\r\n*** Preparing to test memory region 2b19e728e000 (16384 bytes)\r\n*** Preparing to test memory region 2b19e764e000 (20480 bytes)\r\n*** Preparing to test memory region 2b19e7800000 (2097152 bytes)\r\n*** Preparing to test memory region 2b19ee000000 (2097152 bytes)\r\n*** Preparing to test memory region 2b19ee200000 (2097152 bytes)\r\n*** Preparing to test memory region 2b19ee401000 (4194304 bytes)\r\n*** Preparing to test memory region 2b19ee802000 (4194304 bytes)\r\n*** Preparing to test memory region 2b19eec03000 (4194304 bytes)\r\n*** Preparing to test memory region 2b19ef200000 (6933184512 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: intsetGet (base: 0x46aed0)\r\nModule: /apps/svr/redis-4.0.14/bin/redis-server 0.0.0.0:6383 [cluster] (base 0x400000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x46aed0 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n23260:M 16 Apr 22:34:34.875 # dump of function (hexdump of 149 bytes):\r\n31c0397704761c0fb6074863f63c0874173c04741b480fbf447708488902b801000000f3c30f1f00488b44f708ebec90486344b708ebe4660f1f8400000000008b4704c36690662e0f1f8400000000008b070faf47044883c008c30f1f440000415741bf0a000000415641554189fd41544989cc4d89e6554889f5534889d34883ec2848895424\r\n18e8a3f2fbff4889442408eb340f\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/antirez/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version\r\nCentOS Linux release 7.3.1611 (Core)\r\nredis-server 4.0.14\r\n\r\n\r\nquestion 1: after failover,I get this key and find that is only  33 BYTES(3 values)\r\n`argv[0]: 'SMEMBERS'\r\nargv[1]: 'ug:1:1:443209786'\r\n23260:M 16 Apr 22:34:01.755 # key 'ug:1:1:443209786' found in DB containing the following object:\r\n23260:M 16 Apr 22:34:01.755 # Object type: 2\r\n23260:M 16 Apr 22:34:01.755 # Object encoding: 6\r\n23260:M 16 Apr 22:34:01.755 # Object refcount: 1\r\n23260:M 16 Apr 22:34:01.755 # Set size: 976304690\r\n`\r\n\r\n\r\nquestion 2: I didn't  find any memory error from my machine",
  "state": "open",
  "created_at": "2022-04-17T01:47:45Z",
  "updated_at": "2022-04-18T03:03:41Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1100810805,
      "user": "oranagra",
      "created_at": "2022-04-17T05:59:05Z",
      "body": "@825644691 any chance this is reproducible? if it is, i'd like you try a newer version of redis.\r\n\r\n> after failover,I get this key and find that is only 33 BYTES(3 values)\r\n\r\ni assume 3 values is closer to what you would expect (rather than 976304690), right?\r\ni imagine somehow this memory got corrupted, which is also why SMEMBERS crashed.\r\nsadly, the only way to move forward with this is if we learn how to reproduce it."
    }
  ]
}