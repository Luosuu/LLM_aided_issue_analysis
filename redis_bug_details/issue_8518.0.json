{
  "issue_number": 8518.0,
  "title": "[CRASH] Cannot start Redis 6.0.10 on M1 Mac (macOS 11.2.1)",
  "body": "Hello, I am just starting to learn Redis and wanted to install in on my M1 MacBook Pro. I followed [these instructions](https://gist.github.com/tomysmile/1b8a321e7c58499ef9f9441b2faa0aa8), but I was unable to start Redis at all. I have tried doing so both with and without root permissions.\r\n\r\n**Crash report**\r\n\r\nThis is what was logged in my system console upon running `brew services start redis`\r\n\r\n```\r\nProcess:               redis-server [19373]\r\nPath:                  /opt/homebrew/*/redis-server\r\nIdentifier:            redis-server\r\nVersion:               0\r\nCode Type:             ARM-64 (Native)\r\nParent Process:        ??? [1]\r\nResponsible:           redis-server [19373]\r\nUser ID:               501\r\n\r\nDate/Time:             2021-02-20 22:31:26.845 -0600\r\nOS Version:            macOS 11.2.1 (20D74)\r\nReport Version:        12\r\nAnonymous UUID:        E98E77F9-5D1C-9590-3DFF-537EA24817DB\r\n\r\n\r\nTime Awake Since Boot: 1500 seconds\r\n\r\nSystem Integrity Protection: enabled\r\n\r\nCrashed Thread:        0\r\n\r\nException Type:        EXC_BAD_ACCESS (Code Signature Invalid)\r\nException Codes:       0x0000000000000032, 0x00000001022ec000\r\nException Note:        EXC_CORPSE_NOTIFY\r\n\r\nTermination Reason:    Namespace CODESIGNING, Code 0x2\r\n\r\nkernel messages:\r\n\r\nVM Regions Near 0x1022ec000:\r\n    __LINKEDIT                  1022b4000-1022ec000    [  224K] r--/r-- SM=COW  /opt/homebrew/*\r\n--> mapped file                 1022ec000-1022f0000    [   16K] r--/r-x SM=PRV  Object_id=8867d0f5\r\n    __TEXT                      102654000-1026d0000    [  496K] r-x/r-x SM=COW  /usr/lib/dyld\r\n\r\nApplication Specific Information:\r\ndyld: launch, loading dependent libraries\r\n/opt/homebrew/opt/openssl@1.1/lib/libssl.1.1.dylib\r\n\r\nThread 0 Crashed:\r\n0   dyld                          \t0x00000001026b0780 bcmp + 16\r\n1   dyld                          \t0x0000000102671408 ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) + 136\r\n2   dyld                          \t0x00000001026783b8 ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) + 268\r\n3   dyld                          \t0x000000010266fffc ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) + 172\r\n4   dyld                          \t0x0000000102658290 dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) + 668\r\n5   dyld                          \t0x0000000102660dd8 dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 1328\r\n6   dyld                          \t0x0000000102660824 dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 208\r\n7   dyld                          \t0x0000000102660530 dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 1100\r\n8   dyld                          \t0x000000010265fcf0 dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 212\r\n9   dyld                          \t0x0000000102657e0c dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 468\r\n10  dyld                          \t0x00000001026579b0 dyld::load(char const*, dyld::LoadContext const&, unsigned int&) + 196\r\n11  dyld                          \t0x000000010266177c dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*, unsigned int&) + 56\r\n12  dyld                          \t0x000000010266b9d4 ImageLoader::recursiveLoadLibraries(ImageLoader::LinkContext const&, bool, ImageLoader::RPathChain const&, char const*) + 344\r\n13  dyld                          \t0x000000010266a1ac ImageLoader::link(ImageLoader::LinkContext const&, bool, bool, bool, ImageLoader::RPathChain const&, char const*) + 160\r\n14  dyld                          \t0x000000010265a5f4 dyld::link(ImageLoader*, bool, bool, ImageLoader::RPathChain const&, unsigned int) + 328\r\n15  dyld                          \t0x000000010265c928 dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) + 6764\r\n16  dyld                          \t0x0000000102655258 dyldbootstrap::start(dyld3::MachOLoaded const*, int, char const**, dyld3::MachOLoaded const*, unsigned long*) + 476\r\n17  dyld                          \t0x0000000102655038 _dyld_start + 56\r\n\r\nThread 0 crashed with ARM Thread State (64-bit):\r\n    x0: 0x00000001022ec000   x1: 0x000000016dc45da0   x2: 0x0000000000000690   x3: 0x0000000000040001\r\n    x4: 0x0000000000000003   x5: 0x0000000000000000   x6: 0x00000001026d8280   x7: 0x0000000000000000\r\n    x8: 0x0000000000000000   x9: 0x000000016dc46350  x10: 0x0000000000000001  x11: 0x0001803000000000\r\n   x12: 0x0000000000000032  x13: 0x0004000000000000  x14: 0x0000000000076b40  x15: 0x000000016dc462d0\r\n   x16: 0x00000000000000c5  x17: 0x0000000000000000  x18: 0x0000000000000000  x19: 0x00000001026dd7a0\r\n   x20: 0x00000000000006a0  x21: 0x000000016dc45da0  x22: 0x00000001022ec000  x23: 0x0000000000000003\r\n   x24: 0x000000016dc46430  x25: 0x000000016dc4deb8  x26: 0x00000001021b0700  x27: 0x000000016dc45da0\r\n   x28: 0x0000000000000002   fp: 0x000000016dc457a0   lr: 0x0000000102671408\r\n    sp: 0x000000016dc45760   pc: 0x00000001026b0780 cpsr: 0x20000000\r\n   far: 0x00000001022ec000  esr: 0x92000007\r\n\r\n\r\nBinary Images:\r\n       0x1021b0000 -        0x102287fff +redis-server (0) <95D988DD-A0E0-3327-9A6F-1876A7CF385B> /opt/homebrew/*/redis-server\r\n       0x102654000 -        0x1026cffff  dyld (832.7.3) <4AB185B3-DC20-3C03-A193-67C0E6C589D7> /usr/lib/dyld\r\n       0x19ed52000 -        0x19ed53fff  libSystem.B.dylib (1292.60.1) <CF348B98-3432-3B5A-920B-2C7AFE89000D> /usr/lib/libSystem.B.dylib\r\n\r\nExternal Modification Summary:\r\n  Calls made by other processes targeting this process:\r\n    task_for_pid: 0\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n  Calls made by this process:\r\n    task_for_pid: 0\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n  Calls made by all processes on this machine:\r\n    task_for_pid: 1541\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n\r\nVM Region Summary:\r\nReadOnly portion of Libraries: Total=481.2M resident=0K(0%) swapped_out_or_unallocated=481.2M(100%)\r\nWritable regions: Total=8496K written=0K(0%) resident=0K(0%) swapped_out=0K(0%) unallocated=8496K(100%)\r\n \r\n                                VIRTUAL   REGION \r\nREGION TYPE                        SIZE    COUNT (non-coalesced) \r\n===========                     =======  ======= \r\nSTACK GUARD                       56.0M        1 \r\nStack                             8176K        1 \r\n__AUTH                                8        1 \r\n__AUTH_CONST                        624        1 \r\n__DATA                             384K        5 \r\n__DATA_CONST                        48K        2 \r\n__LINKEDIT                       479.9M        4 \r\n__TEXT                            1368K        3 \r\nmapped file                         16K        1 \r\n===========                     =======  ======= \r\nTOTAL                            545.7M       19 \r\n```\r\n\r\nAnd this was logged by `redis-cli ping`:\r\n\r\n```\r\nProcess:               redis-cli [19195]\r\nPath:                  /opt/homebrew/*/redis-cli\r\nIdentifier:            redis-cli\r\nVersion:               0\r\nCode Type:             ARM-64 (Native)\r\nParent Process:        bash [3337]\r\nResponsible:           iTerm2 [879]\r\nUser ID:               501\r\n\r\nDate/Time:             2021-02-20 22:30:00.247 -0600\r\nOS Version:            macOS 11.2.1 (20D74)\r\nReport Version:        12\r\nAnonymous UUID:        E98E77F9-5D1C-9590-3DFF-537EA24817DB\r\n\r\n\r\nTime Awake Since Boot: 1400 seconds\r\n\r\nSystem Integrity Protection: enabled\r\n\r\nCrashed Thread:        0\r\n\r\nException Type:        EXC_BAD_ACCESS (Code Signature Invalid)\r\nException Codes:       0x0000000000000032, 0x0000000102e74000\r\nException Note:        EXC_CORPSE_NOTIFY\r\n\r\nTermination Reason:    Namespace CODESIGNING, Code 0x2\r\n\r\nkernel messages:\r\n\r\nVM Regions Near 0x102e74000:\r\n    __LINKEDIT                  102e64000-102e74000    [   64K] r--/r-- SM=COW  /opt/homebrew/*\r\n--> mapped file                 102e74000-102e78000    [   16K] r--/r-x SM=PRV  Object_id=8867d0f5\r\n    __TEXT                      103194000-103210000    [  496K] r-x/r-x SM=COW  /usr/lib/dyld\r\n\r\nApplication Specific Information:\r\ndyld: launch, loading dependent libraries\r\n/opt/homebrew/opt/openssl@1.1/lib/libssl.1.1.dylib\r\n\r\nThread 0 Crashed:\r\n0   dyld                          \t0x00000001031f0780 bcmp + 16\r\n1   dyld                          \t0x00000001031b1408 ImageLoaderMachO::validateFirstPages(linkedit_data_command const*, int, unsigned char const*, unsigned long, long long, ImageLoader::LinkContext const&) + 136\r\n2   dyld                          \t0x00000001031b83b8 ImageLoaderMachOCompressed::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, unsigned int, unsigned int, linkedit_data_command const*, encryption_info_command const*, ImageLoader::LinkContext const&) + 268\r\n3   dyld                          \t0x00000001031afffc ImageLoaderMachO::instantiateFromFile(char const*, int, unsigned char const*, unsigned long, unsigned long long, unsigned long long, stat const&, ImageLoader::LinkContext const&) + 172\r\n4   dyld                          \t0x0000000103198290 dyld::loadPhase6(int, stat const&, char const*, dyld::LoadContext const&) + 668\r\n5   dyld                          \t0x00000001031a0dd8 dyld::loadPhase5(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 1328\r\n6   dyld                          \t0x00000001031a0824 dyld::loadPhase4(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 208\r\n7   dyld                          \t0x00000001031a0530 dyld::loadPhase3(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 1100\r\n8   dyld                          \t0x000000010319fcf0 dyld::loadPhase1(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 212\r\n9   dyld                          \t0x0000000103197e0c dyld::loadPhase0(char const*, char const*, dyld::LoadContext const&, unsigned int&, std::__1::vector<char const*, std::__1::allocator<char const*> >*) + 468\r\n10  dyld                          \t0x00000001031979b0 dyld::load(char const*, dyld::LoadContext const&, unsigned int&) + 196\r\n11  dyld                          \t0x00000001031a177c dyld::libraryLocator(char const*, bool, char const*, ImageLoader::RPathChain const*, unsigned int&) + 56\r\n12  dyld                          \t0x00000001031ab9d4 ImageLoader::recursiveLoadLibraries(ImageLoader::LinkContext const&, bool, ImageLoader::RPathChain const&, char const*) + 344\r\n13  dyld                          \t0x00000001031aa1ac ImageLoader::link(ImageLoader::LinkContext const&, bool, bool, bool, ImageLoader::RPathChain const&, char const*) + 160\r\n14  dyld                          \t0x000000010319a5f4 dyld::link(ImageLoader*, bool, bool, ImageLoader::RPathChain const&, unsigned int) + 328\r\n15  dyld                          \t0x000000010319c928 dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) + 6764\r\n16  dyld                          \t0x0000000103195258 dyldbootstrap::start(dyld3::MachOLoaded const*, int, char const**, dyld3::MachOLoaded const*, unsigned long*) + 476\r\n17  dyld                          \t0x0000000103195038 _dyld_start + 56\r\n\r\nThread 0 crashed with ARM Thread State (64-bit):\r\n    x0: 0x0000000102e74000   x1: 0x000000016cfcd7c0   x2: 0x0000000000000690   x3: 0x0000000000040001\r\n    x4: 0x0000000000000003   x5: 0x0000000000000000   x6: 0x0000000103218280   x7: 0x0000000000000000\r\n    x8: 0x0000000000000000   x9: 0x000000016cfcdd70  x10: 0x0000000000000001  x11: 0x0001803000000000\r\n   x12: 0x0000000000000032  x13: 0x0004000000000000  x14: 0x0000000000076b40  x15: 0x000000016cfcdcf0\r\n   x16: 0x00000000000000c5  x17: 0x0000000000000000  x18: 0x0000000000000000  x19: 0x000000010321d7a0\r\n   x20: 0x00000000000006a0  x21: 0x000000016cfcd7c0  x22: 0x0000000102e74000  x23: 0x0000000000000003\r\n   x24: 0x000000016cfcde50  x25: 0x000000016cfd58d8  x26: 0x0000000102e286b0  x27: 0x000000016cfcd7c0\r\n   x28: 0x0000000000000002   fp: 0x000000016cfcd1c0   lr: 0x00000001031b1408\r\n    sp: 0x000000016cfcd180   pc: 0x00000001031f0780 cpsr: 0x20000000\r\n   far: 0x0000000102e74000  esr: 0x92000007\r\n\r\n\r\nBinary Images:\r\n       0x102e28000 -        0x102e57fff +redis-cli (0) <6902B5F9-4425-3EB1-81BF-4D107D0499F8> /opt/homebrew/*/redis-cli\r\n       0x103194000 -        0x10320ffff  dyld (832.7.3) <4AB185B3-DC20-3C03-A193-67C0E6C589D7> /usr/lib/dyld\r\n       0x19ed52000 -        0x19ed53fff  libSystem.B.dylib (1292.60.1) <CF348B98-3432-3B5A-920B-2C7AFE89000D> /usr/lib/libSystem.B.dylib\r\n\r\nExternal Modification Summary:\r\n  Calls made by other processes targeting this process:\r\n    task_for_pid: 0\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n  Calls made by this process:\r\n    task_for_pid: 0\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n  Calls made by all processes on this machine:\r\n    task_for_pid: 1541\r\n    thread_create: 0\r\n    thread_set_state: 0\r\n\r\nVM Region Summary:\r\nReadOnly portion of Libraries: Total=480.4M resident=0K(0%) swapped_out_or_unallocated=480.4M(100%)\r\nWritable regions: Total=8400K written=0K(0%) resident=0K(0%) swapped_out=0K(0%) unallocated=8400K(100%)\r\n \r\n                                VIRTUAL   REGION \r\nREGION TYPE                        SIZE    COUNT (non-coalesced) \r\n===========                     =======  ======= \r\nSTACK GUARD                       56.0M        1 \r\nStack                             8176K        1 \r\n__AUTH                                8        1 \r\n__AUTH_CONST                        624        1 \r\n__DATA                             256K        5 \r\n__DATA_CONST                        48K        2 \r\n__LINKEDIT                       479.8M        4 \r\n__TEXT                             696K        3 \r\nmapped file                         16K        1 \r\n===========                     =======  ======= \r\nTOTAL                            544.8M       19 \r\n```\r\n\r\n**Aditional information**\r\n\r\n1. macOS 11.2.1\r\n2. Steps to reproduce:\r\n\r\nHere's how I installed it via Homebrew 3.0.1:\r\n\r\n```\r\n$ brew install redis\r\nWarning: Treating redis as a formula. For the cask, use homebrew/cask/redis\r\n==> Downloading https://homebrew.bintray.com/bottles/redis-6.0.10.arm64_big_sur.bottle.tar.gz\r\nAlready downloaded: /Users/jeremyckahn/Library/Caches/Homebrew/downloads/7ba5f6a220056a681399457cc571100883a319d999dd9a327863b49aea4379fb--redis-6.0.10.arm64_big_sur.bottle.tar.gz\r\n==> Pouring redis-6.0.10.arm64_big_sur.bottle.tar.gz\r\nWarning: This keg was marked linked already, continuing anyway\r\n==> Caveats\r\nTo have launchd start redis now and restart at login:\r\n  brew services start redis\r\nOr, if you don't want/need a background service you can just run:\r\n  redis-server /opt/homebrew/etc/redis.conf\r\n==> Summary\r\n🍺  /opt/homebrew/Cellar/redis/6.0.10: 13 files, 4MB\r\n ~\r\n$ brew services start redis\r\n==> Successfully started `redis` (label: homebrew.mxcl.redis)\r\n ~\r\n$ redis-cli ping\r\nKilled: 9\r\n ~\r\n$ brew services list\r\nName    Status  User        Plist\r\nredis   error   jeremyckahn /Users/jeremyckahn/Library/LaunchAgents/homebrew.mxcl.redis.plist\r\nunbound stopped\r\n```\r\n\r\nPotentially related Github issues:\r\n\r\n  - #8062\r\n  - #8144",
  "state": "closed",
  "created_at": "2021-02-21T04:44:52Z",
  "updated_at": "2021-02-21T20:25:35Z",
  "closed_at": "2021-02-21T20:25:35Z",
  "labels": [],
  "comments_data": [
    {
      "id": 782832709,
      "user": "yossigo",
      "created_at": "2021-02-21T10:14:31Z",
      "body": "@jeremyckahn Not a macOS person but this line might indicate it is some security policy / local configuration issue on your system:\r\n\r\n```\r\nTermination Reason:    Namespace CODESIGNING, Code 0x2\r\n```"
    },
    {
      "id": 782872309,
      "user": "jeremyckahn",
      "created_at": "2021-02-21T15:05:56Z",
      "body": "@yossigo Thanks for the quick response and suggestion! That line also stood out to me. I looked in my system preferences and tried granting more access to Terminal:\r\n\r\n<img width=\"669\" alt=\"Screen Shot 2021-02-21 at 9 02 31 AM\" src=\"https://user-images.githubusercontent.com/366330/108629060-be480380-7423-11eb-906e-ce4197bac4cf.png\">\r\n\r\nI then reinstalled Redis, but the issue persisted. I'll keep digging into this, but I'd love to know what others think as well.\r\n\r\nThis issue is potentially related to the code signing issue: Homebrew/brew#9082"
    },
    {
      "id": 782906185,
      "user": "jeremyckahn",
      "created_at": "2021-02-21T18:50:39Z",
      "body": "Update: I was able to install and run Redis **without** Homebrew. After running `brew uninstall redis`, I followed the non-Homebrew install directions here: https://phoenixnap.com/kb/install-redis-on-mac\r\n\r\nSpecifically, I ran this:\r\n\r\n```bash\r\nmkdir redis && cd redis\r\ncurl -O http://download.redis.io/redis-stable.tar.gz\r\ntar xzvf redis-stable.tar.gz\r\ncd redis-stable\r\nmake\r\nmake test\r\nsudo make install\r\n```\r\n\r\nAnd everything seems to work! This suggests that this may be a Homebrew issue, so I will file an issue against that project. Given this, would this be considered a Redis bug, or should this issue be closed?"
    },
    {
      "id": 782920540,
      "user": "jeremyckahn",
      "created_at": "2021-02-21T20:25:35Z",
      "body": "A fix has been identified by @dtrodrigues here: https://github.com/Homebrew/homebrew-core/issues/71667#issuecomment-782915318\r\n\r\nThe solution:\r\n\r\n```bash\r\nbrew reinstall openssl@1.1\r\n```\r\n\r\nClosing this issue!"
    }
  ]
}