{
  "issue_number": 10734.0,
  "title": "[CRASH] Redis 6.2.6 crashed by signal: 11, si_code: 1",
  "body": "**Crash report**\r\n\r\n\r\n1:M 16 May 2022 15:41:21.014 # Redis 6.2.6 crashed by signal: 11, si_code: 1\r\n1:M 16 May 2022 15:41:21.014 # Accessing address: 0x2000\r\n1:M 16 May 2022 15:41:21.014 # Crashed running the instruction at: 0x40049c16a3\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/lib/redis/modules/redisgraph.so(+0x2396a3)[0x40049c16a3]\r\n\r\nBacktrace:\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x12980)[0x4002f85980]\r\n/usr/lib/redis/modules/redisgraph.so(+0x2396a3)[0x40049c16a3]\r\n/usr/lib/redis/modules/redisgraph.so(ResultSet_EmitVerboseRow+0x49)[0x40049c1cd9]\r\n/usr/lib/redis/modules/redisgraph.so(ResultSet_Reply+0xf2)[0x40049c08a2]\r\n/usr/lib/redis/modules/redisgraph.so(+0x1f4af8)[0x400497caf8]\r\n/usr/lib/redis/modules/redisgraph.so(+0x243ab4)[0x40049cbab4]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x76db)[0x4002f7a6db]\r\n/lib/x86_64-linux-gnu/libc.so.6(clone+0x3f)[0x40032b361f]\r\n\r\n------ REGISTERS ------\r\n1:M 16 May 2022 15:41:21.030 # \r\nRAX:0000000000002000 RBX:0000004038dd1980\r\nRCX:000000000000035c RDX:0000000000000a0d\r\nRDI:0000004038dd1980 RSI:0000004003b9288b\r\nRBP:00000040092f9410 RSP:00000040092f9240\r\nR8 :00000040092f9248 R9 :0000004003300440\r\nR10:0000000000000001 R11:000000400334eda0\r\nR12:0000004038e08c00 R13:0000004003bbf140\r\nR14:00000040060c4660 R15:00000040060c46f0\r\nRIP:00000040049c16a3 EFL:0000000000000202\r\nCSGSFS:002b000000000033\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924f) -> 0000004041591b20\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924e) -> 0000000000000002\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924d) -> 0000004000057763\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924c) -> 0000000000000000\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924b) -> 000000400d42d1f0\r\n1:M 16 May 2022 15:41:21.030 # (00000040092f924a) -> 00000040092f9240\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9249) -> 00000040092f9248\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9248) -> 00000040092f9280\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9247) -> 00000040049c15cb\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9246) -> 0000004038e08c00\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9245) -> 00000040000d831c\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9244) -> 0000004038e08c00\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9243) -> 00000040092f9410\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9242) -> 0000004038dd1980\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9241) -> efcc9f4d65ab3600\r\n1:M 16 May 2022 15:41:21.031 # (00000040092f9240) -> 0000000000000001\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:e15697f1a083b6bc\r\nredis_mode:standalone\r\nos:Linux 5.10.104-linuxkit x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:7.5.0\r\nprocess_id:1\r\nprocess_supervised:no\r\nrun_id:d065b288215c0a6d54745ba2ecd426a1cb2038fd\r\ntcp_port:6379\r\nserver_time_usec:1652715681014593\r\nuptime_in_seconds:10822\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:8548513\r\nexecutable:/data/redis-server\r\nconfig_file:\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:3\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:127\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:1\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:22504336\r\nused_memory_human:21.46M\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:25792360\r\nused_memory_peak_human:24.60M\r\nused_memory_peak_perc:87.25%\r\nused_memory_overhead:905783\r\nused_memory_startup:844048\r\nused_memory_dataset:21598553\r\nused_memory_dataset_perc:99.71%\r\nallocator_allocated:24512000\r\nallocator_active:27054080\r\nallocator_resident:32485376\r\ntotal_system_memory:8232747008\r\ntotal_system_memory_human:7.67G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.10\r\nallocator_frag_bytes:2542080\r\nallocator_rss_ratio:1.20\r\nallocator_rss_bytes:5431296\r\nrss_overhead_ratio:0.00\r\nrss_overhead_bytes:-32485376\r\nmem_fragmentation_ratio:0.00\r\nmem_fragmentation_bytes:-22543496\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:61623\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1652715182\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:5627904\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:20\r\ntotal_commands_processed:171153\r\ninstantaneous_ops_per_sec:1\r\ntotal_net_input_bytes:49725716\r\ntotal_net_output_bytes:44283673\r\ninstantaneous_input_kbps:0.08\r\ninstantaneous_output_kbps:2.46\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:1779\r\nevicted_keys:0\r\nkeyspace_hits:340603\r\nkeyspace_misses:5\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:75659\r\ntotal_forks:13\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:19\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:171175\r\ntotal_writes_processed:171286\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:2f2bed8ca150085d41c0eb19914890699ad94cd7\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:142.359307\r\nused_cpu_user:473.754635\r\nused_cpu_sys_children:0.235701\r\nused_cpu_user_children:2.638958\r\nused_cpu_sys_main_thread:0.688920\r\nused_cpu_user_main_thread:29.472587\r\n\r\n# Modules\r\nmodule:name=graph,ver=20812,api=1,filters=0,usedby=[],using=[],options=[]\r\n\r\n# Commandstats\r\ncmdstat_acl:calls=4,usec=826,usec_per_call=206.50,rejected_calls=0,failed_calls=0\r\ncmdstat_ttl:calls=23,usec=428,usec_per_call=18.61,rejected_calls=0,failed_calls=0\r\ncmdstat_graph.RO_QUERY:calls=12,usec=4154,usec_per_call=346.17,rejected_calls=0,failed_calls=0\r\ncmdstat_type:calls=8,usec=490,usec_per_call=61.25,rejected_calls=0,failed_calls=0\r\ncmdstat_client:calls=11,usec=419,usec_per_call=38.09,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=737,usec=898319,usec_per_call=1218.89,rejected_calls=0,failed_calls=0\r\ncmdstat_config:calls=1,usec=660,usec_per_call=660.00,rejected_calls=0,failed_calls=0\r\ncmdstat_scan:calls=20,usec=4037,usec_per_call=201.85,rejected_calls=0,failed_calls=0\r\ncmdstat_memory:calls=14,usec=408,usec_per_call=29.14,rejected_calls=0,failed_calls=0\r\ncmdstat_module:calls=4,usec=3629,usec_per_call=907.25,rejected_calls=0,failed_calls=0\r\ncmdstat_cluster:calls=1,usec=332,usec_per_call=332.00,rejected_calls=0,failed_calls=1\r\ncmdstat_dbsize:calls=21,usec=848,usec_per_call=40.38,rejected_calls=0,failed_calls=0\r\ncmdstat_command:calls=3,usec=27479,usec_per_call=9159.67,rejected_calls=0,failed_calls=0\r\ncmdstat_del:calls=3,usec=27205,usec_per_call=9068.33,rejected_calls=0,failed_calls=0\r\ncmdstat_graph.QUERY:calls=170290,usec=10712086,usec_per_call=62.90,rejected_calls=0,failed_calls=0\r\ncmdstat_ping:calls=1,usec=38,usec_per_call=38.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_ERR:count=13\r\nerrorstat_encountered:count=6\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=2,expires=0,avg_ttl=0\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=113566 addr=172.17.0.1:55856 laddr=172.17.0.3:6379 fd=10 name=redisinsight-common-c7952259 age=3762 idle=2 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=info user=default redir=-1\r\nid=113567 addr=172.17.0.1:55858 laddr=172.17.0.3:6379 fd=11 name=redisinsight-browser-66fb8b6a age=3762 idle=3581 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20520 events=r cmd=graph.QUERY user=default redir=-1\r\nid=113568 addr=172.17.0.1:55866 laddr=172.17.0.3:6379 fd=12 name=redisinsight-workbench-93392805 age=3754 idle=1 flags=b db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=95 obl=0 oll=0 omem=0 tot-mem=20607 events=r cmd=graph.QUERY user=default redir=-1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n# graph_executing commands\r\ngraph_command:GRAPH.QUERY MATCH (m:AOV), (o:AO) WHERE o.type = m.type RETURN (m), (o) \r\n\r\n------ FAST MEMORY TEST ------\r\n1:M 16 May 2022 15:41:21.037 # main thread terminated\r\n1:M 16 May 2022 15:41:21.038 # Bio thread for job type #0 terminated\r\n1:M 16 May 2022 15:41:21.038 # Bio thread for job type #1 terminated\r\n1:M 16 May 2022 15:41:21.038 # Bio thread for job type #2 terminated\r\n\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: (null) (base: (nil))\r\nModule: /usr/lib/redis/modules/redisgraph.so (base 0x4004788000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=(nil) -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n\r\nqemu: uncaught target signal 11 (Segmentation fault) - core dumped\r\n\r\n```\r\n```\r\n\r\n**Additional information**\r\n\r\nmacOS Monterey (M1 Pro, 32GB Memory) over Docker by running 'docker run -p 6379:6379 -it --rm redislabs/redisgraph'\r\n\r\n",
  "state": "open",
  "created_at": "2022-05-16T16:19:16Z",
  "updated_at": "2022-05-16T18:50:01Z",
  "closed_at": null,
  "labels": [
    "state:to-be-closed"
  ],
  "comments_data": [
    {
      "id": 1128018035,
      "user": "oranagra",
      "created_at": "2022-05-16T18:49:45Z",
      "body": "This is the known QEMU issue.\r\nPlease try the docker image mentioned here: https://github.com/redis/redis/issues/10162#issuecomment-1072359526"
    }
  ]
}