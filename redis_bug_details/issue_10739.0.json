{
  "issue_number": 10739.0,
  "title": "Crash report[CRASH]",
  "body": "```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n2673:S 17 May 2022 00:02:31.715 # Redis 5.0.7 crashed by signal: 11\r\n2673:S 17 May 2022 00:02:31.715 # Crashed running the instruction at: 0x4a249e\r\n2673:S 17 May 2022 00:02:31.715 # Accessing address: (nil)\r\n2673:S 17 May 2022 00:02:31.715 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](raxRemove+0x10e)[0x4a249e]\r\n\r\nBacktrace:\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](logStackTrace+0x29)[0x470e19]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](sigsegvHandler+0xac)[0x4714bc]\r\n/lib64/libpthread.so.0(+0xf5f0)[0x7f7ab4af25f0]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](raxRemove+0x10e)[0x4a249e]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](slotToKeyUpdateKey+0x18d)[0x44668d]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](dbSyncDelete+0x52)[0x4467c2]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](delGenericCommand+0x6e)[0x4477ee]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](call+0x9b)[0x43049b]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](processCommand+0x33f)[0x43173f]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](processInputBuffer+0x175)[0x440405]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](processInputBufferAndReplicate+0x1e)[0x44053e]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](aeProcessEvents+0x2a0)[0x42a8c0]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](aeMain+0x2b)[0x42ab8b]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster](main+0x4c0)[0x427a30]\r\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f7ab4737505]\r\n/home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster][0x427c8a]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:5.0.7\r\nredis_git_sha1:9eda4983\r\nredis_git_dirty:1\r\nredis_build_id:7f913f29c5e1b1ec\r\nredis_mode:cluster\r\nos:Linux 3.10.0-957.el7.x86_64 x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:4.8.5\r\nprocess_id:2673\r\nrun_id:f95ebbf3d026abe3b7a9cb0336258765122bb14c\r\ntcp_port:6379\r\nuptime_in_seconds:1666685\r\nuptime_in_days:19\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:8549783\r\nexecutable:/home/dba/redis6379/masaike/bin/redis-server\r\nconfig_file:/home/dba/redis6379/masaike/config/redis.conf\r\n\r\n# Clients\r\nconnected_clients:2\r\nclient_recent_max_input_buffer:4\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:43746761464\r\nused_memory_human:40.74G\r\nused_memory_rss:64850657280\r\nused_memory_rss_human:60.40G\r\nused_memory_peak:61840916128\r\nused_memory_peak_human:57.59G\r\nused_memory_peak_perc:70.74%\r\nused_memory_overhead:19602667256\r\nused_memory_startup:1449992\r\nused_memory_dataset:24144094208\r\nused_memory_dataset_perc:55.19%\r\nallocator_allocated:43746946216\r\nallocator_active:63864541184\r\nallocator_resident:64770514944\r\ntotal_system_memory:168831148032\r\ntotal_system_memory_human:157.24G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:128849018880\r\nmaxmemory_human:120.00G\r\nmaxmemory_policy:allkeys-lru\r\nallocator_frag_ratio:1.46\r\nallocator_frag_bytes:20117594968\r\nallocator_rss_ratio:1.01\r\nallocator_rss_bytes:905973760\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:80142336\r\nmem_fragmentation_ratio:1.48\r\nmem_fragmentation_bytes:21103828392\r\nmem_not_counted_for_evict:3512\r\nmem_replication_backlog:1048576\r\nmem_clients_slaves:0\r\nmem_clients_normal:66616\r\nmem_aof_buffer:3512\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:537378214\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1651050266\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:1\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:388\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:48711303168\r\naof_current_size:20289568914\r\naof_base_size:16464252626\r\naof_pending_rewrite:0\r\naof_buffer_length:226\r\naof_rewrite_buffer_length:0\r\naof_pending_bio_fsync:0\r\naof_delayed_fsync:0\r\n\r\n# Stats\r\ntotal_connections_received:683046\r\ntotal_commands_processed:12949722795\r\ninstantaneous_ops_per_sec:27878\r\ntotal_net_input_bytes:426474457353\r\ntotal_net_output_bytes:445630143022\r\ninstantaneous_input_kbps:1313.18\r\ninstantaneous_output_kbps:0.06\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:3\r\nsync_partial_err:0\r\nexpired_keys:16960717\r\nexpired_stale_perc:5.96\r\nexpired_time_cap_reached_count:0\r\nevicted_keys:0\r\nkeyspace_hits:7422809604\r\nkeyspace_misses:4977642266\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:1017282\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\n\r\n# Replication\r\nrole:slave\r\nmaster_host:10.99.49.44\r\nmaster_port:6379\r\nmaster_link_status:up\r\nmaster_last_io_seconds_ago:0\r\nmaster_sync_in_progress:0\r\nslave_repl_offset:874779203998\r\nslave_priority:100\r\nslave_read_only:1\r\nconnected_slaves:0\r\nmaster_replid:22592a6b8f06df695e457968b3832919f972f81e\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:874779203782\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:1\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:874778155207\r\nrepl_backlog_histlen:1048576\r\n\r\n# CPU\r\nused_cpu_sys:113986.743593\r\nused_cpu_user:82089.503530\r\nused_cpu_sys_children:161.676930\r\nused_cpu_user_children:2027.761947\r\n\r\n# Commandstats\r\ncmdstat_config:calls=209809,usec=8195023,usec_per_call=39.06\r\ncmdstat_get:calls=12400451870,usec=19230085311,usec_per_call=1.55\r\ncmdstat_del:calls=107332789,usec=694353346,usec_per_call=6.47\r\ncmdstat_setex:calls=166839989,usec=710483165,usec_per_call=4.26\r\ncmdstat_psync:calls=3,usec=312,usec_per_call=104.00\r\ncmdstat_command:calls=7,usec=20834,usec_per_call=2976.29\r\ncmdstat_ping:calls=9506898,usec=2851106,usec_per_call=0.30\r\ncmdstat_hset:calls=131602719,usec=466417854,usec_per_call=3.54\r\ncmdstat_client:calls=70090,usec=147429,usec_per_call=2.10\r\ncmdstat_replconf:calls=1031213,usec=1646133,usec_per_call=1.60\r\ncmdstat_select:calls=4,usec=5,usec_per_call=1.25\r\ncmdstat_latency:calls=50635,usec=98792,usec_per_call=1.95\r\ncmdstat_expire:calls=131602717,usec=95201892,usec_per_call=0.72\r\ncmdstat_slowlog:calls=101125,usec=444516,usec_per_call=4.40\r\ncmdstat_auth:calls=477757,usec=680048,usec_per_call=1.42\r\ncmdstat_cluster:calls=234378,usec=26055988,usec_per_call=111.17\r\ncmdstat_info:calls=210792,usec=35501715,usec_per_call=168.42\r\n\r\n# Cluster\r\ncluster_enabled:1\r\n\r\n# Keyspace\r\ndb0:keys=172033812,expires=172033812,avg_ttl=3253842108\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=517240 addr=10.172.49.44:6379 fd=32 name= age=606459 idle=0 flags=M db=0 sub=0 psub=0 multi=-1 qbuf=316 qbuf-free=32452 obl=0 oll=0 omem=0 events=r cmd=del\r\nid=682600 addr=10.189.136.109:37324 fd=10 name= age=1643 idle=5 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=config\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=517240 addr=10.172.49.44:6379 fd=32 name= age=606459 idle=0 flags=M db=0 sub=0 psub=0 multi=-1 qbuf=316 qbuf-free=32452 obl=0 oll=0 omem=0 events=r cmd=del\r\nargv[0]: 'DEL'\r\nargv[1]: '/><AD><BF><B3><96>xb'\r\n\r\n------ REGISTERS ------\r\n2673:S 17 May 2022 00:02:31.716 # \r\nRAX:00000000000066e8 RBX:00000000000066e8\r\nRCX:00000000000000ad RDX:00007f75d9e8ace8\r\nRDI:00007f7ab4228690 RSI:0000000000000005\r\nRBP:00007fff023ac870 RSP:00007fff023ac6d0\r\nR8 :00007f7ab4201200 R9 :00007f7ab4400900\r\nR10:0ef54d213ed1c76f R11:0000000000000012\r\nR12:00007fff023ac718 R13:000000000000000a\r\nR14:012230011a32012a R15:0000000000000005\r\nRIP:00000000004a249e EFL:0000000000010246\r\nCSGSFS:0000000000000033\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6df) -> 00007f7ab56218f0\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6de) -> 00007f7300000000\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6dd) -> 00007f75d4a889e0\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6dc) -> 00007f6f82cf4800\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6db) -> 00007f77e5da3600\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6da) -> 00007f7ab43bc200\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d9) -> 00007f7ab43d4070\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d8) -> 0000000000000020\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d7) -> 0000000000000005\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d6) -> 00007fff023ac718\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d5) -> 00007f75d4a889e0\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d4) -> 00007f7a91875d48\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d3) -> 0000000000000000\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d2) -> 00007f7ab4228690\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d1) -> 00007f7ab4228690\r\n2673:S 17 May 2022 00:02:31.716 # (00007fff023ac6d0) -> 00007f7ab420b420\r\n\r\n------ FAST MEMORY TEST ------\r\n2673:S 17 May 2022 00:02:31.716 # Bio thread for job type #0 terminated\r\n2673:S 17 May 2022 00:02:31.717 # Bio thread for job type #1 terminated\r\n2673:S 17 May 2022 00:02:31.717 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 78c000 (2252800 bytes)\r\n*** Preparing to test memory region 1093000 (135168 bytes)\r\n*** Preparing to test memory region 7f6b2f400000 (63816335360 bytes)\r\n*** Preparing to test memory region 7f7a0b053000 (2692218880 bytes)\r\n*** Preparing to test memory region 7f7aab7d4000 (10485760 bytes)\r\n*** Preparing to test memory region 7f7aac1d5000 (10485760 bytes)\r\n*** Preparing to test memory region 7f7aacbd6000 (10485760 bytes)\r\n*** Preparing to test memory region 7f7aad5d6000 (3145728 bytes)\r\n*** Preparing to test memory region 7f7ab3e00000 (8388608 bytes)\r\n*** Preparing to test memory region 7f7ab4ade000 (20480 bytes)\r\n*** Preparing to test memory region 7f7ab4cfb000 (16384 bytes)\r\n*** Preparing to test memory region 7f7ab5621000 (20480 bytes)\r\n*** Preparing to test memory region 7f7ab562c000 (4096 bytes)\r\n*** Preparing to test memory region 7f7ab562d000 (4096 bytes)\r\n*** Preparing to test memory region 7f7ab5630000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: raxRemove (base: 0x4a2390)\r\nModule: /home/dba/redis6379/masaike/bin/redis-server 10.99.49.43:6379 [cluster] (base 0x400000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x4a2390 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n2673:S 17 May 2022 00:06:01.738 # dump of function (hexdump of 398 bytes):\r\n4157415641554989d5415455534881ec580100004c8b374c8d64244848897c240848894c241848c74424380000000048c74424402000000041f706f8ffffff4c89642430c7842448010000000000004c8974242848897c24100f84970600004531ff4885d24889f50f84880600006690450fb61e498d560441f6c3040f85ce000000418b06c1e8034885c00f84f4010000420fb64c3d0031db41384e04750eeb1e0f1f8000000000380c1a74094883c3014839c372f24839c30f84c60100004983c701488b742438483b7424400f84ed000000488b4424304c8934f04883c6014889742438418b0648c1e303c1e8038d500448f7da83e2074801c231c041f60604498d541604480f44c34c8b340241f706f8ffffff4c8974242874094d39fd0f874bffffff450fb61e4489d883e00484c04c897424200f844e0100004c89ff31dbe9b7000000662e0f1f840000000000418b0ec1e9034885c90f84390100004d39fd0f86880000004a8d743d000fb60641384604757a4d89e8bb010000004d29f8eb1c0f1f4400004c39c3746b44\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```",
  "state": "open",
  "created_at": "2022-05-17T13:09:24Z",
  "updated_at": "2022-05-20T07:29:31Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1128879898,
      "user": "oranagra",
      "created_at": "2022-05-17T13:36:08Z",
      "body": "seems similar to #8254 #5693 etc.\r\nwe are out of luck unless maybe you can consistently reproduce it?\r\n\r\nin any case, this is an old version that we no longer maintain, and it is likely to be solved in newer versions (we never saw this issue in newer versions, were some of these mechanisms were completely replaced).\r\n\r\np.s. please mention which OS / docker / image you're using, so we can confirm it's not some known platform issue."
    },
    {
      "id": 1132574086,
      "user": "yuanhengWang",
      "created_at": "2022-05-20T07:29:31Z",
      "body": "Hi,We use CentOS Linux release 7.6.1810 (Core)\r\n\r\nregards~"
    }
  ]
}