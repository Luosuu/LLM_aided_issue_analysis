{
  "issue_number": 7658.0,
  "title": "[CRASH] Centos 7, Redis 5.0.8",
  "body": "**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n16341:M 15 Aug 2020 05:19:07.731 # Server initialized\r\n16341:M 15 Aug 2020 05:19:07.732 * Module 'trie123az' loaded from /usr/local/src/redis-tries/module/trie.so\r\n16341:M 15 Aug 2020 05:19:07.732 * Ready to accept connections\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n16341:M 15 Aug 2020 05:33:26.783 # Redis 5.0.8 crashed by signal: 11\r\n16341:M 15 Aug 2020 05:33:26.783 # Crashed running the instruction at: 0x7fc39d6b93a4\r\n16341:M 15 Aug 2020 05:33:26.783 # Accessing address: 0x7fcb9b701618\r\n16341:M 15 Aug 2020 05:33:26.783 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/local/src/redis-tries/module/trie.so(trie_add_node+0x14)[0x7fc39d6b93a4]\r\n\r\nBacktrace:\r\n/usr/local/bin/redis-server 127.0.0.1:6379(logStackTrace+0x29)[0x4701b9]\r\n/usr/local/bin/redis-server 127.0.0.1:6379(sigsegvHandler+0xac)[0x47085c]\r\n/lib64/libpthread.so.0(+0xf630)[0x7fc3a4ad6630]\r\n/usr/local/src/redis-tries/module/trie.so(trie_add_node+0x14)[0x7fc39d6b93a4]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:5.0.8\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:7d89825d1a1f2db1\r\nredis_mode:standalone\r\nos:Linux 3.10.0-1127.18.2.el7.x86_64 x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:4.8.5\r\nprocess_id:16341\r\nrun_id:3fde029818d6994aa2691c773071fe02a32b6c72\r\ntcp_port:6379\r\nuptime_in_seconds:859\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:3623286\r\nexecutable:/usr/local/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\n\r\n# Clients\r\nconnected_clients:3\r\nclient_recent_max_input_buffer:2\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:16001472\r\nused_memory_human:15.26M\r\nused_memory_rss:19988480\r\nused_memory_rss_human:19.06M\r\nused_memory_peak:20335312\r\nused_memory_peak_human:19.39M\r\nused_memory_peak_perc:78.69%\r\nused_memory_overhead:1205938\r\nused_memory_startup:791720\r\nused_memory_dataset:14795534\r\nused_memory_dataset_perc:97.28%\r\nallocator_allocated:16192016\r\nallocator_active:16687104\r\nallocator_resident:21729280\r\ntotal_system_memory:67340763136\r\ntotal_system_memory_human:62.72G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.03\r\nallocator_frag_bytes:495088\r\nallocator_rss_ratio:1.30\r\nallocator_rss_bytes:5042176\r\nrss_overhead_ratio:0.92\r\nrss_overhead_bytes:-1740800\r\nmem_fragmentation_ratio:1.25\r\nmem_fragmentation_bytes:3966392\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:83538\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:7385\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1597457947\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:353\r\ntotal_commands_processed:37640\r\ninstantaneous_ops_per_sec:83\r\ntotal_net_input_bytes:76932929\r\ntotal_net_output_bytes:257381422\r\ninstantaneous_input_kbps:23.63\r\ninstantaneous_output_kbps:93.33\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:73\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nevicted_keys:0\r\nkeyspace_hits:22925\r\nkeyspace_misses:7965\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:1c102131a7b00afc4eb1920e87868f2e16361539\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:3.463769\r\nused_cpu_user:1.631606\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Commandstats\r\ncmdstat_zadd:calls=343,usec=8750,usec_per_call=25.51\r\ncmdstat_del:calls=252,usec=931,usec_per_call=3.69\r\ncmdstat_ping:calls=352,usec=493,usec_per_call=1.40\r\ncmdstat_set:calls=8031,usec=35749,usec_per_call=4.45\r\ncmdstat_command:calls=1,usec=1789,usec_per_call=1789.00\r\ncmdstat_zremrangebyscore:calls=5,usec=60,usec_per_call=12.00\r\ncmdstat_setex:calls=625,usec=3525,usec_per_call=5.64\r\ncmdstat_info:calls=346,usec=32745,usec_per_call=94.64\r\ncmdstat_auth:calls=3,usec=3,usec_per_call=1.00\r\ncmdstat_mget:calls=2190,usec=14412,usec_per_call=6.58\r\ncmdstat_get:calls=25490,usec=226374,usec_per_call=8.88\r\ncmdstat_trie.contains:calls=2,usec=69,usec_per_call=34.50\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=5981,expires=738,avg_ttl=164797893\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=253 addr=127.0.0.1:59440 fd=7 name= age=275 idle=77 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=trie.contains\r\nid=354 addr=127.0.0.1:60352 fd=8 name= age=1 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=mget\r\nid=355 addr=127.0.0.1:60356 fd=9 name= age=0 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=49 qbuf-free=32719 obl=0 oll=0 omem=0 events=r cmd=trie.insert\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=355 addr=127.0.0.1:60356 fd=9 name= age=0 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=49 qbuf-free=32719 obl=0 oll=0 omem=0 events=r cmd=trie.insert\r\nargv[0]: 'TRIE.INSERT'\r\nargv[1]: 'ro5'\r\nargv[2]: 'a fortiÃ³ri'\r\n16341:M 15 Aug 2020 05:33:26.784 # key 'ro5' found in DB containing the following object:\r\n16341:M 15 Aug 2020 05:33:26.784 # Object type: 5\r\n16341:M 15 Aug 2020 05:33:26.784 # Object encoding: 0\r\n16341:M 15 Aug 2020 05:33:26.784 # Object refcount: 1\r\n\r\n------ REGISTERS ------\r\n16341:M 15 Aug 2020 05:33:26.784 # \r\nRAX:00007fc39b701800 RBX:00007fcb9b701618\r\nRCX:0000000000000069 RDX:00000000ffffffc3\r\nRDI:00007fc39bc9d728 RSI:00000000ffffffc3\r\nRBP:00007fc39bc9d728 RSP:00007ffeb3c31bd0\r\nR8 :00007fc39b716400 R9 :000000000000037b\r\nR10:000000000000000f R11:0000000000000000\r\nR12:ffffffffffffffc3 R13:00007fc39bc9d610\r\nR14:0000000000000000 R15:0000000000000008\r\nRIP:00007fc39d6b93a4 EFL:0000000000010206\r\nCSGSFS:0000000000000033\r\n16341:M 15 Aug 2020 05:33:26.784 # (00007ffeb3c31bdf) -> 00007fc39b6f2a80\r\n16341:M 15 Aug 2020 05:33:26.784 # (00007ffeb3c31bde) -> 0000000000000000\r\n16341:M 15 Aug 2020 05:33:26.784 # (00007ffeb3c31bdd) -> 0000000000000000\r\n16341:M 15 Aug 2020 05:33:26.784 # (00007ffeb3c31bdc) -> 00007ffe0000002c\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bdb) -> 000000000000000b\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bda) -> 00007fc3a5601730\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd9) -> 00000000b3c31c47\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd8) -> 00007fc3a4216600\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd7) -> 00007ffeb3c31c70\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd6) -> 0000000000000000\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd5) -> 00007fc39d6b95c0\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd4) -> 0000000000000008\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd3) -> 0000000000000008\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd2) -> 00007fc3a4209008\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd1) -> 00007fc39d6b9438\r\n16341:M 15 Aug 2020 05:33:26.785 # (00007ffeb3c31bd0) -> 00000000012968d7\r\n\r\n------ FAST MEMORY TEST ------\r\n16341:M 15 Aug 2020 05:33:26.785 # Bio thread for job type #0 terminated\r\n16341:M 15 Aug 2020 05:33:26.785 # Bio thread for job type #1 terminated\r\n16341:M 15 Aug 2020 05:33:26.786 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 79c000 (2248704 bytes)\r\n*** Preparing to test memory region 128d000 (135168 bytes)\r\n*** Preparing to test memory region 7fc399034000 (48758784 bytes)\r\n*** Preparing to test memory region 7fc39beb5000 (8388608 bytes)\r\n*** Preparing to test memory region 7fc39c6b6000 (8388608 bytes)\r\n*** Preparing to test memory region 7fc39ceb7000 (8388608 bytes)\r\n*** Preparing to test memory region 7fc3a3e00000 (8388608 bytes)\r\n*** Preparing to test memory region 7fc3a4ac2000 (20480 bytes)\r\n*** Preparing to test memory region 7fc3a4cdf000 (16384 bytes)\r\n*** Preparing to test memory region 7fc3a5601000 (20480 bytes)\r\n*** Preparing to test memory region 7fc3a5610000 (8192 bytes)\r\n*** Preparing to test memory region 7fc3a5614000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: trie_add_node (base: 0x7fc39d6b9390)\r\nModule: /usr/local/src/redis-tries/module/trie.so (base 0x7fc39d6b7000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x7fc39d6b9390 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n16341:M 15 Aug 2020 05:33:27.287 # dump of function (hexdump of 148 bytes):\r\n4885ff537428488b4708400fbef689f2488d1cd048833b00740631c05bc3669089f7e8c9feffff48890331c05bc3488d0dde280000488d3554200000488d3d95200000ba80000000e823feffff0f1f0041544885ff554889fd530f849a000000803e004889f3745a0f1f8400000000004889dfe828feffff31d285c089c67e180fb604134c8b45204883c20139d6480fbec84188\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n\r\n**Aditional information**\r\n\r\n1. OS distribution and version Centos7, Redis 5.0.8, phpredis 5.3.1\r\n2. Steps to reproduce (if any)\r\n\r\ntried this command in PHP `$redis->rawCommand(\"TRIE.INSERT\", $key, $word)`\r\nother commands via rawCommand such as `set` are working fine\r\n",
  "state": "closed",
  "created_at": "2020-08-15T02:40:03Z",
  "updated_at": "2020-08-15T16:43:20Z",
  "closed_at": "2020-08-15T15:33:40Z",
  "labels": [],
  "comments_data": [
    {
      "id": 674412803,
      "user": "itamarhaber",
      "created_at": "2020-08-15T15:33:40Z",
      "body": "Hello @rvencu \r\n\r\nThanks for submitting the crash report. It appears this crash isn't caused by Redis itself, but rather due to a module (trie) that you're using. Please seek assistance from that module's authors/maintainers/community.\r\n\r\nClosing this as it isn't related to Redis server."
    },
    {
      "id": 674421444,
      "user": "oranagra",
      "created_at": "2020-08-15T16:43:20Z",
      "body": "@rvencu maybe if you upload your binary I can look up in which line it crashed and make sure this bug was fixed already. or you can translate the crash address yourself... "
    }
  ]
}