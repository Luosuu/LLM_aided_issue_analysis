{
  "issue_number": 11018.0,
  "title": "[BUG] redis-cli --cluster del-node  can't del the node has down or can't be connected",
  "body": "**Describe the bug**\r\nwhen some node host is  crash down ,the failed node cant del  from cluster with redis-cli --cluster del-node ,version from 7.0.4 \r\n commit 888effe4beb2c0ac8de1c863e635e45af3d3b329\r\n**To reproduce**\r\n\r\n```\r\n[root@localhost redis-cluster]# redis-cli -p 7000 cluster nodes\r\ne99879144178ee4590fe92594ec24d4c7b1e1b05 172.168.224.131:7007@17007 slave 5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 0 1658304666449 8 connected\r\na0259db380d31f48df961682afc78ef6bb343984 172.168.224.131:7003@17003 master - 0 1658304666000 4 connected 12288-16383\r\nabbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 172.168.224.131:7002@17002 master - 0 1658304666000 3 connected 8192-12287\r\nd6e8d97264c98146ebc46ca60d9af8923610eb78 172.168.224.131:7006@17006 slave ec467a35dab69bf18a734f1ee558bb20df992f01 0 1658304664410 7 connected\r\n5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 172.168.224.131:7001@17001 master - 0 1658304666000 2 connected 4096-8191\r\n36d7e2740c56ea80f0990777c77f355c5c0c7063 172.168.224.131:7004@17004 slave a0259db380d31f48df961682afc78ef6bb343984 0 1658304667474 5 connected\r\nbb537444ac336abb269535adc9c6af61a403d7fe 172.168.224.131:7005@17005 slave abbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 0 1658304668498 6 connected\r\nec467a35dab69bf18a734f1ee558bb20df992f01 172.168.224.131:7000@17000 myself,master - 0 1658304665000 1 connected 0-4095\r\n[root@localhost redis-cluster]# ps -ef|grep redis\r\nroot      25974      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7000 [cluster]\r\nroot      25980      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7001 [cluster]\r\nroot      25986      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7002 [cluster]\r\nroot      25992      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7003 [cluster]\r\nroot      25998      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7004 [cluster]\r\nroot      26004      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7005 [cluster]\r\nroot      26009      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7006 [cluster]\r\nroot      26014      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7007 [cluster]\r\nroot      26019      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7008 [cluster]\r\nroot      26024      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7009 [cluster]\r\nroot      26040  14605  0 04:11 pts/0    00:00:00 grep --color=auto redis\r\n[root@localhost redis-cluster]# kill 26014\r\n[root@localhost redis-cluster]# !ps\r\nps -ef|grep redis\r\nroot      25974      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7000 [cluster]\r\nroot      25980      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7001 [cluster]\r\nroot      25986      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7002 [cluster]\r\nroot      25992      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7003 [cluster]\r\nroot      25998      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7004 [cluster]\r\nroot      26004      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7005 [cluster]\r\nroot      26009      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7006 [cluster]\r\nroot      26019      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7008 [cluster]\r\nroot      26024      1  0 04:10 ?        00:00:00 ../redis-server4 0.0.0.0:7009 [cluster]\r\nroot      26042  14605  0 04:11 pts/0    00:00:00 grep --color=auto redis\r\n[root@localhost redis-cluster]# redis-cli -p 7000 cluster nodes\r\ne99879144178ee4590fe92594ec24d4c7b1e1b05 172.168.224.131:7007@17007 slave 5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 1658304684532 1658304681767 8 disconnected\r\na0259db380d31f48df961682afc78ef6bb343984 172.168.224.131:7003@17003 master - 0 1658304697144 4 connected 12288-16383\r\nabbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 172.168.224.131:7002@17002 master - 0 1658304695000 3 connected 8192-12287\r\nd6e8d97264c98146ebc46ca60d9af8923610eb78 172.168.224.131:7006@17006 slave ec467a35dab69bf18a734f1ee558bb20df992f01 0 1658304696000 7 connected\r\n5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 172.168.224.131:7001@17001 master - 0 1658304697000 2 connected 4096-8191\r\n36d7e2740c56ea80f0990777c77f355c5c0c7063 172.168.224.131:7004@17004 slave a0259db380d31f48df961682afc78ef6bb343984 0 1658304696119 5 connected\r\nbb537444ac336abb269535adc9c6af61a403d7fe 172.168.224.131:7005@17005 slave abbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 0 1658304698166 6 connected\r\nec467a35dab69bf18a734f1ee558bb20df992f01 172.168.224.131:7000@17000 myself,master - 0 1658304695000 1 connected 0-4095\r\n[root@localhost redis-cluster]# redis-cli -p 7000 cluster nodes\r\ne99879144178ee4590fe92594ec24d4c7b1e1b05 172.168.224.131:7007@17007 slave,fail 5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 1658304684532 1658304681767 8 disconnected\r\na0259db380d31f48df961682afc78ef6bb343984 172.168.224.131:7003@17003 master - 0 1658304701253 4 connected 12288-16383\r\nabbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 172.168.224.131:7002@17002 master - 0 1658304702281 3 connected 8192-12287\r\nd6e8d97264c98146ebc46ca60d9af8923610eb78 172.168.224.131:7006@17006 slave ec467a35dab69bf18a734f1ee558bb20df992f01 0 1658304700000 7 connected\r\n5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 172.168.224.131:7001@17001 master - 0 1658304700000 2 connected 4096-8191\r\n36d7e2740c56ea80f0990777c77f355c5c0c7063 172.168.224.131:7004@17004 slave a0259db380d31f48df961682afc78ef6bb343984 0 1658304699000 5 connected\r\nbb537444ac336abb269535adc9c6af61a403d7fe 172.168.224.131:7005@17005 slave abbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 0 1658304700227 6 connected\r\nec467a35dab69bf18a734f1ee558bb20df992f01 172.168.224.131:7000@17000 myself,master - 0 1658304699000 1 connected 0-4095\r\n[root@localhost redis-7.0.4]# src/redis-cli --cluster del-node 172.168.224.131:7000 e99879144178ee4590fe92594ec24d4c7b1e1b05\r\n>>> Removing node e99879144178ee4590fe92594ec24d4c7b1e1b05 from cluster 172.168.224.131:7000\r\nCould not connect to Redis at 172.168.224.131:7007: Connection refused\r\n[ERR] No such node ID e99879144178ee4590fe92594ec24d4c7b1e1b05\r\n[root@localhost redis-cluster]# redis-cli -p 7000 cluster nodes\r\ne99879144178ee4590fe92594ec24d4c7b1e1b05 172.168.224.131:7007@17007 slave,fail 5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 1658304684532 1658304681767 8 disconnected\r\na0259db380d31f48df961682afc78ef6bb343984 172.168.224.131:7003@17003 master - 0 1658304701253 4 connected 12288-16383\r\nabbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 172.168.224.131:7002@17002 master - 0 1658304702281 3 connected 8192-12287\r\nd6e8d97264c98146ebc46ca60d9af8923610eb78 172.168.224.131:7006@17006 slave ec467a35dab69bf18a734f1ee558bb20df992f01 0 1658304700000 7 connected\r\n5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 172.168.224.131:7001@17001 master - 0 1658304700000 2 connected 4096-8191\r\n36d7e2740c56ea80f0990777c77f355c5c0c7063 172.168.224.131:7004@17004 slave a0259db380d31f48df961682afc78ef6bb343984 0 1658304699000 5 connected\r\nbb537444ac336abb269535adc9c6af61a403d7fe 172.168.224.131:7005@17005 slave abbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 0 1658304700227 6 connected\r\nec467a35dab69bf18a734f1ee558bb20df992f01 172.168.224.131:7000@17000 myself,master - 0 1658304699000 1 connected 0-4095\r\n```\r\nit cant work well and when fix or check the cluster  may crash the  redis-cli command\r\n**Expected behavior**\r\n\r\nredis-cli should work well and not crash  ,like this \r\n```\r\nsrc/redis-cli --cluster del-node 172.168.224.131:7000 e99879144178ee4590fe92594ec24d4c7b1e1b05\r\n>>> Removing node e99879144178ee4590fe92594ec24d4c7b1e1b05 from cluster 172.168.224.131:7000\r\nCould not connect to Redis at 172.168.224.131:7007: Connection refused\r\n>>> Sending CLUSTER FORGET messages to the cluster...\r\n[root@localhost redis-cluster]# redis-cli -p 7000 cluster nodes\r\na0259db380d31f48df961682afc78ef6bb343984 172.168.224.131:7003@17003 master - 0 1658305482000 4 connected 12288-16383\r\nabbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 172.168.224.131:7002@17002 master - 0 1658305482017 3 connected 8192-12287\r\nd6e8d97264c98146ebc46ca60d9af8923610eb78 172.168.224.131:7006@17006 slave ec467a35dab69bf18a734f1ee558bb20df992f01 0 1658305484053 7 connected\r\n5cfab7e5d821d5390bab58f0b88db6a5ce4dad22 172.168.224.131:7001@17001 master - 0 1658305483036 2 connected 4096-8191\r\n36d7e2740c56ea80f0990777c77f355c5c0c7063 172.168.224.131:7004@17004 slave a0259db380d31f48df961682afc78ef6bb343984 0 1658305482000 5 connected\r\nbb537444ac336abb269535adc9c6af61a403d7fe 172.168.224.131:7005@17005 slave abbf31dbf414a2a73b36349ab6dc8bdcfdd84a45 0 1658305485075 6 connected\r\nec467a35dab69bf18a734f1ee558bb20df992f01 172.168.224.131:7000@17000 myself,master - 0 1658305482000 1 connected 0-4095\r\n```\r\n\r\n**Additional information**\r\n\r\n\r\n",
  "state": "open",
  "created_at": "2022-07-20T08:17:44Z",
  "updated_at": "2022-07-20T11:28:15Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1190157227,
      "user": "heyone-top",
      "created_at": "2022-07-20T11:28:15Z",
      "body": "my fix\r\nhttps://github.com/heyone-top/redis/commit/d97881822ec61d93f96d2e483a990a36040840df"
    }
  ]
}