{
  "issue_number": 11277.0,
  "title": "[CRASH] periodical crash after Lightroom starts exporting (maybe RAM issue)",
  "body": "Here are 9 crashes log. I think I have anought RAM or HDD. Redis first crashes when I start exporting photos in Lightroom (RAM). After exporting stop Redis continues to crash... Can't understand a reason.\r\nI use Redis to cash Python http responses.\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n22916:C 17 Sep 2022 14:36:53.792 # Redis 6.2.7 crashed by signal: 6, si_code: 0\r\n22916:C 17 Sep 2022 14:36:53.817 # Crashed running the instruction at: 0x7fff6e8aa32a\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n0   libsystem_kernel.dylib              0x00007fff6e8aa32a __pthread_kill + 10\r\n\r\nBacktrace:\r\n0   libsystem_platform.dylib            0x00007fff6e95f5fd _sigtramp + 29\r\n1   ???                                 0x00000001055b5c28 0x0 + 4384840744\r\n2   libsystem_c.dylib                   0x00007fff6e831808 abort + 120\r\n3   rejson.so                           0x0000000103967889 _ZN3std3sys4unix14abort_internal17h4329bd900762fe80E + 9\r\n4   rejson.so                           0x0000000103965ff9 rust_panic + 201\r\n5   rejson.so                           0x0000000103965da6 _ZN3std9panicking20rust_panic_with_hook17h3147bfce63989ccbE + 470\r\n6   rejson.so                           0x0000000103965bb3 _ZN3std9panicking19begin_panic_handler28_$u7b$$u7b$closure$u7d$$u7d$17h354f8ce5af2f2ce8E + 179\r\n7   rejson.so                           0x0000000103964ae7 _ZN3std10sys_common9backtrace26__rust_end_short_backtrace17h63e1494bcfb6c060E + 23\r\n8   rejson.so                           0x000000010396588a rust_begin_unwind + 74\r\n9   rejson.so                           0x000000010398d003 _ZN4core9panicking9panic_fmt17h6e7523bddca0f9b8E + 51\r\n10  rejson.so                           0x0000000103980fb0 _ZN4core7unicode9printable5check17hc7e3c932df8eb6d4E + 0\r\n11  rejson.so                           0x0000000103977019 _ZN4core3ops8function6FnOnce9call_once17h4e847a559d6f2a5bE + 9\r\n12  rejson.so                           0x000000010397b6db _ZN4core10intrinsics17const_eval_select17h048caff331f6c9efE + 27\r\n13  rejson.so                           0x000000010398d241 _ZN4core3str16slice_error_fail17h48af51deb8b0c4bcE + 33\r\n14  rejson.so                           0x00000001038aceb3 _ZN10serde_json3ser18format_escaped_str17h102c9338e20d8e79E + 963\r\n15  rejson.so                           0x00000001038b07d0 _ZN5serde3ser12SerializeMap15serialize_entry17hf277180fa268d0a1E + 288\r\n16  rejson.so                           0x00000001038f9c78 _ZN5ijson3ser74_$LT$impl$u20$serde..ser..Serialize$u20$for$u20$ijson..object..IObject$GT$9serialize17hcb373b62483bb55dE + 152\r\n17  rejson.so                           0x00000001038b07f1 _ZN5serde3ser12SerializeMap15serialize_entry17hf277180fa268d0a1E + 321\r\n18  rejson.so                           0x00000001038f9c78 _ZN5ijson3ser74_$LT$impl$u20$serde..ser..Serialize$u20$for$u20$ijson..object..IObject$GT$9serialize17hcb373b62483bb55dE + 152\r\n19  rejson.so                           0x00000001038b07f1 _ZN5serde3ser12SerializeMap15serialize_entry17hf277180fa268d0a1E + 321\r\n20  rejson.so                           0x00000001038f9c78 _ZN5ijson3ser74_$LT$impl$u20$serde..ser..Serialize$u20$for$u20$ijson..object..IObject$GT$9serialize17hcb373b62483bb55dE + 152\r\n21  rejson.so                           0x00000001038faf32 _ZN6rejson9redisjson12type_methods8rdb_save17h8038bade9665b5a8E + 466\r\n22  redis-server                        0x0000000100cf78ba rdbSaveObject + 634\r\n23  redis-server                        0x0000000100cf82e1 rdbSaveKeyValuePair + 881\r\n24  redis-server                        0x0000000100cf8d42 rdbSaveRio + 1010\r\n25  redis-server                        0x0000000100cf93e6 rdbSave + 214\r\n26  redis-server                        0x0000000100cf968d rdbSaveBackground + 141\r\n27  redis-server                        0x0000000100cc49bb serverCron + 2123\r\n28  redis-server                        0x0000000100cbeffb aeProcessEvents + 1051\r\n29  redis-server                        0x0000000100cbf12d aeMain + 29\r\n30  redis-server                        0x0000000100ccd417 main + 1831\r\n31  libdyld.dylib                       0x00007fff6e762cc9 start + 1\r\n32  ???                                 0x000000000000001c 0x0 + 28\r\n\r\n------ REGISTERS ------\r\n22916:C 17 Sep 2022 14:36:53.823 # \r\nRAX:0000000000000000 RBX:00000001055efdc0\r\nRCX:00007ffeeef45168 RDX:0000000000000000\r\nRDI:0000000000000303 RSI:0000000000000006\r\nRBP:00007ffeeef45190 RSP:00007ffeeef45168\r\nR8 :00007ffeeef4503f R9 :0000000000000001\r\nR10:00000001055efdc0 R11:0000000000000246\r\nR12:0000000000000303 R13:00000001039bdf48\r\nR14:0000000000000006 R15:0000000000000016\r\nRIP:00007fff6e8aa32a EFL:0000000000000246\r\nCS :0000000000000007 FS:0000000000000000  GS:0000000000000000\r\n22916:C 17 Sep 2022 14:36:53.823 # (00007ffeeef45177) -> 00007ffeeef452a0\r\n22916:C 17 Sep 2022 14:36:53.823 # (00007ffeeef45176) -> 0000000103967889\r\n22916:C 17 Sep 2022 14:36:53.823 # (00007ffeeef45175) -> 00007ffeeef451e0\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef45174) -> 0000000000000001\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef45173) -> 0000000000000000\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef45172) -> ffffffffeef45268\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef45171) -> 00007ffefffff9df\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef45170) -> 0000000000000000\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef4516f) -> 0000000000000002\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef4516e) -> 00007fff6e831808\r\n22916:C 17 Sep 2022 14:36:53.824 # (00007ffeeef4516d) -> 00007ffeeef451d0\r\n22916:C 17 Sep 2022 14:36:53.825 # (00007ffeeef4516c) -> 00000001039c2308\r\n22916:C 17 Sep 2022 14:36:53.825 # (00007ffeeef4516b) -> 00007ffeeef451b0\r\n22916:C 17 Sep 2022 14:36:53.825 # (00007ffeeef4516a) -> 0000000000000001\r\n22916:C 17 Sep 2022 14:36:53.825 # (00007ffeeef45169) -> 0000000000000003\r\n22916:C 17 Sep 2022 14:36:53.825 # (00007ffeeef45168) -> 00007fff6e96ae60\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.7\r\nredis_git_sha1:e6f67092\r\nredis_git_dirty:0\r\nredis_build_id:b62801a3bc178a02\r\nredis_mode:standalone\r\nos:Darwin 19.6.0 x86_64\r\narch_bits:64\r\nmonotonic_clock:POSIX clock_gettime\r\nmultiplexing_api:kqueue\r\natomicvar_api:c11-builtin\r\ngcc_version:4.2.1\r\nprocess_id:22916\r\nprocess_supervised:no\r\nrun_id:570d8c5d1ea5d5bf51dbb1d37aa360675d5396e4\r\ntcp_port:6379\r\nserver_time_usec:1663414599059240\r\nuptime_in_seconds:249345\r\nuptime_in_days:2\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:2470215\r\nexecutable:/usr/local/Caskroom/redis-stack-server/6.2.4-v2/bin/redis-server\r\nconfig_file:/usr/local/Caskroom/redis-stack-server/6.2.4-v2/etc/redis-stack.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:1\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:48\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:1717815344\r\nused_memory_human:1.60G\r\nused_memory_rss:2150400\r\nused_memory_rss_human:2.05M\r\nused_memory_peak:1718000240\r\nused_memory_peak_human:1.60G\r\nused_memory_peak_perc:99.99%\r\nused_memory_overhead:3095376\r\nused_memory_startup:1197680\r\nused_memory_dataset:1714719968\r\nused_memory_dataset_perc:99.89%\r\nallocator_allocated:1717811360\r\nallocator_active:2117632\r\nallocator_resident:2117632\r\n[redis_crash.txt](https://github.com/redis/redis/files/9591567/redis_crash.txt)\r\n\r\ntotal_system_memory:17179869184\r\ntotal_system_memory_human:16.00G\r\nused_memory_lua:32768\r\nused_memory_lua_human:32.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:0.00\r\nallocator_frag_bytes:18446744071993857888\r\nallocator_rss_ratio:1.00\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:1.02\r\nrss_overhead_bytes:32768\r\nmem_fragmentation_ratio:0.00\r\nmem_fragmentation_bytes:-1715660960\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:17456\r\nmem_aof_buffer:0\r\nmem_allocator:libc\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:116\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1663413808\r\nrdb_last_bgsave_status:err\r\nrdb_last_bgsave_time_sec:22\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:11\r\ntotal_commands_processed:119512\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:2999877755\r\ntotal_net_output_bytes:2506515434\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:2\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:3637\r\nevicted_keys:0\r\nkeyspace_hits:51683\r\nkeyspace_misses:33906\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:4224\r\ntotal_forks:307\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:1\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:292741\r\ntotal_writes_processed:119503\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:492d22f0a4431378774f780de63752bb7b9d0b0a\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:1.300701\r\nused_cpu_user:5.447012\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\nmodule:name=timeseries,ver=10617,api=1,filters=0,usedby=[],using=[],options=[handle-io-errors]\r\nmodule:name=ReJSON,ver=20200,api=1,filters=0,usedby=[search|graph],using=[],options=[handle-io-errors]\r\nmodule:name=graph,ver=20819,api=1,filters=0,usedby=[],using=[ReJSON],options=[]\r\nmodule:name=search,ver=20414,api=1,filters=0,usedby=[],using=[ReJSON],options=[handle-io-errors]\r\nmodule:name=bf,ver=20218,api=1,filters=0,usedby=[],using=[],options=[]\r\n\r\n# Commandstats\r\ncmdstat_expire:calls=6,usec=10802,usec_per_call=1800.33,rejected_calls=0,failed_calls=0\r\ncmdstat_exec:calls=2,usec=8397,usec_per_call=4198.50,rejected_calls=0,failed_calls=0\r\ncmdstat_json.set:calls=33897,usec=75744482,usec_per_call=2234.55,rejected_calls=1,failed_calls=0\r\ncmdstat_persist:calls=2,usec=45,usec_per_call=22.50,rejected_calls=0,failed_calls=0\r\ncmdstat_sadd:calls=2,usec=4862,usec_per_call=2431.00,rejected_calls=0,failed_calls=0\r\ncmdstat_json.get:calls=85589,usec=26247853,usec_per_call=306.67,rejected_calls=0,failed_calls=0\r\ncmdstat_hset:calls=8,usec=7197,usec_per_call=899.62,rejected_calls=0,failed_calls=0\r\ncmdstat_multi:calls=2,usec=1613,usec_per_call=806.50,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=4,usec=108,usec_per_call=27.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_MISCONF:count=1\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=33898,expires=0,avg_ttl=0\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=21 addr=127.0.0.1:65449 laddr=127.0.0.1:6379 fd=9 name= age=70465 idle=21 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=17456 events=r cmd=json.set user=default redir=-1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n# ReJSON_trace\r\nReJSON_trace:   0: backtrace::backtrace::trace\r\n   1: backtrace::capture::Backtrace::new\r\n   2: redis_module::base_info_func\r\n   3: rejson::__info_func\r\n   4: _modulesCollectInfo\r\n   5: _printCrashReport\r\n   6: _sigsegvHandler\r\n   7: __sigtramp\r\n\r\n\r\n# graph_executing commands\r\n\r\n# search_version\r\nsearch_RedisSearch_version:6.2.7\r\n\r\n# search_index\r\nsearch_number_of_indexes:0\r\n\r\n# search_fields_statistics\r\n\r\n# search_runtime_configurations\r\nsearch_concurrent_mode:OFF\r\nsearch_enableGC:ON\r\nsearch_minimal_term_prefix:2\r\nsearch_maximal_prefix_expansions:200\r\nsearch_query_timeout_ms:500\r\nsearch_timeout_policy:return\r\nsearch_cursor_read_size:1000\r\nsearch_cursor_max_idle_time:300000\r\nsearch_max_doc_table_size:1000000\r\nsearch_max_search_results:10000\r\nsearch_max_aggregate_results:10000\r\nsearch_search_pool_size:20\r\nsearch_index_pool_size:8\r\nsearch_gc_scan_size:100\r\nsearch_min_phonetic_term_length:3\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: __pthread_kill (base: 0x7fff6e8aa320)\r\nModule: /usr/lib/system/libsystem_kernel.dylib (base 0x7fff6e8a3000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x7fff6e8aa320 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n22916:C 17 Sep 2022 14:36:53.856 # dump of function (hexdump of 138 bytes):\r\nb8480100024989ca0f0573084889c7e9e5a2ffffc3909090b8530000024989ca0f0573084889c7e9cda2ffffc3909090b8830100024989ca0f0573084889c7e9b5a2ffffc34585c07416554889e5e8cba2ffffc70016000000b8ffffffff5dc341b840000000e9adc4ffff90b86a0000024989ca0f0573084889c7e979a2ffffc3909090b81e00000249\r\nFunction at 0x7fff6e8a463e is __error\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n\r\n**Additional information**\r\n\r\n1. MacOS Catalina 10.15.7\r\n2. Steps to reproduce: don't know\r\n",
  "state": "closed",
  "created_at": "2022-09-17T11:55:45Z",
  "updated_at": "2022-09-17T13:36:52Z",
  "closed_at": "2022-09-17T13:36:52Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1250073231,
      "user": "itamarhaber",
      "created_at": "2022-09-17T13:36:52Z",
      "body": "Hi @dontsovcmc \r\n\r\nThe issue appears to be caused by RedisJSON, whereas this repository is dedicated to Redis core. Please create a new issue at https://github.io/RedisJSON/RedisJSON to report this."
    }
  ]
}