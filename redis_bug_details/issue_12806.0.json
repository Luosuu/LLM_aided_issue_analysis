{
  "issue_number": 12806.0,
  "title": "[CRASH] My Redis server is crashing. Im on a Mac Book Pro, M2, using docker",
  "body": "Redis used to work just fine. Today stopped working for no reason. \r\n\r\n```\r\nroot@934e962812b1:/var/lib/redis# service redis-server start\r\nJob for redis-server.service failed because a fatal signal was delivered to the control process.\r\nSee \"systemctl status redis-server.service\" and \"journalctl -xeu redis-server.service\" for details.\r\n\r\nroot@934e962812b1:/var/lib/redis# systemctl status redis-server.service\r\nx redis-server.service - Advanced key-value store\r\n     Loaded: loaded (/lib/systemd/system/redis-server.service; enabled; vendor preset: enabled)\r\n     Active: failed (Result: signal) since Fri 2023-11-24 15:43:54 EST; 9s ago\r\n       Docs: http://redis.io/documentation,\r\n             man:redis-server(1)\r\n    Process: 1647 ExecStart=/usr/bin/redis-server /etc/redis/redis.conf --supervised systemd --daemonize no (code=killed, signal>\r\n   Main PID: 1647 (code=killed, signal=SEGV)\r\n     Status: \"Redis is loading...\"\r\n        CPU: 558ms\r\n\r\nNov 24 15:43:54 934e962812b1 systemd[1]: redis-server.service: Scheduled restart job, restart counter is at 5.\r\nNov 24 15:43:54 934e962812b1 systemd[1]: Stopped Advanced key-value store.\r\nNov 24 15:43:54 934e962812b1 systemd[1]: redis-server.service: Start request repeated too quickly.\r\nNov 24 15:43:54 934e962812b1 systemd[1]: redis-server.service: Failed with result 'signal'.\r\nNov 24 15:43:54 934e962812b1 systemd[1]: Failed to start Advanced key-value store.\r\n```\r\n\r\n**Crash report**\r\n\r\n```\r\n790:M 24 Nov 2023 15:12:49.897 # Server initialized\r\n790:M 24 Nov 2023 15:12:49.906 * Loading RDB produced by version 6.0.16\r\n790:M 24 Nov 2023 15:12:49.908 * RDB age 112547 seconds\r\n790:M 24 Nov 2023 15:12:49.908 * RDB memory usage when created 1.98 Mb\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n\r\n790:M 24 Nov 2023 15:12:49.913 # Redis 6.0.16 crashed by signal: 11, si_code: 1\r\n790:M 24 Nov 2023 15:12:49.913 # Crashed running the instruction at: 0x400003da03\r\n790:M 24 Nov 2023 15:12:49.913 # Accessing address: 0x65726568742074\r\n790:M 24 Nov 2023 15:12:49.913 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/bin/redis-server 127.0.0.1:6379(dictAddRaw+0xc3)[0x400003da03]\r\n\r\nBacktrace:\r\n/usr/bin/redis-server 127.0.0.1:6379(logStackTrace+0x5c)[0x400009d83c]\r\n/usr/bin/redis-server 127.0.0.1:6379(sigsegvHandler+0xd0)[0x40000a0320]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x42520)[0x4002bcf520]\r\n/usr/bin/redis-server 127.0.0.1:6379(dictAddRaw+0xc3)[0x400003da03]\r\n/usr/bin/redis-server 127.0.0.1:6379(dictAdd+0x15)[0x400003db45]\r\n/usr/bin/redis-server 127.0.0.1:6379(rdbLoadObject+0x30b)[0x4000070f8b]\r\n/usr/bin/redis-server 127.0.0.1:6379(rdbLoadRio+0x689)[0x4000072f79]\r\n/usr/bin/redis-server 127.0.0.1:6379(rdbLoad+0xb0)[0x4000073760]\r\n/usr/bin/redis-server 127.0.0.1:6379(loadDataFromDisk+0xab)[0x400004cc9b]\r\n/usr/bin/redis-server 127.0.0.1:6379(main+0x3e6)[0x4000032576]\r\n/lib/x86_64-linux-gnu/libc.so.6(+0x29d90)[0x4002bb6d90]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0x80)[0x4002bb6e40]\r\n/usr/bin/redis-server 127.0.0.1:6379(_start+0x25)[0x40000329d5]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.0.16\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:a3fdef44459b3ad6\r\nredis_mode:standalone\r\nos:Linux 5.15.49-linuxkit-pr x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:11.2.0\r\nprocess_id:790\r\nrun_id:f3f853bcb285d8ee24724d2a26a31e858d3eb36d\r\ntcp_port:6379\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:6357953\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_recent_max_input_buffer:0\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:987240\r\nused_memory_human:964.10K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:987240\r\nused_memory_peak_human:964.10K\r\nused_memory_peak_perc:inf%\r\nused_memory_overhead:809904\r\nused_memory_startup:809688\r\nused_memory_dataset:177336\r\nused_memory_dataset_perc:99.88%\r\nallocator_allocated:0\r\nallocator_active:0\r\nallocator_resident:0\r\ntotal_system_memory:8337125376\r\ntotal_system_memory_human:7.76G\r\nused_memory_lua:41984\r\nused_memory_lua_human:41.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:-nan\r\nallocator_frag_bytes:0\r\nallocator_rss_ratio:-nan\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:-nan\r\nrss_overhead_bytes:0\r\nmem_fragmentation_ratio:-nan\r\nmem_fragmentation_bytes:0\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:0\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.2.1\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:1\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1700856769\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\nloading_start_time:1700856769\r\nloading_total_bytes:243794\r\nloading_loaded_bytes:0\r\nloading_loaded_perc:0.00\r\nloading_eta_seconds:1\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_reads_processed:0\r\ntotal_writes_processed:0\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:6783603fe22ec206f1d6a409fb1765c635d1d210\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.038088\r\nused_cpu_user:0.271631\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\n\r\n# Modules\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=3,expires=0,avg_ttl=0\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n790:M 24 Nov 2023 15:12:49.919 # \r\nRAX:00000040039b5e00 RBX:00000040038beb30\r\nRCX:000000000000074f RDX:8498af14ee2feb57\r\nRDI:a6168581d922acd6 RSI:0000000000000000\r\nRBP:0000000000000000 RSP:00000040019862e0\r\nR8 :c711ebe01d012f1a R9 :00000040039b3283\r\nR10:0000000000000004 R11:000000400012ec00\r\nR12:0065726568742074 R13:00000040038beb30\r\nR14:00000040038beb20 R15:00000040039b3263\r\nRIP:000000400003da03 EFL:0000000000000206\r\nCSGSFS:002b000000000033\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862ef) -> 0000004000070f8b\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862ee) -> 0000000000000008\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862ed) -> 00000040039b3263\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862ec) -> 0000000000000024\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862eb) -> 000000400003db45\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862ea) -> 0000004001986960\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e9) -> 0000000000000000\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e8) -> 000000400392fdd0\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e7) -> 00000040039b3298\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e6) -> 00000040039b3263\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e5) -> 00000040038beb20\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e4) -> 00000040032962c0\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e3) -> 000000000000074f\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e2) -> 00000040038beb70\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e1) -> 0000000000003a78\r\n790:M 24 Nov 2023 15:12:49.919 # (00000040019862e0) -> d4163f1ea10f274f\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n790:M 24 Nov 2023 15:12:49.920 # Bio thread for job type #0 terminated\r\n790:M 24 Nov 2023 15:12:49.920 # Bio thread for job type #1 terminated\r\n790:M 24 Nov 2023 15:12:49.920 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 4000169000 (118784 bytes)\r\n*** Preparing to test memory region 40019c3000 (8192 bytes)\r\n*** Preparing to test memory region 40019cf000 (8192 bytes)\r\n*** Preparing to test memory region 40019da000 (4096 bytes)\r\n*** Preparing to test memory region 40022d4000 (2240512 bytes)\r\n*** Preparing to test memory region 40025de000 (8192 bytes)\r\n*** Preparing to test memory region 40026a6000 (4096 bytes)\r\n*** Preparing to test memory region 4002b8a000 (12288 bytes)\r\n*** Preparing to test memory region 4002da8000 (53248 bytes)\r\n*** Preparing to test memory region 4002fe3000 (20480 bytes)\r\n*** Preparing to test memory region 400326a000 (12288 bytes)\r\n*** Preparing to test memory region 4003293000 (24576 bytes)\r\n*** Preparing to test memory region 4003600000 (2097152 bytes)\r\n*** Preparing to test memory region 4003899000 (2097152 bytes)\r\n*** Preparing to test memory region 4004000000 (4194304 bytes)\r\n*** Preparing to test memory region 4004782000 (8388608 bytes)\r\n*** Preparing to test memory region 4004f83000 (8388608 bytes)\r\n*** Preparing to test memory region 4005784000 (8388608 bytes)\r\n*** Preparing to test memory region 4005f85000 (8388608 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: dictAddRaw (base: 0x400003d940)\r\nModule: /usr/bin/redis-server 127.0.0.1:6379 (base 0x4000000000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x400003d940 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n790:M 24 Nov 2023 15:12:50.136 # dump of function (hexdump of 323 bytes):\r\nf30f1efa41574989f741564989fe41554154554889d5534883ec2848837f50ff0f85ca000000498b064c89ffff10488904244885ed740848c745000000000049837e50ff751a498b4e184885c90f8475010000498b76284839f10f8630010000498d4650498d5e1048894424104989dd488b0c2449234d10488d04cd0000000048894c24184889442408498b45004c8b24c84d85e4752ceb770f1f8000000000498b06488b40184885c0740d498b7e084c89feffd085c075134d8b6424104d85e4744d498b14244939d775d44885ed74044c8965004531ed4883c4284c89e85b5d415c415d415e415fc3660f1f44000048837f58000f852bffffffbe01000000e88bdbffffe91cffffff660f1f44000049837e50ff0f84bc0000004983c5204c396c24100f8546ffffff48837c2418ff74a3498d5e30bf18000000e8c06c00004c8b64\r\n\r\n```\r\n\r\n\r\n1. Im running docker image \r\n```\r\nLinux 934e962812b1 5.15.49-linuxkit-pr #1 SMP PREEMPT Thu May 25 07:27:39 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux \r\n```\r\n",
  "state": "open",
  "created_at": "2023-11-24T20:46:06Z",
  "updated_at": "2023-11-25T11:03:16Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1826281445,
      "user": "sundb",
      "created_at": "2023-11-25T11:03:15Z",
      "body": "@beovideskevin did you see the keyword `qemu` in the full crash log?\r\nit's kind of similar to #11633."
    }
  ]
}