{
  "issue_number": 7793.0,
  "title": "[BUG] Redis-server service keeps crashing and restarting each 1-2 seconds",
  "body": "**Redis-server keeps crashing and restarting each 1-2 seconds**\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n30924:M 13 Sep 15:09:53.635 # === ASSERTION FAILED OBJECT CONTEXT ===\r\n30924:M 13 Sep 15:09:53.635 # Object type: 0\r\n30924:M 13 Sep 15:09:53.635 # Object encoding: 0\r\n30924:M 13 Sep 15:09:53.635 # Object refcount: 1\r\n30924:M 13 Sep 15:09:53.635 # Object raw string len: 50\r\n30924:M 13 Sep 15:09:53.635 # Object raw string content: \"algo_perf_display_cc74e5df7c34305933999bdb45dd4369\"\r\n30924:M 13 Sep 15:09:53.635 # === ASSERTION FAILED ===\r\n30924:M 13 Sep 15:09:53.635 # ==> db.c:161 'retval == DICT_OK' is not true\r\n30924:M 13 Sep 15:09:53.635 # (forcing SIGSEGV to print the bug report.)\r\n30924:M 13 Sep 15:09:53.635 # Redis 3.2.6 crashed by signal: 11\r\n30924:M 13 Sep 15:09:53.635 # Crashed running the instuction at: 0x55f5c883c550\r\n30924:M 13 Sep 15:09:53.635 # Accessing address: 0xffffffffffffffff\r\n30924:M 13 Sep 15:09:53.635 # Failed assertion: retval == DICT_OK (db.c:161)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/bin/redis-server 127.0.0.1:6379(_serverAssert+0x70)[0x55f5c883c550]\r\n\r\nBacktrace:\r\n/usr/bin/redis-server 127.0.0.1:6379(logStackTrace+0x4a)[0x55f5c883e3da]\r\n/usr/bin/redis-server 127.0.0.1:6379(sigsegvHandler+0xc3)[0x55f5c883eba3]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x110e0)[0x7f0082e2d0e0]\r\n/usr/bin/redis-server 127.0.0.1:6379(_serverAssert+0x70)[0x55f5c883c550]\r\n/usr/bin/redis-server 127.0.0.1:6379(dbAdd+0x83)[0x55f5c8817493]\r\n/usr/bin/redis-server 127.0.0.1:6379(rdbLoad+0x216)[0x55f5c8821486]\r\n/usr/bin/redis-server 127.0.0.1:6379(loadDataFromDisk+0x45)[0x55f5c8807025]\r\n/usr/bin/redis-server 127.0.0.1:6379(main+0x3a9)[0x55f5c87f9709]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf1)[0x7f0082a9d2e1]\r\n/usr/bin/redis-server 127.0.0.1:6379(_start+0x2a)[0x55f5c87f995a]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:3.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:a2cab475abc2115e\r\nredis_mode:standalone\r\nos:Linux 4.9.0-9-amd64 x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\ngcc_version:6.3.0\r\nprocess_id:30924\r\nrun_id:f0ed88a28c25ff34a8d1e37bf7004bfc619b9bdf\r\ntcp_port:6379\r\nuptime_in_seconds:1\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:6167072\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:411201800\r\nused_memory_human:392.15M\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:411201800\r\nused_memory_peak_human:392.15M\r\ntotal_system_memory:67338059776\r\ntotal_system_memory_human:62.71G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:0.00\r\nmem_allocator:jemalloc-3.6.0\r\n\r\n# Persistence\r\nloading:1\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1600002592\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\nloading_start_time:1600002592\r\nloading_total_bytes:767186458\r\nloading_loaded_bytes:205520736\r\nloading_loaded_perc:26.79\r\nloading_eta_seconds:2\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.15\r\nused_cpu_user:1.36\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=1084207,expires=0,avg_ttl=0\r\nhash_init_value: 1600117179\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n30924:M 13 Sep 15:09:53.636 # \r\nRAX:0000000000000000 RBX:00000000000000a1\r\nRCX:00007f008326f3d0 RDX:0000000000000002\r\nRDI:00007f0082006000 RSI:000000000000003d\r\nRBP:000055f5c888e545 RSP:00007ffd8c675f00\r\nR8 :00007f008398fec0 R9 :00007f008398fec0\r\nR10:0000000000000073 R11:0000000000000206\r\nR12:000055f5c888c4fc R13:00007f0082023000\r\nR14:0000000000000000 R15:00007f00820e4f90\r\nRIP:000055f5c883c550 EFL:0000000000010206\r\nCSGSFS:002b000000000033\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0f) -> 000055f5c8800200\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0e) -> 00000000fffffffe\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0d) -> 0000000000000007\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0c) -> 000000008200e240\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0b) -> 00007f0082043200\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f0a) -> 00007ffd8c675fa0\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f09) -> 0000017487960d73\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f08) -> 000000000000000a\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f07) -> 000055f5c8821486\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f06) -> ffffffffffffffff\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f05) -> 00007ffd8c675f78\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f04) -> 00007ffd8c675f80\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f03) -> 000055f5c8817493\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f02) -> 00007f0082023000\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f01) -> 00007f00820e4f90\r\n30924:M 13 Sep 15:09:53.636 # (00007ffd8c675f00) -> 00007f00678f9620\r\n\r\n------ FAST MEMORY TEST ------\r\n30924:M 13 Sep 15:09:53.636 # Bio thread for job type #0 terminated\r\n30924:M 13 Sep 15:09:53.636 # Bio thread for job type #1 terminated\r\n*** Preparing to test memory region 55f5c8ac4000 (86016 bytes)\r\n*** Preparing to test memory region 7f0067800000 (419430400 bytes)\r\n*** Preparing to test memory region 7f0080bb3000 (8388608 bytes)\r\n*** Preparing to test memory region 7f00813b4000 (8388608 bytes)\r\n*** Preparing to test memory region 7f0082000000 (8388608 bytes)\r\n*** Preparing to test memory region 7f0082e18000 (16384 bytes)\r\n*** Preparing to test memory region 7f0083035000 (16384 bytes)\r\n*** Preparing to test memory region 7f008326f000 (4096 bytes)\r\n*** Preparing to test memory region 7f008398f000 (16384 bytes)\r\n*** Preparing to test memory region 7f008399d000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: _serverAssert (base: 0x55f5c883c4e0)\r\nModule: /usr/bin/redis-server 127.0.0.1:6379 (base 0x55f5c87da000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x55f5c883c4e0 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n30924:M 13 Sep 15:09:54.586 # dump of function (hexdump of 240 bytes):\r\n8b05e681280041544989fc554889f55389d385c07505e885fdffff488d3546610500bf0300000031c0e8023cfcff488d354c6105004d89e089d94889eabf0300000031c0e8e73bfcff488d3520520500bf0300000031c04c89257a81280048892d7b812800891d7d812800e8c03bfcffc60425ffffffff785b5d415cc30f1f00415541544989fc55534881ec980000008b3d5681280064488b042528000000488984248800000031c085ff0f842f010000488d35e851050031c0bf0300000031ed31db4989e5e8653bfcff418b942498000000488d35c260050031c0bf03000000e84a3bfcff418b542408488d35bd60\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/antirez/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n                _._                                                  \r\n           _.-``__ ''-._                                             \r\n      _.-``    `.  `_.  ''-._           Redis 3.2.6 (00000000/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \r\n (    '      ,       .-`  | `,    )     Running in standalone mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\r\n |    `-._   `._    /     _.-'    |     PID: 31007\r\n  `-._    `-._  `-./  _.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |           http://redis.io        \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |                                  \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n      `-._    `-.__.-'    _.-'                                       \r\n          `-._        _.-'                                           \r\n              `-.__.-'                                               \r\n\r\n31007:M 13 Sep 15:09:55.531 # Server started, Redis version 3.2.6\r\n31007:M 13 Sep 15:09:55.531 # WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.\r\n31007:M 13 Sep 15:09:55.531 # WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never > /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.\r\n```\r\n\r\n**To reproduce**\r\n\r\nA restart of the redis-server reproduces the crash.\r\n\r\n**Expected behavior**\r\n\r\nThe redis-server continues its normal operations of saving key-values without crash.\r\n\r\n**Additional information**\r\n\r\nHappened all of a sudden.\r\nOS: Debian 9\r\nMemory usage:\r\n```\r\nroot@server /var/log # free -h\r\n              total        used        free      shared  buff/cache   available\r\nMem:            62G         30G        2.7G        5.0M         29G         31G\r\nSwap:           15G          0B         15G\r\n```\r\n\r\nDmesg:\r\n```\r\n[Fri Sep 11 17:47:23 2020] php-fpm7.2[1086]: segfault at 60 ip 00007fccd7e19cda sp 00007ffd649253f0 error 4 in libcrypto.so.1.0.2[7fccd7cc3000+238000]\r\n[Fri Sep 11 18:13:54 2020] php-fpm7.2[18294]: segfault at 19 ip 00007fccdddc6524 sp 00007ffd649252a8 error 4 in libc-2.24.so[7fccddd4b000+195000]\r\n[Fri Sep 11 20:24:31 2020] php[21991]: segfault at 50 ip 00007f2486dba784 sp 00007ffdc32e0e90 error 4 in pdo_mysql.so[7f2486db6000+6000]\r\n[Sun Sep 13 10:01:44 2020] php-fpm7.2[27992]: segfault at 60 ip 00007fccd7e19cda sp 00007ffd649253f0 error 4 in libcrypto.so.1.0.2[7fccd7cc3000+238000]\r\n```\r\n\r\nRedis packages installed:\r\n```\r\nroot@server ~ # dpkg -l | grep redis\r\nii  php-redis                                  5.0.2+4.3.0-1+0~20190808.13+debian9~1.gbpcc7e06       amd64        PHP extension for interfacing with Redis\r\nii  redis-server                               3:3.2.6-3+deb9u3                                      amd64        Persistent key-value database with network interface\r\nii  redis-tools                                3:3.2.6-3+deb9u3                                      amd64        Persistent key-value database with network interface (client)\r\n```\r\n\r\nIs it possible that the bug is related to any external module?\r\n",
  "state": "closed",
  "created_at": "2020-09-13T13:49:02Z",
  "updated_at": "2021-11-18T09:19:32Z",
  "closed_at": "2021-11-18T08:39:46Z",
  "labels": [
    "state:to-be-closed"
  ],
  "comments_data": [
    {
      "id": 691674635,
      "user": "oranagra",
      "created_at": "2020-09-13T13:55:50Z",
      "body": "@ssgoburdhun it crashes while loading an RDB file, probably because there are two keys with the same name. \nRename the rdb file (for safe keeping) and redis would start. \nDo you know how that rdb file was produced? Or how to reproduce it from scratch? "
    },
    {
      "id": 691681641,
      "user": "ssgoburdhun",
      "created_at": "2020-09-13T14:55:03Z",
      "body": "Thank you @oranagra for your prompt reply.\r\n> Do you know how that rdb file was produced? Or how to reproduce it from scratch?\r\n\r\nI am not aware how the rdb file was produced and why there are 2 similar keys.\r\nIt just happened suddenly today.\r\nIs there a guide I can follow to reproduce the issue?\r\n\r\nThere are 2 commands used to reproduce the binary file:\r\n```\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x55f5c883c4e0 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n```\r\nWill any of the 2 output be helpful?"
    },
    {
      "id": 691695579,
      "user": "oranagra",
      "created_at": "2020-09-13T16:49:35Z",
      "body": "@ssgoburdhun these commands are used to see better understand the crash, but in this case the crash is clear. \nMaybe you can use redis-rdb-tools to analyze the rdb file and find out the key name that is a duplicate and its type. Then from that try to conclude which commands were used that may have generated it.\n\nAlso, maybe you can tell me the history behind that server and it's data. \nWas it an upgrade from an earlier version?"
    },
    {
      "id": 971442126,
      "user": "erlandl4g",
      "created_at": "2021-11-17T10:28:18Z",
      "body": "I have similar problem on Centos 7. And I have it just installed, configured and not even stored a single key in it. Sometimes it allows me correct to redis, but mostly not.\r\n\r\n```\r\n/usr/local/bin/redis-server /etc/redis/6379.conf\r\n[root@email /var/run]# redis-cli -h 10.39.136.205 -p 6379\r\n10.39.136.205:6379> client list\r\nid=3 addr=10.39.136.205:40062 laddr=10.39.136.205:6379 fd=10 name= age=42 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=26 qbuf-free=40928 argv-mem=10 obl=0 oll=0 omem=0 tot-mem=61466 events=r cmd=client user=default redir=-1\r\nid=4 addr=10.39.138.89:36254 laddr=10.39.136.205:6379 fd=11 name= age=27 idle=27 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=command user=default redir=-1\r\n10.39.136.205:6379> quit\r\n[root@email /var/run]# systemctl restart redis\r\n[root@email /var/run]# redis-cli -h 10.39.138.89 -p 6379\r\nCould not connect to Redis at 10.39.138.89:6379: Connection refused\r\nnot connected> quit\r\n[root@email /var/run]# systemctl stop redis\r\n[root@email /var/run]# systemctl start redis\r\n[root@email /var/run]# redis-cli -h 10.39.138.89 -p 6379\r\nCould not connect to Redis at 10.39.138.89:6379: Connection refused\r\n```\r\n\r\n```\r\n38110:C 17 Nov 2021 05:24:40.162 # Configuration loaded\r\n38110:signal-handler (1637144680) Received SIGTERM scheduling shutdown...\r\n38110:S 17 Nov 2021 05:24:40.163 * Increased maximum number of open files to 10032 (it was originally set to 1024).\r\n38110:S 17 Nov 2021 05:24:40.163 * monotonic clock: POSIX clock_gettime\r\n38110:S 17 Nov 2021 05:24:40.163 * Running mode=standalone, port=6379.\r\n38110:S 17 Nov 2021 05:24:40.163 # Server initialized\r\n38110:S 17 Nov 2021 05:24:40.164 * Ready to accept connections\r\n38110:S 17 Nov 2021 05:24:40.164 # User requested shutdown...\r\n38110:S 17 Nov 2021 05:24:40.164 * Calling fsync() on the AOF file.\r\n38110:S 17 Nov 2021 05:24:40.165 * Saving the final RDB snapshot before exiting.\r\n38110:S 17 Nov 2021 05:24:40.166 * DB saved on disk\r\n38110:S 17 Nov 2021 05:24:40.166 * Removing the pid file.\r\n38110:S 17 Nov 2021 05:24:40.166 # Redis is now ready to exit, bye bye...\r\n38210:C 17 Nov 2021 05:24:45.384 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n38210:C 17 Nov 2021 05:24:45.384 # Redis version=6.2.5, bits=64, commit=00000000, modified=0, pid=38210, just started\r\n38210:C 17 Nov 2021 05:24:45.384 # Configuration loaded\r\n38303:C 17 Nov 2021 05:24:50.412 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n38303:C 17 Nov 2021 05:24:50.412 # Redis version=6.2.5, bits=64, commit=00000000, modified=0, pid=38303, just started\r\n38303:C 17 Nov 2021 05:24:50.412 # Configuration loaded\r\n38303:signal-handler (1637144690) Received SIGTERM scheduling shutdown...\r\n38303:S 17 Nov 2021 05:24:50.413 * Increased maximum number of open files to 10032 (it was originally set to 1024).\r\n38303:S 17 Nov 2021 05:24:50.413 * monotonic clock: POSIX clock_gettime\r\n38303:S 17 Nov 2021 05:24:50.413 * Running mode=standalone, port=6379.\r\n38303:S 17 Nov 2021 05:24:50.414 # Server initialized\r\n38303:S 17 Nov 2021 05:24:50.415 * Ready to accept connections\r\n38303:S 17 Nov 2021 05:24:50.415 # User requested shutdown...\r\n38303:S 17 Nov 2021 05:24:50.415 * Calling fsync() on the AOF file.\r\n38303:S 17 Nov 2021 05:24:50.415 * Saving the final RDB snapshot before exiting.\r\n38303:S 17 Nov 2021 05:24:50.416 * DB saved on disk\r\n38303:S 17 Nov 2021 05:24:50.416 * Removing the pid file.\r\n38303:S 17 Nov 2021 05:24:50.416 # Redis is now ready to exit, bye bye...\r\n38418:C 17 Nov 2021 05:24:55.652 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n38491:C 17 Nov 2021 05:25:00.912 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\r\n38491:C 17 Nov 2021 05:25:00.912 # Redis version=6.2.5, bits=64, commit=00000000, modified=0, pid=38491, just started\r\n38491:C 17 Nov 2021 05:25:00.912 # Configuration loaded\r\n38491:signal-handler (1637144700) Received SIGTERM scheduling shutdown...\r\n38491:S 17 Nov 2021 05:25:00.913 * Increased maximum number of open files to 10032 (it was originally set to 1024).\r\n38491:S 17 Nov 2021 05:25:00.913 * monotonic clock: POSIX clock_gettime\r\n38491:S 17 Nov 2021 05:25:00.913 * Running mode=standalone, port=6379.\r\n38491:S 17 Nov 2021 05:25:00.913 # Server initialized\r\n38491:S 17 Nov 2021 05:25:00.914 * Ready to accept connections\r\n38491:S 17 Nov 2021 05:25:00.914 # User requested shutdown...\r\n38491:S 17 Nov 2021 05:25:00.914 * Calling fsync() on the AOF file.\r\n38491:S 17 Nov 2021 05:25:00.914 * Saving the final RDB snapshot before exiting.\r\n38491:S 17 Nov 2021 05:25:00.916 * DB saved on disk\r\n38491:S 17 Nov 2021 05:25:00.916 * Removing the pid file.\r\n38491:S 17 Nov 2021 05:25:00.916 # Redis is now ready to exit, bye bye...\r\n\r\n```\r\n"
    },
    {
      "id": 971451546,
      "user": "oranagra",
      "created_at": "2021-11-17T10:40:50Z",
      "body": "@erlandl4g it looks like someone / something is instructing redis to shutdown. \r\nmaybe someone else is connecting to it? did you happen to disable `protected-mode`?"
    },
    {
      "id": 971464781,
      "user": "erlandl4g",
      "created_at": "2021-11-17T10:59:47Z",
      "body": "Found the answer on\r\n\r\nhttps://stackoverflow.com/questions/42079847/determining-why-redis-is-receiving-a-sigterm-every-minute-or-two\r\n\r\nWhich I would say is a flaw in Redis and should be fixed"
    },
    {
      "id": 971624141,
      "user": "yossigo",
      "created_at": "2021-11-17T14:17:38Z",
      "body": "@erlandl4g This is not a flaw, the daemonization mechanism configured for Redis needs to match the one systemd is set to expect. When using systemd one should generally:\r\n\r\n* Make sure Redis is built with libsystemd\r\n* Use `Type=Notify`\r\n* Configure Redis with `supervised auto`."
    },
    {
      "id": 972008232,
      "user": "erlandl4g",
      "created_at": "2021-11-17T20:56:16Z",
      "body": "Yes, I see it now, but it was not so clear when reading the manual for the first time and following everything line by line.\r\n\r\nAnd I install the simple recommended way and I assume libsystemd is build that way:\r\n```\r\ncd /opt\r\nwget https://download.redis.io/releases/redis-6.2.6.tar.gz\r\ntar xzf redis-6.2.6.tar.gz\r\ncd redis-6.2.6\r\nmake\r\nmake install\r\n```\r\n\r\nYes `supervised auto` was suggested in the config file and I left it. `daemonize` was not so well explained. `Type=Notify` was not mentioned anywhere either. Unless I have missed it. It would be best if redis install would create systemd file as needed (for most cases).\r\n\r\nSetup guide could be improved on redis site to show better guidance on simple setup, cluster setup and sentinel setup (so there would be no need to read this on other sites having much better explained setup steps and examples).\r\n\r\nAnd last but not least - Yes, my periodic restarts have stopped after I corrected systemd unit file and config file set to `daemonize no` and Redis is working fine now.\r\n\r\nThank you."
    },
    {
      "id": 972648873,
      "user": "yossigo",
      "created_at": "2021-11-18T08:39:35Z",
      "body": "@erlandl4g Thanks for your feedback, I'll take a look and see if we can improve that. Generally install from source is always more tricky and I think pulling a pre-built package from a credible repo is often easier."
    },
    {
      "id": 972679474,
      "user": "oranagra",
      "created_at": "2021-11-18T09:19:32Z",
      "body": "please note this issue is not about supervised / daemonize, it is about a corruption / crash.\r\ni was about to re-open the issue..\r\nbut looking at the correspondence again, the problem was a bad RDB file, and we don't know how it got generated.\r\nso i guess i'll leave it closed, since it's unlikely that we'll ever get to the bottom of it."
    }
  ]
}