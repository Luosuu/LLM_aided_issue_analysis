{
  "issue_number": 12376.0,
  "title": " [CRASH] Redis 6.2.6 SIGSEGV in moduleFireServerEvent at module.c:8266",
  "body": "The systemï¼š\r\nos:Linux 4.14.209-ltsi-altera-g4eb80fd7d5db-dirty armv7l\r\narch_bits:32\r\n\r\n\r\n**Crash report**\r\n\r\nPaste the complete crash log between the quotes below. Please include a few lines from the log preceding the crash report to provide some context.\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n1577:M 27 Apr 2023 06:10:04.179 # Redis 6.2.6 crashed by signal: 11, si_code: 1\r\n1577:M 27 Apr 2023 06:10:04.179 # Accessing address: 0x28fa\r\n1577:M 27 Apr 2023 06:10:04.179 # Crashed running the instruction at: 0xb54a4\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/sbin/redis-server(moduleFireServerEvent+0x1c)[0xb54a4]\r\n\r\nBacktrace:\r\n\r\n------ REGISTERS ------\r\n1577:M 27 Apr 2023 06:10:04.185 #\r\nR10:0000000000000019 R9 :0000000000000000\r\nR8 :00000000beec5628 R7 :00000000beec5628\r\nR6 :0000000000132c30 R5 :0000000000000000\r\nR4 :0000000000000008 R3 :00000000beec5628\r\nR2 :0000000000000000 R1 :0000000000000000\r\nR0 :00000000000028e6 EC :0000000000000017\r\nfp: 000000000018a1d0 ip:000000000000efb0\r\npc:00000000000b54a4 sp:00000000beec54e8\r\ncpsr:0000000060010010 fault_address:00000000000028fa\r\n\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f7) -> 00046c8c\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f6) -> 0019b220\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f5) -> 0019b220\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f4) -> 00000000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f3) -> 0014b2b0\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f2) -> b6eb5000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f1) -> 00000002\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54f0) -> 00000000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54ef) -> 00000000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54ee) -> 00000000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54ed) -> 000296fc\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54ec) -> 0019b220\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54eb) -> 0014b120\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54ea) -> 00000000\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54e9) -> 0003b698\r\n1577:M 27 Apr 2023 06:10:04.185 # (beec54e8) -> 0000000c\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:b58ffd86\r\nredis_git_dirty:1\r\nredis_build_id:92a34b4bc5e1f9fc\r\nredis_mode:standalone\r\nos:Linux 4.14.209-ltsi-altera-g4eb80fd7d5db-dirty armv7l\r\narch_bits:32\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:4.8.3\r\nprocess_id:1577\r\nprocess_supervised:no\r\nrun_id:68fa76d466baa0c43c269f6d015eb83e53ce414e\r\ntcp_port:0\r\nserver_time_usec:1682547003994724\r\nuptime_in_seconds:202\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:4825403\r\nexecutable:/sbin/redis-server\r\nconfig_file:/etc/kvdb/kvdb_0.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:1\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:32\r\nclient_recent_max_output_buffer:0\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:637416\r\nused_memory_human:622.48K\r\nused_memory_rss:2162688\r\nused_memory_rss_human:2.06M\r\nused_memory_peak:668672\r\nused_memory_peak_human:653.00K\r\nused_memory_peak_perc:95.33%\r\nused_memory_overhead:635532\r\nused_memory_startup:618660\r\nused_memory_dataset:1884\r\nused_memory_dataset_perc:10.04%\r\nallocator_allocated:635788\r\nallocator_active:2135040\r\nallocator_resident:2135040\r\ntotal_system_memory:519962624\r\ntotal_system_memory_human:495.88M\r\nused_memory_lua:27648\r\nused_memory_lua_human:27.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:3221225472\r\nmaxmemory_human:3.00G\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:3.36\r\nallocator_frag_bytes:1499252\r\nallocator_rss_ratio:1.00\r\nallocator_rss_bytes:0\r\nrss_overhead_ratio:1.01\r\nrss_overhead_bytes:27648\r\nmem_fragmentation_ratio:3.40\r\nmem_fragmentation_bytes:1526900\r\nmem_not_counted_for_evict:8\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:16860\r\nmem_aof_buffer:12\r\nmem_allocator:libc\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1682546801\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:1\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\naof_current_size:0\r\naof_base_size:0\r\naof_pending_rewrite:0\r\naof_buffer_length:0\r\naof_rewrite_buffer_length:0\r\naof_pending_bio_fsync:0\r\naof_delayed_fsync:0\r\n\r\n# Stats\r\ntotal_connections_received:1\r\ntotal_commands_processed:295\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:15001\r\ntotal_net_output_bytes:1181\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:12\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:294\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\ntotal_forks:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:0\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:295\r\ntotal_writes_processed:295\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:71912a442ea1540472c99bf40cb6b429f50c50ca\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.482229\r\nused_cpu_user:0.117617\r\nused_cpu_sys_children:0.000000\r\nused_cpu_user_children:0.000000\r\nused_cpu_sys_main_thread:0.482003\r\nused_cpu_user_main_thread:0.117561\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_lrange:calls=294,usec=2932,usec_per_call=9.97,rejected_calls=0,failed_calls=0\r\ncmdstat_select:calls=1,usec=1096,usec_per_call=1096.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=3 addr=/run/.5gnr/app_data/kvdb/kvdb_0.sock:0 laddr=/run/.5gnr/app_data/kvdb/kvdb_0.sock:0 fd=8 name= age=177 idle=177 flags=U db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=16860 events=r cmd=lrange user=default redir=-1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n1577:M 27 Apr 2023 06:10:04.189 # Bio thread for job type #0 terminated\r\n1577:M 27 Apr 2023 06:10:04.189 # Bio thread for job type #1 terminated\r\n1577:M 27 Apr 2023 06:10:04.189 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 12d000 (512000 bytes)\r\n*** Preparing to test memory region b558b000 (8384512 bytes)\r\n*** Preparing to test memory region b5d8b000 (8384512 bytes)\r\n*** Preparing to test memory region b658b000 (8716288 bytes)\r\n*** Preparing to test memory region b6eb6000 (12288 bytes)\r\n*** Preparing to test memory region b6ed2000 (8192 bytes)\r\n*** Preparing to test memory region b6edf000 (4096 bytes)\r\n*** Preparing to test memory region b6f88000 (8192 bytes)\r\n*** Preparing to test memory region b6f8c000 (12288 bytes)\r\n.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: moduleFireServerEvent (base: 0xb5488)\r\nModule: /sbin/redis-server (base 0x8000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0xb5488 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n1577:M 27 Apr 2023 06:10:07.133 # dump of function (hexdump of 156 bytes):\r\nb0cf0ee3f04f2de913c040e30040a0e10380a0e141df4de200009ce5143090e5000053e30100001a41df8de2f08fbde898ac0be318bd01e30150a0e10290a0e128108de20020a0e30aa040e313b040e31c208de5fed0fdeb0220c4e30530a0e1f022cde128008de203d1fdeb000050e3ecffff0a086090e5d820c6e1050053e104005201f6ffff1a70008de20010a0e34020a0e3e0ccfdeb003096e5\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/redis/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n```\r\n",
  "state": "open",
  "created_at": "2023-07-02T13:34:38Z",
  "updated_at": "2023-07-13T06:05:51Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1633434574,
      "user": "bugwz",
      "created_at": "2023-07-13T02:14:45Z",
      "body": "@mark6661  I suggest you add some `gdb` debugging records."
    },
    {
      "id": 1633605265,
      "user": "oranagra",
      "created_at": "2023-07-13T06:05:51Z",
      "body": "there's not much to work with here (rather empty stack trace).\r\n@mark6661 can you please describe anything that can help.\r\nmaybe mention if you did anything just before the crash that could have caused it?\r\nmaybe post the last few log lines before the actual crash?\r\nanything special about that deployment (other than the fact it runs on ARM?\r\nare you using any modules?\r\n\r\np.s. i see:\r\n```\r\nredis_git_sha1:b58ffd86\r\nredis_git_dirty:1\r\n```\r\nboth are an indication that this is not a vanilla redis (we don't have b58ffd86), please describe where you got it and how you built it."
    }
  ]
}