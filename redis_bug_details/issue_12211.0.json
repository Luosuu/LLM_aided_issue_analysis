{
  "issue_number": 12211.0,
  "title": "[BUG] when set a expire time smaller than now, event notify should be \"expired-key\", not \"del\"",
  "body": "**Describe the bug**\r\nwhen user use the keyespace notify feature, usually \"expired\" means that the key need be updated and \"del\" means that the key have been no used.\r\n\r\n**To reproduce**\r\n1. > config set notify-keyspace-events glxE\r\n2. > subscribe __keyevent@0__:expired\r\n3. > another client write: set foo bar , expireat foo 1(want key expired immediately to update the value by other appication)\r\n4. > but receive a del eventï¼š\r\n```\r\n1) \"pmessage\"\r\n2) \"__*\"\r\n3) \"__keyevent@0__:del\"\r\n4) \"foo\"\r\n```\r\n**Expected behavior**\r\nreceive a expired event:\r\n```\r\n1) \"pmessage\"\r\n2) \"__*\"\r\n3) \"__keyevent@0__:expired\"\r\n4) \"foo\"\r\n```\r\n\r\n**Additional information**\r\nIf we want, we just need to correct one line:\r\nhttps://github.com/redis/redis/blob/38e284f1064256586a18d9a12fe8a22826866537/src/expire.c#L640\r\n\r\n",
  "state": "closed",
  "created_at": "2023-05-22T12:04:20Z",
  "updated_at": "2023-05-23T12:32:40Z",
  "closed_at": "2023-05-23T12:32:40Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1557260816,
      "user": "itamarhaber",
      "created_at": "2023-05-22T13:51:55Z",
      "body": "Hello @judeng \r\n\r\nThanks for reporting this. However, this is the expected behavior that's documented at https://redis.io/docs/manual/keyspace-notifications/#events-generated-by-different-commands (emphasis mine):\r\n\r\n> [EXPIRE](https://redis.io/commands/expire) and all its variants ([PEXPIRE](https://redis.io/commands/pexpire), [EXPIREAT](https://redis.io/commands/expireat), [PEXPIREAT](https://redis.io/commands/pexpireat)) generate an expire event when called with a positive timeout (or a future timestamp). **Note that when these commands are called with a negative timeout value or timestamp in the past, the key is deleted and only a del event is generated instead.**\r\n\r\nThat being the case, I don't think this is a bug and I don't think we'd want to change the existing behavior"
    },
    {
      "id": 1558443424,
      "user": "judeng",
      "created_at": "2023-05-23T03:09:57Z",
      "body": "@itamarhaber thank you, the document is clear and useful for me. Now I use a `pexpire 1` instead to generate a expired event.\r\nBut until now, I still don't understand why it is designed like this, the expire command generate a 'del' event, it looks incongruous and particular..."
    },
    {
      "id": 1558772235,
      "user": "itamarhaber",
      "created_at": "2023-05-23T08:21:58Z",
      "body": "`EXPIRE` is replaced by `DEL` if the TTL has passed or is negative (also documented at https://redis.io/commands/expire/ btw). Besides avoiding unneeded expiry work, this is mainly done AFAIR, for replication and AOF.\r\n\r\nTherefore, the \"del\" event correctly reflects what happens IMO, despite being generated by the `EXPIRE` command.\r\nAt the same time, I agree that it would have also made sense to generate an expiry event instead. However, that train left the station about 7 years ago so I don't see us changing this now :)"
    },
    {
      "id": 1559103020,
      "user": "judeng",
      "created_at": "2023-05-23T11:25:44Z",
      "body": "Thanks for your patience, I think it is easy to find the approach around it, so just let it go :)\r\nthank you again"
    }
  ]
}