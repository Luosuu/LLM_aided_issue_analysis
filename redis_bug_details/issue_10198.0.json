{
  "issue_number": 10198.0,
  "title": "[BUG] XAUTOCLAIM returns nil for old messages in PEL",
  "body": "**Describe the bug**\r\n\r\nCalling `XAUTOCLAIM` in some instances will return `nil` but still register the pending messages. ~~When I call it with `JUSTID` and use `XREAD`, the message still exists.~~\r\n\r\n*Edit: misread the message ID, it does not match when using XREAD.*\r\n\r\n**To reproduce**\r\n\r\nI'm running in to a similar issue with `XAUTOCLAIM` with Redis 2.6.2 on Aiven.\r\n\r\nWhen we auto claim really old messages, we receive nils:\r\n```\r\nXXXX.aivencloud.com:23033> xautoclaim XXXX XXXX test 75000 0-0 COUNT 16\r\n1) \"1641894502791-3\"\r\n2)  1) (nil)\r\n    2) (nil)\r\n    3) (nil)\r\n    4) (nil)\r\n    5) (nil)\r\n    6) (nil)\r\n    7) (nil)\r\n    8) (nil)\r\n    9) (nil)\r\n   10) (nil)\r\n   11) (nil)\r\n   12) (nil)\r\n   13) (nil)\r\n   14) (nil)\r\n   15) (nil)\r\n   16) (nil)\r\n```\r\n\r\nThis shows that the messages are pending: (consumers 1 and 2 are live services)\r\n```\r\nXXXX.aivencloud.com:23033> xinfo consumers XXXX XXXX\r\n1) 1) \"name\"\r\n   2) \"XXXX\"\r\n   3) \"pending\"\r\n   4) (integer) 64\r\n   5) \"idle\"\r\n   6) (integer) 22065\r\n2) 1) \"name\"\r\n   2) \"XXXX\r\n   3) \"pending\"\r\n   4) (integer) 3640\r\n   5) \"idle\"\r\n   6) (integer) 9595\r\n3) 1) \"name\"\r\n   2) \"test\"\r\n   3) \"pending\"\r\n   4) (integer) 16\r\n   5) \"idle\"\r\n   6) (integer) 1110\r\n````\r\n\r\n~~When I attempt to read just the ID, it works as expected:~~ *Edit: see above*\r\n```\r\nXXXX.aivencloud.com:23033> xautoclaim XXXX XXXX test 75000 0-0 COUNT 16 JUSTID\r\n1) \"1641894501535-0\"\r\n2)  1) \"1641894501383-3\"\r\n    2) \"1641894501383-4\"\r\n    3) \"1641894501383-5\"\r\n    4) \"1641894501383-6\"\r\n    5) \"1641894501383-7\"\r\n    6) \"1641894501383-9\"\r\n    7) \"1641894501383-10\"\r\n    8) \"1641894501383-11\"\r\n    9) \"1641894501383-12\"\r\n   10) \"1641894501383-13\"\r\n   11) \"1641894501383-14\"\r\n   12) \"1641894501384-0\"\r\n   13) \"1641894501385-0\"\r\n   14) \"1641894501385-3\"\r\n   15) \"1641894501385-4\"\r\n   16) \"1641894501391-3\"\r\n```\r\n\r\n~~Then I can still read the message as intended:~~ *Edit: see above*\r\n```\r\nXXXX.aivencloud.com:23033> xread count 1 streams XXXX 1641894501383-3\r\n1) 1) \"XXXX\"\r\n   2) 1) 1) \"1642684625590-0\"\r\n         2) 1) \"m\"\r\n            2) \"\\x12\\x12\\n\\x101\\xba.\\x0b\\xd5\\x1fG\\xe5\\x91\\\"T`8\\x04n\\x81\\x1a\\x14\\n\\x12\\n\\x10\\xeb\\t|\\x87K\\xfeAa\\x9a\\xadik\\xd2\\xffz\\xe2\\\"\\x12\\n\\x10\\xe5\\x0cf\\x0fcyO\\xb2\\x87\\x17\\x81\\xc5\\xf8\\x02mx(\\xb6\\xe5\\x88\\xbd\\xe7/2\\\"\\n\\x05mm-gc\\x12\\x12\\n\\x10\\xf9\\x00\\xcc\\xbb\\xb3\\x1eM\\x1c\\x91g\\x12\\xa2\\xa1\\x14\\xc15\\x18\\xc8\\xe3\\x88\\xbd\\xe7/2*\\n\\rmm-lobby-stop\\x12\\x12\\n\\x10&\\xe6\\xc3\\x17\\xe7\\xfbJ\\x80\\x92\\t\\xbfx\\xc3\\x0f\\xf37\\x18\\xb6\\xe5\\x88\\xbd\\xe7/\"\r\n```\r\n\r\nI assume this has something to do with the dead letter mechanism in Redis streams, but there seems to be very sparse literature on how this works under the hood and how to configure it.\r\n\r\n*Edit: Here's the output of `XPENDING`:*\r\n```\r\nXXXX.aivencloud.com:23033> xpending XXXX XXXX - + 16\r\n 1) 1) \"1641890343856-0\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9814\r\n 2) 1) \"1641894501138-0\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 3) 1) \"1641894501167-0\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 4) 1) \"1641894501167-1\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 5) 1) \"1641894501167-2\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 6) 1) \"1641894501167-3\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 7) 1) \"1641894501168-1\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 8) 1) \"1641894501168-2\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n 9) 1) \"1641894501168-3\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n10) 1) \"1641894501168-4\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n11) 1) \"1641894501174-0\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n12) 1) \"1641894501207-1\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n13) 1) \"1641894501207-2\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n14) 1) \"1641894501208-4\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n15) 1) \"1641894501208-6\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n16) 1) \"1641894501208-8\"\r\n    2) \"XXXX\"\r\n    3) (integer) 34775\r\n    4) (integer) 9813\r\n```\r\n\r\n**Expected behavior**\r\n\r\nShould return messages from the PEL without having to use an XREAD workaround.\r\n\r\n**Additional information**\r\n\r\nPotentially related to https://github.com/redis/redis/issues/8924.\r\n",
  "state": "closed",
  "created_at": "2022-01-27T22:48:01Z",
  "updated_at": "2022-02-08T08:20:09Z",
  "closed_at": "2022-02-08T08:20:09Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1027950472,
      "user": "guybe7",
      "created_at": "2022-02-02T13:39:03Z",
      "body": "@rh2048 please read https://github.com/redis/redis/issues/7021#issuecomment-1027939792\r\n"
    }
  ]
}