{
  "issue_number": 8400.0,
  "title": "[CRASH]  Redis 5.0.5 crashed by signal: 11",
  "body": "\r\n[redis-server.zip](https://github.com/redis/redis/files/5874839/redis-server.zip)\r\n\r\nWe are running redis cluster, often we see redis server crash with following error. \r\n\r\n**Crash report**\r\n```\r\n    redis-server[2514]: === REDIS BUG REPORT START: Cut & paste starting from here ===\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.150 # Redis 5.0.5 crashed by signal: 11\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.150 # Crashed running the instruction at: 0x4aa80e\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.150 # Accessing address: (nil)\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.150 # Failed assertion: <no assertion failed> (<no file>:0)\r\n    redis-server[2514]: ------ STACK TRACE ------\r\n    redis-server[2514]: EIP:\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0xe)[0x4aa80e]\r\n    redis-server[2514]: Backtrace:\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](logStackTrace+0x45)[0x473ed5]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](sigsegvHandler+0xb9)[0x474699]\r\n    redis-server[2514]: /lib/x86_64-linux-gnu/libpthread.so.0(+0x11390)[0x7f2825882390]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0xe)[0x4aa80e]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxRecursiveFree+0x62)[0x4aa862]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](raxFreeWithCallback+0xf)[0x4aa8cf]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](slotToKeyFlush+0x14)[0x4488a4]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](emptyDb+0xf5)[0x4489d5]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](readSyncBulkPayload+0x298)[0x44aa98]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](aeProcessEvents+0x36d)[0x429cdd]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](aeMain+0x2b)[0x429f0b]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](main+0x4ae)[0x426abe]\r\n    redis-server[2514]: /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf0)[0x7f28254c7840]\r\n    redis-server[2514]: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster](_start+0x29)[0x426d29]\r\n    redis-server[2514]: ------ INFO OUTPUT ------\r\n    redis-server[2514]: # Server\r\n    redis-server[2514]: redis_version:5.0.5\r\n    redis-server[2514]: redis_git_sha1:00000000\r\n    redis-server[2514]: redis_git_dirty:0\r\n    redis-server[2514]: redis_build_id:3412dad92d914679\r\n    redis-server[2514]: redis_mode:cluster\r\n    redis-server[2514]: os:Linux 4.15.0-1087-gcp x86_64\r\n    redis-server[2514]: arch_bits:64\r\n    redis-server[2514]: multiplexing_api:epoll\r\n    redis-server[2514]: atomicvar_api:atomic-builtin\r\n    redis-server[2514]: gcc_version:5.4.0\r\n    redis-server[2514]: process_id:2514\r\n    redis-server[2514]: run_id:93ed37bd0a754eb9060519cec12d7e94912da993\r\n    redis-server[2514]: tcp_port:6379\r\n    redis-server[2514]: uptime_in_seconds:564\r\n    redis-server[2514]: uptime_in_days:0\r\n    redis-server[2514]: hz:10\r\n    redis-server[2514]: configured_hz:10\r\n    redis-server[2514]: lru_clock:873536\r\n    redis-server[2514]: executable:/usr/local/bin/redis-server\r\n    redis-server[2514]: config_file:/etc/redis/redis.conf\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Clients\r\n    redis-server[2514]: connected_clients:1\r\n    redis-server[2514]: client_recent_max_input_buffer:2\r\n    redis-server[2514]: client_recent_max_output_buffer:0\r\n    redis-server[2514]: blocked_clients:0\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Memory\r\n    redis-server[2514]: used_memory:47935600\r\n    redis-server[2514]: used_memory_human:45.71M\r\n    redis-server[2514]: used_memory_rss:10544611328\r\n    redis-server[2514]: used_memory_rss_human:9.82G\r\n    redis-server[2514]: used_memory_peak:10360213920\r\n    redis-server[2514]: used_memory_peak_human:9.65G\r\n    redis-server[2514]: used_memory_peak_perc:0.46%\r\n    redis-server[2514]: used_memory_overhead:1485554\r\n    redis-server[2514]: used_memory_startup:1468416\r\n    redis-server[2514]: used_memory_dataset:46450046\r\n    redis-server[2514]: used_memory_dataset_perc:99.96%\r\n    redis-server[2514]: allocator_allocated:10359168424\r\n    redis-server[2514]: allocator_active:10360307712\r\n    redis-server[2514]: allocator_resident:10545127424\r\n    redis-server[2514]: total_system_memory:13649055744\r\n    redis-server[2514]: total_system_memory_human:12.71G\r\n    redis-server[2514]: used_memory_lua:40960\r\n    redis-server[2514]: used_memory_lua_human:40.00K\r\n    redis-server[2514]: used_memory_scripts:216\r\n    redis-server[2514]: used_memory_scripts_human:216B\r\n    redis-server[2514]: number_of_cached_scripts:1\r\n    redis-server[2514]: maxmemory:10400396288\r\n    redis-server[2514]: maxmemory_human:9.69G\r\n    redis-server[2514]: maxmemory_policy:allkeys-lru\r\n    redis-server[2514]: allocator_frag_ratio:1.00\r\n    redis-server[2514]: allocator_frag_bytes:1139288\r\n    redis-server[2514]: allocator_rss_ratio:1.02\r\n    redis-server[2514]: allocator_rss_bytes:184819712\r\n    redis-server[2514]: rss_overhead_ratio:1.00\r\n    redis-server[2514]: rss_overhead_bytes:-516096\r\n    redis-server[2514]: mem_fragmentation_ratio:1.02\r\n    redis-server[2514]: mem_fragmentation_bytes:185508808\r\n    redis-server[2514]: mem_not_counted_for_evict:0\r\n    redis-server[2514]: mem_replication_backlog:0\r\n    redis-server[2514]: mem_clients_slaves:0\r\n    redis-server[2514]: mem_clients_normal:16922\r\n    redis-server[2514]: mem_aof_buffer:0\r\n    redis-server[2514]: mem_allocator:jemalloc-5.1.0\r\n    redis-server[2514]: active_defrag_running:0\r\n    redis-server[2514]: lazyfree_pending_objects:0\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Persistence\r\n    redis-server[2514]: loading:0\r\n    redis-server[2514]: rdb_changes_since_last_save:0\r\n    redis-server[2514]: rdb_bgsave_in_progress:0\r\n    redis-server[2514]: rdb_last_save_time:1611485708\r\n    redis-server[2514]: rdb_last_bgsave_status:ok\r\n    redis-server[2514]: rdb_last_bgsave_time_sec:-1\r\n    redis-server[2514]: rdb_current_bgsave_time_sec:-1\r\n    redis-server[2514]: rdb_last_cow_size:0\r\n    redis-server[2514]: aof_enabled:0\r\n    redis-server[2514]: aof_rewrite_in_progress:0\r\n    redis-server[2514]: aof_rewrite_scheduled:0\r\n    redis-server[2514]: aof_last_rewrite_time_sec:-1\r\n    redis-server[2514]: aof_current_rewrite_time_sec:-1\r\n    redis-server[2514]: aof_last_bgrewrite_status:ok\r\n    redis-server[2514]: aof_last_write_status:ok\r\n    redis-server[2514]: aof_last_cow_size:0\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Stats\r\n    redis-server[2514]: total_connections_received:7\r\n    redis-server[2514]: total_commands_processed:58\r\n    redis-server[2514]: instantaneous_ops_per_sec:0\r\n    redis-server[2514]: total_net_input_bytes:3642056396\r\n    redis-server[2514]: total_net_output_bytes:214894\r\n    redis-server[2514]: instantaneous_input_kbps:123085.17\r\n    redis-server[2514]: instantaneous_output_kbps:2.31\r\n    redis-server[2514]: rejected_connections:0\r\n    redis-server[2514]: sync_full:0\r\n    redis-server[2514]: sync_partial_ok:0\r\n    redis-server[2514]: sync_partial_err:0\r\n    redis-server[2514]: expired_keys:0\r\n    redis-server[2514]: expired_stale_perc:0.00\r\n    redis-server[2514]: expired_time_cap_reached_count:0\r\n    redis-server[2514]: evicted_keys:0\r\n    redis-server[2514]: keyspace_hits:0\r\n    redis-server[2514]: keyspace_misses:0\r\n    redis-server[2514]: pubsub_channels:0\r\n    redis-server[2514]: pubsub_patterns:0\r\n    redis-server[2514]: latest_fork_usec:0\r\n    redis-server[2514]: migrate_cached_sockets:0\r\n    redis-server[2514]: slave_expires_tracked_keys:0\r\n    redis-server[2514]: active_defrag_hits:0\r\n    redis-server[2514]: active_defrag_misses:0\r\n    redis-server[2514]: active_defrag_key_hits:0\r\n    redis-server[2514]: active_defrag_key_misses:0\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Replication\r\n    redis-server[2514]: role:slave\r\n    redis-server[2514]: master_host:xx.xxx..83.166\r\n    redis-server[2514]: master_port:6379\r\n    redis-server[2514]: master_link_status:down\r\n    redis-server[2514]: master_last_io_seconds_ago:-1\r\n    redis-server[2514]: master_sync_in_progress:1\r\n    redis-server[2514]: slave_repl_offset:1\r\n    redis-server[2514]: master_sync_left_bytes:0\r\n    redis-server[2514]: master_sync_last_io_seconds_ago:0\r\n    redis-server[2514]: master_link_down_since_seconds:150\r\n    redis-server[2514]: slave_priority:100\r\n    redis-server[2514]: slave_read_only:1\r\n    redis-server[2514]: connected_slaves:0\r\n    redis-server[2514]: master_replid:a99028ee574759c8d49dabba6d0f851257dcbd84\r\n    redis-server[2514]: master_replid2:0000000000000000000000000000000000000000\r\n    redis-server[2514]: master_repl_offset:2771796122601\r\n    redis-server[2514]: second_repl_offset:-1\r\n    redis-server[2514]: repl_backlog_active:0\r\n    redis-server[2514]: repl_backlog_size:1048576\r\n    redis-server[2514]: repl_backlog_first_byte_offset:2771796122602\r\n    redis-server[2514]: repl_backlog_histlen:0\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # CPU\r\n    redis-server[2514]: used_cpu_sys:29.630961\r\n    redis-server[2514]: used_cpu_user:208.543581\r\n    redis-server[2514]: used_cpu_sys_children:0.000000\r\n    redis-server[2514]: used_cpu_user_children:0.000000\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Commandstats\r\n    redis-server[2514]: cmdstat_readonly:calls=1,usec=0,usec_per_call=0.00\r\n    redis-server[2514]: cmdstat_info:calls=57,usec=6127,usec_per_call=107.49\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Cluster\r\n    redis-server[2514]: cluster_enabled:1\r\n    redis-server[2514]: [1B blob data]\r\n    redis-server[2514]: # Keyspace\r\n    redis-server[2514]: ------ CLIENT LIST OUTPUT ------\r\n    redis-server[2514]: id=11 addr=xx.xxx..83.168:39310 fd=19 name= age=280 idle=1 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=info\r\n    redis-server[2514]: ------ REGISTERS ------\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 #\r\n    redis-server[2514]: RAX:00007f2582832258 RBX:00007f2582832250\r\n    redis-server[2514]: RCX:0000000000000001 RDX:0000000000000000\r\n    redis-server[2514]: RDI:00007f2825028678 RSI:0000000000000000\r\n    redis-server[2514]: RBP:00007f2825028678 RSP:00007ffe75074ba0\r\n    redis-server[2514]: R8 :00000000000000a1 R9 :0000000000000048\r\n    redis-server[2514]: R10:0000000000000009 R11:0000000000000003\r\n    redis-server[2514]: R12:0000000000000000 R13:00007f2582832250\r\n    redis-server[2514]: R14:0000000000000000 R15:0000000000000400\r\n    redis-server[2514]: RIP:00000000004aa80e EFL:0000000000010206\r\n    redis-server[2514]: CSGSFS:002b000000000033\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074baf) -> 00007f257112d3a0\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074bae) -> 0000000000000000\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074bad) -> 00007f2825028678\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074bac) -> 00007f257112d3a8\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074bab) -> 00000000004aa862\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074baa) -> 00007f26e4894918\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba9) -> 00007f26e4894918\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba8) -> 0000000000000000\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba7) -> 00007f2825028678\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba6) -> 00007f26e4894918\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba5) -> 00000000004aa862\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba4) -> 00007f25747575a0\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba3) -> 00007f2582832250\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba2) -> 0000000000000000\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba1) -> 00007f2825028678\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # (00007ffe75074ba0) -> 00007f2582832250\r\n    redis-server[2514]: ------ FAST MEMORY TEST ------\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # Bio thread for job type #0 terminated\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # Bio thread for job type #1 terminated\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:09.194 # Bio thread for job type #2 terminated\r\n    redis-server[2514]: *** Preparing to test memory region 7ae000 (2248704 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 1e13000 (135168 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f255ee00000 (11553210368 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f280f8fd000 (327155712 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f28230fe000 (8388608 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f28238ff000 (8388608 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f2824100000 (8388608 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f2824900000 (11534336 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f282586d000 (16384 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f2825a8a000 (16384 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f28263bb000 (24576 bytes)\r\n    redis-server[2514]: *** Preparing to test memory region 7f28263ca000 (4096 bytes)\r\n    redis-server[2514]: .O.O.O.O.O.O.O.O.O.O.O.O\r\n    redis-server[2514]: Fast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n    redis-server[2514]: ------ DUMPING CODE AROUND EIP ------\r\n    redis-server[2514]: Symbol: raxRecursiveFree (base: 0x4aa800)\r\n    redis-server[2514]: Module: /usr/local/bin/redis-server xx.xxx..83.168:6379 [cluster] (base 0x400000)\r\n    redis-server[2514]: $ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n    redis-server[2514]: $ objdump --adjust-vma=0x4aa800 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n    redis-server[2514]: ------\r\n    redis-server[2514]: 2514:S 24 Jan 2021 18:05:53.221 # dump of function (hexdump of 142 bytes):\r\n    redis-server[2514]: 415641554989f64154554989d453f606044889fd757a8b0ec1e9038d410489ce8d51ff48f7d883e0074801f048c1e603488d5c06fc4c01f385c9742b48c1e2034889d84829d04c8d68f8660f1f440000488b334c89e24889ef4883eb08e89effffff4939dd75e94d85e4740b410fb60683e0033c0174394c89f7e891ccf8ff48836d10015b5d415c415d415ec30f\r\n    redis-server[2514]: Function at 0x4aa800 is raxRecursiveFree\r\n    redis-server[2514]: Function at 0x437510 is zfree\r\n    redis-server[2514]: === REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n    redis-server[2514]: Please report the crash by opening an issue on github:\r\n    redis-server[2514]: http://github.com/antirez/redis/issues\r\n    redis-server[2514]: Suspect RAM error? Use redis-server --test-memory to verify it.\r\n    systemd[1]: redis-server.service: Main process exited, code=dumped, status=11/SEGV\r\n    systemd[1]: redis-server.service: Unit entered failed state.\r\n    systemd[1]: redis-server.service: Failed with result 'core-dump'.\r\n\r\n```\r\n\r\n**Aditional information**\r\n\r\n1. OS distribution and version\r\n Ubuntu 16.04.5 LTS (GNU/Linux 4.15.0-1087-gcp x86_64)\r\n2. Steps to reproduce (if any)\r\nNone",
  "state": "open",
  "created_at": "2021-01-26T17:05:05Z",
  "updated_at": "2021-02-25T08:48:09Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 769947377,
      "user": "itamarhaber",
      "created_at": "2021-01-29T17:39:45Z",
      "body": "Appears related to #7719"
    },
    {
      "id": 785218018,
      "user": "codetodya",
      "created_at": "2021-02-24T16:53:22Z",
      "body": "@itamarhaber any pointers how I can reproduce this issue?"
    },
    {
      "id": 785726932,
      "user": "itamarhaber",
      "created_at": "2021-02-25T08:48:09Z",
      "body": "@codetodya regrettably none yet. Would it be possible for you to attach the log lines before the crash from both the replica and its master?"
    }
  ]
}