{
  "issue_number": 8251.0,
  "title": "[BUG] redis 3.2 crash on startup loading from AOF",
  "body": "**Describe the bug**\r\n\r\nredis can not start up, with beflow info:\r\n\r\n```\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/antirez/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n57692:M 28 Dec 09:41:41.484 * Node configuration loaded, I'm 3a3c3603da19c11c51772c4c380603bf66cb4a71\r\n                _._                                                  \r\n           _.-``__ ''-._                                             \r\n      _.-``    `.  `_.  ''-._           Redis 3.2.10 (00000000/0) 64 bit\r\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \r\n (    '      ,       .-`  | `,    )     Running in cluster mode\r\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 8380\r\n |    `-._   `._    /     _.-'    |     PID: 57692\r\n  `-._    `-._  `-./  _.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |           http://redis.io        \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \r\n |    `-._`-._        _.-'_.-'    |                                  \r\n  `-._    `-._`-.__.-'_.-'    _.-'                                   \r\n      `-._    `-.__.-'    _.-'                                       \r\n          `-._        _.-'                                           \r\n              `-.__.-'                                               \r\n\r\n57692:M 28 Dec 09:41:41.484 # Server started, Redis version 3.2.10\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n57692:M 28 Dec 09:41:41.578 # Redis 3.2.10 crashed by signal: 11\r\n57692:M 28 Dec 09:41:41.578 # Accessing address: 0xffff8a5fe000\r\n57692:M 28 Dec 09:41:41.578 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](logStackTrace+0x2c)[0x45f458]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](sigsegvHandler+0x90)[0x45fb00]\r\n[0xffff93435678]\r\n/lib64/libc.so.6(memset+0x48)[0xffff932014a8]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](sdsnewlen+0x17c)[0x42c5e8]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](loadAppendOnlyFile+0x148)[0x45bb84]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](loadDataFromDisk+0x74)[0x42c068]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster](main+0x368)[0x41fc54]\r\n/lib64/libc.so.6(__libc_start_main+0xf0)[0xffff9319a5d4]\r\n/home/aitpm/software/redis-cluster/bin/redis-server 10.222.93.163:8380 [cluster][0x41ff84]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:3.2.10\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:262756565f1e3cb6\r\nredis_mode:cluster\r\nos:Linux 4.19.0-1.0.0.1.rc2 aarch64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\ngcc_version:4.8.5\r\nprocess_id:57692\r\nrun_id:792dceccf8806a5e2cc256e91fee7ab397d06a0e\r\ntcp_port:8380\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:15284181\r\nexecutable:/home/aitpm/software/redis-cluster/bin/redis-server\r\nconfig_file:/home/aitpm/software/redis-cluster/cluster/8380/redis.conf\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:9982408\r\nused_memory_human:9.52M\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:9982408\r\nused_memory_peak_human:9.52M\r\ntotal_system_memory:405458149376\r\ntotal_system_memory_human:377.61G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:0.00\r\nmem_allocator:jemalloc-4.0.3\r\n\r\n# Persistence\r\nloading:1\r\nrdb_changes_since_last_save:19052\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1609119701\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\nloading_start_time:1609119701\r\nloading_total_bytes:11703075\r\nloading_loaded_bytes:8982368\r\nloading_loaded_perc:76.75\r\nloading_eta_seconds:1\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.04\r\nused_cpu_user:0.06\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:1\r\n\r\n# Keyspace\r\ndb0:keys=3818,expires=3815,avg_ttl=0\r\nhash_init_value: 1609466258\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n\r\n------ FAST MEMORY TEST ------\r\n57692:M 28 Dec 09:41:41.579 # Bio thread for job type #0 terminated\r\n57692:M 28 Dec 09:41:41.579 # Bio thread for job type #1 terminated\r\n*** Preparing to test memory region 535000 (98304 bytes)\r\n*** Preparing to test memory region 31052000 (135168 bytes)\r\n*** Preparing to test memory region ffff8a400000 (2088960 bytes)\r\n*** Preparing to test memory region ffff8a5ff000 (8388608 bytes)\r\n*** Preparing to test memory region ffff8ae00000 (18874368 bytes)\r\n*** Preparing to test memory region ffff8c000000 (4194304 bytes)\r\n*** Preparing to test memory region ffff92e00000 (2097152 bytes)\r\n*** Preparing to test memory region ffff93125000 (65536 bytes)\r\n*** Preparing to test memory region ffff93166000 (65536 bytes)\r\n*** Preparing to test memory region ffff93176000 (12288 bytes)\r\n*** Preparing to test memory region ffff932fb000 (16384 bytes)\r\n*** Preparing to test memory region ffff93330000 (20480 bytes)\r\n*** Preparing to test memory region ffff93433000 (4096 bytes)\r\n*** Preparing to test memory region ffff93438000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```",
  "state": "closed",
  "created_at": "2020-12-28T01:46:47Z",
  "updated_at": "2020-12-31T04:05:58Z",
  "closed_at": "2020-12-31T04:05:58Z",
  "labels": [],
  "comments_data": [
    {
      "id": 751620232,
      "user": "oranagra",
      "created_at": "2020-12-28T07:52:02Z",
      "body": "@xuheer thanks for submitting this report.\r\ni see redis crashes while loading an AOF file, can you have a look at that file to see if it looks valid?\r\ncan you check the redis log file to see if there's any interesting line right before the crash log?\r\np.s. this redis is quite old. maybe you can try a newer version of redis on the same AOF file?"
    },
    {
      "id": 752836203,
      "user": "xuheer",
      "created_at": "2020-12-31T04:05:53Z",
      "body": "> @xuheer thanks for submitting this report.\r\n> i see redis crashes while loading an AOF file, can you have a look at that file to see if it looks valid?\r\n> can you check the redis log file to see if there's any interesting line right before the crash log?\r\n> p.s. this redis is quite old. maybe you can try a newer version of redis on the same AOF file?\r\n\r\nthanks , AOF file really go wrong, when i delete and restart, redis goes well\r\n\r\nit is a good idea to update redis, maybe we will update it in next version.\r\n\r\nthanks"
    }
  ]
}