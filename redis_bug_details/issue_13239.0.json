{
  "issue_number": 13239.0,
  "title": "[BUG]sentinel failed to failover while master was down.[4.0.14]",
  "body": "**Describe the bug**\r\n\r\n\r\n\r\n\r\n**topology:**\r\n10.250.17.68:6379 master\r\n10.250.17.80:6379 slave\r\n10.250.17.68:6380 sentinel \r\n10.250.17.80:6380 sentinel \r\n10.250.17.32:6380 sentinel \r\n\r\nall hosts are virtual machines. host 10.250.17.68 need to be shutdown for maintainance purpose.\r\n\r\n**master 10.250.17.68:6379 exited** \r\n[10.250.17.68-redis-6379]3894:signal-handler (1713937702) Received SIGTERM scheduling shutdown...\r\n[10.250.17.68-redis-6379]3894:M 24 Apr 13:48:22.373 # User requested shutdown...\r\n[10.250.17.68-redis-6379]3894:M 24 Apr 13:48:22.373 * Calling fsync() on the AOF file.\r\n[10.250.17.68-redis-6379]3894:M 24 Apr 13:48:22.373 # Redis is now ready to exit, bye bye...\r\n\r\n\r\n**sentinel 10.250.17.68:6379 exited** \r\n[10.250.17.68-redis-seintiel-6380]3980:signal-handler (1713937702) Received SIGTERM scheduling shutdown...\r\n[10.250.17.68-redis-seintiel-6380]3980:X 24 Apr 13:48:22.379 # User requested shutdown...\r\n[10.250.17.68-redis-seintiel-6380]3980:X 24 Apr 13:48:22.379 # Sentinel is now ready to exit, bye bye...\r\n\r\n\r\n**sentinel 10.250.17.32:6380 marked master as sdown at  13:48:42.51**\r\n[10.250.17.32-redis-sentinel]3812:X 24 Apr 13:48:42.518 # +sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.32-redis-sentinel]3812:X 24 Apr 13:48:42.518 # +sdown sentinel 723cccee8b0adf35a3669c17f698ab8e4968c46a 10.250.17.68 6380 @ sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.32-redis-sentinel]\r\n[10.250.17.32-redis-sentinel]\r\n[10.250.17.32-redis-sentinel]3812:X 24 Apr 13:53:42.571 # +new-epoch 1\r\n[10.250.17.32-redis-sentinel]3812:X 24 Apr 13:53:42.572 # +vote-for-leader 7c484ccb1655219c36b98d86887fcbdf29ede55f 1\r\n[10.250.17.32-redis-sentinel]3812:X 24 Apr 13:53:43.513 # +odown master sentinel-10.250.17.68-6379 10.250.17.68 6379 #quorum 2/2\r\n\r\n**sentinel 10.250.17.80:6380 repeatedly marked master +sdown and -sdown, and marked master as odown at 13:53:42.567**\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:48:22.533 # +sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:48:23.469 # -sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:48:23.527 # +sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:48:24.500 # -sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:48:42.504 # +sdown sentinel 723cccee8b0adf35a3669c17f698ab8e4968c46a 10.250.17.68 6380 @ sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:53:42.505 # +sdown master sentinel-10.250.17.68-6379 10.250.17.68 6379\r\n[10.250.17.80-redis-sentinel]3860:X 24 Apr 13:53:42.567 # +odown master sentinel-10.250.17.68-6379 10.250.17.68 6379 #quorum 2/2\r\n\r\n**questions:**\r\n1.why did 10.250.17.80:6380 first mark master +sdown at  13:48:22.533 while down-after-milliseconds is 20000?  Master exited at 13:48:22.373. The earliest time for 10.250.17.80:6380 to mark master as down should be 13:48:42.373?\r\n\r\n2.why did 10.250.17.80:6380 repeatedly mark master +sdown and -sdown?\r\n\r\n3.Why did 10.250.17.80:6380 only confirm the master as odown at 13:53:42.567? By this time, it had been 5 minutes since the master went down. Host 10.250.17.68 completed its restart at 13:53:42.\r\n\r\n\r\n\r\n\r\n**To reproduce**\r\n\r\nfailed to reproduce\r\n\r\n**Expected behavior**\r\n\r\nto failover successfully\r\n\r\n**Additional information**\r\n\r\nAny additional information that is relevant to the problem.\r\n",
  "state": "open",
  "created_at": "2024-04-30T09:18:15Z",
  "updated_at": "2024-04-30T09:18:15Z",
  "closed_at": null,
  "labels": [],
  "comments_data": []
}