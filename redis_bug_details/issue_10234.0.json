{
  "issue_number": 10234.0,
  "title": "[CRASH] Out Of Memory allocating 16400 bytes!  redis_version: 6.2.6",
  "body": "**Crash report**\r\nRedis 5.0.7 start to crush 2 times a day.\r\n\r\nNo clue what is the problem.\r\n\r\nReal dedicated server with Ubuntu 20.04.3 LTS and redis_version:5.0.7\r\n\r\nDo any one have any solution for this problem?\r\n\r\n\r\n```\r\nOut Of Memory allocating 16400 bytes!\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n735991:M 04 Feb 2022 12:05:24.303 # ------------------------------------------------\r\n735991:M 04 Feb 2022 12:05:24.303 # !!! Software Failure. Press left mouse button to continue\r\n735991:M 04 Feb 2022 12:05:24.303 # Guru Meditation: Redis aborting for OUT OF MEMORY #server.c:3925\r\n735991:M 04 Feb 2022 12:05:24.303 # (forcing SIGSEGV in order to print the stack trace)\r\n735991:M 04 Feb 2022 12:05:24.303 # ------------------------------------------------\r\n735991:M 04 Feb 2022 12:05:24.303 # Redis 5.0.7 crashed by signal: 11\r\n735991:M 04 Feb 2022 12:05:24.303 # Crashed running the instruction at: 0x5573e0abf1d8\r\n735991:M 04 Feb 2022 12:05:24.303 # Accessing address: 0xffffffffffffffff\r\n735991:M 04 Feb 2022 12:05:24.303 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/bin/redis-server 127.0.0.1:6379(_serverPanic+0x148)[0x5573e0abf1d8]\r\n\r\nBacktrace:\r\n/usr/bin/redis-server 127.0.0.1:6379(logStackTrace+0x4f)[0x5573e0ac13af]\r\n/usr/bin/redis-server 127.0.0.1:6379(sigsegvHandler+0xb5)[0x5573e0ac1bb5]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x153c0)[0x7fd878a593c0]\r\n/usr/bin/redis-server 127.0.0.1:6379(_serverPanic+0x148)[0x5573e0abf1d8]\r\n/usr/bin/redis-server 127.0.0.1:6379(redisOutOfMemoryHandler+0x3a)[0x5573e0a7733a]\r\n/usr/bin/redis-server 127.0.0.1:6379(zmalloc+0x47)[0x5573e0a81227]\r\n/usr/bin/redis-server 127.0.0.1:6379(+0x406a1)[0x5573e0a886a1]\r\n/usr/bin/redis-server 127.0.0.1:6379(addReplyDouble+0xe4)[0x5573e0a89ef4]\r\n/usr/bin/redis-server 127.0.0.1:6379(zrangeGenericCommand+0x51e)[0x5573e0aaaefe]\r\n/usr/bin/redis-server 127.0.0.1:6379(call+0xaf)[0x5573e0a79b2f]\r\n/usr/bin/redis-server 127.0.0.1:6379(execCommand+0xa0)[0x5573e0abe4c0]\r\n/usr/bin/redis-server 127.0.0.1:6379(call+0xaf)[0x5573e0a79b2f]\r\n/usr/bin/redis-server 127.0.0.1:6379(processCommand+0x556)[0x5573e0a7a436]\r\n/usr/bin/redis-server 127.0.0.1:6379(processInputBuffer+0x171)[0x5573e0a8b0a1]\r\n/usr/bin/redis-server 127.0.0.1:6379(aeProcessEvents+0x112)[0x5573e0a732d2]\r\n/usr/bin/redis-server 127.0.0.1:6379(aeMain+0x2b)[0x5573e0a736fb]\r\n/usr/bin/redis-server 127.0.0.1:6379(main+0x4de)[0x5573e0a6dade]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0x7fd8788790b3]\r\n/usr/bin/redis-server 127.0.0.1:6379(_start+0x2e)[0x5573e0a6dd3e]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:5.0.7\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:636cde3b5c7a3923\r\nredis_mode:standalone\r\nos:Linux 5.4.0-91-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:9.2.1\r\nprocess_id:735991\r\nrun_id:2d1c52d190d781a088b5c5f2fffc11bddfbfec14\r\ntcp_port:6379\r\nuptime_in_seconds:387322\r\nuptime_in_days:4\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:16586372\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\n\r\n# Clients\r\nconnected_clients:12\r\nclient_recent_max_input_buffer:2\r\nclient_recent_max_output_buffer:57739264\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:914899080\r\nused_memory_human:872.52M\r\nused_memory_rss:988934144\r\nused_memory_rss_human:943.12M\r\nused_memory_peak:1018331200\r\nused_memory_peak_human:971.16M\r\nused_memory_peak_perc:89.84%\r\nused_memory_overhead:4830596\r\nused_memory_startup:796240\r\nused_memory_dataset:910068484\r\nused_memory_dataset_perc:99.56%\r\nallocator_allocated:911523528\r\nallocator_active:921133056\r\nallocator_resident:989069312\r\ntotal_system_memory:67335008256\r\ntotal_system_memory_human:62.71G\r\nused_memory_lua:41984\r\nused_memory_lua_human:41.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.01\r\nallocator_frag_bytes:9609528\r\nallocator_rss_ratio:1.07\r\nallocator_rss_bytes:67936256\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:-135168\r\nmem_fragmentation_ratio:1.09\r\nmem_fragmentation_bytes:77643448\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:3967564\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.2.1\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:11618\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1643976309\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:4\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:67022848\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:28\r\ntotal_commands_processed:243415647\r\ninstantaneous_ops_per_sec:606\r\ntotal_net_input_bytes:21289486937\r\ntotal_net_output_bytes:7955222927584\r\ninstantaneous_input_kbps:51.94\r\ninstantaneous_output_kbps:7.75\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:13\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nevicted_keys:0\r\nkeyspace_hits:2308838\r\nkeyspace_misses:562996\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:51304\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:00fec0c5f2f1d8b03259a55e70f9d116be31d893\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:5862.124498\r\nused_cpu_user:25935.504398\r\nused_cpu_sys_children:1969.233247\r\nused_cpu_user_children:21740.043277\r\n\r\n# Commandstats\r\ncmdstat_expire:calls=18216855,usec=12486181,usec_per_call=0.69\r\ncmdstat_scan:calls=5183,usec=1698273,usec_per_call=327.66\r\ncmdstat_zremrangebyrank:calls=66,usec=20,usec_per_call=0.30\r\ncmdstat_zrem:calls=1229,usec=868,usec_per_call=0.71\r\ncmdstat_del:calls=63,usec=82,usec_per_call=1.30\r\ncmdstat_zremrangebyscore:calls=18727742,usec=261476333,usec_per_call=13.96\r\ncmdstat_lpush:calls=18216845,usec=71587895,usec_per_call=3.93\r\ncmdstat_smembers:calls=12896,usec=24079,usec_per_call=1.87\r\ncmdstat_ltrim:calls=18216845,usec=44053712,usec_per_call=2.42\r\ncmdstat_unwatch:calls=19061039,usec=4475704,usec_per_call=0.23\r\ncmdstat_zcard:calls=224529,usec=72024,usec_per_call=0.32\r\ncmdstat_setnx:calls=33,usec=119,usec_per_call=3.61\r\ncmdstat_llen:calls=74843,usec=91836,usec_per_call=1.23\r\ncmdstat_zrangebyscore:calls=648,usec=2175,usec_per_call=3.36\r\ncmdstat_zrevrange:calls=1419118,usec=87614795,usec_per_call=61.74\r\ncmdstat_watch:calls=10,usec=64,usec_per_call=6.40\r\ncmdstat_exec:calls=19061029,usec=24857149394,usec_per_call=1304.08\r\ncmdstat_command:calls=1,usec=546,usec_per_call=546.00\r\ncmdstat_config:calls=4,usec=42,usec_per_call=10.50\r\ncmdstat_zrange:calls=311881,usec=17758756211,usec_per_call=56940.81\r\ncmdstat_lrange:calls=84238,usec=6204684013,usec_per_call=73656.59\r\ncmdstat_info:calls=3,usec=618,usec_per_call=206.00\r\ncmdstat_bgsave:calls=1,usec=48814,usec_per_call=48814.00\r\ncmdstat_multi:calls=19061030,usec=5393238,usec_per_call=0.28\r\ncmdstat_hset:calls=18731519,usec=40855589,usec_per_call=2.18\r\ncmdstat_hsetnx:calls=1176,usec=1936,usec_per_call=1.65\r\ncmdstat_zincrby:calls=10,usec=109,usec_per_call=10.90\r\ncmdstat_exists:calls=84228,usec=186379,usec_per_call=2.21\r\ncmdstat_hincrby:calls=36436402,usec=116822029,usec_per_call=3.21\r\ncmdstat_ping:calls=6,usec=2,usec_per_call=0.33\r\ncmdstat_select:calls=24,usec=5,usec_per_call=0.21\r\ncmdstat_hdel:calls=10,usec=11,usec_per_call=1.10\r\ncmdstat_hgetall:calls=416034,usec=2142105,usec_per_call=5.15\r\ncmdstat_get:calls=1,usec=1,usec_per_call=1.00\r\ncmdstat_client:calls=3,usec=8,usec_per_call=2.67\r\ncmdstat_zadd:calls=54806686,usec=559082513,usec_per_call=10.20\r\ncmdstat_hget:calls=243417,usec=350278,usec_per_call=1.44\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=657,expires=0,avg_ttl=0\r\ndb1:keys=533,expires=73,avg_ttl=138730199\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version - Ubuntu 20.04.3 LTS\r\nCPU: Intel Xeon-E 2388G - 8c/16t - 3.2 GHz/4.6 GHz\r\nMemory: DDR4 64Gb\r\nSSD: 1.92 TB SSD NVMe\r\n",
  "state": "closed",
  "created_at": "2022-02-04T16:06:25Z",
  "updated_at": "2022-10-13T10:05:22Z",
  "closed_at": "2022-10-13T10:05:22Z",
  "labels": [],
  "comments_data": [
    {
      "id": 1030141635,
      "user": "oranagra",
      "created_at": "2022-02-04T16:23:06Z",
      "body": "Looks like redis attempted to allocate some 16kb of memory and got rejected. \r\nI see you have 64gb on the machine, and that redis takes roughly 1gb. Any chance the rest is used? \r\nIs over-commit / swap enabled? "
    },
    {
      "id": 1030146235,
      "user": "AlexSpain",
      "created_at": "2022-02-04T16:28:24Z",
      "body": "> Looks like redis attempted to allocate some 16kb of memory and got rejected. I see you have 64gb on the machine, and that redis takes roughly 1gb. Any chance the rest is used? Is over-commit / swap enabled?\r\n\r\nSystem use 10 GB memory / Total 64Gb\r\nSwap partition use 10Mb / Total 512Mb"
    },
    {
      "id": 1030773367,
      "user": "oranagra",
      "created_at": "2022-02-06T08:05:55Z",
      "body": "@AlexSpain i can't think of anything else, other than maybe memory corruption.\r\ndoes it reproduce? if it does, maybe you can try a more recent version of Redis?"
    },
    {
      "id": 1030859634,
      "user": "AlexSpain",
      "created_at": "2022-02-06T15:50:53Z",
      "body": "> @AlexSpain i can't think of anything else, other than maybe memory corruption. does it reproduce? if it does, maybe you can try a more recent version of Redis?\r\n\r\nIt crash 2 times now. I not have option at Ubuntu 20.04.3 LTS to update redis-server it with apt-get upgrade"
    },
    {
      "id": 1038440801,
      "user": "AlexSpain",
      "created_at": "2022-02-13T21:29:33Z",
      "body": "I update to latest redis_version: 6.2.6\r\nand it crush again\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n863380:M 13 Feb 2022 07:08:23.339 # ------------------------------------------------\r\n863380:M 13 Feb 2022 07:08:23.339 # !!! Software Failure. Press left mouse button to continue\r\n863380:M 13 Feb 2022 07:08:23.339 # Guru Meditation: Redis aborting for OUT OF MEMORY. Allocating 16400 bytes! #server.c:5967\r\n\r\n------ STACK TRACE ------\r\n\r\nBacktrace:\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:557672d61c1e18ba\r\nredis_mode:standalone\r\nos:Linux 5.4.0-91-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:9.3.0\r\nprocess_id:863380\r\nprocess_supervised:systemd\r\nrun_id:d6446aef57022c6765878fc5b733dc973193d668\r\ntcp_port:6379\r\nserver_time_usec:1644736103307240\r\nuptime_in_seconds:235334\r\nuptime_in_days:2\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:568935\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:12\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:48\r\nclient_recent_max_output_buffer:57765936\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:849379576\r\nused_memory_human:810.03M\r\nused_memory_rss:888287232\r\nused_memory_rss_human:847.14M\r\nused_memory_peak:957961024\r\nused_memory_peak_human:913.58M\r\nused_memory_peak_perc:88.67%\r\nused_memory_overhead:1125744\r\nused_memory_startup:810016\r\nused_memory_dataset:848253832\r\nused_memory_dataset_perc:99.96%\r\nallocator_allocated:812953864\r\nallocator_active:818737152\r\nallocator_resident:885293056\r\ntotal_system_memory:67335008256\r\ntotal_system_memory_human:62.71G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.01\r\nallocator_frag_bytes:5783288\r\nallocator_rss_ratio:1.08\r\nallocator_rss_bytes:66555904\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:2994176\r\nmem_fragmentation_ratio:1.09\r\nmem_fragmentation_bytes:75780576\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:246008\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:24149\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1644736069\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:4\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:51036160\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:16\r\ntotal_commands_processed:143569964\r\ninstantaneous_ops_per_sec:649\r\ntotal_net_input_bytes:12521880376\r\ntotal_net_output_bytes:8634990129194\r\ninstantaneous_input_kbps:55.48\r\ninstantaneous_output_kbps:13472.71\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:9\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:7201\r\nevicted_keys:0\r\nkeyspace_hits:2269668\r\nkeyspace_misses:406717\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:52570\r\ntotal_forks:3656\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:360\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:44499240\r\ntotal_writes_processed:149819145\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:571c29093e08c4f23519105cc5db0bd396cef106\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:3302.327321\r\nused_cpu_user:22073.959274\r\nused_cpu_sys_children:1355.464370\r\nused_cpu_user_children:11653.150833\r\nused_cpu_sys_main_thread:3037.410686\r\nused_cpu_user_main_thread:22052.439782\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_unwatch:calls=11336287,usec=2801652,usec_per_call=0.25,rejected_calls=0,failed_calls=0\r\ncmdstat_zadd:calls=31912233,usec=318208277,usec_per_call=9.97,rejected_calls=194,failed_calls=0\r\ncmdstat_zcard:calls=136916,usec=46330,usec_per_call=0.34,rejected_calls=3,failed_calls=0\r\ncmdstat_hget:calls=254326,usec=344090,usec_per_call=1.35,rejected_calls=1,failed_calls=0\r\ncmdstat_client:calls=2,usec=3,usec_per_call=1.50,rejected_calls=0,failed_calls=0\r\ncmdstat_ping:calls=3,usec=0,usec_per_call=0.00,rejected_calls=0,failed_calls=0\r\ncmdstat_smembers:calls=7844,usec=12939,usec_per_call=1.65,rejected_calls=0,failed_calls=0\r\ncmdstat_llen:calls=45638,usec=52129,usec_per_call=1.14,rejected_calls=1,failed_calls=0\r\ncmdstat_del:calls=37,usec=53,usec_per_call=1.43,rejected_calls=0,failed_calls=0\r\ncmdstat_zrangebyscore:calls=394,usec=1370,usec_per_call=3.48,rejected_calls=0,failed_calls=0\r\ncmdstat_scan:calls=3168,usec=471799,usec_per_call=148.93,rejected_calls=0,failed_calls=0\r\ncmdstat_setnx:calls=25,usec=98,usec_per_call=3.92,rejected_calls=0,failed_calls=0\r\ncmdstat_exists:calls=104281,usec=219506,usec_per_call=2.10,rejected_calls=5,failed_calls=0\r\ncmdstat_lpush:calls=10603571,usec=39891705,usec_per_call=3.76,rejected_calls=0,failed_calls=0\r\ncmdstat_bgsave:calls=1,usec=35544,usec_per_call=35544.00,rejected_calls=0,failed_calls=0\r\ncmdstat_hincrby:calls=21208536,usec=45546797,usec_per_call=2.15,rejected_calls=0,failed_calls=0\r\ncmdstat_multi:calls=11336284,usec=2930938,usec_per_call=0.26,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=3,usec=115,usec_per_call=38.33,rejected_calls=0,failed_calls=0\r\ncmdstat_ttl:calls=2,usec=5,usec_per_call=2.50,rejected_calls=0,failed_calls=0\r\ncmdstat_zincrby:calls=4,usec=33,usec_per_call=8.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hset:calls=10916587,usec=15430418,usec_per_call=1.41,rejected_calls=0,failed_calls=0\r\ncmdstat_zrem:calls=599,usec=520,usec_per_call=0.87,rejected_calls=0,failed_calls=0\r\ncmdstat_zrevrange:calls=1249027,usec=50775591,usec_per_call=40.65,rejected_calls=4,failed_calls=0\r\ncmdstat_zremrangebyscore:calls=11032163,usec=118243706,usec_per_call=10.72,rejected_calls=143,failed_calls=0\r\ncmdstat_expire:calls=10603575,usec=7864793,usec_per_call=0.74,rejected_calls=0,failed_calls=0\r\ncmdstat_hdel:calls=4,usec=3,usec_per_call=0.75,rejected_calls=0,failed_calls=0\r\ncmdstat_hsetnx:calls=566,usec=529,usec_per_call=0.93,rejected_calls=0,failed_calls=0\r\ncmdstat_zrange:calls=249716,usec=14365210893,usec_per_call=57526.19,rejected_calls=1,failed_calls=0\r\ncmdstat_ltrim:calls=10603571,usec=20368767,usec_per_call=1.92,rejected_calls=0,failed_calls=0\r\ncmdstat_watch:calls=4,usec=17,usec_per_call=4.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hgetall:calls=523952,usec=2923632,usec_per_call=5.58,rejected_calls=7,failed_calls=0\r\ncmdstat_config:calls=9,usec=83,usec_per_call=9.22,rejected_calls=0,failed_calls=0\r\ncmdstat_get:calls=2,usec=1,usec_per_call=0.50,rejected_calls=0,failed_calls=0\r\ncmdstat_exec:calls=11336283,usec=20586679680,usec_per_call=1816.00,rejected_calls=0,failed_calls=1\r\ncmdstat_select:calls=15,usec=10,usec_per_call=0.67,rejected_calls=0,failed_calls=0\r\ncmdstat_type:calls=2,usec=2,usec_per_call=1.00,rejected_calls=0,failed_calls=0\r\ncmdstat_zremrangebyrank:calls=50,usec=19,usec_per_call=0.38,rejected_calls=0,failed_calls=0\r\ncmdstat_lrange:calls=104284,usec=5762524756,usec_per_call=55258.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_EXECABORT:count=1\r\nerrorstat_LOADING:count=359\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=657,expires=0,avg_ttl=0\r\ndb1:keys=596,expires=90,avg_ttl=111234375\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=7 addr=127.0.0.1:25350 laddr=127.0.0.1:6379 fd=13 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nid=9 addr=127.0.0.1:25356 laddr=127.0.0.1:6379 fd=15 name= age=235334 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=10 addr=127.0.0.1:25370 laddr=127.0.0.1:6379 fd=9 name= age=235333 idle=0 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=11 addr=127.0.0.1:25372 laddr=127.0.0.1:6379 fd=16 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=12 addr=127.0.0.1:25374 laddr=127.0.0.1:6379 fd=17 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=13 addr=127.0.0.1:25376 laddr=127.0.0.1:6379 fd=18 name= age=235333 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=17 addr=127.0.0.1:41736 laddr=127.0.0.1:6379 fd=20 name= age=194064 idle=193974 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=bgsave user=default redir=-1\r\nid=14 addr=127.0.0.1:25518 laddr=127.0.0.1:6379 fd=8 name= age=235309 idle=105 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20528 events=r cmd=zrangebyscore user=default redir=-1\r\nid=4 addr=127.0.0.1:25344 laddr=127.0.0.1:6379 fd=10 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20520 events=r cmd=zremrangebyscore user=default redir=-1\r\nid=5 addr=127.0.0.1:25346 laddr=127.0.0.1:6379 fd=11 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=6 addr=127.0.0.1:25348 laddr=127.0.0.1:6379 fd=12 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\n------ CURRENT CLIENT INFO ------\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n863380:M 13 Feb 2022 07:08:23.340 # Redis 6.2.6 crashed by signal: 6, si_code: -6\r\n863380:M 13 Feb 2022 07:08:23.340 # Killed by PID: 863380, UID: 112\r\n863380:M 13 Feb 2022 07:08:23.340 # Crashed running the instruction at: 0x7f791714918b\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/lib/x86_64-linux-gnu/libc.so.6(gsignal+0xcb)[0x7f791714918b]\r\n\r\nBacktrace:\r\n\r\n------ REGISTERS ------\r\n863380:M 13 Feb 2022 07:08:23.340 # \r\nRAX:0000000000000000 RBX:00007f7916f67000\r\nRCX:00007f791714918b RDX:0000000000000000\r\nRDI:0000000000000002 RSI:00007ffc69265470\r\nRBP:00007ffc69265770 RSP:00007ffc69265470\r\nR8 :0000000000000000 R9 :00007ffc69265470\r\nR10:0000000000000008 R11:0000000000000246\r\nR12:0000000000001000 R13:ffffffffffffffff\r\nR14:00007f78cc38ce1d R15:00007f78f2e3bec0\r\nRIP:00007f791714918b EFL:0000000000000246\r\nCSGSFS:002b000000000033\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547f) -> 00007f79172667c0\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547e) -> 0000000000000001\r\n```"
    },
    {
      "id": 1038655567,
      "user": "AlexSpain",
      "created_at": "2022-02-14T05:19:19Z",
      "body": "Feb 13 07:08:23 ns5007838 redis-server[863380]: libgcc_s.so.1 must be installed for pthread_cancel to work\r\nFeb 13 07:08:23 ns5007838 redis-server[863380]: libgcc_s.so.1 must be installed for pthread_cancel to work\r\nFeb 13 07:08:23 ns5007838 systemd[1]: redis-server.service: Main process exited, code=dumped, status=6/ABRT\r\nFeb 13 07:08:23 ns5007838 systemd[1]: redis-server.service: Failed with result 'core-dump'.\r\nFeb 13 07:08:23 ns5007838 systemd[1]: redis-server.service: Scheduled restart job, restart counter is at 1.\r\nFeb 13 07:08:23 ns5007838 systemd[1]: Stopped Advanced key-value store.\r\nFeb 13 07:08:23 ns5007838 systemd[1]: Starting Advanced key-value store..."
    },
    {
      "id": 1038691951,
      "user": "TomeC",
      "created_at": "2022-02-14T06:19:25Z",
      "body": "You can download the source code and compile it yourself."
    },
    {
      "id": 1038766387,
      "user": "oranagra",
      "created_at": "2022-02-14T07:59:26Z",
      "body": "@yossigo @yoav-steinberg maybe you can think of something i'm missing here.\r\nit fails allocating some 16k, and we see redis is consuming around 1gb and the system has some 64gb."
    },
    {
      "id": 1038809724,
      "user": "yossigo",
      "created_at": "2022-02-14T08:46:17Z",
      "body": "@AlexSpain Can you share the systemd unit file used to start Redis? Is it possible that you specify some systemd-level memory limit?"
    },
    {
      "id": 1038873388,
      "user": "yoav-steinberg",
      "created_at": "2022-02-14T09:47:52Z",
      "body": "@AlexSpain Can you provide more details about the use case? It seems like the crash happens when trying to allocate a new buffer for the output buffer linked list which consists of 16400 byte buffers. This seems to be happening because of a multi-exec transaction which includes lots of commands in it, including a `zrangebyscore` which is attempting to write a score beyond the 16k buffer boundary prompting an allocation of a new buffer. If I could better understand what's happening in that multi-exec I might be able to try to recreate this."
    },
    {
      "id": 1038985089,
      "user": "oranagra",
      "created_at": "2022-02-14T11:40:54Z",
      "body": "@AlexSpain the crash log from redis 6.2.6 is also missing the stack trace, is it a copy paste error? or was it really missing?"
    },
    {
      "id": 1039448182,
      "user": "AlexSpain",
      "created_at": "2022-02-14T19:06:22Z",
      "body": "I report crash log again\r\n```\r\n874543:C 13 Feb 2022 07:05:39.068 * DB saved on disk\r\n874543:C 13 Feb 2022 07:05:39.177 * RDB: 19 MB of memory used by copy-on-write\r\n863380:M 13 Feb 2022 07:05:39.306 * Background saving terminated with success\r\n863380:M 13 Feb 2022 07:06:40.066 * 10000 changes in 60 seconds. Saving...\r\n863380:M 13 Feb 2022 07:06:40.125 * Background saving started by pid 874544\r\n874544:C 13 Feb 2022 07:06:44.146 * DB saved on disk\r\n874544:C 13 Feb 2022 07:06:44.264 * RDB: 68 MB of memory used by copy-on-write\r\n863380:M 13 Feb 2022 07:06:44.405 * Background saving terminated with success\r\n863380:M 13 Feb 2022 07:07:45.000 * 10000 changes in 60 seconds. Saving...\r\n863380:M 13 Feb 2022 07:07:45.053 * Background saving started by pid 874546\r\n874546:C 13 Feb 2022 07:07:49.055 * DB saved on disk\r\n874546:C 13 Feb 2022 07:07:49.163 * RDB: 48 MB of memory used by copy-on-write\r\n863380:M 13 Feb 2022 07:07:49.256 * Background saving terminated with success\r\n863380:M 13 Feb 2022 07:08:23.339 # Out Of Memory allocating 16400 bytes!\r\n\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n863380:M 13 Feb 2022 07:08:23.339 # ------------------------------------------------\r\n863380:M 13 Feb 2022 07:08:23.339 # !!! Software Failure. Press left mouse button to continue\r\n863380:M 13 Feb 2022 07:08:23.339 # Guru Meditation: Redis aborting for OUT OF MEMORY. Allocating 16400 bytes! #server.c:5967\r\n\r\n------ STACK TRACE ------\r\n\r\nBacktrace:\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:557672d61c1e18ba\r\nredis_mode:standalone\r\nos:Linux 5.4.0-91-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:9.3.0\r\nprocess_id:863380\r\nprocess_supervised:systemd\r\nrun_id:d6446aef57022c6765878fc5b733dc973193d668\r\ntcp_port:6379\r\nserver_time_usec:1644736103307240\r\nuptime_in_seconds:235334\r\nuptime_in_days:2\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:568935\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:12\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:48\r\nclient_recent_max_output_buffer:57765936\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:849379576\r\nused_memory_human:810.03M\r\nused_memory_rss:888287232\r\nused_memory_rss_human:847.14M\r\nused_memory_peak:957961024\r\nused_memory_peak_human:913.58M\r\nused_memory_peak_perc:88.67%\r\nused_memory_overhead:1125744\r\nused_memory_startup:810016\r\nused_memory_dataset:848253832\r\nused_memory_dataset_perc:99.96%\r\nallocator_allocated:812953864\r\nallocator_active:818737152\r\nallocator_resident:885293056\r\ntotal_system_memory:67335008256\r\ntotal_system_memory_human:62.71G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.01\r\nallocator_frag_bytes:5783288\r\nallocator_rss_ratio:1.08\r\nallocator_rss_bytes:66555904\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:2994176\r\nmem_fragmentation_ratio:1.09\r\nmem_fragmentation_bytes:75780576\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:246008\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:24149\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1644736069\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:4\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:51036160\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:16\r\ntotal_commands_processed:143569964\r\ninstantaneous_ops_per_sec:649\r\ntotal_net_input_bytes:12521880376\r\ntotal_net_output_bytes:8634990129194\r\ninstantaneous_input_kbps:55.48\r\ninstantaneous_output_kbps:13472.71\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:9\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:7201\r\nevicted_keys:0\r\nkeyspace_hits:2269668\r\nkeyspace_misses:406717\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:52570\r\ntotal_forks:3656\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:360\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:44499240\r\ntotal_writes_processed:149819145\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:571c29093e08c4f23519105cc5db0bd396cef106\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:3302.327321\r\nused_cpu_user:22073.959274\r\nused_cpu_sys_children:1355.464370\r\nused_cpu_user_children:11653.150833\r\nused_cpu_sys_main_thread:3037.410686\r\nused_cpu_user_main_thread:22052.439782\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_unwatch:calls=11336287,usec=2801652,usec_per_call=0.25,rejected_calls=0,failed_calls=0\r\ncmdstat_zadd:calls=31912233,usec=318208277,usec_per_call=9.97,rejected_calls=194,failed_calls=0\r\ncmdstat_zcard:calls=136916,usec=46330,usec_per_call=0.34,rejected_calls=3,failed_calls=0\r\ncmdstat_hget:calls=254326,usec=344090,usec_per_call=1.35,rejected_calls=1,failed_calls=0\r\ncmdstat_client:calls=2,usec=3,usec_per_call=1.50,rejected_calls=0,failed_calls=0\r\ncmdstat_ping:calls=3,usec=0,usec_per_call=0.00,rejected_calls=0,failed_calls=0\r\ncmdstat_smembers:calls=7844,usec=12939,usec_per_call=1.65,rejected_calls=0,failed_calls=0\r\ncmdstat_llen:calls=45638,usec=52129,usec_per_call=1.14,rejected_calls=1,failed_calls=0\r\ncmdstat_del:calls=37,usec=53,usec_per_call=1.43,rejected_calls=0,failed_calls=0\r\ncmdstat_zrangebyscore:calls=394,usec=1370,usec_per_call=3.48,rejected_calls=0,failed_calls=0\r\ncmdstat_scan:calls=3168,usec=471799,usec_per_call=148.93,rejected_calls=0,failed_calls=0\r\ncmdstat_setnx:calls=25,usec=98,usec_per_call=3.92,rejected_calls=0,failed_calls=0\r\ncmdstat_exists:calls=104281,usec=219506,usec_per_call=2.10,rejected_calls=5,failed_calls=0\r\ncmdstat_lpush:calls=10603571,usec=39891705,usec_per_call=3.76,rejected_calls=0,failed_calls=0\r\ncmdstat_bgsave:calls=1,usec=35544,usec_per_call=35544.00,rejected_calls=0,failed_calls=0\r\ncmdstat_hincrby:calls=21208536,usec=45546797,usec_per_call=2.15,rejected_calls=0,failed_calls=0\r\ncmdstat_multi:calls=11336284,usec=2930938,usec_per_call=0.26,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=3,usec=115,usec_per_call=38.33,rejected_calls=0,failed_calls=0\r\ncmdstat_ttl:calls=2,usec=5,usec_per_call=2.50,rejected_calls=0,failed_calls=0\r\ncmdstat_zincrby:calls=4,usec=33,usec_per_call=8.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hset:calls=10916587,usec=15430418,usec_per_call=1.41,rejected_calls=0,failed_calls=0\r\ncmdstat_zrem:calls=599,usec=520,usec_per_call=0.87,rejected_calls=0,failed_calls=0\r\ncmdstat_zrevrange:calls=1249027,usec=50775591,usec_per_call=40.65,rejected_calls=4,failed_calls=0\r\ncmdstat_zremrangebyscore:calls=11032163,usec=118243706,usec_per_call=10.72,rejected_calls=143,failed_calls=0\r\ncmdstat_expire:calls=10603575,usec=7864793,usec_per_call=0.74,rejected_calls=0,failed_calls=0\r\ncmdstat_hdel:calls=4,usec=3,usec_per_call=0.75,rejected_calls=0,failed_calls=0\r\ncmdstat_hsetnx:calls=566,usec=529,usec_per_call=0.93,rejected_calls=0,failed_calls=0\r\ncmdstat_zrange:calls=249716,usec=14365210893,usec_per_call=57526.19,rejected_calls=1,failed_calls=0\r\ncmdstat_ltrim:calls=10603571,usec=20368767,usec_per_call=1.92,rejected_calls=0,failed_calls=0\r\ncmdstat_watch:calls=4,usec=17,usec_per_call=4.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hgetall:calls=523952,usec=2923632,usec_per_call=5.58,rejected_calls=7,failed_calls=0\r\ncmdstat_config:calls=9,usec=83,usec_per_call=9.22,rejected_calls=0,failed_calls=0\r\ncmdstat_get:calls=2,usec=1,usec_per_call=0.50,rejected_calls=0,failed_calls=0\r\ncmdstat_exec:calls=11336283,usec=20586679680,usec_per_call=1816.00,rejected_calls=0,failed_calls=1\r\ncmdstat_select:calls=15,usec=10,usec_per_call=0.67,rejected_calls=0,failed_calls=0\r\ncmdstat_type:calls=2,usec=2,usec_per_call=1.00,rejected_calls=0,failed_calls=0\r\ncmdstat_zremrangebyrank:calls=50,usec=19,usec_per_call=0.38,rejected_calls=0,failed_calls=0\r\ncmdstat_lrange:calls=104284,usec=5762524756,usec_per_call=55258.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_EXECABORT:count=1\r\nerrorstat_LOADING:count=359\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=657,expires=0,avg_ttl=0\r\ndb1:keys=596,expires=90,avg_ttl=111234375\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=7 addr=127.0.0.1:25350 laddr=127.0.0.1:6379 fd=13 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nid=9 addr=127.0.0.1:25356 laddr=127.0.0.1:6379 fd=15 name= age=235334 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=10 addr=127.0.0.1:25370 laddr=127.0.0.1:6379 fd=9 name= age=235333 idle=0 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=11 addr=127.0.0.1:25372 laddr=127.0.0.1:6379 fd=16 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=12 addr=127.0.0.1:25374 laddr=127.0.0.1:6379 fd=17 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=13 addr=127.0.0.1:25376 laddr=127.0.0.1:6379 fd=18 name= age=235333 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=17 addr=127.0.0.1:41736 laddr=127.0.0.1:6379 fd=20 name= age=194064 idle=193974 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=bgsave user=default redir=-1\r\nid=14 addr=127.0.0.1:25518 laddr=127.0.0.1:6379 fd=8 name= age=235309 idle=105 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20528 events=r cmd=zrangebyscore user=default redir=-1\r\nid=4 addr=127.0.0.1:25344 laddr=127.0.0.1:6379 fd=10 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20520 events=r cmd=zremrangebyscore user=default redir=-1\r\nid=5 addr=127.0.0.1:25346 laddr=127.0.0.1:6379 fd=11 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=6 addr=127.0.0.1:25348 laddr=127.0.0.1:6379 fd=12 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nargv[0]: 'LRANGE'\r\nargv[1]: 'users:data'\r\nargv[2]: '0'\r\nargv[3]: '1176000'\r\n863380:M 13 Feb 2022 07:08:23.340 # key 'users:data' found in DB containing the following object:\r\n863380:M 13 Feb 2022 07:08:23.340 # Object type: 1\r\n863380:M 13 Feb 2022 07:08:23.340 # Object encoding: 9\r\n863380:M 13 Feb 2022 07:08:23.340 # Object refcount: 1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n863380:M 13 Feb 2022 07:08:23.340 # Redis 6.2.6 crashed by signal: 6, si_code: -6\r\n863380:M 13 Feb 2022 07:08:23.340 # Killed by PID: 863380, UID: 112\r\n863380:M 13 Feb 2022 07:08:23.340 # Crashed running the instruction at: 0x7f791714918b\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/lib/x86_64-linux-gnu/libc.so.6(gsignal+0xcb)[0x7f791714918b]\r\n\r\nBacktrace:\r\n\r\n------ REGISTERS ------\r\n863380:M 13 Feb 2022 07:08:23.340 # \r\nRAX:0000000000000000 RBX:00007f7916f67000\r\nRCX:00007f791714918b RDX:0000000000000000\r\nRDI:0000000000000002 RSI:00007ffc69265470\r\nRBP:00007ffc69265770 RSP:00007ffc69265470\r\nR8 :0000000000000000 R9 :00007ffc69265470\r\nR10:0000000000000008 R11:0000000000000246\r\nR12:0000000000001000 R13:ffffffffffffffff\r\nR14:00007f78cc38ce1d R15:00007f78f2e3bec0\r\nRIP:00007f791714918b EFL:0000000000000246\r\nCSGSFS:002b000000000033\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547f) -> 00007f79172667c0\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547e) -> 0000000000000001\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547d) -> 00007f78d5452005\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547c) -> 00007f7916a09c5b\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547b) -> 0000000000000005\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc6926547a) -> 0000008000000010\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265479) -> 0000562291a8755f\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265478) -> 00007f78d5452000\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265477) -> 00007ffc69265510\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265476) -> 0000000000000001\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265475) -> e8a273d1fd93c500\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265474) -> 00000000000002f2\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265473) -> 00007ffc69265510\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265472) -> 00007ffc6926577e\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265471) -> e8a273d1fd93c500\r\n863380:M 13 Feb 2022 07:08:23.340 # (00007ffc69265470) -> 0000000000000000\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.6\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:557672d61c1e18ba\r\nredis_mode:standalone\r\nos:Linux 5.4.0-91-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:9.3.0\r\nprocess_id:863380\r\nprocess_supervised:systemd\r\nrun_id:d6446aef57022c6765878fc5b733dc973193d668\r\ntcp_port:6379\r\nserver_time_usec:1644736103307240\r\nuptime_in_seconds:235334\r\nuptime_in_days:2\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:568935\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:12\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:48\r\nclient_recent_max_output_buffer:57765936\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:849379792\r\nused_memory_human:810.03M\r\nused_memory_rss:888287232\r\nused_memory_rss_human:847.14M\r\nused_memory_peak:957961024\r\nused_memory_peak_human:913.58M\r\nused_memory_peak_perc:88.67%\r\nused_memory_overhead:1125744\r\nused_memory_startup:810016\r\nused_memory_dataset:848254048\r\nused_memory_dataset_perc:99.96%\r\nallocator_allocated:812953864\r\nallocator_active:818737152\r\nallocator_resident:885293056\r\ntotal_system_memory:67335008256\r\ntotal_system_memory_human:62.71G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nused_memory_scripts:0\r\nused_memory_scripts_human:0B\r\nnumber_of_cached_scripts:0\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.01\r\nallocator_frag_bytes:5783288\r\nallocator_rss_ratio:1.08\r\nallocator_rss_bytes:66555904\r\nrss_overhead_ratio:1.00\r\nrss_overhead_bytes:2994176\r\nmem_fragmentation_ratio:1.09\r\nmem_fragmentation_bytes:75780576\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:246008\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:24149\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1644736069\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:4\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:51036160\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:16\r\ntotal_commands_processed:143569964\r\ninstantaneous_ops_per_sec:649\r\ntotal_net_input_bytes:12521880376\r\ntotal_net_output_bytes:8634990129194\r\ninstantaneous_input_kbps:55.48\r\ninstantaneous_output_kbps:13472.71\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:9\r\nexpired_stale_perc:0.00\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:7201\r\nevicted_keys:0\r\nkeyspace_hits:2269668\r\nkeyspace_misses:406717\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:52570\r\ntotal_forks:3656\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:360\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:44499240\r\ntotal_writes_processed:149819145\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:571c29093e08c4f23519105cc5db0bd396cef106\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:3302.327353\r\nused_cpu_user:22073.959488\r\nused_cpu_sys_children:1355.464370\r\nused_cpu_user_children:11653.150833\r\nused_cpu_sys_main_thread:3037.410716\r\nused_cpu_user_main_thread:22052.439998\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_unwatch:calls=11336287,usec=2801652,usec_per_call=0.25,rejected_calls=0,failed_calls=0\r\ncmdstat_zadd:calls=31912233,usec=318208277,usec_per_call=9.97,rejected_calls=194,failed_calls=0\r\ncmdstat_zcard:calls=136916,usec=46330,usec_per_call=0.34,rejected_calls=3,failed_calls=0\r\ncmdstat_hget:calls=254326,usec=344090,usec_per_call=1.35,rejected_calls=1,failed_calls=0\r\ncmdstat_client:calls=2,usec=3,usec_per_call=1.50,rejected_calls=0,failed_calls=0\r\ncmdstat_ping:calls=3,usec=0,usec_per_call=0.00,rejected_calls=0,failed_calls=0\r\ncmdstat_smembers:calls=7844,usec=12939,usec_per_call=1.65,rejected_calls=0,failed_calls=0\r\ncmdstat_llen:calls=45638,usec=52129,usec_per_call=1.14,rejected_calls=1,failed_calls=0\r\ncmdstat_del:calls=37,usec=53,usec_per_call=1.43,rejected_calls=0,failed_calls=0\r\ncmdstat_zrangebyscore:calls=394,usec=1370,usec_per_call=3.48,rejected_calls=0,failed_calls=0\r\ncmdstat_scan:calls=3168,usec=471799,usec_per_call=148.93,rejected_calls=0,failed_calls=0\r\ncmdstat_setnx:calls=25,usec=98,usec_per_call=3.92,rejected_calls=0,failed_calls=0\r\ncmdstat_exists:calls=104281,usec=219506,usec_per_call=2.10,rejected_calls=5,failed_calls=0\r\ncmdstat_lpush:calls=10603571,usec=39891705,usec_per_call=3.76,rejected_calls=0,failed_calls=0\r\ncmdstat_bgsave:calls=1,usec=35544,usec_per_call=35544.00,rejected_calls=0,failed_calls=0\r\ncmdstat_hincrby:calls=21208536,usec=45546797,usec_per_call=2.15,rejected_calls=0,failed_calls=0\r\ncmdstat_multi:calls=11336284,usec=2930938,usec_per_call=0.26,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=3,usec=115,usec_per_call=38.33,rejected_calls=0,failed_calls=0\r\ncmdstat_ttl:calls=2,usec=5,usec_per_call=2.50,rejected_calls=0,failed_calls=0\r\ncmdstat_zincrby:calls=4,usec=33,usec_per_call=8.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hset:calls=10916587,usec=15430418,usec_per_call=1.41,rejected_calls=0,failed_calls=0\r\ncmdstat_zrem:calls=599,usec=520,usec_per_call=0.87,rejected_calls=0,failed_calls=0\r\ncmdstat_zrevrange:calls=1249027,usec=50775591,usec_per_call=40.65,rejected_calls=4,failed_calls=0\r\ncmdstat_zremrangebyscore:calls=11032163,usec=118243706,usec_per_call=10.72,rejected_calls=143,failed_calls=0\r\ncmdstat_expire:calls=10603575,usec=7864793,usec_per_call=0.74,rejected_calls=0,failed_calls=0\r\ncmdstat_hdel:calls=4,usec=3,usec_per_call=0.75,rejected_calls=0,failed_calls=0\r\ncmdstat_hsetnx:calls=566,usec=529,usec_per_call=0.93,rejected_calls=0,failed_calls=0\r\ncmdstat_zrange:calls=249716,usec=14365210893,usec_per_call=57526.19,rejected_calls=1,failed_calls=0\r\ncmdstat_ltrim:calls=10603571,usec=20368767,usec_per_call=1.92,rejected_calls=0,failed_calls=0\r\ncmdstat_watch:calls=4,usec=17,usec_per_call=4.25,rejected_calls=0,failed_calls=0\r\ncmdstat_hgetall:calls=523952,usec=2923632,usec_per_call=5.58,rejected_calls=7,failed_calls=0\r\ncmdstat_config:calls=9,usec=83,usec_per_call=9.22,rejected_calls=0,failed_calls=0\r\ncmdstat_get:calls=2,usec=1,usec_per_call=0.50,rejected_calls=0,failed_calls=0\r\ncmdstat_exec:calls=11336283,usec=20586679680,usec_per_call=1816.00,rejected_calls=0,failed_calls=1\r\ncmdstat_select:calls=15,usec=10,usec_per_call=0.67,rejected_calls=0,failed_calls=0\r\ncmdstat_type:calls=2,usec=2,usec_per_call=1.00,rejected_calls=0,failed_calls=0\r\ncmdstat_zremrangebyrank:calls=50,usec=19,usec_per_call=0.38,rejected_calls=0,failed_calls=0\r\ncmdstat_lrange:calls=104284,usec=5762524756,usec_per_call=55258.00,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_EXECABORT:count=1\r\nerrorstat_LOADING:count=359\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=657,expires=0,avg_ttl=0\r\ndb1:keys=596,expires=90,avg_ttl=111234375\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=7 addr=127.0.0.1:25350 laddr=127.0.0.1:6379 fd=13 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nid=9 addr=127.0.0.1:25356 laddr=127.0.0.1:6379 fd=15 name= age=235334 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=10 addr=127.0.0.1:25370 laddr=127.0.0.1:6379 fd=9 name= age=235333 idle=0 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=11 addr=127.0.0.1:25372 laddr=127.0.0.1:6379 fd=16 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=12 addr=127.0.0.1:25374 laddr=127.0.0.1:6379 fd=17 name= age=235333 idle=1 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=13 addr=127.0.0.1:25376 laddr=127.0.0.1:6379 fd=18 name= age=235333 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=17 addr=127.0.0.1:41736 laddr=127.0.0.1:6379 fd=20 name= age=194064 idle=193974 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=bgsave user=default redir=-1\r\nid=14 addr=127.0.0.1:25518 laddr=127.0.0.1:6379 fd=8 name= age=235309 idle=105 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20528 events=r cmd=zrangebyscore user=default redir=-1\r\nid=4 addr=127.0.0.1:25344 laddr=127.0.0.1:6379 fd=10 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20520 events=r cmd=zremrangebyscore user=default redir=-1\r\nid=5 addr=127.0.0.1:25346 laddr=127.0.0.1:6379 fd=11 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\nid=6 addr=127.0.0.1:25348 laddr=127.0.0.1:6379 fd=12 name= age=235334 idle=12 flags=N db=1 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 argv-mem=0 obl=0 oll=0 omem=0 tot-mem=20496 events=r cmd=unwatch user=default redir=-1\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nargv[0]: 'LRANGE'\r\nargv[1]: 'users:data'\r\nargv[2]: '0'\r\nargv[3]: '1176000'\r\n863380:M 13 Feb 2022 07:08:23.340 # key 'users:data' found in DB containing the following object:\r\n863380:M 13 Feb 2022 07:08:23.340 # Object type: 1\r\n863380:M 13 Feb 2022 07:08:23.340 # Object encoding: 9\r\n863380:M 13 Feb 2022 07:08:23.340 # Object refcount: 1\r\n\r\n------ MODULES INFO OUTPUT ------\r\n\r\n------ FAST MEMORY TEST ------\r\n874559:C 13 Feb 2022 07:08:23.684 * Supervised by systemd. Please make sure you set appropriate values for TimeoutStartSec and TimeoutStopSec in your service unit.\r\n```"
    },
    {
      "id": 1039454729,
      "user": "AlexSpain",
      "created_at": "2022-02-14T19:12:30Z",
      "body": "@yossigo \r\n> Can you share the systemd unit file used to start Redis? Is it possible that you specify some systemd-level memory limit?\r\n\r\n```\r\n[Unit]\r\nDescription=Advanced key-value store\r\nAfter=network.target\r\nDocumentation=http://redis.io/documentation, man:redis-server(1)\r\n\r\n[Service]\r\nType=notify\r\nExecStart=/usr/bin/redis-server /etc/redis/redis.conf\r\nExecStop=/bin/kill -s TERM $MAINPID\r\nPIDFile=/run/redis/redis-server.pid\r\nTimeoutStopSec=0\r\nRestart=always\r\nUser=redis\r\nGroup=redis\r\nRuntimeDirectory=redis\r\nRuntimeDirectoryMode=2755\r\n\r\nUMask=007\r\nPrivateTmp=yes\r\nLimitNOFILE=65535\r\nPrivateDevices=yes\r\nProtectHome=yes\r\nReadOnlyDirectories=/\r\nReadWriteDirectories=-/var/lib/redis\r\nReadWriteDirectories=-/var/log/redis\r\nReadWriteDirectories=-/run/redis\r\n\r\nNoNewPrivileges=true\r\nCapabilityBoundingSet=CAP_SETGID CAP_SETUID CAP_SYS_RESOURCE\r\nRestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX\r\nMemoryDenyWriteExecute=true\r\nProtectKernelModules=true\r\nProtectKernelTunables=true\r\nProtectControlGroups=true\r\nRestrictRealtime=true\r\nRestrictNamespaces=true\r\n\r\n# redis-server can write to its own config file when in cluster mode so we\r\n# permit writing there by default. If you are not using this feature, it is\r\n# recommended that you replace the following lines with \"ProtectSystem=full\".\r\nProtectSystem=true\r\nReadWriteDirectories=-/etc/redis\r\n\r\n[Install]\r\nWantedBy=multi-user.target\r\nAlias=redis.service`\r\n```"
    },
    {
      "id": 1039774562,
      "user": "sundb",
      "created_at": "2022-02-15T02:08:56Z",
      "body": "The last crash was caused by `lrange users:data 0 1176000`, what is the size of this key?\r\nIt is odd, why the average request time of `lrange` is 55ms.\r\nIs it possible that the OOM is caused by a corrupted `ziplist`? ~~`used_memory` is not updated during the execution of commands.~~\r\n\r\n```\r\ncmdstat_lrange:calls=104284,usec=5762524756,usec_per_call=55258.00,rejected_calls=0,failed_calls=0\r\n```\r\n\r\n@AlexSpain Can you change config `sanitize-dump-payload` to `yes` and restart redis again?"
    },
    {
      "id": 1039879359,
      "user": "oranagra",
      "created_at": "2022-02-15T05:38:37Z",
      "body": "@sundb what do you mean by \r\n> `used_memory` is not updated during the execution of commands. \r\n\r\nThe crash report should be up to date with the latest allocations. \r\n\r\nLooking at the recent crash reports, they don't contain stack trace, which is very odd. "
    },
    {
      "id": 1039883570,
      "user": "sundb",
      "created_at": "2022-02-15T05:47:55Z",
      "body": "@oranagra Silly me, take back what I said."
    },
    {
      "id": 1040004723,
      "user": "AlexSpain",
      "created_at": "2022-02-15T08:41:54Z",
      "body": "> The last crash was caused by `lrange users:data 0 1176000`, what is the size of this key?\r\n> It is odd, why the average request time of `lrange` is 55ms.\r\n\r\nDEBUG OBJECT users:data\r\nValue at:0x7f9292a490a0 refcount:1 encoding:quicklist serializedlength:15001524 lru:748983 lru_seconds_idle:0 ql_nodes:6358 ql_avg_node:184.96 ql_ziplist_max:-2 ql_compressed:0 ql_uncompressed_size:51813982\r\n\r\nMEMORY USAGE users:data\r\n42627942"
    },
    {
      "id": 1040026585,
      "user": "sundb",
      "created_at": "2022-02-15T09:06:53Z",
      "body": "@AlexSpain I wonder why the encoding of `users.data` is not `quicklist`, but `skiplist`, which is shown as `list` in the crash log."
    },
    {
      "id": 1040030995,
      "user": "AlexSpain",
      "created_at": "2022-02-15T09:11:14Z",
      "body": "> @AlexSpain I wonder why the encoding of `users.data` is not `quicklist`, but `skiplist`, which is shown as `list` in the crash log.\r\n\r\nSorry, I copy stats from my home redis what is not production one, I edit post with info from production server\r\n"
    },
    {
      "id": 1040031696,
      "user": "oranagra",
      "created_at": "2022-02-15T09:11:56Z",
      "body": "to clarify, it seems the key was a **list** type and is now a **sorted set**"
    },
    {
      "id": 1040068879,
      "user": "yoav-steinberg",
      "created_at": "2022-02-15T09:51:00Z",
      "body": "Some things to note:\r\nThe crash always seems to happen while executing an `EXEC`. Also I noticed there are always 7 commands in the multi-exec transaction. Also the crash always happens when there are 1800 elements in the reply buffer list and we're trying to allocate another one.\r\n@AlexSpain Can you try to pinpoint where in your app you have a multi-exec transaction with 7 commands in it? What are the other commands other than `lrange`?"
    },
    {
      "id": 1040102418,
      "user": "AlexSpain",
      "created_at": "2022-02-15T10:24:40Z",
      "body": "tx.LPush(r.formatKey(\"user:data\"), login)\r\ntx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)\r\ntx.HIncrBy(r.formatKey(\"info\", \"rCurrent\"), login, dinf)\r\ntx.ZAdd(r.formatKey(\"data2\"), redis.Z{Score: float64(ts), Member: join(dinf, login, id, ms, dinf, hostname)})\r\ntx.ZAdd(r.formatKey(\"data2\", login), redis.Z{Score: float64(ts), Member: join(dinf, id, ms, dinf, hostname)})\r\ntx.Expire(r.formatKey(\"data2\", login), expire)\r\ntx.HSet(r.formatKey(\"peoples\", login), \"lastTime\", strconv.FormatInt(ts, 10))\r\n\r\nSame code work at Ubuntu 16.04 (2 years without any restart) with old redis (redis_version:5.0.7) without any crash."
    },
    {
      "id": 1040196603,
      "user": "yoav-steinberg",
      "created_at": "2022-02-15T12:08:29Z",
      "body": "Hmm.. that's strange, no transaction with access to the `user:data` key and/or using the `lrange` or `zrange` commands? Because it seems that those were being used during a 7 command transaction during the crash."
    },
    {
      "id": 1040285893,
      "user": "AlexSpain",
      "created_at": "2022-02-15T13:39:09Z",
      "body": "@yoav-steinberg first two commands \r\ntx.LPush(r.formatKey(\"user:data\"), login)\r\ntx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)"
    },
    {
      "id": 1041314578,
      "user": "yoav-steinberg",
      "created_at": "2022-02-16T10:00:54Z",
      "body": "@oranagra Looking at this, from the crash log it seems like we're inside a transaction (`exec`) but the `argv` array shows an `lrange` command. From what I see in the code this debug print should have printed the `argv` of the `exec` command. \r\nI suspect there's some corruption here. \r\nAlso looking at the output size `omem` it seems like we weren't processing the transaction but actually the `lrange` command. @AlexSpain provided the transaction code above and there's nothing there that I'd expect to produce a ~37MB reply, while `lrange` for over a million items can easily produce this.\r\n```\r\n------ CURRENT CLIENT INFO ------\r\nid=8 addr=127.0.0.1:25354 laddr=127.0.0.1:6379 fd=14 name= age=235334 idle=0 flags=x db=1 sub=0 psub=0 multi=7 qbuf=681 qbuf-free=40273 argv-mem=4 obl=205 oll=1800 omem=36907200 tot-mem=36968676 events=r cmd=exec user=default redir=-1\r\nargv[0]: 'LRANGE'\r\nargv[1]: 'users:data'\r\nargv[2]: '0'\r\nargv[3]: '1176000'\r\n863380:M 13 Feb 2022 07:08:23.340 # key 'users:data' found in DB containing the following object:\r\n863380:M 13 Feb 2022 07:08:23.340 # Object type: 1\r\n863380:M 13 Feb 2022 07:08:23.340 # Object encoding: 9\r\n863380:M 13 Feb 2022 07:08:23.340 # Object refcount: 1\r\n```"
    },
    {
      "id": 1041346750,
      "user": "AlexSpain",
      "created_at": "2022-02-16T10:37:47Z",
      "body": "@yoav-steinberg what I need to do for stop redis to crash? It crash today again, same error same log"
    },
    {
      "id": 1041538743,
      "user": "oranagra",
      "created_at": "2022-02-16T14:18:59Z",
      "body": "@AlexSpain please try to enable `sanitize-dump-payload` and restart as suggested [here](https://github.com/redis/redis/issues/10234#issuecomment-1039774562).\r\nif there's some corruption of the data that could lead to corruption of memory, maybe this can smoke it out..."
    },
    {
      "id": 1042696125,
      "user": "yoav-steinberg",
      "created_at": "2022-02-17T08:34:51Z",
      "body": "@AlexSpain Are you sure there's no call to `lrange` on `user:data` inside some transaction? Can you take a look and if you find it paste the transaction code here like you did before?\r\n\r\nAlso how did you build your redis 5.0.7 and 6.2.6? Are you using your own build or Ubuntu's deb? Are you using a deb from the distro's standard repository or some other ppa? If you use a custom build can you sent your build command line?"
    },
    {
      "id": 1042701802,
      "user": "oranagra",
      "created_at": "2022-02-17T08:42:10Z",
      "body": "I see that the Redis 5.0 crash you posted was using jemalloc-5.2.1 (latest jemalloc, that's not part of redis 5.0).\r\nand the Redis 6.2 crash you posted was using jemalloc-5.1.0 (which was indeed bundled in redis 6.2).\r\nthe only explanation i can think of here, is that for some reason the allocator returned NULL even though the system has a lot of memory. this could maybe happen when the allocator's memory got corrupted.\r\n\r\n"
    },
    {
      "id": 1042705192,
      "user": "yossigo",
      "created_at": "2022-02-17T08:46:11Z",
      "body": "@oranagra I assume this is because Redis 5.0.7 comes bundled with Ubuntu, which builds Redis to use the system jemalloc (following official Debian policy), and Redis 6.2.6 was built locally."
    },
    {
      "id": 1043001607,
      "user": "AlexSpain",
      "created_at": "2022-02-17T14:22:10Z",
      "body": "@yoav-steinberg \r\n> @AlexSpain Are you sure there's no call to `lrange` on `user:data` inside some transaction? Can you take a look and if you find it paste the transaction code here like you did before?\r\n>\r\nthis code run around 7000 times per minute\r\n\r\n\ttx.LPush(r.formatKey(\"user:data\"), login)\r\n\ttx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)\r\n\ttx.HIncrBy(r.formatKey(\"info\", \"rCurrent\"), login, dinf)\r\n\ttx.ZAdd(r.formatKey(\"data2\"), redis.Z{Score: float64(ts), Member: join(dinf, login, id, ms, dinf, hostname)})\r\n\ttx.ZAdd(r.formatKey(\"data2\", login), redis.Z{Score: float64(ts), Member: join(dinf, id, ms, dinf, hostname)})\r\n\ttx.Expire(r.formatKey(\"data2\", login), expire)\r\n\ttx.HSet(r.formatKey(\"peoples\", login), \"lastTime\", strconv.FormatInt(ts, 10))\r\n\r\ncode run every 5 seconds\r\n\r\n\ttx := r.client.Multi()\r\n\tdefer tx.Close()\r\n\t\r\n\tcmds, err := tx.Exec(func() error {\r\n\t\ttx.HGetAllMap(r.formatKey(\"peoples\", login))\r\n\t\ttx.ZRevRangeWithScores(r.formatKey(\"payments\", login), 0, maxPayments-1)\r\n\t\ttx.HGet(r.formatKey(\"paymentsTotal\"), login)\r\n\t\ttx.HGet(r.formatKey(\"info\", \"currentS\"), login)\r\n\t\ttx.LRange(r.formatKey(\"user:data\"), 0, r.sized)\r\n\t\ttx.ZRevRangeWithScores(r.formatKey(\"rewards\", login), 0, 39)\r\n\t\ttx.ZRevRangeWithScores(r.formatKey(\"rewards\", login), 0, -1)\r\n\t})\r\n\r\n code run 2-5 times a day\r\n\r\n\tms := util.MakeTimestamp()\r\n\tcmds, err := tx.Exec(func() error {\r\n\t\tr.writeS(tx, ms, ts, login, id, dinf, window, hostname)\r\n\t\ttx.HSet(r.formatKey(\"stats\"), \"lastBF\", strconv.FormatInt(ts, 10))\r\n\t\ttx.HDel(r.formatKey(\"stats\"), \"roundS\")\r\n\t\ttx.ZIncrBy(r.formatKey(\"finders\"), 1, login)\r\n\t\ttx.HIncrBy(r.formatKey(\"peoples\", login), \"bFound\", 1)\r\n\t\ttx.HGetAllMap(r.formatKey(\"info\", \"rCurrent\"))\r\n\t\ttx.Del(r.formatKey(\"info\", \"rCurrent\"))\r\n\t\ttx.LRange(r.formatKey(\"user:data\"), 0, r.sized)\r\n\t\treturn nil\r\n\t})\r\n\t\r\n\r\n> Also how did you build your redis 5.0.7 and 6.2.6? Are you using your own build or Ubuntu's deb? Are you using a deb from the distro's standard repository or some other ppa? If you use a custom build can you sent your build command line?\r\nIs how I install Redis 6.2.6 to Ubuntu 20.04 what have before default Redis 5.0.7 comes bundled with Ubuntu\r\n\r\n`$ curl https://packages.redis.io/gpg | sudo apt-key add -`\r\n`$ echo \"deb https://packages.redis.io/deb $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/redis.list`\r\n`$ sudo apt-get update`\r\n`$ sudo apt-get install redis`"
    },
    {
      "id": 1043605280,
      "user": "AlexSpain",
      "created_at": "2022-02-17T23:17:51Z",
      "body": "Is can be what it crash because\r\ntx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)\r\nand\r\ntx.LRange(r.formatKey(\"user:data\"), 0, r.sized)\r\n\r\nrun same time?"
    },
    {
      "id": 1044345114,
      "user": "oranagra",
      "created_at": "2022-02-18T11:03:50Z",
      "body": "they're not running at the same time, just as part of the same transaction, which is very similar to just running them in a pipeline one after the other. i don't see how this could cause any issue."
    },
    {
      "id": 1044786666,
      "user": "AlexSpain",
      "created_at": "2022-02-18T16:24:05Z",
      "body": "> they're not running at the same time, just as part of the same transaction, which is very similar to just running them in a pipeline one after the other. i don't see how this could cause any issue.\r\n\r\n@oranagra they run in parallel in two different applications with same Redis DB\r\napp one\r\nrun around 7000 times per minute\r\ntx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)\r\n\r\napp two\r\nrun every 5 seconds\r\ntx.LRange(r.formatKey(\"user:data\"), 0, r.sized)"
    },
    {
      "id": 1044983745,
      "user": "oranagra",
      "created_at": "2022-02-18T18:37:23Z",
      "body": "ok, but Redis is single threaded, and processes a single command (or transaction) at a time. so whichever comes first will be served first, not at the same time.\r\nanyway, that's not the the trigger to this crash.\r\n\r\nsince i'm out of ideas, if this is non-production, or you have a way to reproduce this in a staging environment, maybe you can give redis 7.0 RC1 a try (maybe we'll be lucky and in some way it'll be manifested differently there and we'll be able to figure it out)"
    },
    {
      "id": 1046830707,
      "user": "AlexSpain",
      "created_at": "2022-02-21T12:34:22Z",
      "body": "I make some research\r\nI change timing to run scripts to make less call to redis per min\r\nthis code run around 5000 times per minute\r\n\r\ntx.LPush(r.formatKey(\"user:data\"), login)\r\ntx.LTrim(r.formatKey(\"user:data\"), 0, r.sized)\r\ntx.HIncrBy(r.formatKey(\"info\", \"rCurrent\"), login, dinf)\r\ntx.ZAdd(r.formatKey(\"data2\"), redis.Z{Score: float64(ts), Member: join(dinf, login, id, ms, dinf, hostname)})\r\ntx.ZAdd(r.formatKey(\"data2\", login), redis.Z{Score: float64(ts), Member: join(dinf, id, ms, dinf, hostname)})\r\ntx.Expire(r.formatKey(\"data2\", login), expire)\r\ntx.HSet(r.formatKey(\"peoples\", login), \"lastTime\", strconv.FormatInt(ts, 10))\r\n\r\nredis stop to crash every 24 hours, now it crash every 2 days"
    },
    {
      "id": 1053612573,
      "user": "AlexSpain",
      "created_at": "2022-02-27T16:49:12Z",
      "body": "> sanitize-dump-payload\r\n\r\n26 at 17:00 I change sanitize-dump-payload  to yes and restart redis .\r\n24 hours without crash.\r\nWaiting more days"
    },
    {
      "id": 1055415927,
      "user": "oranagra",
      "created_at": "2022-03-01T12:57:30Z",
      "body": "@AlexSpain please follow the discussion in https://github.com/redis/redis/issues/10319, this could be due to `vm.max_map_count`, please try to increase it and see if the problem is gone."
    },
    {
      "id": 1057005948,
      "user": "AlexSpain",
      "created_at": "2022-03-02T14:42:27Z",
      "body": "> @AlexSpain please follow the discussion in #10319, this could be due to `vm.max_map_count`, please try to increase it and see if the problem is gone.\r\n\r\ncat /proc/sys/vm/max_map_count\r\n65530\r\n\r\nWhat number I can write? ```sysctl -w vm.max_map_count=262144``` is ok to test?"
    },
    {
      "id": 1057019835,
      "user": "oranagra",
      "created_at": "2022-03-02T14:54:44Z",
      "body": "i suppose so... don't have any experience with what."
    },
    {
      "id": 1060070525,
      "user": "AlexSpain",
      "created_at": "2022-03-07T00:07:06Z",
      "body": "After I apply `sysctl -w vm.max_map_count=262144` and restart redis, redis server not crash 5 days."
    },
    {
      "id": 1060825745,
      "user": "yossigo",
      "created_at": "2022-03-07T15:41:56Z",
      "body": "Interesting! So assuming this is really the issue, I think we still don't have an answer to why this has started to happen all of a sudden and how come it does not affect many systems. I'd expect this to either be directly affected by jemalloc, or by anything else that loads into the process (other shared libs, maybe `LD_PRELOAD`, etc.)."
    },
    {
      "id": 1261966203,
      "user": "kletord",
      "created_at": "2022-09-29T08:47:29Z",
      "body": "I encounter this error on a Redis 5.0.14 with jemalloc 5.1.0. Redis running out of memory due to a virtual memory map exhaustion. \r\n\r\nI found the root cause to be https://github.com/jemalloc/jemalloc/issues/1328, after changing the vm.overcommit to 0 and restart the redis process, everything was stable again. "
    },
    {
      "id": 1262219388,
      "user": "oranagra",
      "created_at": "2022-09-29T12:39:44Z",
      "body": "very interesting... but Redis cannot usually afford to run without overcommit (forks will fail if you're close to your system resources).\r\ni wonder what causes some (relatively small) deployments to hit this problem, while others (bigger ones) don't."
    },
    {
      "id": 1269959418,
      "user": "oranagra",
      "created_at": "2022-10-06T12:33:53Z",
      "body": "ohh, i now realize the problem with jemalloc causing fragmented mapping is when overcommit is **disabled** (not when enabled).\r\n\r\n@kletord you said that setting it to 0 (heuristic) solved it, can you confirm it previously set to 2 (disabled, which isn't really suitable for redis)?\r\n\r\ncan everyone else who reported this problem please report the value of `/proc/sys/vm/overcommit_memory` and try to set it to 1 to solve the problem."
    }
  ]
}