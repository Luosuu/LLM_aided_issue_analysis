{
  "issue_number": 13137.0,
  "title": "[CRASH] Redis 6.2.7 crashed by signal: 11, si_code: 128",
  "body": "**Crash report**\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n928:M 14 Mar 2024 05:10:17.979 # Redis 6.2.7 crashed by signal: 11, si_code: 128\r\n928:M 14 Mar 2024 05:10:17.979 # Accessing address: (nil)\r\n928:M 14 Mar 2024 05:10:17.979 # Crashed running the instruction at: 0x55dae6e57a64\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/usr/bin/redis-server *:6379(sdsAllocSize+0x4)[0x55dae6e57a64]\r\n\r\nBacktrace:\r\n/lib64/libpthread.so.0(+0x141d0)[0x7f8b4ba6e1d0]\r\n/usr/bin/redis-server *:6379(sdsAllocSize+0x4)[0x55dae6e57a64]\r\n/usr/bin/redis-server *:6379(clientsCronResizeQueryBuffer+0x11)[0x55dae6e4d571]\r\n/usr/bin/redis-server *:6379(clientsCron+0xcf)[0x55dae6e4d8bf]\r\n/usr/bin/redis-server *:6379(serverCron+0x15d)[0x55dae6e5689d]\r\n/usr/bin/redis-server *:6379(aeProcessEvents+0x12d)[0x55dae6e48a5d]\r\n/usr/bin/redis-server *:6379(aeMain+0x1d)[0x55dae6e48e9d]\r\n/usr/bin/redis-server *:6379(main+0x337)[0x55dae6e45517]\r\n/lib64/libc.so.6(__libc_start_main+0xf2)[0x7f8b4b462a72]\r\n/usr/bin/redis-server *:6379(_start+0x2e)[0x55dae6e45a5e]\r\n\r\n------ REGISTERS ------\r\n928:M 14 Mar 2024 05:10:17.980 #\r\nRAX:0000000000000000 RBX:00007f8b3a8d4280\r\nRCX:0000000000000000 RDX:00007f8b3a99c320\r\nRDI:0500090100030002 RSI:0000018e39a6d27b\r\nRBP:000055dae7014da0 RSP:00007fff6e36a308\r\nR8 :0000000000000010 R9 :0000000000000000\r\nR10:0000000002fd7eb0 R11:000055dae6fc40c0\r\nR12:0000018e39a6d27b R13:0000000000000001\r\nR14:00007f8b3a8d4280 R15:0000000000000000\r\nRIP:000055dae6e57a64 EFL:0000000000010246\r\nCSGSFS:002b000000000033\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a317) -> 0000000000000001\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a316) -> 0000000000000001\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a315) -> 00007fff6e36a3b0\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a314) -> 00007f8b4ae230a0\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a313) -> 00007fff6e3f2a87\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a312) -> 159dd1c100000000\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a311) -> 0000000000000000\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a310) -> 000055dae6e5689d\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30f) -> 0000000000000001\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30e) -> 0000000000000001\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30d) -> 000000000df82c91\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30c) -> 000000002b11252b\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30b) -> 000055dae7014da0\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a30a) -> 000055dae6e4d8bf\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a309) -> 000000000000000b\r\n928:M 14 Mar 2024 05:10:17.980 # (00007fff6e36a308) -> 000055dae6e4d571\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:6.2.7\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:b61ed404cacc6c27\r\nredis_mode:standalone\r\nos:Linux 5.10.134-16.al8.x86_64 x86_64\r\narch_bits:64\r\nmonotonic_clock:POSIX clock_gettime\r\nmultiplexing_api:epoll\r\natomicvar_api:c11-builtin\r\ngcc_version:10.2.1\r\nprocess_id:928\r\nprocess_supervised:systemd\r\nrun_id:30afb8da835f31aea9e148b8e4c7163bfef6fac7\r\ntcp_port:6379\r\nserver_time_usec:1710364217979570\r\nuptime_in_seconds:25131\r\nuptime_in_days:0\r\nhz:10\r\nconfigured_hz:10\r\nlru_clock:15865401\r\nexecutable:/usr/bin/redis-server\r\nconfig_file:/etc/redis.conf\r\nio_threads_active:0\r\n\r\n# Clients\r\nconnected_clients:226\r\ncluster_connections:0\r\nmaxclients:10000\r\nclient_recent_max_input_buffer:56\r\nclient_recent_max_output_buffer:15620604899393263920\r\nblocked_clients:0\r\ntracking_clients:0\r\nclients_in_timeout_table:0\r\n\r\n# Memory\r\nused_memory:10228296\r\nused_memory_human:9.75M\r\nused_memory_rss:22315008\r\nused_memory_rss_human:21.28M\r\nused_memory_peak:17536984\r\nused_memory_peak_human:16.72M\r\nused_memory_peak_perc:58.32%\r\nused_memory_overhead:3196599359611562144\r\nused_memory_startup:812112\r\nused_memory_dataset:15250144714108217768\r\nused_memory_dataset_perc:161956740726784.00%\r\nallocator_allocated:10643808\r\nallocator_active:12763136\r\nallocator_resident:21626880\r\ntotal_system_memory:32844468224\r\ntotal_system_memory_human:30.59G\r\nused_memory_lua:36864\r\nused_memory_lua_human:36.00K\r\nused_memory_scripts:1344\r\nused_memory_scripts_human:1.31K\r\nnumber_of_cached_scripts:4\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nallocator_frag_ratio:1.20\r\nallocator_frag_bytes:2119328\r\nallocator_rss_ratio:1.69\r\nallocator_rss_bytes:8863744\r\nrss_overhead_ratio:1.03\r\nrss_overhead_bytes:688128\r\nmem_fragmentation_ratio:2.18\r\nmem_fragmentation_bytes:12088504\r\nmem_not_counted_for_evict:0\r\nmem_replication_backlog:0\r\nmem_clients_slaves:0\r\nmem_clients_normal:3196599359608774096\r\nmem_aof_buffer:0\r\nmem_allocator:jemalloc-5.1.0\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\nlazyfreed_objects:0\r\n\r\n# Persistence\r\nloading:0\r\ncurrent_cow_size:0\r\ncurrent_cow_size_age:0\r\ncurrent_fork_perc:0.00\r\ncurrent_save_keys_processed:0\r\ncurrent_save_keys_total:0\r\nrdb_changes_since_last_save:402\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1710364069\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:0\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:749568\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nmodule_fork_in_progress:0\r\nmodule_fork_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:25090\r\ntotal_commands_processed:2712691\r\ninstantaneous_ops_per_sec:31\r\ntotal_net_input_bytes:234368145\r\ntotal_net_output_bytes:722543915\r\ninstantaneous_input_kbps:0.85\r\ninstantaneous_output_kbps:2.35\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:24989\r\nexpired_stale_perc:0.41\r\nexpired_time_cap_reached_count:0\r\nexpire_cycle_cpu_milliseconds:1109\r\nevicted_keys:0\r\nkeyspace_hits:381132\r\nkeyspace_misses:129591\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:443\r\ntotal_forks:83\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\ntracking_total_keys:0\r\ntracking_total_items:0\r\ntracking_total_prefixes:0\r\nunexpected_error_replies:0\r\ntotal_error_replies:120527\r\ndump_payload_sanitizations:0\r\ntotal_reads_processed:2733415\r\ntotal_writes_processed:2709074\r\nio_threaded_reads_processed:0\r\nio_threaded_writes_processed:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_failover_state:no-failover\r\nmaster_replid:7ef692ab0b1ca1beabc84fd45b2f680e3865f1ad\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:34.274030\r\nused_cpu_user:46.890963\r\nused_cpu_sys_children:0.338626\r\nused_cpu_user_children:2.697668\r\nused_cpu_sys_main_thread:34.140946\r\nused_cpu_user_main_thread:46.806058\r\n\r\n# Modules\r\n\r\n# Commandstats\r\ncmdstat_psetex:calls=48525,usec=287200,usec_per_call=5.92,rejected_calls=0,failed_calls=0\r\ncmdstat_auth:calls=902,usec=3944,usec_per_call=4.37,rejected_calls=0,failed_calls=0\r\ncmdstat_lrem:calls=360,usec=2561,usec_per_call=7.11,rejected_calls=0,failed_calls=0\r\ncmdstat_rpush:calls=705,usec=4233,usec_per_call=6.00,rejected_calls=0,failed_calls=0\r\ncmdstat_subscribe:calls=0,usec=0,usec_per_call=0.00,rejected_calls=24187,failed_calls=0\r\ncmdstat_ping:calls=250609,usec=160721,usec_per_call=0.64,rejected_calls=23779,failed_calls=0\r\ncmdstat_publish:calls=3913,usec=3656,usec_per_call=0.93,rejected_calls=24186,failed_calls=0\r\ncmdstat_exists:calls=41800,usec=62376,usec_per_call=1.49,rejected_calls=0,failed_calls=0\r\ncmdstat_del:calls=35850,usec=111341,usec_per_call=3.11,rejected_calls=0,failed_calls=0\r\ncmdstat_llen:calls=37200,usec=62764,usec_per_call=1.69,rejected_calls=0,failed_calls=0\r\ncmdstat_client:calls=0,usec=0,usec_per_call=0.00,rejected_calls=24188,failed_calls=0\r\ncmdstat_pexpire:calls=13606,usec=25953,usec_per_call=1.91,rejected_calls=0,failed_calls=0\r\ncmdstat_scan:calls=1804958,usec=11959132,usec_per_call=6.63,rejected_calls=0,failed_calls=0\r\ncmdstat_incr:calls=1900,usec=9648,usec_per_call=5.08,rejected_calls=0,failed_calls=0\r\ncmdstat_sismember:calls=1563,usec=3389,usec_per_call=2.17,rejected_calls=0,failed_calls=0\r\ncmdstat_get:calls=426247,usec=1485158,usec_per_call=3.48,rejected_calls=0,failed_calls=0\r\ncmdstat_incrby:calls=7402,usec=22589,usec_per_call=3.05,rejected_calls=0,failed_calls=0\r\ncmdstat_info:calls=0,usec=0,usec_per_call=0.00,rejected_calls=24187,failed_calls=0\r\ncmdstat_hincrby:calls=7826,usec=37670,usec_per_call=4.81,rejected_calls=0,failed_calls=0\r\ncmdstat_sadd:calls=4,usec=136,usec_per_call=34.00,rejected_calls=0,failed_calls=0\r\ncmdstat_hexists:calls=3913,usec=14625,usec_per_call=3.74,rejected_calls=0,failed_calls=0\r\ncmdstat_eval:calls=25055,usec=779315,usec_per_call=31.10,rejected_calls=0,failed_calls=0\r\ncmdstat_lpop:calls=353,usec=3064,usec_per_call=8.68,rejected_calls=0,failed_calls=0\r\n\r\n# Errorstats\r\nerrorstat_NOAUTH:count=120527\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=22661,expires=22661,avg_ttl=1558842669\r\n\r\n\r\n\r\n```\r\n```\r\n\r\n**Additional information**\r\n\r\n1. OS distribution and version\r\nLinux version 5.10.134-16.al8.x86_64 (mockbuild@a12i03132.na61) (gcc (GCC) 10.2.1 20200825 (Alibaba 10.2.1-3.5 2.32), GNU ld version 2.35-12.2.al8) #1 SMP Thu Nov 16 05:08:49 UTC 2023\r\n\r\n3. Steps to reproduce (if any)\r\n",
  "state": "open",
  "created_at": "2024-03-14T03:06:36Z",
  "updated_at": "2024-03-15T04:33:20Z",
  "closed_at": null,
  "labels": [],
  "comments_data": [
    {
      "id": 1996323136,
      "user": "sundb",
      "created_at": "2024-03-14T03:29:06Z",
      "body": "~~seems related to #12924.~~\r\nEDIT: not included\r\n@wangbin77 do you have any specific configs?"
    },
    {
      "id": 1996649616,
      "user": "wangbin77",
      "created_at": "2024-03-14T06:50:25Z",
      "body": "> seems related to #12924. @wangbin77 do you have any specific configs?\r\n\r\nNo, I only set the auth password"
    },
    {
      "id": 1998866210,
      "user": "sundb",
      "created_at": "2024-03-15T03:17:03Z",
      "body": "@wangbin77 ~~Could you share that what size your command is almost? Are there any commands over 32k? ~~\r\nThe following memory infos are all overflowing, they are all related to the user, and I'm guessing that one of the user's client structures has been corrupted.\r\n`client_recent_max_output_buffer`\r\n`used_memory_overhead`\r\n`mem_clients_normal`\r\n\r\nCould you give the fully crash report? I saw that the client info following `Keyspace` are not provided. thanks.\r\n"
    }
  ]
}