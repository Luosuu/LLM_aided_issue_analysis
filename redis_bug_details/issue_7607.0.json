{
  "issue_number": 7607.0,
  "title": "[BUG] \"make test\" fails with [exception]: Executing test client: tail: + 28: No such file or directory.",
  "body": "VERSION: 6.0.6\r\nDESCRIPTION: Post-build automated testing fails with error.\r\nREPRODUCTION: run `make test`\r\nEXPECTATION: Success.\r\n\r\nThis is in reference to the now-closed #7605 issue.\r\n\r\nMy version of macOS comes with `tclsh` 8.5.9\r\nI used MacPorts to install 8.6.10 then re-ran `make test`\r\nI now have some fresh errors:\r\n```\r\n. . .\r\n[ok]: Detect write load to master\r\n[ok]: Test replication partial resync: no backlog (diskless: yes, disabled, reconnect: 1)\r\n[ok]: Check for memory leaks (pid 43538)\r\n[ok]: Check for memory leaks (pid 43520)\r\n[ok]: Master stream is correctly processed while the replica has a script in -BUSY state\r\n[ok]: Check for memory leaks (pid 43128)\r\n[ok]: Check for memory leaks (pid 43118)\r\n[ok]: Slave should be able to synchronize with the master\r\n[ok]: Detect write load to master\r\n[ok]: slave fails full sync and diskless load swapdb recovers it\r\n\r\nLogged warnings (pid 44327):\r\n(none)\r\n\r\n\r\nLogged warnings (pid 44327):\r\n(none)\r\n\r\n[exception]: Executing test client: tail: +      28: No such file or directory.\r\ntail: +      28: No such file or directory\r\n    while executing\r\n\"exec tail +$from_line < $stdout\"\r\n    (procedure \"wait_for_log_message\" line 5)\r\n    invoked from within\r\n\"wait_for_log_message -1 \"*Loading DB in memory*\" $loglines 2000 1\"\r\n    (\"uplevel\" body line 43)\r\n    invoked from within\r\n\"uplevel 1 $code \"\r\n    (procedure \"start_server\" line 3)\r\n    invoked from within\r\n\"start_server {} {\r\n            set master [srv 0 client]\r\n            set master_host [srv 0 host]\r\n            set master_port [srv 0 port]\r\n\r\n           ...\"\r\n    (\"uplevel\" body line 5)\r\n    invoked from within\r\n\"uplevel 1 $code \"\r\n    (procedure \"start_server\" line 3)\r\n    invoked from within\r\n\"start_server {tags {\"repl\"}} {\r\n        set replica [srv 0 client]\r\n        set replica_host [srv 0 host]\r\n        set replica_port [srv 0 port]\r\n        ...\"\r\n    (\"uplevel\" body line 2)\r\n    invoked from within\r\n\"uplevel 1 $code\"\r\n    (procedure \"test\" line 47)\r\n    invoked from within\r\n\"test {diskless loading short read} {\r\n    start_server {tags {\"repl\"}} {\r\n        set replica [srv 0 client]\r\n        set replica_host [srv 0 host]\r\n     ...\"\r\n    (file \"tests/integration/replication.tcl\" line 396)\r\n    invoked from within\r\n\"source $path\"\r\n    (procedure \"execute_test_file\" line 4)\r\n    invoked from within\r\n\"execute_test_file $data\"\r\n    (procedure \"test_client_main\" line 10)\r\n    invoked from within\r\n\"test_client_main $::test_server_port \"\r\nKilling still running Redis server 37614\r\nKilling still running Redis server 37621\r\nKilling still running Redis server 37629\r\nKilling still running Redis server 38460\r\nKilling still running Redis server 38926\r\nKilling still running Redis server 44036\r\nKilling still running Redis server 44044\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r type $k\"\r\n    (procedure \"createComplexDataset\" line 27)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 4)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 12)I/O error reading reply\r\n    while executing\r\n\"{*}$r hset $k $f $v\"\r\n    (\"uplevel\" body line 2)\r\n    invoked from within\r\n\"uplevel 1 [lindex $args $path]\"\r\n    (procedure \"randpath\" line 3)\r\n    invoked from within\r\n\"randpath {\r\n                {*}$r set $k $v\r\n            } {\r\n                {*}$r lpush $k $v\r\n            } {\r\n                {*}$r sadd $k $v\r\n        ...\"\r\n    (procedure \"createComplexDataset\" line 30)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 4)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 12)\r\n\r\nKilling still running Redis server 44318\r\nI/O error reading reply\r\n    while executing\r\n\"{*}$r zadd $k $d $v\"\r\n    (\"uplevel\" body line 1)\r\n    invoked from within\r\n\"uplevel 1 [lindex $args $path]\"\r\n    (procedure \"randpath\" line 3)\r\n    invoked from within\r\n\"randpath {{*}$r zadd $k $d $v}  {{*}$r zrem $k $v}  {\r\n                            set otherzset [findKeyWithType {*}$r zset]\r\n                         ...\"\r\n    (procedure \"createComplexDataset\" line 68)\r\n    invoked from within\r\n\"createComplexDataset $r $ops\"\r\n    (procedure \"bg_complex_data\" line 4)\r\n    invoked from within\r\n\"bg_complex_data [lindex $argv 0] [lindex $argv 1] [lindex $argv 2] [lindex $argv 3] [lindex $argv 4]\"\r\n    (file \"tests/helpers/bg_complex_data.tcl\" line 12)\r\nmake[1]: *** [test] Error 1\r\nmake: *** [test] Error 2\r\n$\r\n```",
  "state": "closed",
  "created_at": "2020-08-02T21:41:13Z",
  "updated_at": "2020-08-06T11:49:47Z",
  "closed_at": "2020-08-03T05:34:58Z",
  "labels": [],
  "comments_data": [
    {
      "id": 667812562,
      "user": "oranagra",
      "created_at": "2020-08-03T05:34:51Z",
      "body": "thanks for the report, this is already fixed in unstable by https://github.com/redis/redis/pull/7543"
    },
    {
      "id": 669640234,
      "user": "xiegithub",
      "created_at": "2020-08-06T02:08:28Z",
      "body": "There are still errorsï¼š\r\n\r\n[ok]: Client output buffer soft limit is enforced if time is overreached\r\n[54/56 done]: unit/obuf-limits (134 seconds)\r\n[ok]: Master stream is correctly processed while the replica has a script in -BUSY state\r\n[ok]: Test replication partial resync: ok psync (diskless: yes, swapdb, reconnect: 1)\r\n[ok]: slave fails full sync and diskless load swapdb recovers it\r\n[ok]: Slave should be able to synchronize with the master\r\n[ok]: Detect write load to master\r\n\r\nLogged warnings (pid 1028209):\r\n(none)\r\n\r\n\r\nLogged warnings (pid 1028209):\r\n(none)\r\n\r\n[exception]: Executing test client: tail: cannot open '+30' for reading: No such file or directory.\r\ntail: cannot open '+30' for reading: No such file or directory\r\n    while executing\r\n\"exec tail +$from_line < $stdout\"\r\n    (procedure \"wait_for_log_message\" line 5)\r\n    invoked from within\r\n\"wait_for_log_message -1 \"*Loading DB in memory*\" $loglines 2000 1\"\r\n\r\n"
    },
    {
      "id": 669880438,
      "user": "oranagra",
      "created_at": "2020-08-06T11:49:47Z",
      "body": "@xiegithub this is only resolved in the `unstable` branch."
    }
  ]
}