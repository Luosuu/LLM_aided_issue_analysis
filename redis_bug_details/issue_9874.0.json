{
  "issue_number": 9874.0,
  "title": "[CRASH] redis crash,can not restart",
  "body": "**Crash report**\r\nHi,  we are useing redis of 4.0.2 version . After  redis crash,i try to  restart it, but fail.\r\nThe details is below, thanks.\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n17523:M 29 Nov 09:09:56.275 # === ASSERTION FAILED OBJECT CONTEXT ===\r\n17523:M 29 Nov 09:09:56.275 # Object type: 0\r\n17523:M 29 Nov 09:09:56.275 # Object encoding: 0\r\n17523:M 29 Nov 09:09:56.275 # Object refcount: 1\r\n17523:M 29 Nov 09:09:56.275 # Object raw string len: 0\r\n17523:M 29 Nov 09:09:56.275 # Object raw string content: \"\"\r\n17523:M 29 Nov 09:09:56.275 # === ASSERTION FAILED ===\r\n17523:M 29 Nov 09:09:56.275 # ==> db.c:164 'retval == DICT_OK' is not true\r\n17523:M 29 Nov 09:09:56.275 # (forcing SIGSEGV to print the bug report.)\r\n17523:M 29 Nov 09:09:56.275 # Redis 4.0.2 crashed by signal: 11\r\n17523:M 29 Nov 09:09:56.275 # Accessing address: 0xffffffffffffffff\r\n17523:M 29 Nov 09:09:56.275 # Failed assertion: retval == DICT_OK (db.c:164)\r\n\r\n------ STACK TRACE ------\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(logStackTrace+0x34)[0x4696f4]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(sigsegvHandler+0x88)[0x469dc8]\r\nlinux-vdso.so.1(__kernel_rt_sigreturn+0x0)[0xfffe93580698]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(_serverAssert+0x7c)[0x467a8c]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(dbAdd+0xac)[0x44010c]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(rdbLoadRio+0x238)[0x44a6d0]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(rdbLoad+0x40)[0x44ac10]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(loadDataFromDisk+0x74)[0x42e604]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379(main+0x444)[0x4224c4]\r\n/lib/aarch64-linux-gnu/libc.so.6(__libc_start_main+0xe4)[0xfffe932e0da4]\r\n/home/coremail/libexec/redis-server 10.1.34.90:6379[0x422828]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:4.0.2\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:e6b8ff705c37b8cc\r\nredis_mode:standalone\r\nos:Linux 4.19.0-arm64-server aarch64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\natomicvar_api:atomic-builtin\r\ngcc_version:8.3.0\r\nprocess_id:17523\r\nrun_id:d94ad11e9e6ab322823653422f909a39ec74bb7c\r\ntcp_port:6379\r\nuptime_in_seconds:0\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:10758244\r\nexecutable:/home/coremail/libexec/redis-server\r\nconfig_file:/home/coremail/conf/redis.conf\r\n\r\n# Clients\r\nconnected_clients:0\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:943872\r\nused_memory_human:921.75K\r\nused_memory_rss:0\r\nused_memory_rss_human:0B\r\nused_memory_peak:943872\r\nused_memory_peak_human:921.75K\r\nused_memory_peak_perc:inf%\r\nused_memory_overhead:931064\r\nused_memory_startup:798480\r\nused_memory_dataset:12808\r\nused_memory_dataset_perc:8.81%\r\ntotal_system_memory:68545413120\r\ntotal_system_memory_human:63.84G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:0.00\r\nmem_allocator:jemalloc-4.0.3\r\nactive_defrag_running:0\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:1\r\nrdb_changes_since_last_save:0\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1638148196\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\nloading_start_time:1638148196\r\nloading_total_bytes:3461936\r\nloading_loaded_bytes:0\r\nloading_loaded_perc:0.00\r\nloading_eta_seconds:1\r\n\r\n# Stats\r\ntotal_connections_received:0\r\ntotal_commands_processed:0\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:0\r\ntotal_net_output_bytes:0\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\nslave_expires_tracked_keys:0\r\nactive_defrag_hits:0\r\nactive_defrag_misses:0\r\nactive_defrag_key_hits:0\r\nactive_defrag_key_misses:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_replid:63aef2c7d29f44608f87747464d143bfdadfab04\r\nmaster_replid2:0000000000000000000000000000000000000000\r\nmaster_repl_offset:0\r\nsecond_repl_offset:-1\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:0.00\r\nused_cpu_user:0.01\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=24,expires=23,avg_ttl=0\r\n\r\n------ CLIENT LIST OUTPUT ------\r\n\r\n------ REGISTERS ------\r\n\r\n------ FAST MEMORY TEST ------\r\n17523:M 29 Nov 09:09:56.275 # Bio thread for job type #0 terminated\r\n17523:M 29 Nov 09:09:56.275 # Bio thread for job type #1 terminated\r\n17523:M 29 Nov 09:09:56.275 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 550000 (131072 bytes)\r\n*** Preparing to test memory region 10ba0000 (196608 bytes)\r\n*** Preparing to test memory region fffe90be0000 (8388608 bytes)\r\n*** Preparing to test memory region fffe913f0000 (8388608 bytes)\r\n*** Preparing to test memory region fffe91c00000 (10485760 bytes)\r\n*** Preparing to test memory region fffe93000000 (2097152 bytes)\r\n*** Preparing to test memory region fffe93430000 (65536 bytes)\r\n.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n```\r\n",
  "state": "closed",
  "created_at": "2021-12-01T07:55:45Z",
  "updated_at": "2021-12-01T08:38:08Z",
  "closed_at": "2021-12-01T08:38:08Z",
  "labels": [],
  "comments_data": [
    {
      "id": 983386816,
      "user": "oranagra",
      "created_at": "2021-12-01T08:05:06Z",
      "body": "looks like the RDB contains two keys with the same name for some reason.\r\ndo you have any idea how it happened? was this rdb file a result of simple use of redis commands? do have any clue what could be special in this case?\r\nmaybe you can load this rdb file into redis-rdb-tools or alike and find out the name and type of that key."
    },
    {
      "id": 983409170,
      "user": "leoruns",
      "created_at": "2021-12-01T08:34:48Z",
      "body": "sa already delete the rdb file，i also have no idea now.maybe it happen again，i can do according your suggestion.\r\nthanks for your reply."
    },
    {
      "id": 983411512,
      "user": "oranagra",
      "created_at": "2021-12-01T08:38:08Z",
      "body": "ok, i'm closing this one for now, feel free to re-open if you'll find more info.\r\np.s. i suggest to upgrade, you're using an old version, maybe this problem was already solved."
    }
  ]
}