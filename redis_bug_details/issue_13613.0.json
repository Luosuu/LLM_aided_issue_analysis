{
  "issue_number": 13613.0,
  "title": "[BUG]There is an error on redis:6.0 redis server frequently restart ",
  "body": "**Describe the bug**\r\n\r\n redis server frequently restart\r\n\r\n**To reproduce**\r\n\r\n**Expected behavior**\r\n\r\nNo Redis crash should be\r\n\r\n**Additional information**\r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n3050910:S 22 Oct 2024 08:12:30.218 # Redis 6.0.15 crashed by signal: 11\r\n3050910:S 22 Oct 2024 08:12:30.218 # Crashed running the instruction at: 0x42e7e4\r\n3050910:S 22 Oct 2024 08:12:30.218 # Accessing address: 0x40\r\n3050910:S 22 Oct 2024 08:12:30.218 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n./redis-server *:20407(dictScanCount2+0xe4)[0x42e7e4]\r\n\r\nBacktrace:\r\n./redis-server *:20407(logStackTrace+0x54)[0x479c1c]\r\n./redis-server *:20407(sigsegvHandler+0x98)[0x47a3d8]\r\nlinux-vdso.so.1(__kernel_rt_sigreturn+0x0)[0xfffd525f07c0]\r\n./redis-server *:20407(dictScanCount2+0xe4)[0x42e7e4]\r\n./redis-server *:20407(scanlimitGenericCommand2+0x220)[0x44ba40]\r\n./redis-server *:20407(scanlimitCommand+0x70)[0x44bd70]\r\n./redis-server *:20407(call+0xa4)[0x431e6c]\r\n./redis-server *:20407(processCommand+0x408)[0x432668]\r\n./redis-server *:20407(processInputBuffer+0x14c)[0x442bb4]\r\n./redis-server *:20407(aeProcessEvents+0x13c)[0x42b5ec]\r\n./redis-server *:20407(aeMain+0x30)[0x42ba40]\r\n./redis-server *:20407(main+0x628)[0x428650]\r\n/lib64/libc.so.6(__libc_start_main+0xe0)[0xfffd52303ec0]\r\n./redis-server *:20407[0x4287f8]\r\n\r\n------ INFO OUTPUT ------\r\n# Server^M\r\nredis_version:6.0.15^M\r\nredis_git_sha1:00000000^M\r\nredis_git_dirty:0^M\r\nredis_build_id:aaa43c3c81ae99c^M\r\nredis_mode:standalone^M\r\nos:Linux 4.19.90-2102.2.0.0062.ctl2.aarch64 aarch64^M\r\narch_bits:64^M\r\nmultiplexing_api:epoll^M\r\natomicvar_api:atomic-builtin^M\r\ngcc_version:7.3.0^M\r\nprocess_id:3050910^M\r\nrun_id:a05a8de4857f4cd1b6b49274da37e01c469cb6bc^M\r\ntcp_port:20407^M\r\nuptime_in_seconds:159823^M\r\nuptime_in_days:1^M\r\nhz:10^M\r\nconfigured_hz:10^M\r\nlru_clock:1502702^M\r\nexecutable:/app/ctgcache/cache_apps/redisEntites/redis/src/./redis-server^M\r\nconfig_file:/app/ctgcache/cache_apps/redisEntites/20407/redis20407.conf^M\r\n^M\r\n# Clients^M\r\nconnected_clients:3^M\r\nclient_recent_max_input_buffer:2^M\r\nclient_recent_max_output_buffer:0^M\r\nblocked_clients:0^M\r\n\r\n# Memory^M\r\nused_memory:2594648952^M\r\nused_memory_human:2.42G^M\r\nused_memory_rss:2625830912^M\r\nused_memory_rss_human:2.45G^M\r\nused_memory_peak:2594683456^M\r\nused_memory_peak_human:2.42G^M\r\nused_memory_peak_perc:100.00%^M\r\nused_memory_overhead:374440334^M\r\nused_memory_startup:1030976^M\r\nused_memory_dataset:2220208618^M\r\nused_memory_dataset_perc:85.60%^M\r\nallocator_allocated:2594874136^M\r\nallocator_active:2600206336^M\r\nallocator_resident:2624978944^M\r\ntotal_system_memory:547474309120^M\r\ntotal_system_memory_human:509.88G^M\r\nused_memory_lua:37888^M\r\nused_memory_lua_human:37.00K^M\r\nused_memory_scripts:0^M\r\nused_memory_scripts_human:0B^M\r\nnumber_of_cached_scripts:0^M\r\nmaxmemory:17179869184^M\r\nmaxmemory_human:16.00G^M\r\nmaxmemory_policy:volatile-lru^M\r\nallocator_frag_ratio:1.00^M\r\nallocator_frag_bytes:5332200^M\r\nallocator_rss_ratio:1.01^M\r\nallocator_rss_bytes:24772608^M\r\nrss_overhead_ratio:1.00^M\r\nrss_overhead_bytes:851968^M\r\nmem_fragmentation_ratio:1.01^M\r\nmem_fragmentation_bytes:31232888^M\r\nmem_not_counted_for_evict:0^M\r\nmem_replication_backlog:0^M\r\nmem_clients_slaves:0^M\r\nmem_clients_normal:117198^M\r\nmem_aof_buffer:0^M\r\nmem_allocator:jemalloc-5.1.0^M\r\nactive_defrag_running:0^M\r\nlazyfree_pending_objects:0^M\r\n\r\n# Persistence^M\r\nloading:0^M\r\nrdb_changes_since_last_save:100952^M\r\nrdb_bgsave_in_progress:0^M\r\nrdb_last_save_time:1729555476^M\r\nrdb_last_bgsave_status:ok^M\r\nrdb_last_bgsave_time_sec:21^M\r\nrdb_current_bgsave_time_sec:-1^M\r\nrdb_last_cow_size:0^M\r\naof_enabled:1^M\r\naof_rewrite_in_progress:0^M\r\naof_rewrite_scheduled:0^M\r\naof_last_rewrite_time_sec:-1^M\r\naof_current_rewrite_time_sec:-1^M\r\naof_last_bgrewrite_status:ok^M\r\naof_last_write_status:ok^M\r\naof_last_cow_size:0^M\r\naof_current_size:62356096^M\r\naof_base_size:0^M\r\naof_pending_rewrite:0^M\r\naof_buffer_length:0^M\r\naof_rewrite_buffer_length:0^M\r\naof_pending_bio_fsync:0^M\r\naof_delayed_fsync:0^M\r\n^M\r\n# Stats^M\r\ntotal_connections_received:30532^M\r\ntotal_commands_processed:8429527^M\r\ninstantaneous_ops_per_sec:113^M\r\ntotal_net_input_bytes:9099858613^M\r\ntotal_net_output_bytes:17339489^M\r\ninstantaneous_input_kbps:129.69^M\r\ninstantaneous_output_kbps:0.00^M\r\nrejected_connections:0^M\r\nsync_full:0^M\r\nsync_partial_ok:0^M\r\nsync_partial_err:0^M\r\nexpired_keys:0^M\r\nexpired_stale_perc:0.00^M\r\nexpired_time_cap_reached_count:0^M\r\nevicted_keys:0^M\r\nkeyspace_hits:0^M\r\nkeyspace_misses:0^M\r\npubsub_channels:0^M\r\npubsub_patterns:0^M\r\nlatest_fork_usec:4779^M\r\nmigrate_cached_sockets:0^M\r\nslave_expires_tracked_keys:0^M\r\nactive_defrag_hits:0^M\r\nactive_defrag_misses:0^M\r\nactive_defrag_key_hits:0^M\r\nactive_defrag_key_misses:0^M\r\nshowlog_length:0^M\r\nauth_fail_times:0^M\r\n^M\r\n# Replication^M\r\nrole:slave^M\r\nmaster_host:172.17.2.37^M\r\nmaster_port:20407^M\r\nmaster_link_status:up^M\r\nmaster_last_io_seconds_ago:0^M\r\nmaster_sync_in_progress:0^M\r\nslave_repl_offset:62356096^M\r\nslave_priority:100^M\r\nslave_read_only:1^M\r\nconnected_slaves:0^M\r\n^M\r\n# CPU^M\r\nused_cpu_sys:542.555984^M\r\nused_cpu_user:193.123267^M\r\nused_cpu_sys_children:34.401356^M\r\nused_cpu_user_children:779.451043^M\r\n^M\r\n# Commandstats^M\r\ncmdstat_auth:calls=43849,usec=48264,usec_per_call=1.10,max_usec=25^M\r\ncmdstat_select:calls=60672,usec=30524,usec_per_call=0.50,max_usec=23^M\r\ncmdstat_newsave:calls=2663,usec=3238,usec_per_call=1.22,max_usec=2^M\r\ncmdstat_aoffileend:calls=49,usec=1047,usec_per_call=21.37,max_usec=34^M\r\ncmdstat_detect:calls=2663,usec=54535,usec_per_call=20.48,max_usec=82^M\r\ncmdstat_rdbfilesave:calls=40,usec=41,usec_per_call=1.02,max_usec=2^M\r\ncmdstat_scanlimit:calls=60671,usec=388860,usec_per_call=6.41,max_usec=72^M\r\ncmdstat_config:calls=1,usec=14,usec_per_call=14.00,max_usec=14^M\r\ncmdstat_info:calls=13318,usec=362360,usec_per_call=27.21,max_usec=183^M\r\ncmdstat_ping:calls=10653,usec=3779,usec_per_call=0.35,max_usec=9^M\r\ncmdstat_aoffiletrans:calls=8234948,usec=48668217,usec_per_call=5.91,max_usec=1018^M\r\n^M\r\n# Cluster^M\r\ncluster_enabled:0^M\r\n^M\r\n^M\r\n# Keyspace^M\r\ndb1:keys=4879540,expires=0,avg_ttl=0^M\r\ndb3:keys=9,expires=9,avg_ttl=0^M\r\ndb4:keys=987403,expires=0,avg_ttl=0^M\r\ndb5:keys=2878,expires=0,avg_ttl=0^M\r\ndb21:keys=1154771,expires=0,avg_ttl=0^M\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=6 addr=172.17.2.37:20407 fd=9 name= age=159808 idle=0 flags=M db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=aoffiletrans\r\nid=30396 addr=172.17.2.37:46244 fd=11 name= age=765 idle=0 flags=N db=3 sub=0 psub=0 multi=-1 qbuf=91 qbuf-free=32677 obl=5 oll=0 omem=0 events=r cmd=scanlimit\r\nid=30397 addr=172.17.2.37:46252 fd=12 name= age=765 idle=5 flags=N db=3 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=scanlimit\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=30396 addr=172.17.2.37:46244 fd=11 name= age=765 idle=0 flags=N db=3 sub=0 psub=0 multi=-1 qbuf=91 qbuf-free=32677 obl=5 oll=0 omem=0 events=r cmd=scanlimit\r\nargv[0]: 'SCANLIMIT'\r\nargv[1]: '000'\r\nargv[2]: 'match'\r\nargv[3]: '*'\r\nargv[4]: 'count'\r\nargv[5]: '10000'\r\n\r\n------ REGISTERS ------\r\n\r\n------ FAST MEMORY TEST ------\r\n3050910:S 22 Oct 2024 08:12:30.219 # Bio thread for job type #0 terminated\r\n3050910:S 22 Oct 2024 08:12:30.219 # Bio thread for job type #1 terminated\r\n3050910:S 22 Oct 2024 08:12:30.219 # Bio thread for job type #2 terminated\r\n3050910:S 22 Oct 2024 08:12:30.219 # Bio thread for job type #3 terminated\r\n*** Preparing to test memory region 5c0000 (655360 bytes)\r\n*** Preparing to test memory region fe20000 (196608 bytes)\r\n*** Preparing to test memory region fffc00000000 (1610612736 bytes)\r\n*** Preparing to test memory region fffc70000000 (2415919104 bytes)\r\n*** Preparing to test memory region fffd00000000 (1073741824 bytes)\r\n*** Preparing to test memory region fffd43570000 (8388608 bytes)\r\n*** Preparing to test memory region fffd43d80000 (8388608 bytes)\r\n*** Preparing to test memory region fffd44590000 (8388608 bytes)\r\n*** Preparing to test memory region fffd44da0000 (8388608 bytes)\r\n.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: dictScanCount2 (base: 0x42e700)\r\nModule: ./redis-server *:20407 (base 0x400000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x42e700 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n3050910:S 22 Oct 2024 08:12:52.403 # dump of function (hexdump of 356 bytes):\r\nfd7bb9a9e60300aafd030091e93700fd2900679e011440f9002440f9200000abe00e0054c12840f9b92300f9d9400091a83300fd3f0400b1b55b02a9f60305aa280b40fdb76303a9f80303aab35301a9f70304aaf40302aab50040f9201d280e0000669e02f07dd3000d0054c6c000912001669ebaef04a9e40306aa230740f9c1e840a9bc2f00f91c001a8a7f0001eb80f37dd3680e0054e60319aae00302aaf90304aac10040f9336860f8130100b50a0000141f2003d5e10313aae00316aae0023fd6730a40f9930000b4a01640f91f0014eb23ffff540001669e1b001aca200340f913787cf8d30100b4a01640f99f0200ebc80000540a0000141f2003d5a01640f91f0014ebc2000054e10313aae00316aae0023fd6730a40f933ffffb5201da80e0000669e000400910000679e091ce82e2001669e1f001bea600000541c001a8ae7ffff17baef44a9bc2f40f9281de80ee0e7072fc1008052000480d20200669e\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===\r\n\r\n       Please report the crash by opening an issue on github:\r\n\r\n           http://github.com/antirez/redis/issues\r\n\r\n  Suspect RAM error? Use redis-server --test-memory to verify it.\r\n\r\n",
  "state": "closed",
  "created_at": "2024-10-22T01:10:18Z",
  "updated_at": "2024-10-25T07:31:44Z",
  "closed_at": "2024-10-25T07:31:43Z",
  "labels": [],
  "comments_data": [
    {
      "id": 2428070914,
      "user": "ShooterIT",
      "created_at": "2024-10-22T02:15:48Z",
      "body": "hi @playaround88 do you change the redis code? `scanlimit` seems not a redis built-in command"
    },
    {
      "id": 2437094064,
      "user": "playaround88",
      "created_at": "2024-10-25T07:31:43Z",
      "body": "@ShooterIT Thx! the version is customized. maybe i should seek advice from intercompany."
    }
  ]
}