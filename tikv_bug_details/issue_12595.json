{
  "issue_number": 12595,
  "title": "when enable api v2 , TiDB resolve lock meet error",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n```\r\n[2022/05/20 15:37:26.939 +08:00] [INFO] [lib.rs:79] [\"Welcome to TiKV\"]\r\n[2022/05/20 15:37:26.939 +08:00] [INFO] [lib.rs:84] [\"Release Version:   6.1.0-alpha\"]\r\n[2022/05/20 15:37:26.939 +08:00] [INFO] [lib.rs:84] [\"Edition:           Community\"]\r\n[2022/05/20 15:37:26.940 +08:00] [INFO] [lib.rs:84] [\"Git Commit Hash:   1fb8980ccab9ff40c1adc206df52952dab8e8ad8\"]\r\n[2022/05/20 15:37:26.940 +08:00] [INFO] [lib.rs:84] [\"Git Commit Branch: master\"]\r\n[2022/05/20 15:37:26.940 +08:00] [INFO] [lib.rs:84] [\"UTC Build Time:    Unknown (env var does not exist when building)\"]\r\n[2022/05/20 15:37:26.940 +08:00] [INFO] [lib.rs:84] [\"Rust Version:      rustc 1.60.0-nightly (1e12aef3f 2022-02-13)\"]\r\n[2022/05/20 15:37:26.940 +08:00] [INFO] [lib.rs:84] [\"Enable Features:   jemalloc mem-profiling portable sse test-engine-kv-rocksdb test-engine-raft-raf\r\nt-engine cloud-aws cloud-gcp cloud-azure\"]\r\n```\r\n\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\nCentOS 7.6\r\nIntel(R) Xeon(R) CPU E5-2630 v4 @ 2.20GHz\r\n\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\ntikv configuration is :\r\n```\r\nenable-ttl = true\r\napi-version = 2\r\n```\r\n\r\nand start PD,TiKV,TiDB. wait TiDB to start update safepoint.\r\n\r\n\r\n\r\n### What did you expect?\r\ngc process can execute success.\r\n\r\n\r\n### What did happened?\r\n\r\nTiDB log:\r\n```\r\n[2022/05/20 15:47:34.821 +08:00] [INFO] [range_task.go:281] [\"canceling range task because of error\"] [name=resolve-locks-runner] [\"failed startKey\"=] [\"failed endKey\"=] [error=\"unexpected scanlock error: error:<abort:\\\"Error(InvalidKeyRangeMode { cmd: scan_lock, storage_api_version: V2, range: (None, Some(\\\\\\\"7480000000000000FF0500000000000000F8\\\\\\\")) })\\\" > \"]\r\n[2022/05/20 15:47:34.821 +08:00] [INFO] [range_task.go:204] [\"range task failed\"] [name=resolve-locks-runner] [startKey=] [endKey=] [\"cost time\"=2.182695ms] [error=\"unexpected scanlock error: error:<abort:\\\"Error(InvalidKeyRangeMode { cmd: scan_lock, storage_api_version: V2, range: (None, Some(\\\\\\\"7480000000000000FF0500000000000000F8\\\\\\\")) })\\\" > \"]\r\n[2022/05/20 15:47:34.821 +08:00] [ERROR] [gc_worker.go:1031] [\"[gc worker] resolve locks failed\"] [uuid=6038199f268000a] [safePoint=433332487393902592] [error=\"unexpected scanlock error: error:<abort:\\\"Error(InvalidKeyRangeMode { cmd: scan_lock, storage_api_version: V2, range: (None, Some(\\\\\\\"7480000000000000FF0500000000000000F8\\\\\\\")) })\\\" > \"]\r\n[2022/05/20 15:47:34.821 +08:00] [ERROR] [gc_worker.go:613] [\"[gc worker] resolve locks returns an error\"] [uuid=6038199f268000a] [error=\"unexpected scanlock error: error:<abort:\\\"Error(InvalidKeyRangeMode { cmd: scan_lock, storage_api_version: V2, range: (None, Some(\\\\\\\"7480000000000000FF0500000000000000F8\\\\\\\")) })\\\" > \"]\r\n[2022/05/20 15:47:34.821 +08:00] [ERROR] [gc_worker.go:212] [\"[gc worker] runGCJob\"] [error=\"unexpected scanlock error: error:<abort:\\\"Error(InvalidKeyRangeMode { cmd: scan_lock, storage_api_version: V2, range: (None, Some(\\\\\\\"7480000000000000FF0500000000000000F8\\\\\\\")) })\\\" > \"]\r\n\r\n\r\n```\r\n",
  "state": "closed",
  "created_at": "2022-05-20T07:55:46Z",
  "updated_at": "2022-05-24T12:44:48Z",
  "closed_at": "2022-05-24T12:44:48Z",
  "labels": [
    "type/bug",
    "severity/major",
    "affects-6.1"
  ],
  "comments_data": []
}