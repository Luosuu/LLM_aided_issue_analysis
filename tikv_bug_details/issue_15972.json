{
  "issue_number": 15972,
  "title": "TiKV should delay request snapshot if it exceeds receiving snapshot  limit",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\nFrom the log below, we found leaders fail to send snapshots, because their receive-ends have reached snapshot task limits.\r\nSnapshots generated by leaders can consumes lots of disk space, and may be wasted if leaders compacts their logs.\r\n\r\nIt's better to let follower delay requests snapshot, if they find the snapshot limit is reached.  \r\n\r\n<details><summary>TiKV Logs</summary>\r\n<p>\r\n\r\ntikv-20 got lots of send snapshot failures.\r\n\r\n```log\r\n[2023/11/13 13:40:00.097 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:00.854 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:00.889 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=158552] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:02.100 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:02.852 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:04.102 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:04.854 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:05.602 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:06.103 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:06.342 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:06.858 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:08.106 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:08.857 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1561753] [to>\r\n[2023/11/13 13:40:10.108 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:10.857 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:12.107 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:12.354 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:12.862 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:13.125 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:14.231 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:14.364 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=339339] [to_>\r\n[2023/11/13 13:40:14.921 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:15.364 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=339339] [to_>\r\n[2023/11/13 13:40:16.113 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:16.865 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1561753] [to>\r\n[2023/11/13 13:40:17.366 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=339339] [to_>\r\n[2023/11/13 13:40:18.117 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:18.869 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:19.106 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:19.849 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:20.119 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:20.871 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1561753] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:22.121 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:24.122 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:26.124 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:26.602 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:28.132 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:30.127 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:32.131 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:33.355 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:34.133 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:35.708 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1392211] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:36.132 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:36.756 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1392211] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:38.137 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:38.757 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1392211] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:40.109 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n[2023/11/13 13:40:40.760 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1392211] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:41.507 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1392211] [to>\r\n[2023/11/13 13:40:41.783 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1889027] [to>\r\n[2023/11/13 13:40:42.144 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:42.784 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1392211] [to>\r\n[2023/11/13 13:40:42.787 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1889027] [to>\r\n[2023/11/13 13:40:44.143 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1567474] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:44.386 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1016225] [to>\r\n[2023/11/13 13:40:44.780 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1392211] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:44.782 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=Grpc(RemoteStopped)] [region_id=1889027] [to_addr=tc-tikv-21.tc-tikv-peer.titan-open-zccxk.svc:20160] [thread_id=0x5]\r\n[2023/11/13 13:40:45.770 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1016225] [to>\r\n[2023/11/13 13:40:46.145 +08:00] [ERROR] [snap.rs:545] [\"failed to send snap\"] [err=\"Grpc(RpcFinished(Some(RpcStatus { code: 8-RESOURCE_EXHAUSTED, message: \\\"the number of received snapshot tasks 32 exceeded the limitation 32\\\", details: [] })))\"] [region_id=1567474] [to>\r\n```\r\n\r\ntikv-21 had reached snapshot limit.\r\n\r\n```log\r\n[2023/11/13 13:40:44.741 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.748 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.767 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.784 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.800 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.948 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.948 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:44.999 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.071 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.074 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.115 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.131 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.166 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.174 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.181 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.243 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.289 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.299 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.306 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.329 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.341 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.380 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.492 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.524 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.674 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.704 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.772 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.782 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.789 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.794 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.805 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.810 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.830 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:45.842 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.002 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.056 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.058 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.059 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.062 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.147 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.171 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.339 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.394 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.442 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.484 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.565 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.692 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.750 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.753 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.768 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.772 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.787 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.795 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.817 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.835 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:46.865 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:47.001 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:47.038 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n[2023/11/13 13:40:47.056 +08:00] [WARN] [snap.rs:425] [\"too many recving snapshot tasks, ignore\"] [thread_id=0x5]\r\n```\r\n\r\n</p>\r\n</details> \r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n\r\nv7.4.0\r\n\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n\r\nScale in, scale out or some scenarios that involve lots of region balance.\r\n\r\n### What did you expect?\r\n\r\nNo \"too many recving snapshot tasks\" logs.\r\n\r\n### What did happened?\r\n\r\nLots of \"too many recving snapshot tasks\" and wasted snapshots.\r\n",
  "state": "closed",
  "created_at": "2023-11-13T06:05:35Z",
  "updated_at": "2024-06-12T11:54:01Z",
  "closed_at": "2024-06-12T11:54:01Z",
  "labels": [
    "type/bug",
    "severity/minor"
  ],
  "comments_data": [
    {
      "id": 1868230804,
      "user": "zzl-7",
      "created_at": "2023-12-23T07:32:35Z",
      "body": "Hi @overvenus Is this open to contribution?\r\n"
    },
    {
      "id": 1915329043,
      "user": "tonyxuqqi",
      "created_at": "2024-01-29T18:32:44Z",
      "body": "@zzl-7 Yes, TiKV is always open to contribution if it's not assigned yet. "
    },
    {
      "id": 2060161979,
      "user": "tonyxuqqi",
      "created_at": "2024-04-17T01:11:55Z",
      "body": "/cc @hbisheng"
    }
  ]
}