{
  "issue_number": 6607,
  "title": "tikv panic about replica reads",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\ncommit: `5fd2239d508a1bd437d2f838c71b1d12fe61ad92`\r\n\r\n### What did happened?\r\n```\r\n2020/02/13 06:18:52.154 +00:00] [FATAL] [lib.rs:503] [\"called `Option::unwrap()` on a `None` value\"] [backtrace=\"stack backtrace:\r\n   0: tikv_util::set_panic_hook::{{closure}}\r\n             at components/tikv_util/src/lib.rs:502\r\n   1: std::panicking::rust_panic_with_hook\r\n             at src/libstd/panicking.rs:475\r\n   2: rust_begin_unwind\r\n             at src/libstd/panicking.rs:375\r\n   3: core::panicking::panic_fmt\r\n             at src/libcore/panicking.rs:84\r\n   4: core::panicking::panic\r\n             at src/libcore/panicking.rs:51\r\n   5: core::option::Option<T>::unwrap\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libcore/macros/mod.rs:15\r\n      tikv::raftstore::store::read_queue::ReadIndexQueue::advance_replica_reads\r\n             at root/tikv/src/raftstore/store/read_queue.rs:182\r\n      tikv::raftstore::store::peer::Peer::apply_reads\r\n             at root/tikv/src/raftstore/store/peer.rs:1423\r\n      tikv::raftstore::store::peer::Peer::handle_raft_ready_apply\r\n             at root/tikv/src/raftstore/store/peer.rs:1348\r\n      tikv::raftstore::store::fsm::peer::PeerFsmDelegate<T,C>::post_raft_ready_append\r\n             at root/tikv/src/raftstore/store/fsm/peer.rs:659\r\n   6: tikv::raftstore::store::fsm::store::RaftPoller<T,C>::handle_raft_ready\r\n             at root/tikv/src/raftstore/store/fsm/store.rs:550\r\n      <tikv::raftstore::store::fsm::store::RaftPoller<T,C> as batch_system::batch::PollHandler<tikv::raftstore::store::fsm::peer::PeerFsm,tikv::raftstore::store::fsm::store::StoreFsm>>::end\r\n             at root/tikv/src/raftstore/store/fsm/store.rs:693\r\n      batch_system::batch::Poller<N,C,Handler>::poll\r\n             at root/tikv/components/batch-system/src/batch.rs:329\r\n   7: batch_system::batch::BatchSystem<N,C>::spawn::{{closure}}\r\n             at root/tikv/components/batch-system/src/batch.rs:392\r\n      std::sys_common::backtrace::__rust_begin_short_backtrace\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/sys_common/backtrace.rs:136\r\n   8: std::thread::Builder::spawn_unchecked::{{closure}}::{{closure}}\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/thread/mod.rs:469\r\n      <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/panic.rs:318\r\n      std::panicking::try::do_call\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/panicking.rs:292\r\n      std::panicking::try\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8//src/libpanic_unwind/lib.rs:78\r\n      std::panic::catch_unwind\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/panic.rs:394\r\n      std::thread::Builder::spawn_unchecked::{{closure}}\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libstd/thread/mod.rs:468\r\n      core::ops::function::FnOnce::call_once{{vtable.shim}}\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libcore/ops/function.rs:232\r\n   9: <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/liballoc/boxed.rs:1022\r\n  10: <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once\r\n             at rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/liballoc/boxed.rs:1022\r\n      std::sys_common::thread::start_thread\r\n             at src/libstd/sys_common/thread.rs:13\r\n      std::sys::unix::thread::Thread::new::thread_start\r\n             at src/libstd/sys/unix/thread.rs:80\r\n  11: <unknown>\r\n  12: __clone\r\n\"] [location=/rustc/0de96d37fbcc54978458c18f5067cd9817669bc8/src/libcore/macros/mod.rs:15]\r\n```\r\n",
  "state": "closed",
  "created_at": "2020-02-13T16:11:26Z",
  "updated_at": "2020-08-10T05:29:47Z",
  "closed_at": "2020-02-14T09:37:35Z",
  "labels": [
    "type/bug",
    "severity/major"
  ],
  "comments_data": []
}