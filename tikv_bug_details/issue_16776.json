{
  "issue_number": 16776,
  "title": "TiKV Server Crashed And Restart With Panic Info",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n```\r\nTiKV \r\nRelease Version:   5.4.3\r\nEdition:           Community\r\nGit Commit Hash:   deb149e42d97743349277ff8741f5cb9ae1c027d\r\nGit Commit Branch: heads/refs/tags/v5.4.3\r\nUTC Build Time:    2022-10-09 08:30:38\r\nRust Version:      rustc 1.56.0-nightly (2faabf579 2021-07-27)\r\nEnable Features:   jemalloc mem-profiling portable sse test-engines-rocksdb cloud-aws cloud-gcp cloud-azure\r\nProfile:           dist_release\r\n```\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\ntotal 16 processors\r\n```\r\ncat /proc/cpuinfo\r\nprocessor\t: 0\r\nvendor_id\t: GenuineIntel\r\ncpu family\t: 6\r\nmodel\t\t: 85\r\nmodel name\t: Intel(R) Xeon(R) Platinum 8255C CPU @ 2.50GHz\r\nstepping\t: 5\r\nmicrocode\t: 0x1\r\ncpu MHz\t\t: 2499.996\r\ncache size\t: 36608 KB\r\nphysical id\t: 0\r\nsiblings\t: 16\r\ncore id\t\t: 0\r\ncpu cores\t: 16\r\napicid\t\t: 0\r\ninitial apicid\t: 0\r\nfpu\t\t: yes\r\nfpu_exception\t: yes\r\ncpuid level\t: 13\r\nwp\t\t: yes\r\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc eagerfpu pni pclmulqdq monitor ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 arat avx512_vnni\r\nbogomips\t: 4999.99\r\nclflush size\t: 64\r\ncache_alignment\t: 64\r\naddress sizes\t: 46 bits physical, 48 bits virtual\r\npower management:\r\n```\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n```\r\n[2024/04/07 21:26:25.431 +08:00] [FATAL] [lib.rs:465] [\"commit_ts: TimeStamp(448920645354651662), resolved_ts: TimeStamp(448920645996904752)\"] [backtrace=\"   0: tikv_util::set_panic_hook::{{closure}}\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/tikv_util/src/lib.rs:464:18\\n   1: std::panicking::rust_panic_with_hook\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:626:17\\n   2: std::panicking::begin_panic_handler::{{closure}}\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:519:13\\n   3: std::sys_common::backtrace::__rust_end_short_backtrace\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/sys_common/backtrace.rs:141:18\\n   4: rust_begin_unwind\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:515:5\\n   5: std::panicking::begin_panic_fmt\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:457:5\\n   6: cdc::delegate::Delegate::sink_put\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/cdc/src/delegate.rs:630:21\\n      cdc::delegate::Delegate::sink_data\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/cdc/src/delegate.rs:544:21\\n   7: cdc::delegate::Delegate::on_batch\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/cdc/src/delegate.rs:416:17\\n   8: cdc::endpoint::Endpoint<T,E>::on_multi_batch\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/cdc/src/endpoint.rs:740:33\\n      <cdc::endpoint::Endpoint<T,E> as tikv_util::worker::pool::Runnable>::run\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/cdc/src/endpoint.rs:1548:18\\n   9: tikv_util::worker::pool::Worker::start_with_timer_impl::{{closure}}\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/tikv_util/src/worker/pool.rs:454:25\\n      <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/core/src/future/mod.rs:80:19\\n      yatp::task::future::RawTask<F>::poll\\n             at /rust/git/checkouts/yatp-e704b73c3ee279b6/d564d19/src/task/future.rs:59:9\\n  10: yatp::task::future::TaskCell::poll\\n             at /rust/git/checkouts/yatp-e704b73c3ee279b6/d564d19/src/task/future.rs:103:9\\n      <yatp::task::future::Runner as yatp::pool::runner::Runner>::handle\\n             at /rust/git/checkouts/yatp-e704b73c3ee279b6/d564d19/src/task/future.rs:387:20\\n  11: <tikv_util::yatp_pool::YatpPoolRunner<T> as yatp::pool::runner::Runner>::handle\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/tikv_util/src/yatp_pool/mod.rs:104:24\\n      yatp::pool::worker::WorkerThread<T,R>::run\\n             at /rust/git/checkouts/yatp-e704b73c3ee279b6/d564d19/src/pool/worker.rs:48:13\\n      yatp::pool::builder::LazyBuilder<T>::build::{{closure}}\\n             at /rust/git/checkouts/yatp-e704b73c3ee279b6/d564d19/src/pool/builder.rs:91:25\\n      std::sys_common::backtrace::__rust_begin_short_backtrace\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/sys_common/backtrace.rs:125:18\\n  12: std::thread::Builder::spawn_unchecked::{{closure}}::{{closure}}\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/thread/mod.rs:476:17\\n      <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panic.rs:347:9\\n      std::panicking::try::do_call\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:401:40\\n      std::panicking::try\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panicking.rs:365:19\\n      std::panic::catch_unwind\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/panic.rs:434:14\\n      std::thread::Builder::spawn_unchecked::{{closure}}\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/thread/mod.rs:475:30\\n      core::ops::function::FnOnce::call_once{{vtable.shim}}\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/core/src/ops/function.rs:227:5\\n  13: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/alloc/src/boxed.rs:1572:9\\n      <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/alloc/src/boxed.rs:1572:9\\n      std::sys::unix::thread::Thread::new::thread_start\\n             at /rustc/2faabf579323f5252329264cc53ba9ff803429a3/library/std/src/sys/unix/thread.rs:91:17\\n  14: start_thread\\n  15: clone\\n\"] [location=components/cdc/src/delegate.rs:630] [thread_name=cdc-0]\r\n[2024/04/07 21:26:45.070 +08:00] [INFO] [lib.rs:81] [\"Welcome to TiKV\"]\r\n[2024/04/07 21:26:45.070 +08:00] [INFO] [lib.rs:86] [\"Release Version:   5.4.3\"]\r\n[2024/04/07 21:26:45.071 +08:00] [INFO] [lib.rs:86] [\"Edition:           Community\"]\r\n[2024/04/07 21:26:45.071 +08:00] [INFO] [lib.rs:86] [\"Git Commit Hash:   deb149e42d97743349277ff8741f5cb9ae1c027d\"]\r\n[2024/04/07 21:26:45.071 +08:00] [INFO] [lib.rs:86] [\"Git Commit Branch: heads/refs/tags/v5.4.3\"]\r\n```\r\n### What did you expect?\r\nTiKV Server Running With No Restart\r\n### What did happened?\r\nTiKV Server Crashed And Restart With Panic Info",
  "state": "open",
  "created_at": "2024-04-08T03:39:46Z",
  "updated_at": "2024-08-07T05:48:30Z",
  "closed_at": null,
  "labels": [
    "type/bug",
    "severity/moderate"
  ],
  "comments_data": [
    {
      "id": 2043677249,
      "user": "zhangjinpeng87",
      "created_at": "2024-04-08T21:32:07Z",
      "body": "@yoas0bi Would you mind to upgrade TiKV to latest LTS version 7.5?"
    },
    {
      "id": 2051611658,
      "user": "yoas0bi",
      "created_at": "2024-04-12T11:51:33Z",
      "body": "> @yoas0bi Would you mind to upgrade TiKV to latest LTS version 7.5?\r\n\r\nThis was an occasional accident; the system has been running stably for over two years, and we currently have no plans to upgrade to 7.5"
    }
  ]
}