{
  "issue_number": 13868,
  "title": "after flashback, admin check table report \" region 20009 is in flashback progress\"",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n[root@localhost test_kv]# ./tikv-server -V\r\nTiKV \r\nRelease Version:   6.5.0-alpha\r\nEdition:           Community\r\nGit Commit Hash:   46f9a576e785c5006e9390ebd57623f5d3a6a5cc\r\nGit Commit Branch: flashback_unify_reader\r\nUTC Build Time:    2022-12-01 03:28:15\r\nRust Version:      rustc 1.67.0-nightly (96ddd32c4 2022-11-14)\r\nEnable Features:   pprof-fp jemalloc mem-profiling portable sse test-engine-kv-rocksdb test-engine-raft-raft-engine cloud-aws cloud-gcp cloud-azure\r\nProfile:           release\r\n[root@localhost test_kv]# \r\n\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\n\r\n### Steps to reproduce\r\n1. tidb cluster with tiflash and pitr task and ticdc task\r\n2. prepare 300G data\r\n3. run update with 2k qps for 1 hour\r\n4. flashback to 1 hour ago\r\n\r\n### What did you expect?\r\nflashback successfully\r\ndata consistent in upstream and downstream\r\n\r\n### What did happened?\r\n```code \r\nMySQL [flashback]> admin check table user_data4 ;\r\nERROR 1105 (HY000): region 31259 is in flashback progress\r\n\r\nMySQL [(none)]> flashback cluster to timestamp '2022-12-01 17:50:15';\r\nQuery OK, 0 rows affected (29 min 42.77 sec)\r\nMySQL [flashback]> admin check table user_data1 ;\r\nERROR 1105 (HY000): region 28192 is in flashback progress\r\nMySQL [flashback]> admin check table user_data2 ;\r\nQuery OK, 0 rows affected (3.32 sec)\r\n\r\nMySQL [flashback]> admin check table user_data3 ;\r\nQuery OK, 0 rows affected (4.19 sec)\r\n\r\nMySQL [flashback]> admin check table user_data4 ;\r\nERROR 1105 (HY000): region 31259 is in flashback progress\r\nMySQL [flashback]> admin check table user_data5 ;\r\nERROR 1105 (HY000): region 23474 is in flashback progress\r\nMySQL [flashback]> admin check table user_data6 ;\r\nQuery OK, 0 rows affected (2.74 sec)\r\n\r\nMySQL [flashback]> admin check table user_data7 ;\r\nQuery OK, 0 rows affected (3.55 sec)\r\n\r\nMySQL [flashback]> admin check table user_data8 ;\r\nQuery OK, 0 rows affected (4.77 sec)\r\n\r\nMySQL [flashback]> admin check table user_data9 ;\r\nERROR 1105 (HY000): region 20009 is in flashback progress\r\nMySQL [flashback]> admin check table user_data10;\r\nQuery OK, 0 rows affected (4.91 sec)\r\n\r\nMySQL [flashback]>\r\nMySQL [flashback]> admin show ddl jobs;\r\n+--------+-----------+-------------+-------------------+--------------+-----------+----------+-----------+---------------------+---------------------+---------------------+--------+\r\n| JOB_ID | DB_NAME   | TABLE_NAME  | JOB_TYPE          | SCHEMA_STATE | SCHEMA_ID | TABLE_ID | ROW_COUNT | CREATE_TIME         | START_TIME          | END_TIME            | STATE  |\r\n+--------+-----------+-------------+-------------------+--------------+-----------+----------+-----------+---------------------+---------------------+---------------------+--------+\r\n|    182 |           |             | flashback cluster | public       |         0 |        0 |         0 | 2022-12-01 20:07:08 | 2022-12-01 20:07:09 | 2022-12-01 20:36:51 | synced |\r\n```",
  "state": "closed",
  "created_at": "2022-12-01T14:34:40Z",
  "updated_at": "2022-12-05T18:50:04Z",
  "closed_at": "2022-12-05T18:50:04Z",
  "labels": [
    "type/bug",
    "component/backup-restore",
    "severity/critical",
    "feature/developing",
    "affects-6.5"
  ],
  "comments_data": [
    {
      "id": 1333860095,
      "user": "seiya-annie",
      "created_at": "2022-12-01T14:35:05Z",
      "body": "```code\r\n2022-12-01 20:49:27 (UTC+08:00)TiDB [172.16.6.46:4000](http://172.16.6.46:4000/)[conn.go:1152] [\"command dispatched failed\"] [conn=1866526541266026913] [connInfo=\"id:1866526541266026913, addr:[172.16.6.46:11002](http://172.16.6.46:11002/) status:10, collation:utf8_general_ci, user:root\"] [command=Query] [status=\"inTxn:0, autocommit:1\"] [sql=\"admin check table user_data9\"] [txn_mode=PESSIMISTIC] [timestamp=437753994849288198] [err=\"region 20009 is in flashback progress\\[ngithub.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).onRegionError\\n\\t/home/jason/client-go/internal/locate/region_request.go:1458\\ngithub.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).SendReqCtx\\n\\t/home/jason/client-go/internal/locate/region_request.go:1043\\ngithub.com/tikv/client-go/v2/txnkv/txnsnapshot.(*ClientHelper).SendReqCtx\\n\\t/home/jason/client-go/txnkv/txnsnapshot/client_helper.go:146\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce\\n\\t/home/jason/tidb/store/copr/coprocessor.go:914\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask\\n\\t/home/jason/tidb/store/copr/coprocessor.go:821\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).run\\n\\t/home/jason/tidb/store/copr/coprocessor.go:536\\nruntime.goexit\\n\\t/usr/local/go/src/runtime/asm_amd64.s:1594\\ngithub.com/pingcap/errors.AddStack\\n\\t/home/jason/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174\\ngithub.com/pingcap/errors.Trace\\n\\t/home/jason/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/juju_adaptor.go:15\\ngithub.com/pingcap/tidb/store/driver/error.ToTiDBErr\\n\\t/home/jason/tidb/store/driver/error/error.go:169\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce\\n\\t/home/jason/tidb/store/copr/coprocessor.go:915\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask\\n\\t/home/jason/tidb/store/copr/coprocessor.go:821\\ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).run\\n\\t/home/jason/tidb/store/copr/coprocessor.go:536\\nruntime.goexit\\n\\t/usr/local/go/src/runtime/asm_amd64.s:1594](http://ngithub.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).onRegionError/n/t/home/jason/client-go/internal/locate/region_request.go:1458/ngithub.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).SendReqCtx/n/t/home/jason/client-go/internal/locate/region_request.go:1043/ngithub.com/tikv/client-go/v2/txnkv/txnsnapshot.(*ClientHelper).SendReqCtx/n/t/home/jason/client-go/txnkv/txnsnapshot/client_helper.go:146/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce/n/t/home/jason/tidb/store/copr/coprocessor.go:914/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask/n/t/home/jason/tidb/store/copr/coprocessor.go:821/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).run/n/t/home/jason/tidb/store/copr/coprocessor.go:536/nruntime.goexit/n/t/usr/local/go/src/runtime/asm_amd64.s:1594/ngithub.com/pingcap/errors.AddStack/n/t/home/jason/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/errors.go:174/ngithub.com/pingcap/errors.Trace/n/t/home/jason/go/pkg/mod/github.com/pingcap/errors@v0.11.5-0.20220729040631-518f63d66278/juju_adaptor.go:15/ngithub.com/pingcap/tidb/store/driver/error.ToTiDBErr/n/t/home/jason/tidb/store/driver/error/error.go:169/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce/n/t/home/jason/tidb/store/copr/coprocessor.go:915/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask/n/t/home/jason/tidb/store/copr/coprocessor.go:821/ngithub.com/pingcap/tidb/store/copr.(*copIteratorWorker).run/n/t/home/jason/tidb/store/copr/coprocessor.go:536/nruntime.goexit/n/t/usr/local/go/src/runtime/asm_amd64.s:1594)\"]\r\n```"
    }
  ]
}