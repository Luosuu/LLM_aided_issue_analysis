{
  "issue_number": 12306,
  "title": "Compared with v5.4.0, the performance of TPCH drop 4.5% in v6.0.0 with the duration of TableFullScan increases and cache_hit_count decreases",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\ntikv_version: v6.0.0\r\ntikv_commit: 769a997e4f42d5eea6c607a6ed82a1f7b9dcb61a\r\n\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\namd64\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n1. deploy two TiDB clusters with 1 TIDB + 3TiKV + 1 PD in each with both v5.4.0 and v6.0.0\r\n2. run benchmark TPCH 50g\r\n3. compare the performance\r\n### What did you expect?\r\n\r\n### What did happened?\r\nThe duration of TableFullScan increases in queries: Q21, Q1, Q21, Q8 and etc, while the cache_hit_count decreases, which results in the elapsed time of each of these queries increase 2-3s. Please contact me for more details about the release test results.\r\n![image](https://user-images.githubusercontent.com/84501897/160748942-78982aa4-95ed-4727-aad6-ee3b02aba7fe.png)\r\n\r\n\r\nThe execution plan of Q21 are as follows:\r\n```\r\nv5.4.0 Q21 Execution Plan:\r\nOlap_Detail_Log_ID: 1952424   Plan_Digest: f1ee8e7b69f39d544212be83b42a0d8c Elapsed_Time (s): 21.40 \r\n\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n| ID                                     | ESTROWS      | ACTROWS   | TASK      | ACCESS OBJECT                                     | EXECUTION INFO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | OPERATOR INFO                                                                                                                                                                                                                                                                                     | MEMORY    | DISK    |\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n| Projection_26                          | 100.00       | 100       | root      |                                                   | time:21.4s, loops:2, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | test.supplier.s_name, Column#72                                                                                                                                                                                                                                                                   | 4.62 KB   | N/A     |\r\n| └─TopN_29                              | 100.00       | 100       | root      |                                                   | time:21.4s, loops:2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Column#72:desc, test.supplier.s_name, offset:0, count:100                                                                                                                                                                                                                                         | 55.9 KB   | N/A     |\r\n|   └─HashAgg_34                         | 12800.00     | 20057     | root      |                                                   | time:21.4s, loops:33, partial_worker:{wall_time:21.415320639s, concurrency:16, task_num:202, tot_wait:5m42.326868512s, tot_exec:197.229511ms, tot_time:5m42.563797851s, max:21.415278529s, p95:21.415278529s}, final_worker:{wall_time:21.418942222s, concurrency:16, task_num:256, tot_wait:5m42.552747615s, tot_exec:127.268445ms, tot_time:5m42.680095256s, max:21.418923231s, p95:21.418923231s}                                                                                                                                                                                      | group by:test.supplier.s_name, funcs:count(1)->Column#72, funcs:firstrow(test.supplier.s_name)->test.supplier.s_name                                                                                                                                                                              | 25.4 MB   | N/A     |\r\n|     └─IndexHashJoin_42                 | 7815107.48   | 198698    | root      |                                                   | time:21.4s, loops:203, inner:{total:2m19.9s, concurrency:16, task:146, construct:3.38s, fetch:2m7.6s, build:612.5ms, join:8.94s}                                                                                                                                                                                                                                                                                                                                                                                                                                                          | anti semi join, inner:IndexLookUp_39, outer key:test.lineitem.l_orderkey, inner key:test.lineitem.l_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey), other cond:ne(test.lineitem.l_suppkey, test.lineitem.l_suppkey)                                                  | 889.2 MB  | N/A     |\r\n|       ├─IndexHashJoin_83(Build)        | 9768884.35   | 3542799   | root      |                                                   | time:21.1s, loops:3467, inner:{total:2m35.5s, concurrency:16, task:152, construct:3.89s, fetch:2m22.4s, build:632.6ms, join:9.17s}                                                                                                                                                                                                                                                                                                                                                                                                                                                        | semi join, inner:IndexLookUp_80, outer key:test.lineitem.l_orderkey, inner key:test.lineitem.l_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey), other cond:ne(test.lineitem.l_suppkey, test.lineitem.l_suppkey), ne(test.lineitem.l_suppkey, test.supplier.s_suppkey) | 811.3 MB  | N/A     |\r\n|       │ ├─IndexJoin_99(Build)          | 12211105.44  | 3675878   | root      |                                                   | time:20.8s, loops:3595, inner:{total:2m8s, concurrency:16, task:305, construct:7.84s, fetch:1m59.2s, build:962.9ms}, probe:3.1s                                                                                                                                                                                                                                                                                                                                                                                                                                                           | inner join, inner:TableReader_95, outer key:test.lineitem.l_orderkey, inner key:test.orders.o_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.orders.o_orderkey)                                                                                                                           | 1.07 GB   | N/A     |\r\n|       │ │ ├─HashJoin_107(Build)        | 12033348.21  | 7609895   | root      |                                                   | time:20.5s, loops:7440, build_hash_table:{total:387.4ms, fetch:382.5ms, build:4.97ms}, probe:{concurrency:16, total:5m31.5s, max:20.7s, probe:38.3s, fetch:4m53.2s}                                                                                                                                                                                                                                                                                                                                                                                                                       | inner join, equal:[eq(test.supplier.s_suppkey, test.lineitem.l_suppkey)]                                                                                                                                                                                                                          | 1.00 MB   | 0 Bytes |\r\n|       │ │ │ ├─HashJoin_120(Build)      | 20000.00     | 20058     | root      |                                                   | time:382.8ms, loops:33, build_hash_table:{total:84.8µs, fetch:79.2µs, build:5.58µs}, probe:{concurrency:16, total:6.15s, max:385.3ms, probe:95.8ms, fetch:6.06s}                                                                                                                                                                                                                                                                                                                                                                                                                          | inner join, equal:[eq(test.nation.n_nationkey, test.supplier.s_nationkey)]                                                                                                                                                                                                                        | 24.5 KB   | 0 Bytes |\r\n|       │ │ │ │ ├─TableReader_125(Build) | 1.00         | 1         | root      |                                                   | time:39.1µs, loops:2, cop_task: {num: 1, max: 1.25ms, proc_keys: 25, rpc_num: 1, rpc_time: 1.18ms, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                                                                                                                                            | data:Selection_124                                                                                                                                                                                                                                                                                | 243 Bytes | N/A     |\r\n|       │ │ │ │ │ └─Selection_124        | 1.00         | 1         | cop[tikv] |                                                   | tikv_task:{time:0s, loops:1}, scan_detail: {total_process_keys: 25, total_process_keys_size: 3109, total_keys: 26, rocksdb: {delete_skipped_count: 0, key_skipped_count: 25, block: {cache_hit_count: 2, read_count: 0, read_byte: 0 Bytes}}}                                                                                                                                                                                                                                                                                                                                             | eq(test.nation.n_name, \"EGYPT\")                                                                                                                                                                                                                                                                   | N/A       | N/A     |\r\n|       │ │ │ │ │   └─TableFullScan_123  | 25.00        | 25        | cop[tikv] | table:nation                                      | tikv_task:{time:0s, loops:1}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ │ │ └─TableReader_122(Probe) | 500000.00    | 500000    | root      |                                                   | time:379.1ms, loops:490, cop_task: {num: 1, max: 379.3ms, proc_keys: 500000, tot_proc: 327ms, tot_wait: 1ms, rpc_num: 1, rpc_time: 379.3ms, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                                                                                                   | data:TableFullScan_121                                                                                                                                                                                                                                                                            | 20.0 MB   | N/A     |\r\n|       │ │ │ │   └─TableFullScan_121    | 500000.00    | 500000    | cop[tikv] | table:supplier                                    | tikv_task:{time:293ms, loops:493}, scan_detail: {total_process_keys: 500000, total_process_keys_size: 90738654, total_keys: 500001, rocksdb: {delete_skipped_count: 0, key_skipped_count: 500000, block: {cache_hit_count: 1492, read_count: 0, read_byte: 0 Bytes}}}                                                                                                                                                                                                                                                                                                                     | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ │ └─TableReader_128(Probe)   | 240004648.80 | 189670348 | root      |                                                   | time:19.7s, loops:184599, cop_task: {num: 570, max: 3.28s, min: 36.8ms, avg: 998.6ms, p95: 2.02s, max_proc_keys: 528339, p95_proc_keys: 528089, tot_proc: 8m43.1s, tot_wait: 26.8s, rpc_num: 570, rpc_time: 9m29.2s, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                          | data:Selection_127                                                                                                                                                                                                                                                                                | 30.6 MB   | N/A     |\r\n|       │ │ │   └─Selection_127          | 240004648.80 | 189670348 | cop[tikv] |                                                   | tikv_task:{proc max:750ms, min:0s, p80:651ms, p95:697ms, iters:295454, tasks:570}, scan_detail: {total_process_keys: 300005811, total_process_keys_size: 59595430182, total_keys: 300006381, rocksdb: {delete_skipped_count: 0, key_skipped_count: 300005811, block: {cache_hit_count: 973822, read_count: 597, read_byte: 9.69 MB}}}                                                                                                                                                                                                                                                     | gt(test.lineitem.l_receiptdate, test.lineitem.l_commitdate)                                                                                                                                                                                                                                       | N/A       | N/A     |\r\n|       │ │ │     └─TableFullScan_126    | 300005811.00 | 300005811 | cop[tikv] | table:l1                                          | tikv_task:{proc max:696ms, min:0s, p80:592ms, p95:635ms, iters:295454, tasks:570}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ └─TableReader_95(Probe)      | 0.49         | 3496229   | root      |                                                   | time:1m55.1s, loops:3875, cop_task: {num: 1122, max: 1.07s, min: 537.2µs, avg: 192.4ms, p95: 712.3ms, max_proc_keys: 24355, p95_proc_keys: 16232, tot_proc: 2m54.7s, tot_wait: 30.7s, rpc_num: 1122, rpc_time: 3m35.9s, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                       | data:Selection_94                                                                                                                                                                                                                                                                                 | N/A       | N/A     |\r\n|       │ │   └─Selection_94             | 0.49         | 3496229   | cop[tikv] |                                                   | tikv_task:{proc max:237ms, min:0s, p80:80ms, p95:120ms, iters:11892, tasks:1122}, scan_detail: {total_process_keys: 7236347, total_process_keys_size: 1099134554, total_keys: 7795779, rocksdb: {delete_skipped_count: 0, key_skipped_count: 1169240, block: {cache_hit_count: 7390414, read_count: 32666, read_byte: 574.9 MB}}}                                                                                                                                                                                                                                                         | eq(test.orders.o_orderstatus, \"F\")                                                                                                                                                                                                                                                                | N/A       | N/A     |\r\n|       │ │     └─TableRangeScan_93      | 1.00         | 7236347   | cop[tikv] | table:orders                                      | tikv_task:{proc max:236ms, min:0s, p80:79ms, p95:119ms, iters:11892, tasks:1122}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | range: decided by [test.lineitem.l_orderkey], keep order:false                                                                                                                                                                                                                                    | N/A       | N/A     |\r\n|       │ └─IndexLookUp_80(Probe)        | 4.06         | 17316573  | root      |                                                   | time:2m19.4s, loops:17136, index_task: {total_time: 1m22.8s, fetch_handle: 1m22.8s, build: 1.83ms, wait: 5.46ms}, table_task: {total_time: 6m22s, num: 1458, concurrency: 2432}                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                   | 18.8 KB   | N/A     |\r\n|       │   ├─IndexRangeScan_78(Build)   | 4.06         | 17316573  | cop[tikv] | table:l2, index:PRIMARY(L_ORDERKEY, L_LINENUMBER) | time:1m21.7s, loops:17808, cop_task: {num: 1265, max: 1.12s, min: 585.4µs, avg: 239.1ms, p95: 785.4ms, max_proc_keys: 56546, p95_proc_keys: 30682, tot_proc: 4m9.6s, tot_wait: 44.9s, rpc_num: 1265, rpc_time: 5m2.4s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:291ms, min:0s, p80:105ms, p95:156ms, iters:22485, tasks:1265}, scan_detail: {total_process_keys: 17316573, total_process_keys_size: 917778369, total_keys: 20812713, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17316573, block: {cache_hit_count: 6792605, read_count: 212547, read_byte: 962.5 MB}}} | range: decided by [eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey)], keep order:false                                                                                                                                                                                                      | N/A       | N/A     |\r\n|       │   └─TableRowIDScan_79(Probe)   | 4.06         | 17316573  | cop[tikv] | table:l2                                          | time:6m14.7s, loops:19428, cop_task: {num: 2587, max: 1.12s, min: 350.6µs, avg: 183.4ms, p95: 711.4ms, max_proc_keys: 21022, p95_proc_keys: 20360, tot_proc: 6m32.3s, tot_wait: 1m11.1s, rpc_num: 2587, rpc_time: 7m54.4s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:135ms, min:0s, p80:43ms, p95:73ms, iters:28639, tasks:2587}, scan_detail: {total_process_keys: 17316573, total_process_keys_size: 3439881252, total_keys: 20529328, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17195150, block: {cache_hit_count: 6719221, read_count: 491, read_byte: 308.6 MB}}} | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       └─IndexLookUp_39(Probe)          | 4.06         | 12022896  | root      |                                                   | time:2m4.9s, loops:11956, index_task: {total_time: 1m7.9s, fetch_handle: 1m7.9s, build: 1.84ms, wait: 5.51ms}, table_task: {total_time: 6m9.7s, num: 1408, concurrency: 2336}                                                                                                                                                                                                                                                                                                                                                                                                             |                                                                                                                                                                                                                                                                                                   | 213.2 KB  | N/A     |\r\n|         ├─IndexRangeScan_36(Build)     | 5.07         | 17183512  | cop[tikv] | table:l3, index:PRIMARY(L_ORDERKEY, L_LINENUMBER) | time:1m6.8s, loops:17771, cop_task: {num: 1571, max: 1.13s, min: 356.1µs, avg: 187.7ms, p95: 695.6ms, max_proc_keys: 55575, p95_proc_keys: 29234, tot_proc: 4m5.1s, tot_wait: 41.8s, rpc_num: 1571, rpc_time: 4m54.8s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:225ms, min:0s, p80:65ms, p95:104ms, iters:23664, tasks:1571}, scan_detail: {total_process_keys: 17183134, total_process_keys_size: 910706102, total_keys: 20546124, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17183134, block: {cache_hit_count: 6738746, read_count: 0, read_byte: 0 Bytes}}}        | range: decided by [eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey)], keep order:false                                                                                                                                                                                                      | N/A       | N/A     |\r\n|         └─Selection_38(Probe)          | 4.06         | 12022896  | cop[tikv] |                                                   | time:6m2.4s, loops:13751, cop_task: {num: 2931, max: 1.07s, min: 387.2µs, avg: 167.4ms, p95: 681.9ms, max_proc_keys: 20728, p95_proc_keys: 17376, tot_proc: 6m43s, tot_wait: 1m16.8s, rpc_num: 2931, rpc_time: 8m10.7s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:104ms, min:0s, p80:38ms, p95:65ms, iters:29905, tasks:2931}, scan_detail: {total_process_keys: 17183512, total_process_keys_size: 3413452181, total_keys: 20396320, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17183046, block: {cache_hit_count: 6482846, read_count: 0, read_byte: 0 Bytes}}}       | gt(test.lineitem.l_receiptdate, test.lineitem.l_commitdate)                                                                                                                                                                                                                                       | N/A       | N/A     |\r\n|           └─TableRowIDScan_37          | 5.07         | 17183512  | cop[tikv] | table:l3                                          | tikv_task:{proc max:99ms, min:0s, p80:37ms, p95:63ms, iters:29905, tasks:2931}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n\r\n```\r\n\r\n```\r\n\r\nv6.0.0  Q21 Execution Plan:\r\nOlap_Detail_Log_ID: 2041790   Plan_Digest: f1ee8e7b69f39d544212be83b42a0d8c Elapsed_Time (s): 26.10 \r\n\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n| ID                                     | ESTROWS      | ACTROWS   | TASK      | ACCESS OBJECT                                     | EXECUTION INFO                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | OPERATOR INFO                                                                                                                                                                                                                                                                                     | MEMORY    | DISK    |\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n| Projection_26                          | 100.00       | 100       | root      |                                                   | time:26.1s, loops:2, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | test.supplier.s_name, Column#72                                                                                                                                                                                                                                                                   | 4.26 KB   | N/A     |\r\n| └─TopN_29                              | 100.00       | 100       | root      |                                                   | time:26.1s, loops:2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Column#72:desc, test.supplier.s_name, offset:0, count:100                                                                                                                                                                                                                                         | 62.4 KB   | N/A     |\r\n|   └─HashAgg_34                         | 12800.00     | 20057     | root      |                                                   | time:26.1s, loops:33, partial_worker:{wall_time:26.106238196s, concurrency:16, task_num:202, tot_wait:6m57.451695168s, tot_exec:215.799108ms, tot_time:6m57.689185482s, max:26.106169128s, p95:26.106169128s}, final_worker:{wall_time:26.113823517s, concurrency:16, task_num:256, tot_wait:6m57.691346931s, tot_exec:110.629867ms, tot_time:6m57.802047539s, max:26.113793239s, p95:26.113793239s}                                                                                                                                                                                       | group by:test.supplier.s_name, funcs:count(1)->Column#72, funcs:firstrow(test.supplier.s_name)->test.supplier.s_name                                                                                                                                                                              | 25.4 MB   | N/A     |\r\n|     └─IndexHashJoin_42                 | 7815107.48   | 198698    | root      |                                                   | time:26.1s, loops:203, inner:{total:3m17.1s, concurrency:16, task:146, construct:2.95s, fetch:3m5.6s, build:550.4ms, join:8.53s}                                                                                                                                                                                                                                                                                                                                                                                                                                                           | anti semi join, inner:IndexLookUp_39, outer key:test.lineitem.l_orderkey, inner key:test.lineitem.l_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey), other cond:ne(test.lineitem.l_suppkey, test.lineitem.l_suppkey)                                                  | 890.4 MB  | N/A     |\r\n|       ├─IndexHashJoin_83(Build)        | 9768884.35   | 3542799   | root      |                                                   | time:25.8s, loops:3467, inner:{total:3m28.2s, concurrency:16, task:152, construct:3.36s, fetch:3m15.7s, build:593.4ms, join:9.08s}                                                                                                                                                                                                                                                                                                                                                                                                                                                         | semi join, inner:IndexLookUp_80, outer key:test.lineitem.l_orderkey, inner key:test.lineitem.l_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey), other cond:ne(test.lineitem.l_suppkey, test.lineitem.l_suppkey), ne(test.lineitem.l_suppkey, test.supplier.s_suppkey) | 814.2 MB  | N/A     |\r\n|       │ ├─IndexJoin_99(Build)          | 12211105.44  | 3675878   | root      |                                                   | time:25.5s, loops:3595, inner:{total:3m58.7s, concurrency:16, task:305, construct:7.15s, fetch:3m50.4s, build:1.14s}, probe:2.96s                                                                                                                                                                                                                                                                                                                                                                                                                                                          | inner join, inner:TableReader_95, outer key:test.lineitem.l_orderkey, inner key:test.orders.o_orderkey, equal cond:eq(test.lineitem.l_orderkey, test.orders.o_orderkey)                                                                                                                           | 1.08 GB   | N/A     |\r\n|       │ │ ├─HashJoin_107(Build)        | 12033348.21  | 7609895   | root      |                                                   | time:24s, loops:7442, build_hash_table:{total:609.8ms, fetch:604ms, build:5.75ms}, probe:{concurrency:16, total:6m46.9s, max:25.4s, probe:53.4s, fetch:5m53.5s}                                                                                                                                                                                                                                                                                                                                                                                                                            | inner join, equal:[eq(test.supplier.s_suppkey, test.lineitem.l_suppkey)]                                                                                                                                                                                                                          | 1.04 MB   | 0 Bytes |\r\n|       │ │ │ ├─HashJoin_120(Build)      | 20000.00     | 20058     | root      |                                                   | time:604.3ms, loops:32, build_hash_table:{total:93.4µs, fetch:89.8µs, build:3.59µs}, probe:{concurrency:16, total:9.7s, max:607.2ms, probe:77.3ms, fetch:9.62s}                                                                                                                                                                                                                                                                                                                                                                                                                            | inner join, equal:[eq(test.nation.n_nationkey, test.supplier.s_nationkey)]                                                                                                                                                                                                                        | 24.5 KB   | 0 Bytes |\r\n|       │ │ │ │ ├─TableReader_125(Build) | 1.00         | 1         | root      |                                                   | time:43.5µs, loops:2, cop_task: {num: 1, max: 1.03ms, proc_keys: 25, rpc_num: 1, rpc_time: 997.3µs, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                                                                                                                                            | data:Selection_124                                                                                                                                                                                                                                                                                | 243 Bytes | N/A     |\r\n|       │ │ │ │ │ └─Selection_124        | 1.00         | 1         | cop[tikv] |                                                   | tikv_task:{time:0s, loops:1}, scan_detail: {total_process_keys: 25, total_process_keys_size: 3109, total_keys: 26, rocksdb: {delete_skipped_count: 0, key_skipped_count: 25, block: {cache_hit_count: 2, read_count: 0, read_byte: 0 Bytes}}}                                                                                                                                                                                                                                                                                                                                              | eq(test.nation.n_name, \"EGYPT\")                                                                                                                                                                                                                                                                   | N/A       | N/A     |\r\n|       │ │ │ │ │   └─TableFullScan_123  | 25.00        | 25        | cop[tikv] | table:nation                                      | tikv_task:{time:0s, loops:1}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ │ │ └─TableReader_122(Probe) | 500000.00    | 500000    | root      |                                                   | time:599.7ms, loops:490, cop_task: {num: 1, max: 600.6ms, proc_keys: 500000, tot_proc: 561ms, tot_wait: 1ms, rpc_num: 1, rpc_time: 600.6ms, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                                                                                                    | data:TableFullScan_121                                                                                                                                                                                                                                                                            | 20.0 MB   | N/A     |\r\n|       │ │ │ │   └─TableFullScan_121    | 500000.00    | 500000    | cop[tikv] | table:supplier                                    | tikv_task:{time:497ms, loops:493}, scan_detail: {total_process_keys: 500000, total_process_keys_size: 90738654, total_keys: 500001, rocksdb: {delete_skipped_count: 0, key_skipped_count: 500000, block: {cache_hit_count: 1492, read_count: 0, read_byte: 0 Bytes}}}                                                                                                                                                                                                                                                                                                                      | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ │ └─TableReader_128(Probe)   | 240004648.80 | 189670348 | root      |                                                   | time:23.5s, loops:184598, cop_task: {num: 570, max: 4.25s, min: 60.4ms, avg: 1.22s, p95: 2.71s, max_proc_keys: 528339, p95_proc_keys: 528089, tot_proc: 10m59.7s, tot_wait: 17.5s, rpc_num: 570, rpc_time: 11m36s, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                             | data:Selection_127                                                                                                                                                                                                                                                                                | 173.5 MB  | N/A     |\r\n|       │ │ │   └─Selection_127          | 240004648.80 | 189670348 | cop[tikv] |                                                   | tikv_task:{proc max:994ms, min:0s, p80:727ms, p95:916ms, iters:295454, tasks:570}, scan_detail: {total_process_keys: 300005811, total_process_keys_size: 59595430182, total_keys: 300006381, rocksdb: {delete_skipped_count: 0, key_skipped_count: 300005811, block: {cache_hit_count: 717690, read_count: 256729, read_byte: 4.07 GB}}}                                                                                                                                                                                                                                                   | gt(test.lineitem.l_receiptdate, test.lineitem.l_commitdate)                                                                                                                                                                                                                                       | N/A       | N/A     |\r\n|       │ │ │     └─TableFullScan_126    | 300005811.00 | 300005811 | cop[tikv] | table:l1                                          | tikv_task:{proc max:929ms, min:0s, p80:659ms, p95:846ms, iters:295454, tasks:570}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       │ │ └─TableReader_95(Probe)      | 0.49         | 3496199   | root      |                                                   | time:3m46s, loops:3875, cop_task: {num: 1160, max: 1.75s, min: 665.5µs, avg: 392.7ms, p95: 1.23s, max_proc_keys: 23458, p95_proc_keys: 13355, tot_proc: 6m40.7s, tot_wait: 44.6s, rpc_num: 1160, rpc_time: 7m35.4s, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                                                                                            | data:Selection_94                                                                                                                                                                                                                                                                                 | N/A       | N/A     |\r\n|       │ │   └─Selection_94             | 0.49         | 3496199   | cop[tikv] |                                                   | tikv_task:{proc max:224ms, min:0s, p80:92ms, p95:130ms, iters:11995, tasks:1160}, scan_detail: {total_process_keys: 7236356, total_process_keys_size: 1099135174, total_keys: 7795723, rocksdb: {delete_skipped_count: 0, key_skipped_count: 1169106, block: {cache_hit_count: 7272763, read_count: 151122, read_byte: 2.56 GB}}}                                                                                                                                                                                                                                                          | eq(test.orders.o_orderstatus, \"F\")                                                                                                                                                                                                                                                                | N/A       | N/A     |\r\n|       │ │     └─TableRangeScan_93      | 1.00         | 7236356   | cop[tikv] | table:orders                                      | tikv_task:{proc max:220ms, min:0s, p80:90ms, p95:128ms, iters:11995, tasks:1160}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | range: decided by [test.lineitem.l_orderkey], keep order:false                                                                                                                                                                                                                                    | N/A       | N/A     |\r\n|       │ └─IndexLookUp_80(Probe)        | 4.06         | 17316520  | root      |                                                   | time:3m12.9s, loops:17135, index_task: {total_time: 1m30.4s, fetch_handle: 1m30.4s, build: 10.4ms, wait: 6.2ms}, table_task: {total_time: 11m7.5s, num: 1458, concurrency: 2432}                                                                                                                                                                                                                                                                                                                                                                                                           |                                                                                                                                                                                                                                                                                                   | 18.3 KB   | N/A     |\r\n|       │   ├─IndexRangeScan_78(Build)   | 4.06         | 17316520  | cop[tikv] | table:l2, index:PRIMARY(L_ORDERKEY, L_LINENUMBER) | time:1m29.1s, loops:17813, cop_task: {num: 1298, max: 1.78s, min: 559.8µs, avg: 184.3ms, p95: 899ms, max_proc_keys: 55909, p95_proc_keys: 30641, tot_proc: 3m21.7s, tot_wait: 29.5s, rpc_num: 1298, rpc_time: 3m59.1s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:269ms, min:0s, p80:85ms, p95:129ms, iters:22635, tasks:1298}, scan_detail: {total_process_keys: 17316520, total_process_keys_size: 917775560, total_keys: 20812648, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17316520, block: {cache_hit_count: 6900493, read_count: 104642, read_byte: 473.9 MB}}}   | range: decided by [eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey)], keep order:false                                                                                                                                                                                                      | N/A       | N/A     |\r\n|       │   └─TableRowIDScan_79(Probe)   | 4.06         | 17316520  | cop[tikv] | table:l2                                          | time:11m0.9s, loops:19345, cop_task: {num: 2576, max: 1.93s, min: 354.6µs, avg: 314.1ms, p95: 1.11s, max_proc_keys: 20756, p95_proc_keys: 20164, tot_proc: 11m56.1s, tot_wait: 1m24.1s, rpc_num: 2576, rpc_time: 13m29.1s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:253ms, min:0s, p80:46ms, p95:84ms, iters:28586, tasks:2576}, scan_detail: {total_process_keys: 17316520, total_process_keys_size: 3439870134, total_keys: 20529271, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17195154, block: {cache_hit_count: 6631413, read_count: 88162, read_byte: 1.69 GB}}} | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n|       └─IndexLookUp_39(Probe)          | 4.06         | 12022866  | root      |                                                   | time:3m3.1s, loops:11948, index_task: {total_time: 1m23.5s, fetch_handle: 1m23.5s, build: 2.86ms, wait: 6.01ms}, table_task: {total_time: 10m21.4s, num: 1408, concurrency: 2336}                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                   | 269.1 KB  | N/A     |\r\n|         ├─IndexRangeScan_36(Build)     | 5.07         | 17183465  | cop[tikv] | table:l3, index:PRIMARY(L_ORDERKEY, L_LINENUMBER) | time:1m22.5s, loops:17790, cop_task: {num: 1596, max: 1.68s, min: 455.2µs, avg: 154.6ms, p95: 834.1ms, max_proc_keys: 52642, p95_proc_keys: 29181, tot_proc: 3m32s, tot_wait: 27.8s, rpc_num: 1596, rpc_time: 4m6.7s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:183ms, min:0s, p80:59ms, p95:93ms, iters:23793, tasks:1596}, scan_detail: {total_process_keys: 17182300, total_process_keys_size: 910661900, total_keys: 20545127, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17182300, block: {cache_hit_count: 6738424, read_count: 3, read_byte: 2.76 KB}}}           | range: decided by [eq(test.lineitem.l_orderkey, test.lineitem.l_orderkey)], keep order:false                                                                                                                                                                                                      | N/A       | N/A     |\r\n|         └─Selection_38(Probe)          | 4.06         | 12022866  | cop[tikv] |                                                   | time:10m15s, loops:13753, cop_task: {num: 2915, max: 1.81s, min: 404.6µs, avg: 275.7ms, p95: 1.06s, max_proc_keys: 20992, p95_proc_keys: 18400, tot_proc: 11m39.4s, tot_wait: 1m33.9s, rpc_num: 2915, rpc_time: 13m23.4s, copr_cache_hit_ratio: 0.00}, tikv_task:{proc max:112ms, min:0s, p80:37ms, p95:66ms, iters:29840, tasks:2915}, scan_detail: {total_process_keys: 17183465, total_process_keys_size: 3413442420, total_keys: 20396222, rocksdb: {delete_skipped_count: 0, key_skipped_count: 17182990, block: {cache_hit_count: 6482628, read_count: 148, read_byte: 2.40 MB}}}    | gt(test.lineitem.l_receiptdate, test.lineitem.l_commitdate)                                                                                                                                                                                                                                       | N/A       | N/A     |\r\n|           └─TableRowIDScan_37          | 5.07         | 17183465  | cop[tikv] | table:l3                                          | tikv_task:{proc max:110ms, min:0s, p80:36ms, p95:64ms, iters:29840, tasks:2915}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | keep order:false                                                                                                                                                                                                                                                                                  | N/A       | N/A     |\r\n+----------------------------------------+--------------+-----------+-----------+---------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------+---------+\r\n\r\n```\r\n",
  "state": "open",
  "created_at": "2022-03-30T04:30:12Z",
  "updated_at": "2024-11-01T10:16:32Z",
  "closed_at": null,
  "labels": [
    "type/bug",
    "severity/major",
    "found/automation",
    "affects-6.0",
    "affects-6.1",
    "affects-6.2",
    "affects-6.3",
    "affects-6.4",
    "affects-6.5",
    "affects-6.6",
    "affects-7.0",
    "affects-7.1",
    "affects-7.5",
    "affects-8.1",
    "affects-8.5"
  ],
  "comments_data": [
    {
      "id": 1082612377,
      "user": "Yui-Song",
      "created_at": "2022-03-30T04:35:10Z",
      "body": "/type bug"
    },
    {
      "id": 1082613798,
      "user": "Yui-Song",
      "created_at": "2022-03-30T04:38:06Z",
      "body": "/severity Major"
    },
    {
      "id": 1095996362,
      "user": "Yui-Song",
      "created_at": "2022-04-12T04:31:04Z",
      "body": "/found automation"
    },
    {
      "id": 1252403149,
      "user": "tiancaiamao",
      "created_at": "2022-09-20T14:03:21Z",
      "body": "I verify the query on the master branch, and can't reproduce the issue.\r\nI believe it's happened during the feature development phase, when copr-cache is not supported.\r\nAfter https://github.com/pingcap/tidb/pull/35787, this should have been fixed.\r\n\r\n"
    },
    {
      "id": 2243823495,
      "user": "zhangjinpeng87",
      "created_at": "2024-07-22T21:12:17Z",
      "body": "@tiancaiamao @Yui-Song Does this issue still exist? Can we close this issue?"
    }
  ]
}