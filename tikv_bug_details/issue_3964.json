{
  "issue_number": 3964,
  "title": "Tikv segfault at split-check",
  "body": "## Bug Report\r\n\r\n**What version of Rust are you using?**\r\n`rustc 1.29.0-nightly (4f3c7a472 2018-07-17)`\r\n\r\n**What version of GCC are you using?**\r\n\r\n```Using built-in specs.\r\nCOLLECT_GCC=gcc\r\nCOLLECT_LTO_WRAPPER=/opt/rh/devtoolset-6/root/usr/libexec/gcc/x86_64-redhat-linux/6.3.1/lto-wrapper\r\nTarget: x86_64-redhat-linux\r\nConfigured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,lto --prefix=/opt/rh/devtoolset-6/root/usr --mandir=/opt/rh/devtoolset-6/root/usr/share/man --infodir=/opt/rh/devtoolset-6/root/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --enable-plugin --with-linker-hash-style=gnu --enable-initfini-array --disable-libgcj --with-default-libstdcxx-abi=gcc4-compatible --with-isl=/builddir/build/BUILD/gcc-6.3.1-20170216/obj-x86_64-redhat-linux/isl-install --enable-libmpx --with-mpc=/builddir/build/BUILD/gcc-6.3.1-20170216/obj-x86_64-redhat-linux/mpc-install --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux\r\nThread model: posix\r\ngcc version 6.3.1 20170216 (Red Hat 6.3.1-3) (GCC) \r\n```\r\n\r\n\r\n**What operating system and CPU are you using?**\r\n\r\n`CentOS Linux release 7.6.1810 (Core) `\r\n\r\n```\r\nprocessor\t: 0\r\nvendor_id\t: GenuineIntel\r\ncpu family\t: 6\r\nmodel\t\t: 45\r\nmodel name\t: Intel(R) Xeon(R) CPU E5-2603 0 @ 1.80GHz\r\nstepping\t: 7\r\nmicrocode\t: 0x714\r\ncpu MHz\t\t: 1800.000\r\ncache size\t: 10240 KB\r\nphysical id\t: 0\r\nsiblings\t: 4\r\ncore id\t\t: 0\r\ncpu cores\t: 4\r\napicid\t\t: 0\r\ninitial apicid\t: 0\r\nfpu\t\t: yes\r\nfpu_exception\t: yes\r\ncpuid level\t: 13\r\nwp\t\t: yes\r\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx lahf_lm epb ssbd ibrs ibpb stibp tpr_shadow vnmi flexpriority ept vpid xsaveopt dtherm arat pln pts spec_ctrl intel_stibp flush_l1d\r\nbogomips\t: 3599.98\r\nclflush size\t: 64\r\ncache_alignment\t: 64\r\naddress sizes\t: 46 bits physical, 48 bits virtual\r\npower management:\r\n```\r\n**What did you do?**\r\nUpdate tikv from 2.1.0 to 2.1.1 and running for  almost 80 hours\r\n\r\n**What did you expect to see?**\r\nshould not segfault\r\n\r\n**What did you see instead?**\r\n\r\n```\r\nDec 21 12:07:52 db24 kernel: split-check[31704]: segfault at 7fd00c5e9dc7 ip 0000559c2075ab51 sp 00007fcead7fc080 error 4 in tikv-server[559c1f5e9000+1637000]\r\n```\r\n\r\n`0x0000559c2075ab51 -  0x559c1f5e9000 = 0x1171B51`\r\n\r\n```sh\r\n$ addr2line -e tikv-server -fCip 0x1171B51\r\nLZ4_copy8 at /root/.cargo/git/checkouts/lz4-rs-01ce59d74c48a2d5/41509fe/lz4-sys/liblz4/lib/lz4.c:252\r\n (inlined by) LZ4_decompress_generic at /root/.cargo/git/checkouts/lz4-rs-01ce59d74c48a2d5/41509fe/lz4-sys/liblz4/lib/lz4.c:1252\r\n (inlined by) LZ4_decompress_safe_continue at /root/.cargo/git/checkouts/lz4-rs-01ce59d74c48a2d5/41509fe/lz4-sys/liblz4/lib/lz4.c:1340\r\n```\r\n\r\n```C\r\n 239 static void LZ4_writeLE16(void* memPtr, U16 value)\r\n 240 {\r\n 241     if (LZ4_isLittleEndian()) {\r\n 242         LZ4_write16(memPtr, value);\r\n 243     } else {\r\n 244         BYTE* p = (BYTE*)memPtr;\r\n 245         p[0] = (BYTE) value;\r\n 246         p[1] = (BYTE)(value>>8);\r\n 247     }\r\n 248 }\r\n 249 \r\n 250 static void LZ4_copy8(void* dst, const void* src)\r\n 251 {\r\n 252     memcpy(dst,src,8);\r\n 253 }\r\n 254 \r\n 255 /* customized variant of memcpy, which can overwrite up to 8 bytes beyond dstEnd */\r\n 256 static void LZ4_wildCopy(void* dstPtr, const void* srcPtr, void* dstEnd)\r\n 257 {\r\n 258     BYTE* d = (BYTE*)dstPtr;\r\n 259     const BYTE* s = (const BYTE*)srcPtr;\r\n 260     BYTE* const e = (BYTE*)dstEnd;\r\n 261 \r\n 262     do { LZ4_copy8(d,s); d+=8; s+=8; } while (d<e);\r\n 263 }\r\n```\r\n\r\n",
  "state": "closed",
  "created_at": "2018-12-21T06:47:29Z",
  "updated_at": "2019-01-10T09:40:51Z",
  "closed_at": "2019-01-10T09:40:51Z",
  "labels": [
    "type/bug"
  ],
  "comments_data": [
    {
      "id": 449279298,
      "user": "Connor1996",
      "created_at": "2018-12-21T06:52:56Z",
      "body": "Please give me some logs of the TiKV before segfault occurs."
    },
    {
      "id": 449281265,
      "user": "darren",
      "created_at": "2018-12-21T06:59:23Z",
      "body": "crash happens at 2018/12/21 12:07:52 and restarted manually at 2018/12/21 14:12:42.269 \r\n```\r\n2018/12/21 12:07:47.187 INFO keys.rs:157: [region 660157] approximate keys 1485570 >= 1440000, need to do split check\r\n2018/12/21 12:07:47.895 INFO size.rs:173: [region 6589170] approximate size 169748456 >= 150994944, need to do split check\r\n2018/12/21 12:07:48.242 INFO apply.rs:902: [region 6408530] 7317664 execute admin command cmd_type: CompactLog compact_log {compact_index: 132326 compact_term: 19} at [term: 19, index: 132328]\r\n2018/12/21 12:07:48.565 INFO apply.rs:902: [region 1867884] 7785905 execute admin command cmd_type: CompactLog compact_log {compact_index: 40960 compact_term: 335} at [term: 335, index: 40962]\r\n2018/12/21 12:07:48.735 INFO apply.rs:902: [region 5551572] 7413861 execute admin command cmd_type: CompactLog compact_log {compact_index: 253670 compact_term: 424} at [term: 424, index: 253672]\r\n2018/12/21 12:07:48.943 WARN mod.rs:99: handle task Split Check Task for 6589170, auto_split: true [takes 1.049s]\r\n2018/12/21 12:07:49.071 INFO apply.rs:902: [region 1842694] 7317439 execute admin command cmd_type: CompactLog compact_log {compact_index: 100669 compact_term: 371} at [term: 371, index: 100671]\r\n2018/12/21 12:07:49.078 INFO keys.rs:157: [region 1880328] approximate keys 1479272 >= 1440000, need to do split check\r\n2018/12/21 12:07:49.232 INFO apply.rs:902: [region 1877948] 7373593 execute admin command cmd_type: CompactLog compact_log {compact_index: 149738 compact_term: 606} at [term: 606, index: 149740]\r\n2018/12/21 12:07:49.504 INFO apply.rs:902: [region 1979131] 7446247 execute admin command cmd_type: CompactLog compact_log {compact_index: 488809 compact_term: 624} at [term: 624, index: 488811]\r\n2018/12/21 12:07:50.108 INFO apply.rs:902: [region 5652370] 7331273 execute admin command cmd_type: CompactLog compact_log {compact_index: 3912413 compact_term: 111} at [term: 111, index: 3912415]\r\n2018/12/21 12:07:50.126 INFO keys.rs:157: [region 3854368] approximate keys 1506684 >= 1440000, need to do split check\r\n2018/12/21 12:07:50.136 INFO apply.rs:902: [region 2054065] 7317822 execute admin command cmd_type: CompactLog compact_log {compact_index: 468544 compact_term: 257} at [term: 257, index: 468546]\r\n2018/12/21 12:07:50.418 INFO apply.rs:902: [region 3594679] 7387181 execute admin command cmd_type: CompactLog compact_log {compact_index: 541031 compact_term: 141} at [term: 141, index: 541033]\r\n2018/12/21 12:07:50.854 INFO keys.rs:157: [region 1221583] approximate keys 1497482 >= 1440000, need to do split check\r\n2018/12/21 12:07:51.009 INFO apply.rs:902: [region 7892867] 7892870 execute admin command cmd_type: CompactLog compact_log {compact_index: 2422 compact_term: 6} at [term: 6, index: 2424]\r\n2018/12/21 12:07:51.334 INFO apply.rs:902: [region 5452452] 7601382 execute admin command cmd_type: CompactLog compact_log {compact_index: 289022 compact_term: 80} at [term: 80, index: 289024]\r\n2018/12/21 12:07:51.498 INFO keys.rs:157: [region 15203] approximate keys 1466722 >= 1440000, need to do split check\r\n2018/12/21 14:12:42.269 INFO mod.rs:26: Welcome to TiKV. \r\nRelease Version:   2.1.1\r\nGit Commit Hash:   b48f3317c162fb69a1589e48c83452c2b89efb9d\r\nGit Commit Branch: release-2.1\r\nUTC Build Time:    2018-12-17 02:25:04\r\nRust Version:      rustc 1.29.0-nightly (4f3c7a472 2018-07-17)\r\n2018/12/21 14:12:42.271 INFO config.rs:145: no advertise-addr is specified, fall back to addr.\r\n2018/12/21 14:12:42.273 INFO tikv-server.rs:405: using config: {\r\n\r\n```\r\n\r\n\r\ndb/LOG before crash happens:\r\n```\r\n2018/12/21-12:07:44.407655 7fcf191fe700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26766] Generated table #416298: 304561 keys, 5031018 bytes\r\n2018/12/21-12:07:44.407732 7fcf191fe700 EVENT_LOG_v1 {\"time_micros\": 1545365264407696, \"cf_name\": \"write\", \"job\": 26766, \"event\": \"table_file_creation\", \"file_number\": 416298, \"file_size\": 5031018, \"table_properties\": {\"data_size\": 4640465, \"index_size\": 16243, \"filter_size\": 380741, \"raw_key_size\": 13400684, \"raw_average_key_size\": 44, \"raw_value_size\": 16551895, \"raw_average_value_size\": 54, \"num_data_blocks\": 382, \"num_entries\": 304561, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:44.472411 7fcf191fe700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1390] [write] [JOB 26766] Compacted 2@4 + 8@5 files to L5 => 89374062 bytes\r\n2018/12/21-12:07:44.592698 7fcf191fe700 (Original Log Time 2018/12/21-12:07:44.588835) [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:750] [write] compacted to: base level 3 max bytes base 536870912 files[3 0 0 60 518 1407 42794] max score 0.99, MB/sec: 9.1 rd, 8.7 wr, level 5, files in(2, 8) out(10) MB in(17.5, 71.7) out(85.2), read-write-amplify(9.9) write-amplify(4.9) OK, records in: 7502854, records dropped: 305700 output_compression: LZ4\r\n2018/12/21-12:07:44.592717 7fcf191fe700 (Original Log Time 2018/12/21-12:07:44.588908) EVENT_LOG_v1 {\"time_micros\": 1545365264588878, \"job\": 26766, \"event\": \"compaction_finished\", \"compaction_time_micros\": 10255079, \"output_level\": 5, \"num_output_files\": 10, \"total_output_size\": 89374062, \"num_input_records\": 7502854, \"num_output_records\": 7197154, \"num_subcompactions\": 1, \"output_compression\": \"LZ4\", \"num_single_delete_mismatches\": 0, \"num_single_delete_fallthrough\": 0, \"lsm_state\": [3, 0, 0, 60, 518, 1407, 42794]}\r\n2018/12/21-12:07:44.592829 7fceacbf9700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/db_impl_compaction_flush.cc:975] [write] Manual compaction starting\r\n2018/12/21-12:07:44.593860 7fcf1adff700 (Original Log Time 2018/12/21-12:07:44.593828) [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/db_impl_compaction_flush.cc:1695] [write] Manual compaction from level-5 to level-6 from 'zt? .. 'zt?; will stop at (end)\r\n2018/12/21-12:07:44.593871 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1635] [write] [JOB 26767] Compacting 2@5 + 7@6 files to L6, score -1.00\r\n2018/12/21-12:07:44.593894 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1639] [write] Compaction start summary: Base version 24554 Base level 5, inputs: [416293(9286KB) 416294(8941KB)], [152912(9174KB) 365638(9022KB) 365640(9118KB) 365641(9119KB) 365642(9212KB) 365643(9127KB) 365644(7394KB)]\r\n2018/12/21-12:07:44.594109 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365264594069, \"job\": 26767, \"event\": \"compaction_started\", \"compaction_reason\": \"ManualCompaction\", \"files_L5\": [416293, 416294], \"files_L6\": [152912, 365638, 365640, 365641, 365642, 365643, 365644], \"score\": -1, \"input_data_size\": 82327230}\r\n2018/12/21-12:07:44.700761 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264700750, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 416033}\r\n2018/12/21-12:07:44.704126 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264704121, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 416032}\r\n2018/12/21-12:07:44.706293 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264706287, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 393130}\r\n2018/12/21-12:07:44.708844 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264708839, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 393129}\r\n2018/12/21-12:07:44.710861 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264710856, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366173}\r\n2018/12/21-12:07:44.713214 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264713208, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366172}\r\n2018/12/21-12:07:44.715347 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264715342, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366171}\r\n2018/12/21-12:07:44.717671 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264717666, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366170}\r\n2018/12/21-12:07:44.719988 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264719983, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366169}\r\n2018/12/21-12:07:44.722452 7fcead7ff700 EVENT_LOG_v1 {\"time_micros\": 1545365264722447, \"job\": 0, \"event\": \"table_file_deletion\", \"file_number\": 366168}\r\n2018/12/21-12:07:45.776671 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416299: 819612 keys, 9447946 bytes\r\n2018/12/21-12:07:45.776742 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365265776710, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416299, \"file_size\": 9447946, \"table_properties\": {\"data_size\": 8398305, \"index_size\": 48751, \"filter_size\": 1024581, \"raw_key_size\": 65568960, \"raw_average_key_size\": 80, \"raw_value_size\": 16392240, \"raw_average_value_size\": 20, \"num_data_blocks\": 609, \"num_entries\": 819612, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:46.985641 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416300: 832950 keys, 9460026 bytes\r\n2018/12/21-12:07:46.985727 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365266985696, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416300, \"file_size\": 9460026, \"table_properties\": {\"data_size\": 8393768, \"index_size\": 49388, \"filter_size\": 1041221, \"raw_key_size\": 66636000, \"raw_average_key_size\": 80, \"raw_value_size\": 16659000, \"raw_average_value_size\": 20, \"num_data_blocks\": 617, \"num_entries\": 832950, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:48.235754 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416301: 772185 keys, 9389133 bytes\r\n2018/12/21-12:07:48.235819 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365268235789, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416301, \"file_size\": 9389133, \"table_properties\": {\"data_size\": 8400062, \"index_size\": 46180, \"filter_size\": 965317, \"raw_key_size\": 61774800, \"raw_average_key_size\": 80, \"raw_value_size\": 15443700, \"raw_average_value_size\": 20, \"num_data_blocks\": 585, \"num_entries\": 772185, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:49.294523 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416302: 815286 keys, 9440439 bytes\r\n2018/12/21-12:07:49.294588 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365269294557, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416302, \"file_size\": 9440439, \"table_properties\": {\"data_size\": 8395504, \"index_size\": 49284, \"filter_size\": 1019205, \"raw_key_size\": 65222880, \"raw_average_key_size\": 80, \"raw_value_size\": 16305720, \"raw_average_value_size\": 20, \"num_data_blocks\": 636, \"num_entries\": 815286, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:50.311598 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416303: 764620 keys, 9369583 bytes\r\n2018/12/21-12:07:50.311664 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365270311634, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416303, \"file_size\": 9369583, \"table_properties\": {\"data_size\": 8389225, \"index_size\": 46616, \"filter_size\": 955845, \"raw_key_size\": 61169600, \"raw_average_key_size\": 80, \"raw_value_size\": 15292400, \"raw_average_value_size\": 20, \"num_data_blocks\": 611, \"num_entries\": 764620, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:51.273349 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416304: 741897 keys, 9353043 bytes\r\n2018/12/21-12:07:51.273415 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365271273384, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416304, \"file_size\": 9353043, \"table_properties\": {\"data_size\": 8401332, \"index_size\": 45499, \"filter_size\": 927429, \"raw_key_size\": 59351760, \"raw_average_key_size\": 80, \"raw_value_size\": 14837940, \"raw_average_value_size\": 20, \"num_data_blocks\": 619, \"num_entries\": 741897, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n2018/12/21-12:07:52.282090 7fcf1adff700 [/root/.cargo/git/checkouts/rust-rocksdb-82ef6e5337b3fbe6/6e57a11/librocksdb_sys/rocksdb/db/compaction_job.cc:1324] [write] [JOB 26767] Generated table #416305: 749074 keys, 9356600 bytes\r\n2018/12/21-12:07:52.282173 7fcf1adff700 EVENT_LOG_v1 {\"time_micros\": 1545365272282136, \"cf_name\": \"write\", \"job\": 26767, \"event\": \"table_file_creation\", \"file_number\": 416305, \"file_size\": 9356600, \"table_properties\": {\"data_size\": 8395663, \"index_size\": 45858, \"filter_size\": 936389, \"raw_key_size\": 59925920, \"raw_average_key_size\": 80, \"raw_value_size\": 14981480, \"raw_average_value_size\": 20, \"num_data_blocks\": 621, \"num_entries\": 749074, \"filter_policy_name\": \"rocksdb.BuiltinBloomFilter\", \"kDeletedKeys\": \"0\", \"kMergeOperands\": \"0\"}}\r\n```"
    },
    {
      "id": 449283524,
      "user": "Connor1996",
      "created_at": "2018-12-21T07:06:20Z",
      "body": "do you have a core dump"
    },
    {
      "id": 449285105,
      "user": "darren",
      "created_at": "2018-12-21T07:11:06Z",
      "body": "Sorry no. \r\nIf the crash happens again, I shall report the core dump later..."
    },
    {
      "id": 449288292,
      "user": "Connor1996",
      "created_at": "2018-12-21T07:21:46Z",
      "body": "Thanks for your feedback."
    },
    {
      "id": 449289066,
      "user": "Connor1996",
      "created_at": "2018-12-21T07:24:27Z",
      "body": "and please give me the information of region 15203, `pd-ctl region 15203`"
    },
    {
      "id": 449289398,
      "user": "darren",
      "created_at": "2018-12-21T07:25:38Z",
      "body": "```\r\n{\r\n  \"id\": 15203,\r\n  \"start_key\": \"t\\\\x80\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\xffy_i\\\\x80\\\\x00\\\\x00\\\\x00\\\\x00\\\\xff\\\\x00\\\\x00\\\\x01\\\\x03\\\\x80\\\\x00\\\\x00\\\\x00\\\\xff,8\\\\xa2\\\\xca\\\\x03\\\\x80\\\\x00\\\\x00\\\\xff\\\\x00\\\\x00\\\\x00\\\\x05\\\\xe3\\\\x00\\\\x00\\\\x00\\\\xfc\",\r\n  \"end_key\": \"t\\\\x80\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\xffy_i\\\\x80\\\\x00\\\\x00\\\\x00\\\\x00\\\\xff\\\\x00\\\\x00\\\\x01\\\\x03\\\\x80\\\\x00\\\\x00\\\\x00\\\\xff.\\\\xed\\\\x00\\\\xfb\\\\x03\\\\x80\\\\x00\\\\x00\\\\xff\\\\x00\\\\x00\\\\x00\\\\x05\\\\xe4\\\\x00\\\\x00\\\\x00\\\\xfc\",\r\n  \"epoch\": {\r\n    \"conf_ver\": 66,\r\n    \"version\": 13\r\n  },\r\n  \"peers\": [\r\n    {\r\n      \"id\": 15208,\r\n      \"store_id\": 1854\r\n    },\r\n    {\r\n      \"id\": 832010,\r\n      \"store_id\": 321151\r\n    },\r\n    {\r\n      \"id\": 6249390,\r\n      \"store_id\": 6098045\r\n    },\r\n    {\r\n      \"id\": 7309566,\r\n      \"store_id\": 7299596\r\n    },\r\n    {\r\n      \"id\": 7418481,\r\n      \"store_id\": 7315824\r\n    }\r\n  ],\r\n  \"leader\": {\r\n    \"id\": 7309566,\r\n    \"store_id\": 7299596\r\n  },\r\n  \"approximate_size\": 114,\r\n  \"approximate_keys\": 1537299\r\n}\r\n```"
    },
    {
      "id": 449358345,
      "user": "Connor1996",
      "created_at": "2018-12-21T11:00:26Z",
      "body": "I go through the split-check related code, but not find any place where may cause segfault. \r\n/cc @huachaohuang Is there any chance that RocksDB occurs segfault when iterating the keys? "
    },
    {
      "id": 449732324,
      "user": "huachaohuang",
      "created_at": "2018-12-24T13:08:02Z",
      "body": "What's the output of `addr2line -e tikv-server 0000559c2075ab51`?"
    },
    {
      "id": 449783128,
      "user": "darren",
      "created_at": "2018-12-25T01:17:02Z",
      "body": "```\r\n# addr2line -e tikv-server 0000559c2075ab51\r\n??:0\r\n```\r\n\r\nps: We have not met another segfault so far.\r\n"
    },
    {
      "id": 449833649,
      "user": "huachaohuang",
      "created_at": "2018-12-25T09:52:00Z",
      "body": "Hmmm, no idea too, maybe we need to get a core dump first :("
    }
  ]
}