{
  "issue_number": 7849,
  "title": "Progress of Backup / Restore occasionally stuck",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n```\r\nTiKV \r\nRelease Version:   4.1.0-alpha\r\nGit Commit Hash:   957655cacab1bd48100bf0b252fa93a9758848dc\r\nGit Commit Branch: master\r\nUTC Build Time:    2020-05-08 02:04:59\r\nRust Version:      rustc 1.44.0-nightly (b2e36e6c2 2020-04-22)\r\nEnable Features:   jemalloc portable sse protobuf-codec\r\nProfile:           dist_release\r\n```\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\nrun in container \r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n\r\n- deploy a cluster in gcp\r\n\r\n- restore data from `dbaas-hibernate`  and prefix `test180`  parameter as below\r\n```\r\nrestore full --send-credentials-to-tikv=true --storage=gcs://dbaas-hibernate/test180/ --pd=db-pd.tidb1261141553175334912:2379 --ca=/var/lib/cluster-client-tls/ca.crt --cert=/var/lib/cluster-client-tls/tls.crt --key=/var/lib/cluster-client-tls/tls.key\r\n```\r\n\r\n- the restore process will not complete and will not report error\r\n\r\n### What did you expect?\r\nrestore completed \r\n### What did happened?\r\nrestore process is stop in 76%, it seems a bug, log is send to @kennytm \r\ntikv log is like below \r\n```\r\n[2020/05/15 05:36:26.712 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25671] [region_id=25668]\r\n[2020/05/15 05:36:26.712 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25715] [region_id=25712]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25651] [region_id=25648]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25727] [region_id=25724]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25755] [region_id=25752]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25691] [region_id=25688]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25719] [region_id=25716]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25711] [region_id=25708]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25723] [region_id=25720]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25735] [region_id=25732]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25751] [region_id=25748]\r\n[2020/05/15 05:36:26.713 +00:00] [INFO] [peer.rs:770] [\"failed to schedule peer tick\"] [err=\"sending on a disconnected channel\"] [tick=CHECK_PEER_STALE_STATE] [peer_id=25731] [region_id=25728]\r\n```\r\n\r\nbr log is like this \r\n```\r\nI0515 05:54:43.612376       1 restore.go:86] [2020/05/15 05:54:43.612 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:43.812199       1 restore.go:86] [2020/05/15 05:54:43.812 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:44.012278       1 restore.go:86] [2020/05/15 05:54:44.011 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:44.212036       1 restore.go:86] [2020/05/15 05:54:44.211 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:44.412107       1 restore.go:86] [2020/05/15 05:54:44.411 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:44.612145       1 restore.go:86] [2020/05/15 05:54:44.612 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:44.812428       1 restore.go:86] [2020/05/15 05:54:44.812 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:45.012036       1 restore.go:86] [2020/05/15 05:54:45.011 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:45.212085       1 restore.go:86] [2020/05/15 05:54:45.211 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:45.412056       1 restore.go:86] [2020/05/15 05:54:45.411 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:45.612074       1 restore.go:86] [2020/05/15 05:54:45.611 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:45.812108       1 restore.go:86] [2020/05/15 05:54:45.811 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:46.012047       1 restore.go:86] [2020/05/15 05:54:46.011 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:46.212153       1 restore.go:86] [2020/05/15 05:54:46.212 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\nI0515 05:54:46.412007       1 restore.go:86] [2020/05/15 05:54:46.411 +00:00] [INFO] [progress.go:102] [\"Full restore\"] [progress=76.57%!](MISSING)\r\n```",
  "state": "closed",
  "created_at": "2020-05-15T06:29:29Z",
  "updated_at": "2020-07-22T03:54:16Z",
  "closed_at": "2020-07-22T03:54:16Z",
  "labels": [
    "type/bug",
    "component/backup-restore",
    "sig/migrate"
  ],
  "comments_data": [
    {
      "id": 662223303,
      "user": "overvenus",
      "created_at": "2020-07-22T03:39:45Z",
      "body": "Is it resolved now？"
    },
    {
      "id": 662226469,
      "user": "shuijing198799",
      "created_at": "2020-07-22T03:54:05Z",
      "body": "> Is it resolved now？\r\n\r\nyes, It is fix by https://github.com/tikv/tikv/pull/7917"
    }
  ]
}