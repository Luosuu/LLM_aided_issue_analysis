{
  "issue_number": 8941,
  "title": "Index out of range for slice in TableScan",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\nv3.0.14 \r\n\r\n### What did happened?\r\n```\r\n[2020/11/03 10:02:06.365 +08:00] [FATAL] [lib.rs:499] [\"index 18023998335487711277 out of range for slice of length 1153629839656069881\"] [backtrace=\"stack backtrace:\r\n   0:     0x5634f191599d - backtrace::backtrace::libunwind::trace::h958f5f3eb75b2917\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/backtrace-0.2.3/src/backtrace/libunwind.rs:54\r\n                         - backtrace::backtrace::trace::hdf994f7eb3c12b81                        at /rust/registry/src/github.com-1ecc6299db9ec823/backtrace-0.2.3/src/backtrace/mod.rs:70   1:     0x5634f190b690 - tikv_util::set_panic_hook::{{closure}}::h41912738a4270625\r\n                        at /home/jenkins/.target/release/build/backtrace-e20a32a05fd0b8fe/out/capture.rs:79\r\n   2:     0x5634f1aa88ef - std::panicking::rust_panic_with_hook::h8d2408723e9a2bd4\r\n                        at src/libstd/panicking.rs:479\r\n   3:     0x5634f1aa86cd - std::panicking::continue_panic_fmt::hb2aaa9386c4e5e80\r\n                        at src/libstd/panicking.rs:382\r\n   4:     0x5634f1ab7f35 - rust_begin_unwind\r\n                        at src/libstd/panicking.rs:309\r\n   5:     0x5634f1ac2adb - core::panicking::panic_fmt::h79e840586f23493b\r\n                        at src/libcore/panicking.rs:85\r\n   6:     0x5634f1ac2564 - core::slice::slice_index_len_fail::hf36fc625c5f88c4d\r\n                        at src/libcore/slice/mod.rs:2568\r\n   7:     0x5634f11aa070 - <core::ops::range::Range<usize> as core::slice::SliceIndex<[T]>>::index::h79d0be9ad221551e\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/slice/mod.rs:2745\r\n                         - <core::ops::range::RangeTo<usize> as core::slice::SliceIndex<[T]>>::index::ha72ff735f7d1dad7\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/slice/mod.rs:2791\r\n                         - core::slice::<impl core::ops::index::Index<I> for [T]>::index::ha2f71b0a90b76f72\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/slice/mod.rs:2551\r\n                         - <alloc::vec::Vec<T> as core::ops::index::Index<I>>::index::h15106cc10f64e98b\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/vec.rs:1756\r\n                         - <protobuf::repeated::RepeatedField<T> as core::convert::AsRef<[T]>>::as_ref::h44ddf1b4ddcd9d89\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/protobuf-2.0.6/src/repeated.rs:366\r\n                         - protobuf::repeated::RepeatedField<T>::to_vec::h801f12169db5f6d5\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/protobuf-2.0.6/src/repeated.rs:310\r\n                         - <protobuf::repeated::RepeatedField<T> as core::clone::Clone>::clone::hee6afe698f6ab803\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/protobuf-2.0.6/src/repeated.rs:318\r\n                         - <tipb::schema::ColumnInfo as core::clone::Clone>::clone::h1a51dc1522211756\r\n                        at /rust/git/checkouts/tipb-ef7de851bf2183d8/d2c068e/src/schema.rs:242\r\n                         - <core::iter::adapters::Cloned<I> as core::iter::traits::iterator::Iterator>::fold::{{closure}}::h2468cbd8a6633938\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/iter/adapters/mod.rs:274\r\n                         - <core::slice::Iter<T> as core::iter::traits::iterator::Iterator>::fold::hd9fe9c302f792a0e\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/slice/mod.rs:3158\r\n                         - <core::iter::adapters::Cloned<I> as core::iter::traits::iterator::Iterator>::fold::h53ac817fcc70f147\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/iter/adapters/mod.rs:274\r\n                         - core::iter::traits::iterator::Iterator::for_each::hdfcf0960422d06a1\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/iter/traits/iterator.rs:604\r\n                         - <alloc::vec::Vec<T> as alloc::vec::SpecExtend<T,I>>::spec_extend::h3590a141a30f0798\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/vec.rs:1926\r\n                         - <alloc::vec::Vec<T> as alloc::vec::SpecExtend<&T,I>>::spec_extend::he861b51fd76d3731\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/vec.rs:1976\r\n                         - alloc::vec::Vec<T>::extend_from_slice::h842d36d6ed46e68b\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/vec.rs:1430\r\n                         - alloc::slice::hack::to_vec::h56c3b1556105f439\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/slice.rs:159\r\n                         - alloc::slice::<impl [T]>::to_vec::hedc6856d81ca603c\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/slice.rs:379\r\n   8:     0x5634f1194d30 - protobuf::repeated::RepeatedField<T>::to_vec::ha54a69034175c4f1\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/protobuf-2.0.6/src/repeated.rs:310\r\n                         - tikv::coprocessor::dag::executor::table_scan::<impl tikv::coprocessor::dag::executor::scan::ScanExecutor<S,tikv::coprocessor::dag::executor::table_scan::TableInnerExecutor>>::table_scan::hd1a2bab11e222382\r\n                        at src/coprocessor/dag/executor/table_scan.rs:71\r\n   9:     0x5634f11aebfd - tikv::coprocessor::dag::builder::DAGBuilder::build_normal_first_executor::h978fe4ec58a6886a\r\n                        at src/coprocessor/dag/builder.rs:344\r\n                         - tikv::coprocessor::dag::builder::DAGBuilder::build_normal::ha5916eed30f454c6\r\n                        at src/coprocessor/dag/builder.rs:295\r\n                         - tikv::coprocessor::dag::builder::DAGBuilder::build_dag::hed1b9e9a97d9f72c\r\n                        at src/coprocessor/dag/builder.rs:389\r\n                         - tikv::coprocessor::dag::builder::DAGBuilder::build::hd39832b29052f25c\r\n                        at src/coprocessor/dag/builder.rs:508\r\n  10:     0x5634f11aaa87 - tikv::coprocessor::endpoint::Endpoint<E>::parse_request::{{closure}}::hd28c56176a93f7f6\r\n                        at src/coprocessor/endpoint.rs:134\r\n                         - core::ops::function::FnOnce::call_once{{vtable.shim}}::h691ff0f091610a78\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/ops/function.rs:231\r\n  11:     0x5634f117169c - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::h81260ed9341d34b7\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/boxed.rs:746\r\n  12:     0x5634f116ccda - tikv::coprocessor::endpoint::Endpoint<E>::handle_unary_request_impl::{{closure}}::hd10381b532c813d3\r\n                        at src/coprocessor/endpoint.rs:253\r\n                         - <futures::future::and_then::AndThen<A,B,F> as futures::future::Future>::poll::{{closure}}::{{closure}}::h261c8daed4716cfd\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/and_then.rs:34\r\n                         - core::result::Result<T,E>::map::hab26168df77103b9\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/result.rs:460\r\n                         - <futures::future::and_then::AndThen<A,B,F> as futures::future::Future>::poll::{{closure}}::h4b8365d61f3288c4\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/and_then.rs:33\r\n                         - futures::future::chain::Chain<A,B,C>::poll::hdbe84aabb5b9c941\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/chain.rs:39\r\n                         - <futures::future::and_then::AndThen<A,B,F> as futures::future::Future>::poll::hd263d9cbbe77468f\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/and_then.rs:32\r\n                         - futures::future::chain::Chain<A,B,C>::poll::h434adebb2143c6cb\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/chain.rs:26\r\n                         - <futures::future::and_then::AndThen<A,B,F> as futures::future::Future>::poll::ha6134ee287cb0d41\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/and_then.rs:32\r\n                         - futures::future::chain::Chain<A,B,C>::poll::h30da6b12de87d3fd\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/chain.rs:26\r\n                         - <futures::future::then::Then<A,B,F> as futures::future::Future>::poll::hb3ff001fac7d1878\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/then.rs:32\r\n                         - <futures::future::lazy::Lazy<F,R> as futures::future::Future>::poll::hb4d43cf2a2bfa24f\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/lazy.rs:82\r\n                         - <futures::sync::oneshot::Execute<F> as futures::future::Future>::poll::h737b21e82236d37b\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/sync/oneshot.rs:589\r\n  13:     0x5634f197b36f - <alloc::boxed::Box<F> as futures::future::Future>::poll::h7e49c480ed4507e4\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/future/mod.rs:113\r\n                         - futures::task_impl::Spawn<T>::poll_future_notify::{{closure}}::he729c3ff6aec31d3\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/mod.rs:329\r\n                         - futures::task_impl::Spawn<T>::enter::{{closure}}::h59ffeec01da0dd3b\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/mod.rs:399\r\n                         - futures::task_impl::std::set::h641625099c89b458\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/std/mod.rs:83\r\n                         - futures::task_impl::Spawn<T>::enter::hbff05f799cf1ed77\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/mod.rs:399\r\n                         - futures::task_impl::Spawn<T>::poll_fn_notify::hb007dc439b5be953\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/mod.rs:291\r\n                         - futures::task_impl::Spawn<T>::poll_future_notify::h67f3228158c8d022\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/futures-0.1.29/src/task_impl/mod.rs:329\r\n                         - tokio_threadpool::task::Task::run::{{closure}}::h274697493d9892f6\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/task/mod.rs:145\r\n                         - core::ops::function::FnOnce::call_once::h4aab0c9e318c40f1\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/ops/function.rs:231\r\n                         - <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once::h5cc6b3d4446d2356\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panic.rs:309\r\n                         - std::panicking::try::do_call::h6d575ae297b845fe\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panicking.rs:294\r\n                         - std::panicking::try::ha584e708981695db\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250//src/libpanic_abort/lib.rs:29\r\n                         - std::panic::catch_unwind::he25e94b3b99e27d4\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panic.rs:388\r\n                         - tokio_threadpool::task::Task::run::ha50686a449a06e48\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/task/mod.rs:130\r\n                         - tokio_threadpool::worker::Worker::run_task2::hbb4f7ee0728e41f4\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:567\r\n                         - tokio_threadpool::worker::Worker::run_task::hca162051937f6f9b\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:459\r\n  14:     0x5634f197870c - tokio_threadpool::worker::Worker::try_run_owned_task::hd8594ce2028c2a32\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:390\r\n                         - tokio_threadpool::worker::Worker::try_run_task::hb3c5fa53fa7552c5\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:297\r\n                         - tokio_threadpool::worker::Worker::run::h8810cc913542541d\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:241\r\n  15:     0x5634f1977fb7 - tokio_threadpool::worker::Worker::do_run::{{closure}}::{{closure}}::h0f1e14b478ad4694\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:129\r\n                         - tokio_executor::global::with_default::{{closure}}::hf2729b146997c90c\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-executor-0.1.7/src/global.rs:209\r\n                         - std::thread::local::LocalKey<T>::try_with::h1f4b12f71776c4fc\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/local.rs:299\r\n                         - std::thread::local::LocalKey<T>::with::hbccdd888035cf169\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/local.rs:245\r\n                         - tokio_executor::global::with_default::h17ed700691c60516\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-executor-0.1.7/src/global.rs:178\r\n                         - tokio_threadpool::worker::Worker::do_run::{{closure}}::h57b47e27f13191da\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:125\r\n                         - std::thread::local::LocalKey<T>::try_with::ha1ea9a66320f0c2e\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/local.rs:299\r\n                         - std::thread::local::LocalKey<T>::with::h3c584cfbd7ab658c\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/local.rs:245\r\n                         - tokio_threadpool::worker::Worker::do_run::h7fcd86ab47557f7a\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/worker/mod.rs:116\r\n                         - tokio_threadpool::pool::Pool::spawn_thread::{{closure}}::h8851039b750bb2bc\r\n                        at /rust/registry/src/github.com-1ecc6299db9ec823/tokio-threadpool-0.1.13/src/pool/mod.rs:344\r\n                         - std::sys_common::backtrace::__rust_begin_short_backtrace::hd79b67d8f8eba348\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/sys_common/backtrace.rs:77\r\n  16:     0x5634f1977c98 - std::thread::Builder::spawn_unchecked::{{closure}}::{{closure}}::ha5d7eebfe897bb2e\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/mod.rs:470\r\n                         - <std::panic::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once::he71fa918773a7469\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panic.rs:309\r\n                         - std::panicking::try::do_call::he8c710b9e6e243bb\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panicking.rs:294\r\n                         - std::panicking::try::hce5556c51b827fb5\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250//src/libpanic_abort/lib.rs:29\r\n                         - std::panic::catch_unwind::h2c70332fc0b318f7\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/panic.rs:388\r\n                         - std::thread::Builder::spawn_unchecked::{{closure}}::h88bf4824f0683e99\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libstd/thread/mod.rs:469\r\n                         - core::ops::function::FnOnce::call_once{{vtable.shim}}::h7b9698000aa5ff1f\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/libcore/ops/function.rs:231\r\n  17:     0x5634f1ab6f3e - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::he71721d2d956d451\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/boxed.rs:746\r\n  18:     0x5634f1ab926b - <alloc::boxed::Box<F> as core::ops::function::FnOnce<A>>::call_once::he520045b8d28ce5c\r\n                        at /rustc/0e4a56b4b04ea98bb16caada30cb2418dd06e250/src/liballoc/boxed.rs:746\r\n                         - std::sys_common::thread::start_thread::h2e98d1272dc6d74b\r\n                        at src/libstd/sys_common/thread.rs:13\r\n                         - std::sys::unix::thread::Thread::new::thread_start::h18485805666ccd3c\r\n                        at src/libstd/sys/unix/thread.rs:79\r\n  19:     0x7f2a27e3add4 - start_thread\r\n  20:     0x7f2a27541eac - __clone\r\n  21:                0x0 - <unknown>\"] [location=src/libcore/slice/mod.rs:2568] [thread_name=cop-normal1]\r\n```",
  "state": "closed",
  "created_at": "2020-11-03T03:10:08Z",
  "updated_at": "2022-01-07T18:48:58Z",
  "closed_at": "2022-01-07T18:48:58Z",
  "labels": [
    "type/bug",
    "sig/coprocessor",
    "severity/major",
    "status/cannot-reproduce"
  ],
  "comments_data": [
    {
      "id": 723904138,
      "user": "andylokandy",
      "created_at": "2020-11-09T09:57:07Z",
      "body": "It seems like the proto message is corrupted. Specifically, the `data` field in `Request` message."
    }
  ]
}