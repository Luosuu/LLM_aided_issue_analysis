{
  "issue_number": 15347,
  "title": "[dr-autosync] after running in sync_recovery for 10min, hit 9005 error ",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n<!-- You can run `tikv-server --version` -->\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Release Version:   6.5.3\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Edition:           Community\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Git Commit Hash:   cb0dab3e4e0f3081966e871057272a40aa7ffc2d\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Git Commit Branch: heads/refs/tags/v6.5.3-flashback\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"UTC Build Time:    Unknown (env var does not exist when building)\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Rust Version:      rustc 1.67.0-nightly (96ddd32c4 2022-11-14)\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Enable Features:   pprof-fp jemalloc mem-profiling portable sse test-engine-kv-rocksdb test-engine-raft-raft-engine cloud-aws cloud-gcp cloud-azure\"]\r\n[2023/08/17 03:00:49.417 +08:00] [INFO] [lib.rs:90] [\"Profile:           dist_release\"]\r\n\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\n\r\n### Steps to reproduce\r\n<!-- If possible, provide a recipe for reproducing the error. A complete runnable program is good. -->\r\n\r\n### What did you expect?\r\nNo 9005 error reported.\r\n\r\n### What did happened?\r\n```\r\n[2023/08/17 05:46:31.446 +08:00] [INFO] [utils.go:60] [\"current status is \"] [curStatus=sync_recover]\r\n....\r\n[2023/08/17 05:47:11.429 +08:00] [INFO] [workload.go:771] [\"[2023-08-16 21:47:11] execute run failed, err exec SELECT c_discount, c_last, c_credit, w_tax FROM customer, warehouse WHERE w_id = ? AND c_w_id = w_id AND c_d_id = ? AND c_id = ?(wID=827,dID=1,cID=1750) failed Error 9004: Resolve lock timeout\\r\\n\"]\r\n[2023/08/17 05:47:15.080 +08:00] [INFO] [workload.go:771] [\"[2023-08-16 21:47:15] execute run failed, err exec UPDATE warehouse SET w_ytd = w_ytd + ? WHERE w_id = ? failed Error 1205: Lock wait timeout exceeded; try restarting transaction\\r\\n\"]\r\n[2023/08/17 05:47:15.091 +08:00] [INFO] [workload.go:771] [\"[2023-08-16 21:47:15] execute run failed, err exec SELECT s_i_id, s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM stock WHERE (s_w_id, s_i_id) IN ((?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?)) FOR UPDATE failed Error 9005: Region is unavailable\\r\\n\"]\r\n[2023/08/17 05:47:15.091 +08:00] [INFO] [workload.go:790] [\"workload run with errors.\"]\r\n...\r\n[2023/08/17 05:47:31.460 +08:00] [INFO] [utils.go:60] [\"current status is \"] [curStatus=sync_recover]\r\n```\r\n\r\n```\r\ntidb1-0/tiup.deploy.tidb-4000.log/log/tidb.log:[2023/08/17 05:47:10.919 +08:00] [WARN] [session.go:2242] [\"run statement failed\"] [conn=3046803895171941323] [schemaVersion=64] [error=\"[tikv:9005]Region is unavailable\"] [session=\"{\\n  \\\"currDBName\\\": \\\"tpcc\\\",\\n  \\\"id\\\": 3046803895171941323,\\n  \\\"preparedStmtCount\\\": 63,\\n  \\\"status\\\": 3,\\n  \\\"strictMode\\\": true,\\n  \\\"txn\\\": \\\"443605946167722038\\\",\\n  \\\"user\\\": {\\n    \\\"Username\\\": \\\"root\\\",\\n    \\\"Hostname\\\": \\\"10.200.39.249\\\",\\n    \\\"CurrentUser\\\": false,\\n    \\\"AuthUsername\\\": \\\"root\\\",\\n    \\\"AuthHostname\\\": \\\"%\\\"\\n  }\\n}\"]\r\ntidb1-0/tiup.deploy.tidb-4000.log/log/tidb.log:[2023/08/17 05:47:10.919 +08:00] [INFO] [conn.go:1181] [\"command dispatched failed\"] [conn=3046803895171941323] [connInfo=\"id:3046803895171941323, addr:10.200.39.249:55966 status:11, collation:utf8mb4_general_ci, user:root\"] [command=Execute] [status=\"inTxn:1, autocommit:1\"] [sql=\"SELECT s_i_id, s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM stock WHERE (s_w_id, s_i_id) IN ((?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?)) FOR UPDATE [arguments: (893, 4142, 893, 72494, 893, 90084, 893, 23585, 893, 18465, 893, 6014, 893, 57382)]\"] [txn_mode=PESSIMISTIC] [timestamp=443605946167722038] [err=\"[tikv:9005]Region is unavailable\\nSELECT s_i_id, s_quantity, s_data, s_dist_01, s_dist_02, s_dist_03, s_dist_04, s_dist_05, s_dist_06, s_dist_07, s_dist_08, s_dist_09, s_dist_10 FROM stock WHERE (s_w_id, s_i_id) IN ((?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?)) FOR UPDATE [arguments: (893, 4142, 893, 72494, 893, 90084, 893, 23585, 893, 18465, 893, 6014, 893, 57382)]\\ngithub.com/pingcap/tidb/server.(*clientConn).executePreparedStmtAndWriteResult\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/conn_stmt.go:288\\ngithub.com/pingcap/tidb/server.(*clientConn).executePlanCacheStmt\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/conn_stmt.go:225\\ngithub.com/pingcap/tidb/server.(*clientConn).handleStmtExecute\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/conn_stmt.go:217\\ngithub.com/pingcap/tidb/server.(*clientConn).dispatch\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/conn.go:1430\\ngithub.com/pingcap/tidb/server.(*clientConn).Run\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/conn.go:1152\\ngithub.com/pingcap/tidb/server.(*Server).onConn\\n\\t/home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tidb/server/server.go:648\\nruntime.goexit\\n\\t/usr/local/go/src/runtime/asm_amd64.s:1594\"]\r\n```\r\n\r\n",
  "state": "closed",
  "created_at": "2023-08-17T08:45:01Z",
  "updated_at": "2023-08-22T03:50:32Z",
  "closed_at": "2023-08-22T03:50:32Z",
  "labels": [
    "type/bug",
    "severity/major",
    "may-affects-5.2",
    "may-affects-5.3",
    "may-affects-5.4",
    "may-affects-6.1",
    "affects-6.5",
    "affects-7.1"
  ],
  "comments_data": [
    {
      "id": 1685686974,
      "user": "mayjiang0203",
      "created_at": "2023-08-21T05:43:57Z",
      "body": "/assign @nolouch\r\n/severity major\r\nMark it major or can't reproduce till now."
    },
    {
      "id": 1687374213,
      "user": "mayjiang0203",
      "created_at": "2023-08-22T03:50:32Z",
      "body": "same with https://github.com/tikv/tikv/issues/15366, so close it."
    }
  ]
}