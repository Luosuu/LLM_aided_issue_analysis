{
  "issue_number": 12919,
  "title": "redhat8.4 OS , v6.1.0 add \"data-encryption-method\", reload tikv fail ",
  "body": "## Bug Report\r\n\r\n<!-- Thanks for your bug report! Don't worry if you can't fill out all the sections. -->\r\n\r\n### What version of TiKV are you using?\r\n[root@tikv-0 bin]# ./tikv-server --version\r\nTiKV \r\nRelease Version:   6.1.0\r\nEdition:           Community\r\nGit Commit Hash:   080d086832ae5ce2495352dccaf8df5d40f30687\r\nGit Commit Branch: heads/refs/tags/v6.1.0\r\nUTC Build Time:    2022-06-10 11:22:39\r\nRust Version:      rustc 1.60.0-nightly (1e12aef3f 2022-02-13)\r\nEnable Features:   jemalloc mem-profiling portable sse test-engine-kv-rocksdb test-engine-raft-raft-engine cloud-aws cloud-gcp cloud-azure\r\nProfile:           dist_release\r\n[root@tikv-0 bin]# \r\n\r\n\r\n### What operating system and CPU are you using?\r\n<!-- If you're using Linux, you can run `cat /proc/cpuinfo` -->\r\n\r\n### Steps to reproduce\r\n1. create key file in tikv nodes\r\n\"echo 603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4 > /tiup/deploy/master_key\"\r\n2. edit-config in tiup to add:\r\n[security.encryption]\r\ndata-encryption-method='aes256-ctr'\r\n[security.encryption.master-key]\r\ntype='file'\r\npath='/tiup/deploy/master_key'\r\n3. tiup cluster reload -R tikv\r\n\r\n### What did you expect?\r\nreload successfully\r\n\r\n### What did happened?\r\n[2022/06/27 20:38:02.216 +08:00] [INFO] [mod.rs:102] [\"encryption: found both of key dictionary and file dictionary.\"]\r\n[2022/06/27 20:38:02.216 +08:00] [INFO] [mod.rs:500] [\"encryption is enabled. method = Aes256Ctr\"]\r\n[2022/06/27 20:38:05.274 +08:00] [FATAL] [lib.rs:491] [\"failed to open raft engine: Other(\\\"[components/raft_log_engine/src/engine.rs:464]: IO Error: Other error [components/encryption/src/crypter.rs:83]: Nonce + Counter must be 12/16 bytes, 0\\\")\"] [backtrace=\"   0: tikv_util::set_panic_hook::{{closure}}\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/tikv_util/src/lib.rs:490:18\\n   1: std::panicking::rust_panic_with_hook\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:702:17\\n   2: std::panicking::begin_panic_handler::{{closure}}\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:588:13\\n   3: std::sys_common::backtrace::__rust_end_short_backtrace\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sys_common/backtrace.rs:138:18\\n   4: rust_begin_unwind\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/panicking.rs:584:5\\n   5: core::panicking::panic_fmt\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/panicking.rs:143:14\\n   6: core::result::unwrap_failed\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/result.rs:1749:5\\n   7: core::result::Result<T,E>::expect\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/result.rs:1022:23\\n      <raft_log_engine::engine::RaftLogEngine as server::server::ConfiguredRaftEngine>::build\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/server/src/server.rs:1434:13\\n      server::server::TiKvServer<CER>::init_raw_engines\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/server/src/server.rs:1468:27\\n   8: server::server::run_impl\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/server/src/server.rs:129:35\\n      server::server::run_tikv\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/components/server/src/server.rs:163:5\\n   9: tikv_server::main\\n             at /home/jenkins/agent/workspace/build-common/go/src/github.com/pingcap/tikv/cmd/tikv-server/src/main.rs:189:5\\n  10: core::ops::function::FnOnce::call_once\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/core/src/ops/function.rs:227:5\\n      std::sys_common::backtrace::__rust_begin_short_backtrace\\n             at /rust/toolchains/nightly-2022-02-14-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/library/std/src/sys_common/backtrace.rs:122:18\\n  11: main\\n  12: __libc_start_main\\n  13: <unknown>\\n\"] [location=components/server/src/server.rs:1435] [thread_name=main]\r\n~                                   ",
  "state": "closed",
  "created_at": "2022-06-27T12:46:01Z",
  "updated_at": "2022-06-29T01:45:18Z",
  "closed_at": "2022-06-29T01:45:17Z",
  "labels": [
    "type/bug"
  ],
  "comments_data": [
    {
      "id": 1167310442,
      "user": "seiya-annie",
      "created_at": "2022-06-27T12:47:54Z",
      "body": "[tikv_reload_fail.tar.gz](https://github.com/tikv/tikv/files/8992083/tikv_reload_fail.tar.gz)\r\n"
    },
    {
      "id": 1169445380,
      "user": "tabokie",
      "created_at": "2022-06-29T01:45:17Z",
      "body": "Only support to enable encryption on a fresh node. Won't work unless https://github.com/tikv/tikv/pull/12272 is merged."
    }
  ]
}